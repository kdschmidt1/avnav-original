!function(){var e,t={90515:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return gP}});var r=n(67964),o={log:function(e){if(avnav&&avnav.debugMode)try{console.log(e)}catch(e){}},inherits:function(e,t){if(void 0===t)throw"parent is undefined for inherit to "+e;e.prototype=Object.create(t.prototype),e.prototype.super_=t.prototype,e.prototype.base_=t}};window.SVGElement||(window.SVGElement=function(){});var i=o,a=n(79804),s=n.n(a),l=n(72598),u=n.n(l);function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}var p=function e(t,n){if(t===n)return!0;if(void 0===t)return!1;if(void 0===n)return!1;if(c(n)!==c(t))return!1;if(n instanceof Date&&t instanceof Date)return n.getTime()===t.getTime();if(n instanceof Array&&t instanceof Array){if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++){if(!e(t[r],n[r]))return!1}return!0}if(n instanceof Object&&t instanceof Object){var o=Object.keys(t),i=Object.keys(n);if(o.length!==i.length)return!1;for(var a=0;a<o.length;a++){var s=o[a];if(!Object.prototype.hasOwnProperty.call(n,s))return!1;if(!e(t[s],n[s]))return!1}return!0}return t===n},f=function(e,t){return void 0===e&&void 0===t||void 0!==e&&(void 0!==t&&(c(t)===c(e)&&(t instanceof Array&&e instanceof Array?u()(e,t):t instanceof Date&&e instanceof Date?t.getTime()==e.getTime():t instanceof Object&&e instanceof Object?s()(t,e):e==t)))};function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}var m=function(){};m.endsWith=function(e,t){return-1!==e.indexOf(t,e.length-t.length)},m.startsWith=function(e,t){return 0==e.indexOf(t,0)},m.addEntryToListItem=function(e,t,n,r,o){e.forEach((function(e){e[t]===n&&(e[r]=o)}))},m.compareProperties=function(e,t,n){if(!e!=!t)return!0;for(var r in n)if(!f(e[r],t[r]))return!0;return!1},m.entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},m.escapeHtml=function(e){return String(e).replace(/[&<>"'\/]/g,(function(e){return m.entityMap[e]}))},m.parseXml=function(e){var t=void 0;window.DOMParser?t=(new DOMParser).parseFromString(e,"text/xml"):((t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e));return t},m.getExt=function(e){if(e)return e.replace(/.*\./,"").toLocaleLowerCase()},m.filteredAssign=function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),n={};for(var r in e){var o=e[r];if(o)for(var i in t)i in o&&(n[i]=o[i])}return n},m.templateReplace=function(e,t){if("object"!==h(t))return e;for(var n in t)e=e.replace("${"+n+"}",t[n]);return e},m.keysToStr=function(e){var t={};for(var n in e)t[n]=n+"";return t},m.getParam=function(e){var t=RegExp(e+"[^&]+").exec(window.location.search);return decodeURIComponent(t?t.toString().replace(/^[^=]+./,""):"")},m.to360=function(e){for(;e<360;)e+=360;return e%360},m.to180=function(e){return to360(e+180)-180},m.radians=function(e){return e*Math.PI/180},m.degrees=function(e){return 180*e/Math.PI},m.toCart=function(e){return[e[1]*Math.sin(m.radians(e[0])),e[1]*Math.cos(m.radians(e[0]))]},m.toPol=function(e){return[m.to360(90-m.degrees(Math.atan2(e[1],e[0]))),Math.sqrt(e[0]*e[0]+e[1]*e[1])]},m.addPolar=function(e,t){return e=m.toCart(e),t=m.toCart(t),m.toPol([e[0]+t[0],e[1]+t[1]])};var d=m,v=n(75609),y=n.n(v),g=n.p+"images/GreyBubble40.png",b=n.p+"images/RedBubble40.png",w=n.p+"images/GreenBubble40.png",k=n.p+"images/YellowBubble40.png",C=(n.p,n.p,n.p,{AisCenterMode:{NONE:0,GPS:1,MAP:2},Point:function(e,t){this.lon=e||0,this.lat=t||0}});C.Point.prototype.fromCoord=function(e){return this.lon=e[0],this.lat=e[1],this},C.Point.prototype.assign=function(e){return e.lon=this.lon,e.lat=this.lat,e},C.Point.prototype.fromPlain=function(e){return this.lon=e.lon,this.lat=e.lat,this},C.Point.prototype.compare=function(e){return!!e&&(e.lon==this.lon&&e.lat==this.lat)},C.Point.prototype.toCoord=function(){return[this.lon,this.lat]},C.Point.prototype.clone=function(){return new C.Point(this.lon,this.lat)},C.WayPoint=function(e,t,n){C.Point.call(this,e,t),this.name=n,this.routeName=void 0},i.inherits(C.WayPoint,C.Point),C.WayPoint.prototype.compare=function(e){if(!e)return!1;var t=C.Point.prototype.compare.call(this,e);return t?!(e instanceof C.WayPoint)||this.routeName==e.routeName:t},C.WayPoint.fromPlain=function(e){return e?new C.WayPoint(e.lon,e.lat,e.name):new C.WayPoint},C.WayPoint.prototype.clone=function(){var e=new C.WayPoint(this.lon,this.lat,this.name?this.name.slice(0):null);return e.routeName=void 0!==this.routeName?this.routeName.slice(0):void 0,e},C.WayPoint.prototype.update=function(e){var t=!1;return void 0!==e.lon&&(e.lon!=this.lon&&(t=!0),this.lon=e.lon),void 0!==e.lat&&(e.lat!=this.lat&&(t=!0),this.lat=e.lat),void 0!==e.name&&(this.name=e.name.slice(0)),void 0!==e.routeName&&(this.routeName=e.routeName.slice(0)),t},C.WayPoint.MOB="MOB",C.TrackPoint=function(e,t,n,r,o){C.Point.call(this,e,t),this.ts=n,this.speed=r||0,this.opt_course=o||0},C.TrackPoint.prototype.clone=function(){var e=new C.TrackPoint;return y()(e,this),e},i.inherits(C.TrackPoint,C.Point),C.Distance=function(){this.dts=0,this.course=0},C.Cpa=function(){this.src=new C.Point(0,0),this.dst=new C.Point(0,0),this.crosspoint=void 0,this.cpa=0,this.tcpa=-1,this.front=void 0},C.Ais=function(){};var S=C,E=n(99275),O={computeDistance:function(e,t,n){var r=e,o=t,i=new S.Distance,a=new E.A(r.lat,r.lon),s=new E.A(o.lat,o.lon);return n?(i.dts=a.rhumbDistanceTo(s),i.course=a.rhumbBearingTo(s)):(i.dts=a.distanceTo(s),i.course=a.initialBearingTo(s)),i},computeXte:function(e,t,n){var r=new E.A(e.lat,e.lon),o=new E.A(t.lat,t.lon);return new E.A(n.lat,n.lon).crossTrackDistanceTo(r,o)},computeRhumbXte:function(e,t,n){var r=new E.A(e.lat,e.lon),o=new E.A(t.lat,t.lon),i=new E.A(n.lat,n.lon),a=o.rhumbBearingTo(r)-o.rhumbBearingTo(i);return o.rhumbDistanceTo(i)*Math.sin(a*Math.PI/180)},computeCoursePoints:function(e,t,n,r){var o=new E.A(e.lat,e.lon),i=new E.A(t.lat,t.lon),a=[o];if(isNaN(n)||n<1)return a.push(i),a;void 0===r&&(r=10*O.NM);var s=o.distanceTo(i);if(s<=r)return a.push(i),a;var l=s/r;l<2&&(l=2);var u=100/l;n<u&&(n=u);for(var c=void 0,p=n;p<=100;p+=n)c=o.intermediatePointTo(i,p/100),a.push(c);return c&&c.lon===i.lon&&c.lat===i.lat||a.push(i),a},checkInverseCourse:function(e,t){var n=(e+180)%360;return Math.abs(t-e)<Math.abs(t-n)?1:-1},computeCpa:function(e,t,n,r){var o=new S.Cpa,i=new E.A(e.lat,e.lon),a=new E.A(t.lat,t.lon),s=r?i.rhumbDistanceTo(a):i.distanceTo(a);if(s<.1);o.curdistance=s;var l=r?i.rhumbBearingTo(a):i.initialBearingTo(a);o.tcpa=0,o.cpa=s;var u=6371e6*Math.PI,c=O.computeApproach(l,s,e.course,e.speed,t.course,t.speed,n.minAISspeed,u);if(void 0!==c.dd&&void 0!==c.ds){var p=r?i.rhumbDestinationPoint(c.dd,e.course):i.destinationPoint(c.dd,e.course);o.crosspoint=new S.Point(p.lon,p.lat)}if(!c.tm)return o.tcpa=0,o.cpa=s,o.front=void 0,o;var f=r?i.rhumbDestinationPoint(c.dms,e.course):i.destinationPoint(c.dms,e.course),h=r?a.rhumbDestinationPoint(c.dms,t.course):a.destinationPoint(c.dmd,t.course);return o.src.lon=f.lon,o.src.lat=f.lat,o.dst.lon=h.lon,o.dst.lat=h.lat,o.cpa=r?f.rhumbDistanceTo(h):f.distanceTo(h),o.tcpa=c.tm,(o.cpa>s||c.tm<0)&&(o.cpa=s),void 0!==c.td&&void 0!==c.ts?o.front=c.ts<c.td?1:0:c.tm>0?o.front=-1:o.front=void 0,o},computeApproach:function(e,t,n,r,o,i,a,s){var l={},u=(e-n)/180*Math.PI,c=(e-o)/180*Math.PI,p=Math.cos(u),f=Math.sin(u),h=Math.cos(c),m=Math.sin(c);if(i>a&&r>a){try{l.td=t/(i*(p/f*m-h)),l.ts=t/(r*(p-f*h/m))}catch(e){}void 0!==l.td&&void 0!==l.ts&&(l.ds=r*l.ts,l.dd=i*l.td,void 0!==s&&(Math.abs(l.ds)>s||Math.abs(l.dd)>s)&&(l.td=void 0,l.ts=void 0,l.ds=void 0,l.dd=void 0))}var d=r*r+i*i-2*r*i*(p*h+f*m);return d<1e-6&&d>-1e-6?(l.tm=void 0,l):(l.tm=t*(p*r-h*i)/d,l.dms=r*l.tm,l.dmd=i*l.tm,l)},computeTarget:function(e,t,n,r){var o=new E.A(e.lat,e.lon),i=r?o.rhumbDestinationPoint(n,t):o.destinationPoint(n,t);return new S.Point(i.lon,i.lat)},computeLegInfo:function(e,t,n){var r=Oe.getData(ve.nav.routeHandler.useRhumbLine),o={markerCourse:void 0,markerCourseGreatCircle:void 0,markerCourseRhumbLine:void 0,markerDistance:void 0,markerDistanceGreatCircle:void 0,markerDistanceRhumbLine:void 0,markerVmg:void 0,markerEta:void 0,markerXte:void 0};if(o.markerWp=e,t.valid){var i=new E.A(t.lat,t.lon),a=new E.A(e.lat,e.lon);if(o.markerCourseGreatCircle=i.initialBearingTo(a),o.markerCourseRhumbLine=i.rhumbBearingTo(a),o.markerDistanceGreatCircle=i.distanceTo(a),o.markerDistanceRhumbLine=i.rhumbDistanceTo(a),r?(o.markerCourse=o.markerCourseRhumbLine,o.markerDistance=o.markerDistanceRhumbLine):(o.markerCourse=o.markerCourseGreatCircle,o.markerDistance=o.markerDistanceGreatCircle),o.markerVmg=t.speed*Math.cos(Math.PI/180*(o.markerCourse-t.course)),t.rtime&&o.markerVmg>0){var s=t.rtime.getTime()+o.markerDistance/o.markerVmg*1e3,l=new Date(Math.round(s));o.markerEta=l}else o.markerEta=null;o.markerXte=n?r?O.computeRhumbXte(n,e,t):O.computeXte(n,e,t):0}return o},NM:1852},P=O,D=function(e){return!e||isNaN(e.lat)||isNaN(e.lon)?"-----":this.formatLonLatsDecimal(e.lat,"lat")+", "+this.formatLonLatsDecimal(e.lon,"lon")};D.parameters=[];var T=function(e,t,n,r,o){var i="";if(e=parseFloat(e),isNaN(e)){for(a="";t>0;)a+="-",t--;return a}void 0!==r&&r&&(i=" "),e<0&&(e=-e,i="-");var a=(o?"":i)+e.toFixed(n),s=10;for(t-=1;t>0;)e<s&&(a=o?"0"+a:" "+a),s*=10,t-=1;return o?i+a:a};T.parameters=[{name:"fix",type:"NUMBER"},{name:"fract",type:"NUMBER"},{name:"addSpace",type:"BOOLEAN"},{name:"prefixZero",type:"BOOLEAN"}];var N=function(e,t,n,r){return e=parseFloat(e),isNaN(e)?T(e,t,n,r):Math.floor(e)==e?T(e,t,0,r):T(e,t,n,r)};N.parameters=[{name:"fix",type:"NUMBER"},{name:"fract",type:"NUMBER"},{name:"addSpace",type:"BOOLEAN"}];var R=function(e,t){var n=parseFloat(e);if(isNaN(n))return"    -";var r=P.NM;return"m"==t&&(r=1),"km"==t&&(r=1e3),(n/=r)<1?T(n,3,2):n<100?T(n,4,1):T(n,5,0)};R.parameters=[{name:"unit",type:"SELECT",list:["nm","m","km"],default:"nm"}];var x=function(e,t){var n=parseFloat(e);if(isNaN(n))return"  -";var r=3600/P.NM;return"ms"==t&&(r=1),"kmh"==t&&(r=3.6),(n*=r)<100?T(n,2,1):T(n,3,0)};x.parameters=[{name:"unit",type:"SELECT",list:["kn","ms","kmh"],default:"kn"}];var j=function(e,t){return t&&(e=180*e/Math.PI),T(e,3,0)};j.parameters=[{name:"inputRadian",type:"BOOLEAN",default:!1}];var A=function(e){return e&&e instanceof Date?this.formatDecimal(e.getHours(),2,0).replace(" ","0")+":"+this.formatDecimal(e.getMinutes(),2,0).replace(" ","0")+":"+this.formatDecimal(e.getSeconds(),2,0).replace(" ","0"):"--:--:--"};A.parameters=[];var L=function(e){return e&&e instanceof Date?this.formatDecimal(e.getHours(),2,0).replace(" ","0")+":"+this.formatDecimal(e.getMinutes(),2,0).replace(" ","0"):"--:--"};L.parameters=[];var I=function(e){return e&&e instanceof Date?this.formatDecimal(e.getFullYear(),4,0)+"/"+this.formatDecimal(e.getMonth()+1,2,0,!1,!0)+"/"+this.formatDecimal(e.getDate(),2,0,!1,!0)+" "+this.formatDecimal(e.getHours(),2,0,!1,!0)+":"+this.formatDecimal(e.getMinutes(),2,0,!1,!0)+":"+this.formatDecimal(e.getSeconds(),2,0,!1,!0):"----/--/-- --:--:--"};I.parameters=[];var M=function(e){return e&&e instanceof Date?this.formatDecimal(e.getFullYear(),4,0)+"/"+this.formatDecimal(e.getMonth()+1,2,0)+"/"+this.formatDecimal(e.getDate(),2,0):"----/--/--"};M.parameters=[];var _=function(e){return e};_.parameters=[];var F=function(e,t){try{if(!t||"pa"===t.toLowerCase())return T(e);if("hpa"===t.toLowerCase())return(parseFloat(e)/100).toFixed(2);if("bar"===t.toLowerCase())return T(parseFloat(e)/1e5,2,4)}catch(e){return"-----"}};F.parameters=[{name:"unit",type:"SELECT",list:["pa","hpa","bar"],default:"pa"}];var B=function(e,t){try{if(!t||t.toLowerCase().match(/^k/))return T(e,3,1);if(t.toLowerCase().match(/^c/))return T(parseFloat(e)-273.15,3,1)}catch(e){return"-----"}};B.parameters=[{name:"unit",type:"SELECT",list:["celsius","kelvin"],default:"kelvin"}];var W={formatDateTime:I,formatClock:L,formatTime:A,formatDecimalOpt:N,formatDecimal:T,formatLonLats:D,formatLonLatsDecimal:function(e,t){e=(e+540)%360-180;var n=Math.abs(e),r=Math.floor(n),o=(n-r)/(1/60);60==o.toFixed(2)&&(r+=1,o=0),r<10&&(r="0"+r),r<100&&"lon"==t&&(r="0"+r);var i=r+"°";return o<10&&(i+="0"),i+=o.toFixed(2)+"'",i+="lon"==t?e<0?"W":"E":e<0?"S":"N"},formatDistance:R,formatDirection:j,formatSpeed:x,formatString:_,formatDate:M,formatPressure:F,formatTemperature:B,skTemperature:B,skPressure:F};function H(e){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},H(e)}var V="A",K="B",U="S",q="T",z={nameOrmmsi:{headline:"name/mmsi",format:function(e){return 21==e.type&&e.name&&"unknown"!==e.name?e.name:e.shipname&&"unknown"!==e.shipname?e.shipname:e.mmsi}},distance:{headline:"dist(nm)",format:function(e){return W.formatDistance(e.distance||0)},unit:"nm"},heading:{headline:"hdg",format:function(e){return void 0===e.heading?"---":W.formatDirection(e.heading)},unit:"°",classes:[V,K]},turn:{headline:"rot(°/min)",format:function(e){return void 0===e.turn?"-":W.formatDecimal(e.turn,1,0)},unit:"°",classes:[V,K]},speed:{headline:"speed(kn)",format:function(e){return W.formatSpeed(e.speed||0)},unit:"kn",classes:[V,K]},course:{headline:"course",format:function(e){return W.formatDirection(e.course||0)},unit:"°",classes:[V,K]},headingTo:{headline:"hdt",format:function(e){return W.formatDirection(e.headingTo||0)},unit:"°"},cpa:{headline:"cpa",format:function(e){return void 0===e.cpa?"----":W.formatDistance(e.cpa||0)}},tcpa:{headline:"tcpa",format:function(e){if(void 0===e.tcpa)return"---------";var t=parseFloat(e.tcpa||0),n="";t<0&&(n="-",t=-t);var r=Math.floor(t/3600),o=Math.floor((t-3600*r)/60),i=t-3600*r-60*o;return n+W.formatDecimal(r,2,0).replace(" ","0")+":"+W.formatDecimal(o,2,0).replace(" ","0")+":"+W.formatDecimal(i,2,0).replace(" ","0")}},passFront:{headline:"pass",format:function(e){return e.cpa?void 0!==e.passFront?e.passFront>0?"Front":e.passFront<0?"Pass":"Back":"Done":"-"}},shipname:{headline:"name",format:function(e){return void 0!==e.shipname&&"unknown"!==e.shipname||21!=e.type?e.shipname:e.name},classes:[V,K,q]},callsign:{headline:"call",format:function(e){return e.callsign},classes:[V,K]},mmsi:{headline:"mmsi",format:function(e){return e.mmsi}},shiptype:{headline:"type",format:function(e){var t=0;try{t=parseInt(e.shiptype||0)}catch(e){}return t>=20&&t<=29?"WIG":30==t?"Fishing":31==t||32==t?"Towing":33==t?"Dredging":34==t?"Diving":35==t?"Military":36==t?"Sail":37==t?"Pleasure":t>=40&&t<=49?"HighSp":50==t?"Pilot":51==t?"SAR":52==t?"Tug":53==t?"PortT":54==t?"AntiPol":55==t?"Law":58==t?"Medical":t>=60&&t<=69?"Passenger":t>=70&&t<=79?"Cargo":t>=80&&t<=89?"Tanker":t>=91&&t<=94?"Hazard":"Other"},classes:[V,K]},status:{headline:"status",format:function(e){if(void 0===e.status)return"----";var t=parseInt(e.status);switch(t){case 0:return"Under way using engine";case 1:return"At anchor";case 2:return"Not under command";case 3:return"Restricted manoeuverability";case 4:return"Constrained by her draught";case 5:return"Moored";case 6:return"Aground";case 7:return"Engaged in Fishing";case 8:return"Under way sailing";case 9:case 10:case 11:case 12:case 13:return"[reserved]";case 14:return"AIS-SART is active"}return t+" [unknown]"},classes:[V,K]},age:{headline:"age",format:function(e){if(void 0===e.age)return"----";var t=e.age;void 0!==e.receiveTime&&(t+=((new Date).getTime()-e.receiveTime)/1e3);return W.formatDecimal(t,5,2)},unit:"s"},position:{headline:"position",format:function(e){return W.formatLonLats({lon:e.lon,lat:e.lat})}},destination:{headline:"destination",format:function(e){var t=e.destination;return t||"unknown"},classes:[V,K]},warning:{headline:"warning",format:function(e){return e.warning||!1}},nearest:{headline:"nearest",format:function(e){return e.nearest||!1}},clazz:{headline:"class",format:function(e){return"object"!==H(e)?"":1==e.type||2==e.type||3==e.type?V:18==e.type||19==e.type?K:4==e.type?U:21==e.type?q:""}},length:{headline:"length",format:function(e){return void 0===e.length?"---":W.formatDecimal(e.length,3)},unit:"m"},beam:{headline:"beam",format:function(e){return void 0===e.beam?"---":W.formatDecimal(e.beam,3)},unit:"m"},draught:{headline:"draught",format:function(e){return void 0===e.draught?"---":W.formatDecimal(e.draught,2,1)},unit:"m",classes:[V,K]},aid_type:{headline:"type",format:function(e){if(void 0===e.aid_type)return"---";var t=parseInt(e.aid_type);switch(t){case 0:return"not specified";case 1:return"Reference point";case 2:return"RACON";case 3:return"Fixed structures off-shore";case 4:return"Emergency Wreck Marking Buoy";case 5:return"Light, without sectors";case 6:return"Light, with sectors";case 7:return"Leading Light Front";case 8:return"Leading Light Rear";case 9:return"Beacon, Cardinal N";case 10:return"Beacon, Cardinal E";case 11:return"Beacon, Cardinal S";case 12:return"Beacon, Cardinal W";case 13:return"Beacon, Port hand";case 14:return"Beacon, Starboard hand";case 15:return"Beacon, Preferred Channel port hand";case 16:return"Beacon, Preferred Channel starboard hand";case 17:return"Beacon, Isolated danger";case 18:return"Beacon, Safe water";case 19:return"Beacon, Special mark";case 20:return"Cardinal Mark N";case 21:return"Cardinal Mark E";case 22:return"Cardinal Mark S";case 23:return"Cardinal Mark W";case 24:return"Port hand Mark";case 25:return"Starboard hand Mark";case 26:return"Preferred Channel Port hand";case 27:return"Preferred Channel Starboard hand";case 28:return"Isolated danger";case 29:return"Safe Water";case 30:return"Special Mark";case 31:return"Light Vessel/LANBY/Rigs"}return t+" (unknown)"},classes:[q]}},G={getHeadline:function(e){var t=z[e];if(t)return t.headline},format:function(e,t,n){var r=z[e];if(r&&void 0!==t){var o=r.format(t);return n&&void 0!==r.unit&&(o+=" "+r.unit),o}},getItemFromList:function(e,t){if(e)for(var n=0;n<e.length;n++)if(e[n].mmsi==t)return e[n]},getLabels:function(){var e=[];for(var t in z)e.push({label:z[t].headline,value:t});return e},filterDisplay:function(e,t){var n=z.clazz.format(t),r=[];for(var o in e){var i=e[o],a="object"===H(i)?i.name:i,s=z[a];s&&(void 0!==s.classes&&s.classes.indexOf(n)<0||r.push(i))}return r},shouldShow:function(e,t){var n=z.clazz.format(t),r=z[e];if(r)return void 0===r.classes||r.classes.indexOf(n)>=0}},Z=G;function X(e){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},X(e)}function J(e,t,n){return t=Q(t),function(e,t){if(t&&("object"==X(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Y()?Reflect.construct(t,n||[],Q(e).constructor):t.apply(e,n))}function Y(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Y=function(){return!!e})()}function Q(e){return Q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Q(e)}function $(e,t){return $=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},$(e,t)}function ee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,re(r.key),r)}}function ne(e,t,n){return t&&te(e.prototype,t),n&&te(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function re(e){var t=function(e,t){if("object"!=X(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=X(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==X(t)?t:t+""}var oe=999,ie=888,ae=[],se={CHECKBOX:0,RANGE:1,LIST:2,COLOR:3,LAYOUT:4,SELECT:5,INTERNAL:6,MULTICHECKBOX:7},le=function(){return ne((function e(t,n,r,o,i){ee(this,e),this.defaultv=t,this.label=n,this.type=void 0!==r?r:se.INTERNAL,this.values=void 0!==o?o:[0,1e3],this.canChange=void 0!==r,this.initialValue=i}),[{key:"isSplit",value:function(){return!1}}])}(),ue=function(e){function t(e,n,r,o,i){return ee(this,t),J(this,t,[e,n,r,o,i])}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$(e,t)}(t,e),ne(t,[{key:"isSplit",value:function(){return!0}}])}(le),ce=function(e){this.description=e},pe=function(e){this.description=e},fe={},he=function(){return ne((function e(t,n){ee(this,e),y()(this,t),this.__path=n}),[{key:"getKeys",value:function(){var e={};for(var t in this)if("_"!==t.substr(0,1)){var n=this[t];"string"==typeof n&&(e[t]=n)}return e}}])}(),me={nav:{gps:{lat:ie,lon:ie,position:new ce("an instance of navobjects.Point"),course:ie,speed:ie,rtime:ie,valid:oe,windAngle:ie,windSpeed:ie,trueWindAngle:ie,trueWindSpeed:ie,trueWindDirection:ie,positionAverageOn:oe,speedAverageOn:oe,courseAverageOn:oe,depthBelowTransducer:ie,depthBelowWaterline:ie,depthBelowKeel:ie,headingCompass:ie,headingMag:ie,headingTrue:ie,waterTemp:ie,waterSpeed:ie,magDeviation:ie,magVariation:ie,currentSet:ie,currentDrift:ie,sequence:oe,connectionLost:oe,updatealarm:new ce("update counter for alarms"),updateleg:new ce("update counter for leg"),updateconfig:new ce("update counter for the server config"),version:new ce("the server version")},display:{boatDirection:new ce("the direction of the boat to be used for display"),directionMode:new ce("one of cog,hdm,hdt"),isSteady:new ce("will be true if steady detected"),mapDirection:new ce("the direction that will be used to rotate the map with course up")},alarms:{all:oe},center:{course:ie,distance:ie,markerCourse:ie,markerDistance:ie},wp:{course:ie,courseRhumbLine:ie,courseGreatCircle:ie,distance:ie,distanceRhumbLine:ie,distanceGreatCircle:ie,eta:ie,xte:ie,vmg:ie,position:ie,name:ie},anchor:{distance:ie,direction:ie,watchDistance:ie},route:{name:ie,numPoints:ie,len:ie,remain:ie,eta:ie,nextCourse:ie,isApproaching:ie},ais:{nearest:oe,list:oe,trackedMmsi:oe,updateCount:oe},routeHandler:{activeName:oe,routeForPage:oe,pageRouteIndex:oe,editingRoute:oe,editingIndex:oe,useRhumbLine:oe,nextWpMode:new ce("switch mode: early, 90, late"),nextWpTime:new ce("switch time for mode early"),currentLeg:new ce("the current leg used for routing"),currentIndex:new ce("the index when working directly on the active route (currentLeg)")},track:{currentTrack:oe}},map:{lockPosition:oe,courseUp:oe,currentZoom:oe,requiredZoom:oe,centerPosition:oe,measurePosition:oe},gui:{capabilities:{addons:oe,uploadCharts:oe,plugins:oe,uploadRoute:oe,uploadLayout:oe,uploadUser:oe,uploadImages:oe,uploadImport:oe,uploadOverlays:oe,uploadTracks:oe,uploadSettings:oe,canConnect:oe,config:oe,debugLevel:oe,log:oe,remoteChannel:oe,fetchHead:oe},global:{splitMode:oe,smallDisplay:oe,onAndroid:oe,propertySequence:oe,propertiesLoaded:oe,hasActiveInputs:oe,currentDialog:oe,windowDimensions:oe,layoutEditing:oe,layoutSequence:oe,reloadSequence:oe,toastText:oe,toastTimeout:oe,toastCallback:oe,soundEnabled:new ce("only enable sound once we reach the mainpage"),dimActive:oe,computedButtonHeight:oe,computedButtonWidth:oe,isFullScreen:oe,remoteChannelState:oe,preventAlarms:oe,ignoreAndroidBack:oe,remoteChannelActive:oe},gpspage:{pageNumber:oe},addonpage:{activeAddOn:oe},addresspage:{addressList:oe},routepage:{initialName:oe},aisinfopage:{hidden:oe},aispage:{searchActive:oe,searchValue:oe}},properties:{lastLoadedName:new le("system.default"),layers:{ais:new le(!0,"AIS",se.CHECKBOX),track:new le(!0,"Track",se.CHECKBOX),nav:new le(!0,"Navigation",se.CHECKBOX),boat:new le(!0,"Boat",se.CHECKBOX),grid:new le(!0,"Grid",se.CHECKBOX),compass:new le(!0,"Compass",se.CHECKBOX),base:new le(!0,"Base",se.CHECKBOX),scale:new le(!0,"ScaleLine",se.CHECKBOX),user:new le({},"User/Plugins",se.CHECKBOX)},startNavPage:new le(!1,"start with last map",se.CHECKBOX),startLastSplit:new le(!1,"start with last split mode",se.CHECKBOX),localAlarmSound:new le(!0,"Alarm Sound",se.CHECKBOX),alarmVolume:new le(50,"Alarm Volume (0...100)",se.RANGE,[0,100]),connectedMode:new ue(!0,"connected",se.CHECKBOX),readOnlyServer:new le(!1),silenceSound:new le("sounds/1-minute-of-silence.mp3"),slideTime:new le(300),slideLevels:new le(3),maxUpscale:new le(2),maxZoom:new le(21),courseAverageLength:new le(10,"average interval for map course up",se.RANGE,[1,30]),courseAverageTolerance:new le(15,"Rotation Tolerance",se.RANGE,[1,30]),courseUpAlwaysCOG:new le(!1,"CourseUp always COG",se.CHECKBOX),maxButtons:new le(8),positionQueryTimeout:new le(1e3,"Position (ms)",se.RANGE,[500,5e3,10]),trackQueryTimeout:new le(5e3,"Track (ms)",se.RANGE,[500,1e4,10]),routeQueryTimeout:new le(1e3,"Route (ms)",se.RANGE,[500,1e4,10]),chartQueryTimeout:new le(3e4,"ChartOverview (ms)",se.RANGE,[500,2e5,100]),connectionLostAlarm:new le(!0,"Connection Lost alarm",se.CHECKBOX),courseAverageInterval:new le(0,"Course average",se.RANGE,[0,20,1]),speedAverageInterval:new le(0,"Speed average",se.RANGE,[0,20,1]),positionAverageInterval:new le(0,"Position average",se.RANGE,[0,20,1]),bearingColor:new le("#DDA01F","Color",se.COLOR),bearingWidth:new le(3,"Width",se.RANGE,[1,10]),routeColor:new le("#27413B","Color",se.COLOR),routeWidth:new le(2,"Width",se.RANGE,[1,10]),routeWpSize:new le(7,"WPSize",se.RANGE,[5,30]),routeApproach:new le(200,"Approach(m)",se.RANGE,[20,2e3]),routeShowLL:new le(!1,"showLatLon",se.CHECKBOX),navCircleColor:new le("#D71038","Circle Color",se.COLOR),navCircleWidth:new le(1,"Circle Width",se.RANGE,[1,10]),navBoatCourseTime:new le(600,"Boat Course Vector Length(sec)",se.RANGE,[1,3600]),anchorCircleColor:new le("#D71038","Anchor Circle Color",se.COLOR),anchorCircleWidth:new le(1,"Anchor Circle Width",se.RANGE,[1,10]),navCircle1Radius:new le(300,"Circle 1 Radius(m)",se.RANGE,[0,5e3,10]),navCircle2Radius:new le(1e3,"Circle 2 Radius(m)",se.RANGE,[0,5e3,10]),navCircle3Radius:new le(0,"Circle 3 Radius(m)",se.RANGE,[0,1e4,10]),boatIconScale:new le(1,"Boat Icon Scale",se.RANGE,[.5,5,.1]),boatDirectionMode:new le("cog","boat direction",se.LIST,["cog","hdt","hdm"]),boatDirectionVector:new le(!0,"add dashed vector for hdt/hdm",se.CHECKBOX),boatSteadyDetect:new le(!1,"zero SOG detect",se.CHECKBOX),boatSteadyMax:new le(.2,"zero SOG detect below (kn)",se.RANGE,[.1,1,.05]),measureColor:new le("red","Measure display color",se.COLOR),windScaleAngle:new le(50,"red/green Angle Wind",se.RANGE,[5,90,1]),anchorWatchDefault:new le(300,"AnchorWatch(m)",se.RANGE,[0,1e3,1]),gpsXteMax:new le(1,"XTE(nm)",se.RANGE,[.1,5,.1,1]),trackColor:new le("#942eba","Color",se.COLOR),trackWidth:new le(3,"Width",se.RANGE,[1,10]),trackInterval:new le(30,"Point Dist.(s)",se.RANGE,[5,300]),initialTrackLength:new le(24,"Length(h)",se.RANGE,[1,48]),aisQueryTimeout:new le(5e3,"AIS (ms)",se.RANGE,[1e3,1e4,10]),aisDistance:new le(20,"Range(nm)",se.RANGE,[1,1e3]),aisUseCourseVector:new le(!0,"use Course Vector",se.CHECKBOX),aisCurvedVectors:new le(!0,"curved vectors",se.CHECKBOX),aisRelativeMotionVectorRange:new le(0,"relative motion vector range (nm)",se.RANGE,[0,100]),aisShowEstimated:new le(!1,"show estimated position",se.CHECKBOX),aisEstimatedOpacity:new le(.4,"estimated image opacity",se.RANGE,[.1,1,.05]),aisUseHeading:new le(!0,"use heading for direction",se.CHECKBOX),aisIconBorderWidth:new le(3,"Border Width",se.RANGE,[0,10]),aisIconScale:new le(1,"Icon Scale",se.RANGE,[.5,5,.1]),aisClassbShrink:new le(.6,"Class B rel size",se.RANGE,[.1,2,.1]),aisMinDisplaySpeed:new le(.5,"min speed (kn) for target/estimated display",se.RANGE,[.1,40]),aisOnlyShowMoving:new le(!1,"only show moving targets",se.CHECKBOX),aisListUpdateTime:new le(5,"update time(s) for list",se.RANGE,[1,20]),aisReducedList:new le(!1,"reduce details in list",se.CHECKBOX),aisHideTime:new le(15,"hide time(s)",se.RANGE,[1,3600]),aisLostTime:new le(600,"lost time (s)",se.RANGE,[1,3600]),aisListLock:new le(!1,"lock ais list",se.CHECKBOX),clickTolerance:new le(60,"Click Tolerance",se.RANGE,[10,120]),maxAisErrors:new le(3),minAISspeed:new le(.1),maxAisTPA:new le(3),aisWarningCpa:new le(500,"Warning-CPA(m)",se.RANGE,[100,5e3,10]),aisWarningTpa:new le(900,"Warning-TPA(s)",se.RANGE,[30,3600,10]),aisTextSize:new le(14,"Text Size(px)",se.RANGE,[8,24]),aisShowA:new le(!0,"Show class A",se.CHECKBOX),aisShowB:new le(!0,"Show class B",se.CHECKBOX),aisShowOther:new le(!1,"Show other",se.CHECKBOX),aisFirstLabel:new le("nameOrmmsi","First label",se.SELECT,["--none--"].concat(Z.getLabels())),aisSecondLabel:new le("--none--","Second label",se.SELECT,["--none--"].concat(Z.getLabels())),aisThirdLabel:new le("--none--","Third label",se.SELECT,["--none--"].concat(Z.getLabels())),statusQueryTimeout:new le(8e3),networkTimeout:new le(8e3,"Network timeout(ms)",se.RANGE,[1e3,2e4,100]),wpaQueryTimeout:new le(1e4),centerDisplayTimeout:new le(45e3),navUrl:new le("/viewer/avnav_navi.php"),maxGpsErrors:new le(3),routingServerError:new le(!0,"ServerError",se.CHECKBOX),routingTextSize:new le(14,"Text Size(px)",se.RANGE,[8,36]),routeCatchRange:new le(50,"route point snap distance %",se.RANGE,[0,100]),statusErrorImage:new le(b),statusOkImage:new le(w),statusYellowImage:new le(k),statusUnknownImage:new le(g),statusIcons:{INACTIVE:new le(g),STARTED:new le(k),RUNNING:new le(k),NMEA:new le(w),ERROR:new le(b)},nightFade:new le(50,"NightDim(%)",se.RANGE,[1,99]),nightChartFade:new le(30,"NightChartDim(%)",se.RANGE,[1,99]),dimFade:new le(0,"Dim Fade(%)",se.RANGE,[0,60]),showDimButton:new le(!0,"Show Dim Button",se.CHECKBOX),showSplitButton:new le(!0,"Show Split Button",se.CHECKBOX),baseFontSize:new le(14,"Base Font(px)",se.RANGE,[8,28]),widgetFontSize:new le(14,"Widget Base Font(px)",se.RANGE,[8,28]),allowTwoWidgetRows:new le(!0,"2 widget rows",se.CHECKBOX),showClock:new le(!0,"show clock",se.CHECKBOX),showZoom:new le(!0,"show zoom",se.CHECKBOX),showWind:new le(!0,"show wind",se.CHECKBOX),showDepth:new le(!0,"show depth",se.CHECKBOX),autoZoom:new le(!0,"automatic zoom",se.CHECKBOX),windKnots:new le(!0,"wind knots",se.CHECKBOX),nightMode:new le(!1,"NightMode",se.CHECKBOX),nightColorDim:new le(60,"Night Dim for Colors",se.RANGE,[5,100]),smallBreak:new le(480,"portrait layout below (px)",se.RANGE,[200,9999]),mapClickWorkaroundTime:new le(300,"time to ignore events map click",se.RANGE,[0,1e3]),wpButtonTimeout:new le(30,"time(s) for auto hiding wp buttons",se.RANGE,[2,3600]),nightModeNavPage:new le(!0,"show night mode on navpage",se.CHECKBOX),hideButtonTime:new le(30,"time(s) to hide buttons on enabled pages",se.RANGE,[2,90]),showButtonShade:new le(!0,"show shade when buttons hidden",se.CHECKBOX),autoHideNavPage:new le(!1,"auto hide buttons on NavPage",se.CHECKBOX),autoHideGpsPage:new le(!1,"auto hide buttons on Dashboard Pages",se.CHECKBOX),toastTimeout:new le(15,"time(s) to display messages",se.RANGE,[2,3600]),layoutName:new ue("system.default","Layout name",se.LAYOUT),mobMinZoom:new le(16,"minzoom for MOB",se.RANGE,[8,20]),buttonCols:new le(!1,"2 button columns",se.CHECKBOX),cancelTop:new le(!1,"Back button top",se.CHECKBOX,void 0,!0),titleIcons:new le(!0,"red icons in title",se.CHECKBOX),titleIconsGps:new le(!0,"title icons on dashboard page",se.CHECKBOX),featureInfo:new le(!0,"Overlay Info on Click",se.CHECKBOX),emptyFeatureInfo:new le(!0,"Always Info on Chart Click",se.CHECKBOX),showFullScreen:new le(!0,"Show Fullscreen Button",se.CHECKBOX),showMeasure:new le(!0,"Show Measure Button",se.CHECKBOX),measureRhumbLine:new le(!0,"Measure rhumb line (false: great circle)",se.CHECKBOX),mapUpZoom:new le(4,"zoom up lower layers",se.RANGE,[0,6]),mapOnlineUpZoom:new le(0,"zoom up lower layers for online sources",se.RANGE,[0,6]),mapScale:new le(1,"scale the map display",se.RANGE,[.3,5]),mapFloat:new le(!1,"float map behind buttons",se.CHECKBOX),mapLockMode:new le("center","lock boat mode",se.LIST,["center","current","ask"]),mapLockMove:new le(!0,"allow move when locked",se.CHECKBOX),mapSequenceTime:new le(2e3,"change check interval(ms)",se.RANGE,[500,1e4,100]),mapScaleBarText:new le(!0,"Show text on scale bar",se.CHECKBOX),mapZoomLock:new le(!0,"Lock to int zoom levels with buttons",se.CHECKBOX),remoteChannelName:new ue("0","remote control channel",se.LIST,["0","1","2","3","4"]),remoteChannelRead:new ue(!1,"read from remote channel",se.CHECKBOX),remoteChannelWrite:new ue(!1,"write to remote channel",se.CHECKBOX),remoteGuardTime:new le(2,"time(s) to switch read/write",se.RANGE,[1,10]),remoteDimGuard:new le(200,"time (ms) before a toggle is accepted from remote",se.RANGE,[100,1e3]),style:{buttonSize:new le(50,"Button Size(px)",se.RANGE,[35,100]),aisWarningColor:new le("#FA584A","Warning",se.COLOR),aisNormalColor:new le("#EBEB55","Normal",se.COLOR),aisNearestColor:new le("#70F3AF","Nearest",se.COLOR),aisTrackingColor:new le("#f8a601","Tracking",se.COLOR),routeApproachingColor:new le("#FA584A","Approach",se.COLOR),widgetMargin:new le(3,"Widget Margin(px)",se.RANGE,[1,20]),useHdpi:new le(!1,"Increase Fonts on High Res",se.CHECKBOX,void 0,!0)}}};!function e(t,n){for(var r in t){var o=n?n+"."+r:r;if(t[r]!==oe)if(t[r]!==ie){var i=t[r];if("object"===X(i)){if(i instanceof ce||i instanceof le||i instanceof pe){fe[o]=i,i instanceof pe&&ae.push(o),t[r]=o;continue}e(t[r],o),t[r]=new he(t[r],o)}}else ae.push(o),t[r]=o;else t[r]=o}}(me);var de={keyNodeToString:function(e){if(e&&void 0!==X(e.__path))return e.__path},getDefaultKeyValues:function(){var e={};for(var t in fe){var n=fe[t];void 0!==n.defaultv&&(e[t]=n.defaultv)}return e},getKeyDescriptions:function(e){if(!e)return fe;var t={};for(var n in fe)fe[n]instanceof le&&(t[n]=fe[n]);return t},flattenedKeys:function(e){if(e instanceof Array)return e;if(e instanceof Object){var t=[];for(var n in e){var r=e[n];r instanceof Object?t=t.concat(de.flattenedKeys(r)):t.push(r)}return t}return[e]},getValue:function(e,t,n){for(var r=t.split("."),o=e,i=void 0,a=n||0;a<r.length;a++){if("object"!==X(o))return;i=o[r[a]],o=o[r[a]]}return i},getValueKeys:function(){return ae}},ve=me;function ye(e){return ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ye(e)}function ge(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ke(r.key),r)}}function be(e,t,n){return t&&ge(e.prototype,t),n&&ge(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function we(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ke(e){var t=function(e,t){if("object"!=ye(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=ye(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ye(t)?t:t+""}var Ce=function(){return be((function e(t,n){we(this,e),this.callback=t,de.keyNodeToString(n)?(this.keys=de.keyNodeToString(n),this.prefix=!0):(this.keys=n,this.prefix=!1)}),[{key:"isCallbackFor",value:function(e){if(!e||0===e.length)return!0;if(this.prefix){for(var t in e)if(d.startsWith(e[t],this.keys))return!0;return!1}if(!this.keys||0===this.keys.length)return!0;for(var n in this.keys)for(var r in e)if(this.keys[n]===e[r])return!0;return!1}},{key:"call",value:function(e){return"function"==typeof this.callback?this.callback(e):this.callback.dataChanged(e)}}])}(),Se=function(){return be((function e(t){we(this,e),this.callbacks=[],this.data={},this.name=t}),[{key:"findCallback",value:function(e){var t;for(t=0;t<this.callbacks.length;t++)if(this.callbacks[t].callback==e)return t;return-1}},{key:"register",value:function(e){var t=Array.prototype.slice.call(arguments,1),n=[];if(1==t.length&&de.keyNodeToString(t[0])?n=t[0]:t.forEach((function(e){if(void 0!==e)if(e instanceof Array)n=n.concat(e);else if(e instanceof Object)for(var t in e)n.push(e[t]);else n=n.concat(e)})),e&&!(n.length<1)){var r=this.findCallback(e);return r<0?(this.callbacks.push(new Ce(e,n)),!0):(this.callbacks[r]=new Ce(e,n),!0)}}},{key:"deregister",value:function(e){var t=this.findCallback(e);return!(t<0)&&(this.callbacks.splice(t,1),!0)}},{key:"callCallbacks",value:function(e,t){this.callbacks.forEach((function(n){if(t){if(t===n.callback)return;if(t instanceof Array)for(var r in t)if(t[r]==n.callback)return}n.isCallbackFor(e)&&n.call(e)}))}},{key:"equalsData",value:function(e,t){return f(e,t)}},{key:"getData",value:function(e,t){var n=this.data[e];return void 0!==n?n:t}},{key:"getMultiple",value:function(e){var t=this,n=e,r={};if(!(n instanceof Array)){if(n instanceof Object){for(var o in n){var i=void 0;i="object"===ye(n[o])?t.getMultiple(n[o]):t.getData(n[o]),r[o]=i}return r}n=[n]}return n.forEach((function(e){var n=t.getData(e);r[e]=n})),r}},{key:"storeData",value:function(e,t,n){var r=!this.equalsData(this.data[e],t);return this.data[e]=t,r&&!0!==n&&this.callCallbacks([e],n),r}},{key:"storeMultiple",value:function(e,t,n,r){var o=[];if(void 0!==e||void 0!==t){for(var i in void 0!==t?t:e){var a=void 0!==t?t[i]:i;if(void 0!==a){var s=void 0!==e?e[i]:void 0;if("object"!==ye(a)){var l=!1;void 0===s&&!0===r||(l=this.storeData(a,s,!0)),l&&o.push(a)}else{var u=this.storeMultiple(s,a,!0,r);o=o.concat(u)}}}return o.length>0&&!0!==n&&this.callCallbacks(o,n),o}}},{key:"getKeysByPrefix",value:function(e,t){var n=[];if(!e)return n;var r=e.length;for(var o in this.data)if(o.substr(0,r)===e){if(t&&"object"===ye(this.data[o]))continue;n.push(o)}return n}}])}(),Ee=Se,Oe=new Ee("global");function Pe(e){return Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pe(e)}function De(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Te(r.key),r)}}function Te(e){var t=function(e,t){if("object"!=Pe(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Pe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Pe(t)?t:t+""}var Ne="Really exit AvNav?",Re=new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.prevent=!0;var t=this;window.onbeforeunload=function(e){if(t.prevent)return(e||window.event).returnValue=Ne,Ne}},(t=[{key:"stop",value:function(){this.prevent=!1}},{key:"activate",value:function(e){var t=this;window.setTimeout((function(){t.prevent=!0}),e||100)}}])&&De(e.prototype,t),n&&De(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}());function xe(e){return xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xe(e)}function je(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ae(r.key),r)}}function Ae(e){var t=function(e,t){if("object"!=xe(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=xe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==xe(t)?t:t+""}var Le={LAYOUT:"avnav.layout",LASTCHART:"avnav.lastChart",ROUTING:"avnav.routing",ROUTE:"avnav.route.",CENTER:"avnav.center",SPLITSETTINGS:"avnav.splitsettings"},Ie={CHARTINFO:"avnav.chartinfo",O_SESSION:"avnav.ochartProvider.sessionId",EULAS:"avnav.eulas",SETTINGS:"avnav.settings",LICENSE:"avnav.licenseAccepted",DEFAULTROUTE:"avnav.defaultRoute",SPLITMODE:"avnav.splitmode"},Me=y()({},Ie,Le),_e=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.prefix="",this.impl="object"===xe(window.localStorage)?window.localStorage:void 0},t=[{key:"hasPrefix",value:function(){return this.prefix&&""!==this.prefix}},{key:"hasStorage",value:function(){return void 0!==this.impl}},{key:"setPrefix",value:function(e){this.prefix=e}},{key:"getPrefix",value:function(){return this.prefix}},{key:"_getRealNameImpl",value:function(e,t){for(var n in t)if(e===t[n])return e}},{key:"getRealName",value:function(e,t,n){if(e){var r=this._getRealNameImpl(e,Le);if(r){var o=n?void 0:this.prefix;return o||(o=""),t?o+r+t:o+r}if(r=this._getRealNameImpl(e,Ie))return t?r+t:r;!function(e,t){console.trace("LocalStorage invalid name "+e+": "+t)}(e,"not found")}}},{key:"getItem",value:function(e,t,n){if(this.impl){var r=this.getRealName(e,t,n);if(r)return this.impl.getItem(r)}}},{key:"setItem",value:function(e,t,n){if(this.impl){var r=this.getRealName(e,t);if(r)return this.impl.setItem(r,n)}}},{key:"removeItem",value:function(e,t){if(this.impl){var n=this.getRealName(e,t);n&&this.impl.removeItem(n)}}},{key:"listByPrefix",value:function(e){if(!this.impl)return[];var t=this.getRealName(e);if(!t)return[];for(var n=t.length,r=[],o=0;o<this.impl.length;o++){var i=this.impl.key(o);i.substr(0,n)===t&&r.push(i)}return r}}],t&&je(e.prototype,t),n&&je(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}(),Fe=new _e;function Be(e){return Be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Be(e)}function We(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,He(r.key),r)}}function He(e){var t=function(e,t){if("object"!=Be(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Be(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Be(t)?t:t+""}var Ve=function(){return e=function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pubSub=new r.A,window.addEventListener("message",(function(e){e.origin===window.location.origin&&"object"===Be(e.data)&&void 0!==e.data.type&&t.pubSub.publish(e.data.type,e.data)})),this.urlParameters={}},t=[{key:"addUrlParameter",value:function(e,t){this.urlParameters[e]=t}},{key:"subscribe",value:function(e,t){return this.pubSub.subscribe(e,t)}},{key:"unsubscribe",value:function(e){this.pubSub.unsubscribe(e)}},{key:"sendToFrame",value:function(e,t){if(Oe.getData(ve.gui.global.splitMode)){t||(t={}),t.type=e;try{window.parent.postMessage(t,window.location.origin)}catch(e){i.log("unable to post message: "+e)}}}},{key:"activateSplitMode",value:function(){Re.stop();var e=window.location.href+"";e=e.replace("avnav_viewer","viewer_split").replace(/\?.*/,"");var t="?";for(var n in this.urlParameters)e+=t+encodeURIComponent(n)+"="+encodeURIComponent(this.urlParameters[n]),t="&";window.location.replace(e)}},{key:"deactivateSplitMode",value:function(){Re.stop(),this.sendToFrame("finishSplit")}},{key:"toggleSplitMode",value:function(){Oe.getData(ve.gui.global.splitMode)?(Fe.setItem(Ie.SPLITMODE,void 0,"off"),this.deactivateSplitMode()):(Fe.setItem(Ie.SPLITMODE,void 0,"on"),this.activateSplitMode())}},{key:"setSplitFromLast",value:function(){var e=Oe.getData(ve.gui.global.splitMode);if(!Oe.getData(ve.properties.startLastSplit)){if(!e)return Fe.setItem(Ie.SPLITMODE,void 0,"off"),!1;if(!Oe.getData(ve.gui.global.preventAlarms))return Fe.setItem(Ie.SPLITMODE,void 0,"on"),!1}var t=Fe.getItem(Ie.SPLITMODE);return"on"!==t||e?!("on"===t||!e||Oe.getData(ve.gui.global.preventAlarms)||(this.deactivateSplitMode(),0)):(this.activateSplitMode(),!0)}},{key:"buttonDef",value:function(e){var t=this;return y()({name:"Split",storeKeys:{toggle:ve.gui.global.splitMode,visible:ve.properties.showSplitButton},editDisable:!0,onClick:function(){t.toggleSplitMode()}},e)}}],t&&We(e.prototype,t),n&&We(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}(),Ke=new Ve,Ue=n(2057),qe=n(22520),ze=n(55947),Ge=n.n(ze);function Ze(e){return Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ze(e)}var Xe=["storeKeys","uf","changeCallback"],Je=["storeKeys","updateFunction","changeCallback"];function Ye(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function Qe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,$e(r.key),r)}}function $e(e){var t=function(e,t){if("object"!=Ze(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Ze(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Ze(t)?t:t+""}function et(e,t,n){return t=nt(t),function(e,t){if(t&&("object"==Ze(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,tt()?Reflect.construct(t,n||[],nt(e).constructor):t.apply(e,n))}function tt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(tt=function(){return!!e})()}function nt(e){return nt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},nt(e)}function rt(e,t){return rt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},rt(e,t)}function ot(e,t,n){var r=n||Oe,o=function(n){function o(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=et(this,o,[e])).getTranslatedStoreValues=t.getTranslatedStoreValues.bind(t),t.getStoreKeys=t.getStoreKeys.bind(t),t.dataChanged=t.dataChanged.bind(t);var n=t.getStoreKeys();return n&&r.register(t,n),t.lastUpdate=0,t.state=t.getTranslatedStoreValues(),t.updateCallback(t.state),t.timer=void 0,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&rt(e,t)}(o,n),i=o,a=[{key:"updateCallback",value:function(e){this.lastUpdate=(new Date).getTime();var n=this.props.changeCallback;if(!n&&t&&(n=t.changeCallback),n){var r=this.props,o=(r.storeKeys,r.uf,r.changeCallback,Ye(r,Xe));n(y()({},o,e))}}},{key:"getStoreKeys",value:function(){var e=this.props.storeKeys;if(t&&t.storeKeys&&(e=y()({},t.storeKeys,e)),e)return e instanceof Array?e:e instanceof Object?Object.values(e):[e]}},{key:"getTranslatedStoreValues",value:function(){if(!this.getStoreKeys())return{};var e=r.getMultiple(this.props.storeKeys||t.storeKeys),n=this.props.updateFunction;return n||t&&t.updateFunction&&(n=t.updateFunction),n?n(e,this.getStoreKeys()):e}},{key:"doUpdate",value:function(){var e=this.getTranslatedStoreValues()||{};this.setState(e),this.updateCallback(e)}},{key:"dataChanged",value:function(){var e=this;if(t&&t.minTime){var n=(new Date).getTime(),r=this.lastUpdate+t.minTime-n;if(r>0)return this.timer&&(window.clearTimeout(this.timer),this.timer=void 0),void(this.timer=window.setTimeout((function(){e.timer=void 0,e.doUpdate()}),r))}this.doUpdate()}},{key:"componentDidMount",value:function(){var e=this.getStoreKeys();e&&r.register(this,e)}},{key:"componentWillUnmount",value:function(){r.deregister(this)}},{key:"render",value:function(){var t=this.props,n=(t.storeKeys,t.updateFunction,t.changeCallback,Ye(t,Je)),r=y()({},n,this.state);return Ue.createElement(e,r)}}],a&&Qe(i.prototype,a),s&&Qe(i,s),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,a,s}(Ue.Component);return o}var it=function(e){if(!e.html)return null;var t=e.style||{};return Ue.createElement("div",{className:"toast "+e.className||0,onClick:function(){e.onClick&&e.onClick()},style:t},e.html)};it.propTypes={html:Ge().string,onClick:Ge().func,className:Ge().string};var at={html:ve.gui.global.toastText,time:ve.gui.global.toastTimeout,onClick:ve.gui.global.toastCallback},st=ot(it,{storeKeys:at}),lt=void 0,ut=function(){lt&&(window.clearTimeout(lt),lt=void 0)},ct=function(e,t,n){ut(),t||(t=1e3*parseInt(Oe.getData(ve.properties.toastTimeout||15))),Oe.storeMultiple({html:e+"",time:t,onClick:function(){pt(),n&&n()}},at),t&&(lt=window.setInterval(pt,t))},pt=function(){ut(),Oe.storeMultiple({html:void 0,time:void 0,onClick:void 0},at)};n(54717);function ft(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],l=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){u=!0,o=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ht(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ht(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ht(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function mt(e){return mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mt(e)}var dt=function(e,t,n){if(void 0===e)return[void 0,void 0];var r="";"string"==typeof e&&(r=e);var o=y()({},n,t);!1!==o.useNavUrl&&(r=Oe.getData(ve.properties.navUrl)+r),"object"===mt(e)&&(r=yt(r,e)),void 0===o.timeout&&(o.timeout=parseInt(Oe.getData(ve.properties.networkTimeout)));var i=void 0;o&&void 0!==o.noCache&&!o.noCache||((i={}).pragma="no-cache",i["cache-control"]="no-cache");var a={};return i&&(a.headers=i),a.timeout=o.timeout,[r,a]},vt=function(e,t,n){return new Promise((function(r,o){if(e){var i=void 0;n&&n.sequenceFunction&&(i=n.sequenceFunction()),fetch(e,t).then((function(e){if(!(e.status<200||e.status>=300))return e.ok?e.json():void o(e.statusText);o(e.statusText)}),(function(e){o(e.message)})).then((function(e){void 0===i||i==n.sequenceFunction()?e?n&&void 0!==n.checkOk&&!n.checkOk||e.status&&("OK"===e.status||"ok"==e.status)?r(e):o("status: "+e.status):o("empty response"):o("sequence changed")}),(function(e){o(e)}))}else o("missing url")}))},yt=function(e,t){if(!t)return e;for(var n in t){var r=t[n];void 0!==r&&("function"!=typeof r&&"object"!=mt(n)&&(e.match(/\?/)?e+="&":e+="?",e+=encodeURIComponent(n)+"="+encodeURIComponent(r)))}return e},gt=function(e,t){return new Promise((function(n,r){var o=JSON.parse(avnav.android.handleUpload(e,t));return"OK"===o.status?void n(o):void r(o.info||o.status)}))},bt={getJson:function(e,t,n){var r=ft(dt(e,t),2),o=r[0],i=r[1];return vt(yt(o,n),i,t)},postJson:function(e,t,n,r){var o=ft(dt(e,n),2),i=o[0],a=o[1];a.method="POST",i=yt(i,r),a.headers||(a.headers={}),a.headers["content-type"]="application/json";var s=JSON.stringify(t);return avnav.android?gt(i,s):(a.body=s,vt(i,a,n))},postPlain:function(e,t,n,r){var o=ft(dt(e,n),2),i=o[0],a=o[1];return i=yt(i,r),a.method="POST",a.headers||(a.headers={}),a.headers["content-type"]="application/octet-string",avnav.android?gt(i,t):(a.body=t,vt(i,a,n))},getHtmlOrText:function(e,t,n){var r=ft(dt(e,t,{useNavUrl:!1,noCache:!1}),2),o=r[0],i=r[1];return new Promise((function(e,r){if(o=yt(o,n)){var a,s=void 0;t&&t.sequenceFunction&&(s=t.sequenceFunction()),fetch(o,i).then((function(e){if((e.status<200||e.status>=300)&&r(e.statusText),e.ok)return a=e,e.text();r(e.statusText)}),(function(e){r(e.message)})).then((function(n){void 0===s||s==t.sequenceFunction()?e(n,a):r("sequence changed")}),(function(e){r(e)}))}else r("missing url")}))},uploadFile:function(e,t,n){try{var r=new XMLHttpRequest;r.open("POST",e,!0),r.setRequestHeader("Content-Type","application/octet-stream"),r.addEventListener("load",(function(e){if(200==r.status){var t=void 0;try{if(!(t=JSON.parse(r.responseText)).status||"OK"!=t.status)return void(n.errorhandler&&n.errorhandler(n,"invalid status: "+t.status))}catch(e){return void(n.errorhandler&&n.errorhandler(n,e))}n.okhandler&&n.okhandler(n,t)}else n.errorhandler&&n.errorhandler(n,r.statusText)})),r.upload.addEventListener("progress",(function(e){n.progresshandler&&n.progresshandler(n,e)})),r.addEventListener("error",(function(e){n.errorhandler&&n.errorhandler(n,"upload error")})),n.starthandler&&n.starthandler(n,r),r.send(t)}catch(e){n.errorhandler&&n.errorhandler(n,e)}}};Object.freeze(bt);var wt=bt;function kt(e){return kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kt(e)}function Ct(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,St(r.key),r)}}function St(e){var t=function(e,t){if("object"!=kt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=kt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==kt(t)?t:t+""}var Et="androidevent.",Ot=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pubsub=new r.A},t=[{key:"subscribe",value:function(e,t){return this.pubsub.subscribe(Et+e,t)}},{key:"unsubscribe",value:function(e){return this.pubsub.unsubscribe(e)}},{key:"handleEvent",value:function(e,t){var n=this;window.setTimeout((function(){n.pubsub.publish(Et+e,{event:e,id:t})}),0)}}],t&&Ct(e.prototype,t),n&&Ct(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}(),Pt=new Ot;function Dt(e){return Dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dt(e)}function Tt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Nt(r.key),r)}}function Nt(e){var t=function(e,t){if("object"!=Dt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Dt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Dt(t)?t:t+""}var Rt=function(e){if(e){var t=e.style.fontSize,n=100,r=!1;if(t&&t.match(/\%/))try{n=parseFloat(t),isNaN(n)||n<10||n>250?n=100:r=!0}catch(e){}if(r||(e.style.fontSize=n+"%"),e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth)for(var o=n;(e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth)&&o>10;o-=10)e.style.fontSize=o+"%";else{for(var i=n,a=n;e.scrollWidth<=e.clientWidth&&e.scrollHeight<=e.clientHeight&&a<=250;a+=10)i=a,e.style.fontSize=a+"%";i>n&&(i-=10,e.style.fontSize=i+"%")}}},xt=function(e,t,n){var r=e.componentDidMount,o=e.componentWillUnmount;e.componentDidUpdate;if(e.componentDidMount=function(){r&&r.apply(e),t.apply(e,[!1])}.bind(e),e.componentWillUnmount=function(){o&&o.apply(e),t.apply(e,[!0])}.bind(e),n);},jt=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.cb=t},t=[{key:"dataChanged",value:function(e,t){this.cb(e,t)}}],t&&Tt(e.prototype,t),n&&Tt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}(),At=function(e,t,n,r){var o=function(e,n){t(e,n)};xt(e,(function(e){e?rn.deregisterHandler(o):rn.registerHandler(o,n,r)}))},Lt=function(e,t,n){var r="values",o="changed";n&&(r=n+r,o=n+o),e.state||(e.state={}),e.state[r]=y()({},t),e.state[o]=!1;var i={setValue:function(n,i){var a=y()({},e.state[r]);if(a[n]!=i){a[n]=i;var s={};s[r]=a,s[o]=!f(a,t),e.setState(s)}},setState:function(n,i){var a;a=i?n:y()({},e.state[r],n);var s={};s[r]=a,s[o]=!f(a,t),e.setState(s)},isChanged:function(){return e.state[o]||!1},isItemChanged:function(e){return!f(i.getValue(e),t[e])},reset:function(){var n={};n[r]=y()({},t),n[o]=!1,e.setState(n)},getValues:function(t){return t?y()({},e.state[r]):e.state[r]||{}},getState:function(e){return i.getValues(e)},getValue:function(e,t){var n=i.getValues()[e];return void 0===n&&void 0!==t&&(n=t),n}};return i},It={resizeElementFont:Rt,resizeByQuerySelector:function(e){var t=document.querySelectorAll(e);if(!(t.length<0))for(var n=0;n<t.length;n++)Rt(t[n])},lifecycleSupport:xt,lifecycleTimer:function(e,t,n,r){var o={sequence:0,timer:void 0,interval:n,unmounted:!1},i=function(e){void 0!==e&&e!==o.sequence||o.timer&&(o.sequence++,window.clearTimeout(o.timer),o.timer=void 0)};return xt(e,(function(n){o.sequence++,n?(i(),o.unmounted=!0):r&&t.apply(e,[o.sequence])})),{startTimer:function(n){if((void 0===n||n==o.sequence)&&!o.unmounted&&(o.timer&&(o.sequence++,window.clearTimeout(o.timer)),o.interval)){var r=o.sequence;o.timer=window.setTimeout((function(){o.timer=void 0,r===o.sequence&&t.apply(e,[r])}),o.interval)}},setTimeout:function(e,t){o.interval=e,t&&(o.timer&&window.clearTimeout(o.timer),o.timer=void 0)},stopTimer:i,currentSequence:function(){return o.sequence},guardedCall:function(e,t){if(void 0===e||e===o.sequence)return t()}}},scrollInContainer:function(e,t){if(!e||!t)return!1;var n=e.getBoundingClientRect(),r=t.getBoundingClientRect();return r.top<n.top?1:r.bottom>n.bottom?2:r.left<n.left?3:r.right>n.right?4:0},keyEventHandler:At,nameKeyEventHandler:function(e,t,n){e.props&&e.props.name&&(e.props.onClick||n)&&(t||(t="widget"),At(e,(function(r,o){r==t&&o==e.props.name&&(n?n.apply(e,[r,o]):e.props.onClick())}),t,e.props.name))},IMAGES:["png","jpg","svg","bmp","tiff","gif"],storeHelper:function(e,t,n,r){var o=new jt((function(){t(Oe.getMultiple(n))}));Oe.register(o,n),xt(e,(function(e){e?Oe.deregister(o):2==r&&t(Oe.getMultiple(n))})),1==r&&t(Oe.getMultiple(n))},storeHelperState:function(e,t,n){var r=new jt((function(r){var o={};n?o[n]=Oe.getMultiple(t):o=Oe.getMultiple(t),e.setState(o)}));return e.state||(e.state={}),n?e.state[n]=Oe.getMultiple(t):y()(e.state,Oe.getMultiple(t)),Oe.register(r,t),xt(e,(function(e){e&&Oe.deregister(r)})),{setValue:function(e,n){var r=t[e];r&&Oe.storeData(r,n)},setMultiple:function(e){Oe.storeMultiple(e,t,!1,!0)}}},stateHelper:Lt,getServerCommand:function(e){return wt.getJson({request:"api",type:"command",action:"getCommands"}).then((function(t){if(t.data)for(var n=0;n<t.data.length;n++)if(t.data[n].name===e)return t.data[n]})).catch((function(t){return i.log("unable to query server command "+e)}))}};function Mt(e){return Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mt(e)}function _t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ft(r.key),r)}}function Ft(e){var t=function(e,t){if("object"!=Mt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Mt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Mt(t)?t:t+""}var Bt=ve.gui.global.dimActive,Wt="dimm",Ht=function(){return e=function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.timerAction=this.timerAction.bind(this),this.timer=window.setInterval(this.timerAction(),1e3),this.timeout=t||6e4,Oe.storeData(Bt,!1),this.trigger=this.trigger.bind(this),this.activate=this.activate.bind(this),this.buttonDef=this.buttonDef.bind(this),this.toggle=this.toggle.bind(this),this.mode="manual",this.actionFunction=void 0,this.lastTrigger=0,this.lastOff=0,Ke.subscribe("dimm",(function(e){e.value!==Oe.getData(Bt)&&(e.value?n.activate(!0):n.trigger(!0))}))},(t=[{key:"init",value:function(){var e=this,t=d.getParam(Wt);if(t)if(t.match(/^server:/)){var n=t.replace(/^server:/,"");It.getServerCommand(n).then((function(r){r&&(e.actionFunction=function(e){wt.getJson({request:"api",type:"command",action:"runCommand",name:n,parameter:e+""}).then((function(e){})).catch((function(e){return i.log("cannot execute command "+n+": "+e)}))},Ke.addUrlParameter(Wt,t))})).catch((function(e){return i.log("cannot get command for dim: "+n)}))}else"true"===t&&(this.actionFunction=function(e){console.log("dimm called with "+e)});else{try{window&&window.bonjourBrowser&&window.bonjourBrowser.dimScreen&&(this.actionFunction=window.bonjourBrowser.dimScreen.bind(window.bonjourBrowser))}catch(e){}if(!this.actionFunction)try{window.avnavAndroid&&window.avnavAndroid.dimScreen&&(this.actionFunction=window.avnavAndroid.dimScreen.bind(window.avnavAndroid))}catch(e){}}}},{key:"activate",value:function(e){if(("manual"==this.mode||"timer"==this.mode)&&this.enabled()){Oe.storeData(Bt,!0);var t=parseInt(Oe.getData(ve.properties.dimFade,0));t<0&&(t=0),t>100&&(t=100),this.actionFunction(t),e||Ke.sendToFrame("dimm",{value:!0})}}},{key:"setMode",value:function(e){if("manual"!=this.mode&&"timer"!=this.mode&&"off"!=this.mode)return!1;this.mode=e,this.trigger()}},{key:"timerAction",value:function(){if("timer"==this.mode){if(Oe.getData(Bt,!1))return;(new Date).getTime()>this.lastTrigger+this.timeout&&this.activate()}}},{key:"trigger",value:function(e){var t=(new Date).getTime();this.lastTrigger=t,this.isActive()&&(this.lastOff=t),Oe.storeData(Bt,!1),this.actionFunction&&this.actionFunction(100),e||Ke.sendToFrame("dimm",{value:!1})}},{key:"toggle",value:function(){if(this.isActive())this.trigger();else{var e=(new Date).getTime();if(this.lastOff>e-parseFloat(Oe.getData(ve.properties.remoteDimGuard,200)))return;this.activate()}}},{key:"isActive",value:function(){return Oe.getData(Bt,!1)}},{key:"canHandle",value:function(){return void 0!==this.actionFunction}},{key:"enabled",value:function(){return this.canHandle()&&Oe.getData(ve.properties.showDimButton,!1)}},{key:"buttonDef",value:function(){var e=this;return{name:"Dim",onClick:function(){return e.activate()},visible:this.enabled(),overflow:!0}}}])&&_t(e.prototype,t),n&&_t(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}(),Vt=new Ht;function Kt(e){return Kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kt(e)}function Ut(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,qt(r.key),r)}}function qt(e){var t=function(e,t){if("object"!=Kt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Kt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Kt(t)?t:t+""}var zt="remote.",Gt={setPage:"CP",key:"K",setChart:"CM",setCenter:"CC",setZoom:"CZ",lock:"CL",courseUp:"CU",gpsNum:"CN",addOn:"CA"},Zt=function(){return e=function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.timerCall=this.timerCall.bind(this),this.timer=void 0,this.websocket=void 0,this.pubsub=new r.A,this.channel=Oe.getData(ve.properties.remoteChannelName,"0"),this.channelChanged=this.channelChanged.bind(this),this.android=window.avnavAndroid,this.android&&(this.token=Pt.subscribe("remoteMessage",(function(e){window.setTimeout((function(){for(;;){var e=n.android.readChannelMessage(n.websocket);if(!e)break;n.onMessage(e)}}),0)})),this.closeToken=Pt.subscribe("channelClose",(function(e){e.id===n.websocket&&n.close()}))),this.id=0,Oe.register((function(){n.checkEnabled()}),[ve.nav.gps.updateconfig])},(t=[{key:"close",value:function(){if(void 0!==this.websocket){if(this.android){try{this.android.channelClose(this.websocket)}catch(e){}return void(this.websocket=void 0)}try{this.websocket.close()}catch(e){}this.websocket=void 0}}},{key:"channelChanged",value:function(){var e=Oe.getData(ve.properties.remoteChannelName,"0");e!==this.channel&&(this.channel=e,this.close(),this.openWebSocket())}},{key:"queryEnabled",value:function(){return wt.getJson({request:"api",type:"remotechannels",command:"enabled"}).then((function(e){return e.enabled}),(function(e){return i.log("unable to query websocket enabled state"),!1}))}},{key:"checkEnabled",value:function(){this.queryEnabled().then((function(e){Oe.storeData(ve.gui.global.remoteChannelActive,e)}))}},{key:"isActive",value:function(){return Oe.getData(ve.gui.capabilities.remoteChannel)&&Oe.getData(ve.gui.global.remoteChannelActive)}},{key:"timerCall",value:function(){void 0===this.websocket?this.isActive()&&this.openWebSocket():this.isActive()||this.close(),Oe.storeData(ve.gui.global.remoteChannelState,{connected:void 0!==this.websocket,channel:this.channel})}},{key:"start",value:function(){var e=this;void 0!==window.WebSocket&&(Oe.register(this.channelChanged,[ve.properties.remoteChannelName]),this.channel=Oe.getData(ve.properties.remoteChannelName,"0"),this.queryEnabled().then((function(t){Oe.storeData(ve.gui.global.remoteChannelActive,t),e.isActive()&&e.openWebSocket()})),this.timer=window.setInterval(this.timerCall,1e3))}},{key:"onMessage",value:function(e){var t=this;if(i.log("message",e),Oe.getData(ve.properties.remoteChannelRead,!1)&&Oe.getData(ve.properties.connectedMode,!1)){var n=e.split(/  */);n.length<2||!n[0]in Gt||(e=e.replace(/^[^ ]* */,""),window.setTimeout((function(){Vt.trigger(),t.pubsub.publish(zt+n[0],e)}),0))}}},{key:"openWebSocket",value:function(){var e=this;if(this.isActive()){if(this.close(),this.android)return this.websocket=this.android.channelOpen("/remotechannels/"+this.channel),void(this.websocket<0&&(this.websocket=void 0));this.id++;var t=this.id,n="ws://"+window.location.host+"/remotechannels/"+this.channel;try{console.log("opening websocket to ",n),this.websocket=new WebSocket(n),this.websocket.addEventListener("message",(function(n){t===e.id&&e.onMessage(n.data)})),this.websocket.addEventListener("close",(function(){console.log("websocket closed"),t===e.id&&(e.websocket=void 0)})),this.websocket.addEventListener("error",(function(){if(console.log("websocket error"),t===e.id){try{e.websocket.close()}catch(e){}e.websocket=void 0}}))}catch(e){i.log("error opening websocket channel")}}}},{key:"stop",value:function(){Oe.deregister(this.channelChanged),void 0!==this.timer&&(window.clearInterval(this.timer),this.timer=void 0),this.close()}},{key:"sendMessage",value:function(e,t){if(this.websocket&&Oe.getData(ve.properties.remoteChannelWrite,!1)&&Oe.getData(ve.properties.connectedMode,!1))try{void 0!==t&&(e+=" "+t),this.android?this.android.sendChannelMessage(this.websocket,e):this.websocket.send(e)}catch(e){}}},{key:"sendJsonMessage",value:function(e,t){var n=JSON.stringify(t);this.sendMessage(e,n)}},{key:"subscribe",value:function(e,t){return this.pubsub.subscribe(zt+e,t)}},{key:"unsubscribe",value:function(e){return this.pubsub.unsubscribe(e)}}])&&Ut(e.prototype,t),n&&Ut(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}(),Xt=new Zt;function Jt(e){return Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jt(e)}function Yt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,$t(r.key),r)}}function Qt(e,t,n){return t&&Yt(e.prototype,t),n&&Yt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function $t(e){var t=function(e,t){if("object"!=Jt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Jt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Jt(t)?t:t+""}function en(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var tn=Qt((function e(t,n,r,o){en(this,e),this.component=r,this.action=o,this.page=n,this.idx=t})),nn=function(){return Qt((function e(){var t=this;en(this,e),this.keymappings={},this.merges={},this.mergeLevels=[],this.registrations={},this.page=void 0,this.ALLPAGES="all",this.enabled=!0,this.dialogComponents=[],this.remoteSubscription=Xt.subscribe(Gt.key,(function(e){t.handleKey(e)}))}),[{key:"disable",value:function(){this.enabled=!1}},{key:"enable",value:function(){this.enabled=!0}},{key:"registerDialogComponent",value:function(e){this.dialogComponents.indexOf(e)>=0||this.dialogComponents.push(e)}},{key:"registerHandler",value:function(e,t,n){this.registrations[t]||(this.registrations[t]={});var r=this.registrations[t];n instanceof Array||(n=[n]);for(var o=0;o<n.length;o++)r[n[o]]||(r[n[o]]=[]),r[n[o]].indexOf(e)<0&&r[n[o]].push(e);return!0}},{key:"deregisterHandler",value:function(e){for(var t in this.registrations){var n=this.registrations[t];for(var r in n){var o=n[r],i=o.indexOf(e);i>=0&&o.splice(i,1)}}}},{key:"registerMappings",value:function(e){this.keymappings=e}},{key:"mergeMappings",value:function(e,t){this.merges[e]=t,this.mergeLevels.indexOf(e)<0&&(this.mergeLevels.push(e),this.mergeLevels.sort())}},{key:"resetMerge",value:function(e){delete this.merges[e];var t=this.mergeLevels.indexOf(e);t<0||(this.mergeLevels.splice(t,1),this.mergeLevels.sort())}},{key:"setPage",value:function(e){this.page=e}},{key:"findMappingForPage",value:function(e,t,n){var r=this.findMappingForPageInternal(e,t,n);if(r){var o=r.idx;void 0===o?o=0:o++;for(var i=o;i<this.mergeLevels.length;i++){var a=this.mergeLevels[i],s=this.merges[a];if(s){var l=s[r.page];if(l){var u=l[r.component];if(u&&void 0!==u[r.action])return}}}return r}}},{key:"findMappingForPageInternal",value:function(e,t,n){for(var r=void 0,o=this.mergeLevels.length-1;o>=0;o--){try{if(r=this.findMappingForType(o,e,t,n))return r;r=this.findMappingForType(o,e,this.ALLPAGES,n)}catch(e){console.log("error when searching keymapping: "+e)}if(r)return r}return(r=this.findMappingForType(void 0,e,t,n))||this.findMappingForType(void 0,e,this.ALLPAGES,n)}},{key:"hasRegistrations",value:function(e,t){var n=this.registrations[e];if(!n)return!1;for(var r in n)if(r===t)return n[r].length>0;return!1}},{key:"findMappingForType",value:function(e,t,n,r){var o;if(void 0!==e){var i=this.mergeLevels[e];o=this.merges[i]}else o=this.keymappings;if(void 0!==o&&void 0!==t&&void 0!==n&&o[n])for(var a in o[n])if(!(r&&this.dialogComponents.indexOf(a)<0)){var s=o[n][a];for(var l in s)if(this.hasRegistrations(a,l)){var u=s[l];if(u instanceof Array){for(var c in u)if(u[c]===t)return new tn(e,n,a,l)}else if(u===t)return new tn(e,n,a,l)}}}},{key:"handleKeyEvent",value:function(e,t){if(this.enabled&&e){var n=e.key;if(n)return e.ctrlKey&&(n="Control-"+n),this.handleKey(n,t,e)}}},{key:"handleKey",value:function(e,t,n){if(i.log("handle key: "+e),this.keymappings){var r=this.page,o=this.findMappingForPage(e,r,t);if(o){n&&(n.preventDefault(),n.stopPropagation()),i.log("found keymapping, page="+r+", component="+o.component+", action="+o.action);var a=this.registrations[o.component];if(a){var s=a[o.action];if(s)for(var l in s)s[l](o.component,o.action)}}}}}])}(),rn=new nn,on=JSON.parse('{"description":"The system default layout. No keys and no properties.","layoutVersion":1,"properties":{"layers":{"ais":true}},"widgets":{"gpspage1":{"left":[{"name":"BRG","weight":1.5},{"name":"DST","weight":1.5},{"name":"XteDisplay","compareState":true,"weight":1},{"name":"ETA"},{"name":"RteCombine"}],"left_anchor":[{"name":"AnchorBearing","weight":1.5},{"name":"AnchorDistance","weight":1.5},{"name":"AnchorWatchDistance"},{"name":"DepthDisplay"},{"name":"Empty"}],"right":[{"name":"COG","weight":1.5},{"name":"SOG","weight":1.5},{"name":"TimeStatus"},{"name":"Position"},{"name":"AisTarget"}]},"gpspage2":{"left":[{"name":"BRG","weight":1.5},{"name":"DST","weight":0.75},{"name":"SOG","weight":0.75},{"name":"DepthDisplay"},{"name":"ETA"},{"name":"RteCombine"}],"left_anchor":[{"name":"AnchorBearing","weight":1.5},{"name":"AnchorDistance","weight":1.5},{"name":"AnchorWatchDistance"},{"name":"DepthDisplay"},{"name":"Empty"}],"right":[{"name":"COG","weight":1.5},{"name":"WindGraphics","weight":2.5},{"name":"DateTime"},{"name":"AisTarget"}]},"gpspage3":{"left":[{"name":"BRG","caption":"BRG","unit":"°","formatterParameters":[""]},{"name":"COG","caption":"COG","unit":"°","formatterParameters":[""]},{"name":"linGauge_Compass","caption":"COG","unit":"°","storeKeys":{"value":"nav.gps.course"},"formatterParameters":[""]},{"name":"radGauge_Compass","caption":"COG","unit":"°","storeKeys":{"value":"nav.gps.course"},"formatterParameters":[""],"drawValue":true,"valueFontFactor":12,"weight":3}],"right":[{"name":"DST","caption":"DST","unit":"nm","formatterParameters":[""]},{"name":"VMG","caption":"VMG","unit":"kn","formatterParameters":[""]},{"name":"SOG","caption":"SOG","unit":"kn","formatterParameters":[""]},{"name":"radGauge_Speed","storeKeys":{"value":"nav.gps.speed"},"formatterParameters":[""],"drawValue":true,"valueFontFactor":12,"colorPlate":"#fff","minValue":0,"maxValue":"10","colorHighlight":"rgba(200, 50, 50, .75)","startHighlight":"6","weight":3,"caption":"SOG","unit":"kn"}]},"navpage":{"left":[{"name":"CenterDisplay"},{"name":"Zoom"},{"name":"WindDisplay"},{"name":"DepthDisplay"},{"name":"AisTarget"},{"name":"ActiveRoute"},{"name":"LargeTime"}],"left_small":[{"name":"ActiveRoute"}],"top_small":[{"name":"WindDisplay"},{"name":"DepthDisplay"},{"name":"AisTarget"},{"name":"LargeTime"},{"name":"Zoom"}],"bottomLeft":[{"name":"BRG"},{"name":"DST"},{"name":"ETA"},{"name":"WpPosition"}],"bottomRight":[{"name":"COG"},{"name":"SOG"},{"name":"TimeStatus"},{"name":"Position"}],"bottomLeft_anchor":[{"name":"AnchorBearing","caption":"ACHR-BRG","unit":"°"},{"name":"AnchorDistance","caption":"ACHR-DST","unit":"m","formatterParameters":["m"]},{"name":"AnchorWatchDistance","caption":"ACHR-WATCH","unit":"m","formatterParameters":[3,1]}]},"editroutepage":{"left":[{"name":"EditRoute"},{"name":"RoutePoints"}],"left_small":[],"top_small":[{"name":"EditRoute"}],"bottomLeft":[{"name":"BRG"},{"name":"DST"},{"name":"ETA"},{"name":"WpPosition"}],"bottomRight":[{"name":"COG"},{"name":"SOG"},{"name":"TimeStatus"},{"name":"Position"}]}}}');function an(e){return an="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},an(e)}function sn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ln(r.key),r)}}function ln(e){var t=function(e,t){if("object"!=an(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=an(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==an(t)?t:t+""}var un="system.default",cn=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.layout=void 0,this.name=void 0,this.propertyDescriptions=de.getKeyDescriptions(!0),this.storeLocally=!Oe.getData(ve.gui.capabilities.uploadLayout,!1),this.temporaryLayouts={},this.temporaryLayouts[un]=on,this.dataChanged=this.dataChanged.bind(this),this._setEditing(!1),this.hiddenPanels={},this.temporaryOptions={},Oe.register(this,ve.gui.capabilities.uploadLayout)},t=[{key:"dataChanged",value:function(e){this.storeLocally=!Oe.getData(ve.gui.capabilities.uploadLayout,!1)}},{key:"hasLoaded",value:function(e){return e==this.name&&this.layout}},{key:"isActiveLayout",value:function(e){return void 0===e&&(e=this.name),e==Oe.getData(ve.properties.layoutName)}},{key:"canEdit",value:function(e){return void 0===e&&(e=this.name),!!e&&!!e.match(/^user\./)}},{key:"startEditing",value:function(e){if(!this.canEdit(e))return!1;this.name=e,this._setEditing(!0),this.setTemporaryOptionValues()}},{key:"isEditing",value:function(){return this.editing}},{key:"loadStoredLayout",value:function(e){var t=this,n=this;return new Promise((function(r,o){var i=Oe.getData(ve.properties.layoutName);if(i!==un&&!e){var a=t._loadFromStorage();if(a&&a.name==i&&a.data)return t.name=a.name,t.layout=a.data,t.temporaryLayouts[t.name]=t.layout,n.activateLayout(),void r(t.layout)}t.loadLayout(i).then((function(e){t.activateLayout(),r(t.layout)})).catch((function(a){if(e){var s=t._loadFromStorage();if(s&&s.name==i&&s.data)return t.name=s.name,t.layout=s.data,t.temporaryLayouts[t.name]=t.layout,n.activateLayout(),void r(t.layout)}var l=de.getKeyDescriptions()[ve.properties.layoutName];l&&l.defaultv?i!=l.defaultv&&(Oe.storeData(ve.properties.layoutName,l.defaultv),n.loadLayout(l.defaultv).then((function(){n.activateLayout(),r(n.layout)})).catch((function(e){o("unable to load default layout: "+e)}))):o("unable to load application layout "+i+": "+a)}))}))}},{key:"_loadFromStorage",value:function(){try{var e=Fe.getItem(Me.LAYOUT);if(e)return JSON.parse(e)}catch(e){i.log("error when trying to read layout locally: "+e)}}},{key:"_setEditing",value:function(e){this.editing=e,Oe.storeData(ve.gui.global.layoutEditing,e)}},{key:"loadLayout",value:function(e,t){var n=this,r=this;return t||(this.layout=void 0,this.name=e,this._setEditing(!1)),new Promise((function(o,a){if(n.storeLocally)if(n.temporaryLayouts[e]){var s=n.temporaryLayouts[e];t||(n.layout=s),o(s)}else a("layout "+e+" not found");else wt.getJson("?request=download&noattach=true&type=layout&name="+encodeURIComponent(e),{checkOk:!1}).then((function(e){var i=r.checkLayout(e);void 0===i?(t||(n.layout=e),o(e)):a("layout error: "+i)}),(function(s){try{var l=Fe.getItem(Me.LAYOUT);if(l){var u=JSON.parse(l);if(u.name==e&&u.data)return t||(n.layout=u.data,e.match(/^user\./)&&r.uploadLayout(e.replace(/^user\./,""),n.layout).then((function(){})).catch((function(){}))),void o(u.data)}}catch(e){i.log("error when trying to read layout locally: "+e)}a(""+s)}))}))}},{key:"nameToBaseName",value:function(e){return e.replace(/^user\./,"").replace(/^system\./,"").replace(/^plugin\./,"").replace(/\.json$/,"").replace(/.*\./,"")}},{key:"uploadLayout",value:function(e,t,n){var r=this;return e&&t?(e=this.nameToBaseName(e),new Promise((function(o,i){try{"string"==typeof t&&(t=JSON.parse(t));var a=r.checkLayout(t);if(a)return void i(a)}catch(e){return void i(e)}var s=r.fileNameToServerName(e),l=r.isActiveLayout(s);if(r.storeLocally)return r.temporaryLayouts[s]=t,l&&(r.name=s,r.layout=t,r.activateLayout()),void o({status:"OK"});wt.postPlain({request:"upload",type:"layout",name:s,overwrite:!!n},JSON.stringify(t,void 0,2)).then((function(e){l&&(r.name=s,r.layout=t,r.activateLayout()),o(e)})).catch((function(e){i(e)}))}))):new Promise((function(e,t){t("missing parameter name or layout")}))}},{key:"fileNameToServerName",value:function(e){return"user."+(e=this.nameToBaseName(e))}},{key:"checkLayout",value:function(e){return e.layoutVersion?e.widgets?void 0:"no property widgets found in Layout":"no layoutVersion found in layout"}},{key:"getLayoutWidgets",value:function(){return this.layout&&this.layout.widgets?this.layout.widgets:{}}},{key:"activateLayout",value:function(e){if(this._removeHiddenPanels(),this._setEditing(!1),!this.layout)return!1;try{Fe.setItem(Me.LAYOUT,void 0,JSON.stringify({name:this.name,data:this.layout}))}catch(e){i.log("unable to store layout locally")}return rn.resetMerge(1),this.layout.keys&&rn.mergeMappings(1,this.layout.keys),Oe.storeData(ve.properties.layoutName,this.name),this.incrementSequence(),e&&this.uploadLayout(this.name,this.layout,!0).then((function(){})).catch((function(e){i.log("unable to upload layout "+e)})),!0}},{key:"incrementSequence",value:function(){var e=Oe.getData(ve.gui.global.layoutSequence,0);Oe.storeData(ve.gui.global.layoutSequence,e+1)}},{key:"_isHiddenPanel",value:function(e,t){if(!this.isEditing())return!1;var n=this.hiddenPanels[e];return n?!!n[t]:void 0}},{key:"_setHiddenPanel",value:function(e,t,n){var r=this.hiddenPanels[e];r||(r={},this.hiddenPanels[e]=r),r[t]=n}},{key:"_removeHiddenPanels",value:function(){if(this.isEditing()){for(var e in this.hiddenPanels){var t=this.getPageData(e);if(t){var n=this.hiddenPanels[e];for(var r in n)n[r]&&delete t[r]}}this.hiddenPanels={}}}},{key:"getPageData",value:function(e,t){var n=this.getLayoutWidgets();if(n){var r=n[e];if(!r){if(!this.isEditing()||!t)return;r={},n[e]=r}if("object"===an(r))return r}}},{key:"getAllOptions",value:function(){var e={};for(var t in this.OPTIONS)e[this.OPTIONS[t]]=!0;return e}},{key:"getOptionsAsArray",value:function(){var e=[];for(var t in this.OPTIONS)e.push(this.OPTIONS[t]);return e}},{key:"getPanelTryList",value:function(e,t){t||(t=[]);var n=e,r=[n];for(var o in this.OPTIONS)t[this.OPTIONS[o]]&&(n+="_"+this.OPTIONS[o],r.push(n));for(var i=[],a=r.length-1;a>=0;a--)i.push(r[a]);return i}},{key:"getPanelData",value:function(e,t,n){if(!this.getPageData(e))return{name:t};for(var r=this.getPanelTryList(t,n),o=0;o<r.length;o++){var i=this.getDirectPanelData(e,r[o]);if(i)return{name:r[o],list:i}}return{name:t}}},{key:"getDirectPanelData",value:function(e,t,n){var r=this.getPageData(e,n);if(r){var o=r[t];if(!o){if(!n||!this.isEditing())return;o=[],r[t]=o}if(this._isHiddenPanel(e,t)){if(!n)return;this._setHiddenPanel(e,t,!1)}return o}}},{key:"removePanel",value:function(e,t){return!!this.isEditing()&&(this._setHiddenPanel(e,t,!0),!0)}},{key:"getItem",value:function(e,t,n){if(this.isEditing()){var r=this.getDirectPanelData(e,t);if(r&&!(n<0||n>=r.length))return r[n]}}},{key:"getPagePanels",value:function(e){var t=[],n=this.getPageData(e);if(!n)return t;for(var r in n)this._isHiddenPanel(e,r)||t.push(r);return t}},{key:"replaceItem",value:function(e,t,n,r,o){if(!this.isEditing())return!1;var i=void 0!==o&&o!==this.ADD_MODES.noAdd;if(i&&!r)return!1;var a={};if(r)for(var s in r)"key"!==s&&"index"!==s&&"wclass"!==s&&"function"!=typeof r[s]&&(a[s]=r[s]);var l=this.getDirectPanelData(e,t,i);if(!l)return!1;if(i){if(o==this.ADD_MODES.beginning)return l.splice(0,0,a),this.incrementSequence(),!0;if(o==this.ADD_MODES.end)return l.push(a),this.incrementSequence(),!0}return!(n<0||n>=l.length||(i?o==this.ADD_MODES.afterIndex?(n==l.length-1?l.push(a):l.splice(n+1,0,a),this.incrementSequence(),0):o!=this.ADD_MODES.beforeIndex||(l.splice(n,0,a),this.incrementSequence(),0):(r?l.splice(n,1,a):l.splice(n,1),this.incrementSequence(),0)))}},{key:"moveItem",value:function(e,t,n,r){if(n==r)return!0;if(!this.isEditing())return!1;var o=this.getDirectPanelData(e,t);if(!o)return!1;if(n<0||n>=o.length)return!1;if(r<0||r>=o.length)return!1;var i=o[n];return o.splice(n,1),o.splice(r,0,i),this.incrementSequence(),!0}},{key:"listLayouts",value:function(){var e=this;return new Promise((function(t,n){var r=Oe.getData(ve.properties.layoutName);if(e.storeLocally){var o=[];for(var i in e.temporaryLayouts){var a={name:i,type:"layout",server:!1,canDelete:i!=r,active:i==r,time:(new Date).getTime()/1e3};o.push(a)}t(o)}else wt.getJson("?request=listdir&type=layout").then((function(e){for(var n=[],o=0;o<e.items.length;o++){var i={};y()(i,e.items[o]),i.type="layout",i.server=!0,r==i.name&&(i.canDelete=!1,i.active=!0),n.push(i)}t(n)})).catch((function(e){n(e)}))}))}},{key:"getLocalDownload",value:function(){var e=this;if(this.storeLocally)return function(t){var n=e.temporaryLayouts[t];if(n)return JSON.stringify(n,null,2)}}},{key:"deleteItem",value:function(e){var t=this;return this.storeLocally?new Promise((function(n,r){delete t.temporaryLayouts[e],n(!0)})):wt.getJson({request:"delete",type:"layout",name:e})}},{key:"getStoreKeys",value:function(e){var t={layoutSequence:ve.gui.global.layoutSequence,isEditing:ve.gui.global.layoutEditing};return t["layout"+this.OPTIONS.ANCHOR]=ve.nav.anchor.watchDistance,t["layout"+this.OPTIONS.SMALL]=ve.gui.global.smallDisplay,y()(t,e)}},{key:"setTemporaryOptionValues",value:function(e){this.isEditing()&&(e||(this.temporaryOptions=this.getOptionValues(this.getOptionsAsArray(),!0)),this.temporaryOptions=y()({},this.temporaryOptions,e),this.incrementSequence())}},{key:"getOptionValues",value:function(e,t){if(this.isEditing()&&!t)return this.temporaryOptions;var n={},r=this.getStoreKeys();return e.forEach((function(e){var t=r["layout"+e];t&&(n[e]=Oe.getData(t,!1))})),n}}],t&&sn(e.prototype,t),n&&sn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();cn.prototype.OPTIONS={SMALL:"small",ANCHOR:"anchor"},cn.prototype.ADD_MODES={noAdd:0,beginning:1,end:2,beforeIndex:3,afterIndex:4};var pn=new cn;function fn(e){return fn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fn(e)}function hn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,mn(r.key),r)}}function mn(e){var t=function(e,t){if("object"!=fn(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=fn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==fn(t)?t:t+""}var dn=function(){return e=function e(t){var n=this;for(var r in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.propertyPrefix=de.keyNodeToString(ve.properties)+".",this.propertyDescriptions=de.getKeyDescriptions(!0),this.getProperties=this.getProperties.bind(this),this.saveUserData=this.saveUserData.bind(this),this.getColor=this.getColor.bind(this),this.getAisColor=this.getAisColor.bind(this),this.incrementSequence=this.incrementSequence.bind(this),this.dataChanged=this.dataChanged.bind(this),this.resetToSaved=this.resetToSaved.bind(this),this.prefixKeys=[],this.propertyDescriptions)this.propertyDescriptions[r]instanceof ue&&this.prefixKeys.push(r);Oe.register(this,ve.properties),Fe.hasStorage()?(this.incrementSequence(),Ke.subscribe("reloadSettings",(function(){n.resetToSaved(),n.incrementSequence()}))):ct("local storage is not available, seems that your browser is not HTML5... - application will not work")},t=[{key:"setPrefixKeys",value:function(e){var t=this;if(!(e instanceof Array))throw new Error("prefix keys must be an array");var n=[];e.forEach((function(e){0!==e.indexOf(t.propertyPrefix)&&(e=t.propertyPrefix+e),n.push(e)})),this.prefixKeys=n}},{key:"loadUserData",value:function(e){var t={};if(e&&!Fe.hasPrefix())return t;var n=e?Me.SPLITSETTINGS:Me.SETTINGS;try{var r=Fe.getItem(n);if(r)return JSON.parse(r)}catch(e){i.log("unable to load user data from "+n)}return t}},{key:"incrementSequence",value:function(){Oe.storeData(ve.gui.global.propertySequence,Oe.getData(ve.gui.global.propertySequence,0)+1)}},{key:"getProperties",value:function(){return Oe.getMultiple(ve.properties)}},{key:"saveUserData",value:function(e,t){var n=JSON.stringify(e);Fe.setItem(t?Me.SPLITSETTINGS:Me.SETTINGS,void 0,n),Ke.sendToFrame("settingsChanged")}},{key:"setItem",value:function(e,t,n,r){e||(e={});for(var o=e,i=t.split("."),a=r||0;a<i.length;a++){var s=i[a];a<i.length-1?("object"!==fn(o[s])&&(o[s]={}),o=o[s]):o[s]=n}return e}},{key:"savePrefixedValues",value:function(){var e={};if(Fe.hasPrefix()){for(var t in this.propertyDescriptions){var n=Oe.getData(t);this.prefixKeys.indexOf(t)>=0&&this.setItem(e,t,n,1)}this.saveUserData(e,!0)}}},{key:"dataChanged",value:function(e){var t={},n={},r=Fe.hasPrefix();for(var o in this.propertyDescriptions){var i=Oe.getData(o);this.prefixKeys.indexOf(o)>=0&&r?this.setItem(n,o,i,1):i!==this.propertyDescriptions[o].defaultv&&this.setItem(t,o,i,1)}this.saveUserData(t),r&&this.saveUserData(n,!0),this.incrementSequence()}},{key:"getColor",value:function(e,t){var n,r,o=Oe.getData(de.keyNodeToString(ve.properties.style)+"."+e);if(void 0===o)return o;if((void 0===t||t)&&Oe.getData(ve.properties.nightMode)){var i=Oe.getData(ve.properties.nightColorDim);return n=i/100,r=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/.exec(o),"rgba("+parseInt(r[1],16)+","+parseInt(r[2],16)+","+parseInt(r[3],16)+","+n+")"}return o}},{key:"getAisColor",value:function(e){return e.warning?this.getColor("aisWarningColor"):e.nearest?this.getColor("aisNearestColor"):e.tracking?this.getColor("aisTrackingColor"):this.getColor("aisNormalColor")}},{key:"resetToSaved",value:function(){var e=de.getDefaultKeyValues();Oe.storeMultiple(e,void 0,!0);try{var t=this.loadUserData(),n=this.loadUserData(!0);if(t){var r={};for(var o in this.propertyDescriptions){var a=de.getValue(t,o,1);if(this.prefixKeys.indexOf(o)>=0){var s=de.getValue(n,o,1);void 0!==s&&(a=s)}void 0!==a&&a!==Oe.getData(o)&&(r[o]=a)}Oe.storeMultiple(r,void 0,!0,!0)}}catch(e){i.log("Exception reading user data "+e)}Oe.storeData(ve.gui.global.propertiesLoaded,!0)}},{key:"firstStart",value:function(){var e={};for(var t in this.propertyDescriptions){var n=this.propertyDescriptions[t];void 0!==n.initialValue&&(e[t]=n.initialValue)}Oe.storeMultiple(e)}},{key:"verifySettingsData",value:function(e,t,n,r){return new Promise((function(o,i){var a=[],s=function(e,r){if(r&&n||!r&&t)return i(e),!0;a.push(e)};if("string"==typeof e)try{e=JSON.parse(e)}catch(e){return void i("unable to parse json: "+e)}var l=e.settingsVersion;if(void 0!==l)if("object"===fn(e.properties)){var u,c={},p=de.getKeyDescriptions(!0),f=[],h=function(n){var o="properties."+n;if(!(o in p))return s(n+" is no existing property",!0)?{v:void 0}:0;var i=p[o],l=e.properties[n];if(r&&"string"==typeof l)for(var u in r)l=l.replace("$"+u+"$",r[u]);var h=l;switch(i.type){case se.MULTICHECKBOX:if("object"!==fn(l)&&s("invalid type "+fn(l)+" for "+n))return{v:void 0};c[n]=l;break;case se.CHECKBOX:"boolean"!=typeof l&&(l="string"==typeof l?"true"===l.toLowerCase():!!l),c[n]=l;break;case se.RANGE:if("number"!=typeof l&&(l=parseFloat(l),isNaN(l)&&(l=i.values[0],s("nan "+h+"(=>"+l+") for "+n))))return{v:void 0};if(l>i.values[1]&&(h=l,l=i.values[1],s(h+" to big (=>"+l+") for "+n)))return{v:void 0};if(l<i.values[0]&&(h=l,l=i.values[0],s(h+" to small (=>"+l+") for "+n)))return{v:void 0};c[n]=l;break;case se.COLOR:if("string"!=typeof l&&s("invalid color "+h+"(=>"+(l+="")+") for "+n))return{v:void 0};c[n]=l;break;case se.LIST:case se.SELECT:var m=!1;if(i.values.forEach((function(e){e instanceof Object?e.value===l&&(m=!0):e===l&&(m=!0)})),!m&&(l=i.values[0],s(h+" is not a valid value (=>"+l+") for "+n)))return{v:void 0};c[n]=l;break;case se.LAYOUT:f.push(pn.loadLayout(l,!0).then((function(e){var t={};return t[n]=l,t}),(function(e){var r=n+": "+l+": "+e;return t?Promise.reject(r):(a.push(r),{})})));break;default:if(s(n+": cannot be set",!0))return{v:void 0}}};for(var m in e.properties)if(0!==(u=h(m))&&u)return u.v;Promise.all(f).then((function(e){e.forEach((function(e){for(var t in e)c[t]=e[t]})),o({warnings:a,data:{settingsVersion:l,properties:c}})})).catch((function(e){return i(e)}))}else i("no properties found");else i("no settings version found")}))}},{key:"uploadSettingsData",value:function(e,t,n,r){if(!Oe.getData(ve.properties.connectedMode,!1))return Promise.reject("not in connected mode, cannot upload");var o=function(t){return"string"!=typeof t&&(t=JSON.stringify(t,void 0,2)),wt.postPlain({request:"upload",type:"settings",name:e,overwrite:!!r},t)};return n?this.verifySettingsData(t,!0,!0).then((function(e){return o(e.data)})):o(t)}},{key:"exportSettings",value:function(e){var t=de.getKeyDescriptions(!0),n={};if(!e){var r=Object.keys(t);e=Oe.getMultiple(r)}for(var o in t){var i=t[o],a=!1;for(var s in se)if(se[s]===i.type&&se[s]!==se.INTERNAL){a=!0;break}a&&e[o]!==i.defaultv&&(n[o.replace(/^properties\./,"")]=e[o])}return{settingsVersion:1,properties:n}}},{key:"importSettings",value:function(e,t,n){return new Promise((function(r,o){if(void 0!==e.settingsVersion)if("object"===fn(e.properties)){var i,a=e.properties,s=de.getKeyDescriptions(!0),l=y()({},t);for(var u in s){var c=s[u],p=!1;for(var f in se)if(se[f]===c.type&&c.type!==se.INTERNAL){p=!0;break}if(p){var h=u.replace(/^properties\./,"");h in a?(l[u]=a[h],c.type===se.LAYOUT&&(i=l[u])):n&&(l[u]=c.defaultv,c.type===se.LAYOUT&&(i=l[u]))}}i?pn.loadLayout(i).then((function(e){r(l)})).catch((function(e){return o("unable to load layout: "+e)})):r(l)}else o("missing or invalid properties");else o("missing settingsVersion")}))}},{key:"listSettings",value:function(e){return Oe.getData(ve.gui.capabilities.uploadSettings,!1)?wt.getJson({request:"listdir",type:"settings"}).then((function(t){if(!e)return t.items;var n=[];return t.items.forEach((function(e){return n.push({label:e.name,value:e.name})})),n})):Promise.resolve([])}},{key:"isPrefixProperty",value:function(e){return!(!e||!Fe.hasPrefix())&&(0!==e.indexOf(this.propertyPrefix)&&(e=this.propertyPrefix+key),this.prefixKeys.indexOf(e)>=0)}},{key:"getMasterValues",value:function(){var e=this,t=this.loadUserData(),n={};return this.prefixKeys.forEach((function(r){var o=de.getValue(t,r,1);if(void 0!==o)n[r]=o;else{var i=e.propertyDescriptions[r];n[r]=i?i.defaultv:void 0}})),n}}],t&&hn(e.prototype,t),n&&hn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}(),vn=new dn,yn=n(92263),gn=n.p+"images/ais-aton.png",bn=n(82240),wn=n.n(bn);function kn(e){return kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kn(e)}function Cn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Sn(r.key),r)}}function Sn(e){var t=function(e,t){if("object"!=kn(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=kn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==kn(t)?t:t+""}var En="#f7c204",On=function(){return e=function e(t,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.src=n,this.style=r,this.loaded=!1,this.image=void 0,this.ghostImage=void 0,this.color=void 0,this.ghostFactor=void 0,this.replaceColor=o,this.sequence=1,this.colorStyle=t},t=[{key:"load",value:function(e){var t=this;if(void 0!==this.src){var n=Oe.getData(de.keyNodeToString(ve.properties.style)+"."+this.colorStyle);if(n){this.sequence++;var r=this.sequence;if(this.loaded||(this.image=void 0,this.ghostImage=void 0),this.image&&void 0!==this.replaceColor&&this.color!==n&&(this.image=void 0),this.image){if(void 0===e)return this.ghostFactor=void 0,void(this.ghostImage=void 0);if(this.ghostFactor===e)return;this.ghostImage=void 0}this.loaded=!1,this.color=n,this.ghostFactor=e,this.image?(this.ghostImage=new Image,this.ghostImage.onload=function(){r===t.sequence&&(t.loaded=!0)},Dn(this.image,e).then((function(e){r===t.sequence&&(t.ghostImage.src=e)}))):(this.image=new Image,void 0!==e?(this.ghostImage=new Image,this.ghostImage.onload=function(){r===t.sequence&&(t.loaded=!0)},this.image.onload=function(){r===t.sequence&&Dn(t.image,e).then((function(e){r===t.sequence&&(t.ghostImage.src=e)}))}):this.image.onload=function(){r===t.sequence&&(t.loaded=!0)},void 0!==this.replaceColor?Pn(this.src,this.replaceColor,n).then((function(e){r===t.sequence&&(t.image.src=e)})):this.image.src=this.src)}}}}],t&&Cn(e.prototype,t),n&&Cn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}(),Pn=function(e,t,n){return new Promise((function(r,o){var i=document.createElement("canvas");if(i){var a=(0,yn.A)(t).toRgb(),s=(0,yn.A)(n).toRgb(),l=new Image;l.onload=function(){var e=i.getContext("2d");i.height=l.height,i.width=l.width,e.drawImage(l,0,0,l.width,l.height);for(var t=e.getImageData(0,0,l.width,l.height),n=!1,o=0;o<t.data.length;o+=4)t.data[o]===a.r&&t.data[o+1]===a.g&&t.data[o+2]===a.b&&(n=!0,t.data[o]=s.r,t.data[o+1]=s.g,t.data[o+2]=s.b);n&&e.putImageData(t,0,0),r(i.toDataURL())},l.onerror=function(){r("data:,error")},l.src=e}else o("no canvas")}))},Dn=function(e,t){return new Promise((function(n,r){var o=document.createElement("canvas");if(o){var i=o.getContext("2d");if(o.height=e.height,o.width=e.width,i.drawImage(e,0,0,e.width,e.height),1!==t&&t>0){for(var a=i.getImageData(0,0,e.width,e.height),s=0;s<a.data.length;s+=4){var l=Math.floor(a.data[s+3]*t);l>255&&(l=255),a.data[s+3]=l}i.putImageData(a,0,0)}n(o.toDataURL())}else r("no canvas")}))},Tn=function(e){this.mapholder=e,this.textStyle={},this.setStyles(),this.symbolStyles={},this.atonStyles={},this.createInternalIcons(),this.computeStyles(),this.pixel=[],this.visible=Oe.getData(ve.properties.layers.ais),Oe.register(this,ve.gui.global.propertySequence),this.computeTarget=this.computeTarget.bind(this)};Tn.prototype.createIcon=function(e,t){var n=document.createElement("canvas");if(n){var r=t?0:200;n.width=100,n.height=r+100;var o=n.getContext("2d");return o.strokeStyle="rgba(0,0,0,0)",o.lineCap="butt",o.lineJoin="miter",o.lineWidth=parseInt(Oe.getData(ve.properties.aisIconBorderWidth,1)),o.miterLimit=4,o.fillStyle=e,o.strokeStyle="#000000",o.lineCap="butt",o.lineJoin="miter",o.beginPath(),o.moveTo(23.5,r+97.875),o.lineTo(50,r),o.lineTo(76.5,r+97.875),o.lineTo(23.5,r+97.875),o.closePath(),o.fill(),o.stroke(),t||(o.fillStyle="rgba(0, 0, 0, 0)",o.strokeStyle=e,o.lineWidth=4,o.lineCap="butt",o.lineJoin="miter",o.beginPath(),o.moveTo(50,200),o.lineTo(50,3),o.fill(),o.stroke()),n.toDataURL()}};var Nn={nearest:"aisNearestColor",warning:"aisWarningColor",tracking:"aisTrackingColor",normal:"aisNormalColor"};Tn.prototype.createInternalIcons=function(){var e=Oe.getMultiple(ve.properties.style),t=Oe.getData(ve.properties.aisUseCourseVector,!1),n=t?this.targetStyleCourseVector:this.targetStyle,r=this.createIcon(En,t);for(var o in Nn)this.symbolStyles["internal"+o]=new On(Nn[o],r,y()({},n,{courseVectorColor:e[Nn[o]]}),En),this.atonStyles["internal"+o]=new On(Nn[o],gn,y()({},this.atonStyle,{courseVectorColor:e[Nn[o]]}),En)},Tn.prototype.computeStyles=function(){var e=Oe.getData(ve.properties.aisShowEstimated,!1)?Oe.getData(ve.properties.aisEstimatedOpacity,.4):void 0;for(var t in this.symbolStyles){this.symbolStyles[t].load(e)}for(var n in this.atonStyles){this.atonStyles[n].load()}},Tn.prototype.findTarget=function(e){if(i.log("findAisTarget "+e[0]+","+e[1]),this.pixel){var t=Oe.getData(ve.properties.clickTolerance)/2,n=this.mapholder.findTarget(e,this.pixel,t);return n>=0?this.pixel[n].ais:void 0}},Tn.prototype.setStyles=function(){this.textStyle={stroke:"#fff",color:"#000",width:3,fontSize:Oe.getData(ve.properties.aisTextSize),fontBase:"Calibri,sans-serif",offsetY:15,align:"left"},this.targetStyle={anchor:[15,60],size:[30,90],rotation:0,rotateWithView:!0},this.targetStyleCourseVector={anchor:[15,0],size:[30,30],rotation:0,rotateWithView:!0},this.atonStyle={anchor:[15,15],size:[30,30],rotation:0,rotateWithView:!0}},Tn.prototype.getStyleEntry=function(e){var t,n,r=Z.format("clazz",e);r!==V&&r!==K||(t="-"+Z.format("shiptype",e),n=void 0!==e.status?"-status"+parseInt(e.status):void 0),r===q&&(t="-type"+e.aid_type);var o=function(e){var t="normal";return e.mmsi===Oe.getData(ve.nav.ais.trackedMmsi)&&(t="tracking"),e.warning?t="warning":e.nearest&&(t="nearest"),t}(e),i=r===q?this.atonStyles:this.symbolStyles;return function(){for(var e={style:{}},t=0;t<arguments.length;t++){var n=arguments[t];if(n){if(void 0!==n.src){if(!n.loaded)continue;e.src=n.src,e.image=n.image,e.ghostImage=n.ghostImage}y()(e.style,n.style)}}return e}(i["internal"+o],i[o],void 0!==t?i[o+t]:void 0,void 0!==n?i[o+n]:void 0,void 0!==n?i[o+t+n]:void 0)};var Rn=function(e,t){if(e)for(var n=0;n<e.length;n++)e[n]=e[n]*t};Tn.prototype.drawTargetSymbol=function(e,t,n,r,o){var i=Oe.getData(ve.properties.navBoatCourseTime,0),a=Oe.getData(ve.properties.aisUseCourseVector,!1),s=Oe.getData(ve.properties.aisCurvedVectors,!1),l=Oe.getData(ve.properties.aisRelativeMotionVectorRange,0),u=Oe.getData(ve.properties.navCircleWidth),c=Oe.getData(ve.properties.aisIconScale,1),p=Oe.getData(ve.properties.aisClassbShrink,1),f=Oe.getData(ve.properties.aisUseHeading,!0),h=Oe.getData(ve.properties.aisLostTime,0),m=Oe.getData(ve.properties.aisMinDisplaySpeed,0),v=Oe.getData(ve.nav.gps.lat,0),y=Oe.getData(ve.nav.gps.lon,0),g=Oe.getData(ve.nav.gps.course,0),b=Oe.getData(ve.nav.gps.speed,0),w=n.course||0,k=n.speed||0,C=(f&&void 0!==n.heading?n.heading:n.course)||0,S=Math.sign(n.turn||0),E=Math.abs(n.turn||0);s=s&&isFinite(E)&&E>.5;var O=this.getStyleEntry(n),D=wn()(O.style);if(O.image&&D.size){void 0!==D.alpha&&(D.alpha=parseFloat(D.alpha),isNaN(D.alpha)?D.alpha=void 0:(D.alpha<0&&(D.alpha=0),D.alpha>1&&(D.alpha=1)));var T=n.hidden||h&&n.age>h;T&&(D.alpha=.2);var N=(new Date).getTime();if(1!=p&&"B"===Z.format("clazz",n)&&(c*=p),1!=c&&(Rn(D.size,c),Rn(D.anchor,c)),void 0===D.rotate||D.rotate?(D.rotation=d.radians(C),D.rotateWithView=!0):(D.rotation=0,D.rotateWithView=!1),!T){var R=void 0!==o,x=function(t,n,o,i,a,s){for(var l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,c=Math.max(3,Math.ceil(Math.abs(a)/5)),p=a/c,f=u/c,h=[],m=0;m<=c;m++){var d=0==m?t:r(n,i+m*p,o);u&&(d=r(d,l,m*f)),h.push(d)}e.drawLineToContext(h,s)};if(s)var j=k/d.radians(E)*60,A=r(t,w+90*S,j),L=d.degrees(k*i/j);if(l>0&&R&&!1!==D.courseVector)if(P.computeDistance({lat:v,lon:y},{lat:n.lat,lon:n.lon}).dts/1852<=l&&(k||b))if(s)x(t,A,j,w-90*S,S*L,{color:D.courseVectorColor,width:u,dashed:!0},g,-b*i);else{var I=r(t,w,k*i);I=r(I,g,-b*i),e.drawLineToContext([t,I],{color:D.courseVectorColor,width:u,dashed:!0})}if(a&&!1!==D.courseVector&&k)if(s&&R)x(t,A,j,w-90*S,S*L,{color:D.courseVectorColor,width:u});else{var M=r(t,w,k*i);e.drawLineToContext([t,M],{color:D.courseVectorColor,width:u})}if(o&&O.ghostImage&&k>=m){var _=n.age+Math.max(0,(N-n.receiveTime)/1e3);if(s)var F=d.degrees(k*_/j),B=r(A,w-S*(90-F),j);else B=r(t,w,k*_);e.drawImageToContext(B,O.ghostImage,D)}}return{pix:e.drawImageToContext(t,O.image,D),scale:c,style:D}}},Tn.prototype.computeTextOffsets=function(e,t,n,r,o){var i=void 0===o?1:o,a=[r?r[0]:10,r?r[1]:0];Rn(a,i),Rn(a,e.getDevPixelRatio());var s=Math.floor(1.2*this.textStyle.fontSize);return e.getUseHdpi()&&(s*=e.getDevPixelRatio()),!t.course||0<=t.course&&t.course<90?a[1]+=(n+.5)*s:(t.course>=90&&t.course<180&&(a[1]+=-(n+.5)*s),t.course>=180&&t.course<270&&(a[1]+=(n+.5)*s),t.course>=270&&t.course<360&&(a[1]+=-(n+.5)*s)),Rn(a,1/e.getDevPixelRatio()),{offsetX:a[0],offsetY:a[1]}},Tn.prototype.onPostCompose=function(e,t){if(this.visible){var n,r=[],o=Oe.getData(ve.nav.ais.list,[]),i=Oe.getData(ve.properties.aisFirstLabel,""),a=Oe.getData(ve.properties.aisSecondLabel,""),s=Oe.getData(ve.properties.aisThirdLabel,""),l=Oe.getData(ve.properties.aisShowEstimated,!1);for(n in o){var u=o[n],c={alpha:u.hidden?.2:void 0},p=u.mapPos;if(p||(p=this.mapholder.pointToMap(new S.Point(u.lon,u.lat).toCoord()),u.mapPos=p),p&&!isNaN(p[0])&&!isNaN(p[1])){var f=this.drawTargetSymbol(t,p,u,this.computeTarget,l);r.push({pixel:f.pix,ais:u});var h=f.scale,m=Z.format(i,u,!0);m&&t.drawTextToContext(p,m,y()({},this.textStyle,this.computeTextOffsets(t,u,0,f.style.textOffset,h),c)),a!==i&&(m=Z.format(a,u,!0))&&t.drawTextToContext(p,m,y()({},this.textStyle,this.computeTextOffsets(t,u,1,f.style.textOffset,h),c)),s!==i&&s!==a&&(m=Z.format(s,u,!0))&&t.drawTextToContext(p,m,y()({},this.textStyle,this.computeTextOffsets(t,u,2,f.style.textOffset,h),c))}}this.pixel=r}},Tn.prototype.dataChanged=function(e){this.visible=Oe.getData(ve.properties.layers.ais),this.setStyles(),this.createInternalIcons(),this.computeStyles()},Tn.prototype.computeTarget=function(e,t,n){try{var r=new S.Point;r.fromCoord(this.mapholder.transformFromMap(e));var o=P.computeTarget(r,t,n,Oe.getData(ve.nav.routeHandler.useRhumbLine));return this.mapholder.transformToMap(o.toCoord())}catch(e){return[0,0]}},Tn.prototype.setImageStyles=function(e){var t=this,n={symbolStyles:"",atonStyles:"aton"},r=function(r){var o=n[r],i=["Normal","Warning","Nearest","Tracking"],a={anchor:!0,size:!0,courseVectorColor:!0,courseVector:!0,rotate:!0,alpha:!0,textOffset:!0},s=[""].concat(i);for(var l in s){var u=s[l],c=new RegExp("^"+("ais"+o+u+"Image")),p=function(n){if(c.exec(n)){var o=n.replace(c,"");(""===u?i:[u]).forEach((function(i){var s=i.toLowerCase()+o,l=e[n];"object"===kn(l)&&(t[r][s]=new On("ais"+i+"Color",l.src,d.filteredAssign(a,l),l.replaceColor))}))}};for(var f in e)p(f)}};for(var o in n)r(o);this.computeStyles()};var xn=Tn,jn=n.p+"images/anchor.png",An=n(26637),Ln={RoutingMode:{WP:0,ROUTE:1,WPINACTIVE:2},Leg:function(e,t,n){this.from=e||new S.WayPoint(0,0),this.from instanceof S.WayPoint||(this.from=S.WayPoint.fromPlain(this.from)),this.to=t||new S.WayPoint(0,0),this.to instanceof S.WayPoint||(this.to=S.WayPoint.fromPlain(this.to)),this.active=n||!1,this.approach=!1,this.approachDistance=0,this.currentRoute=void 0,this.anchorDistance=void 0}};Ln.Leg.prototype.clone=function(){var e=new Ln.Leg(this.from?this.from.clone():void 0,this.to?this.to.clone():void 0,this.active);return e.approach=this.approach,e.approachDistance=this.approachDistance,e.currentRoute=this.currentRoute?this.currentRoute.clone():void 0,e.anchorDistance=this.anchorDistance,e},Ln.Leg.prototype.toJsonString=function(){return JSON.stringify(this.toJson())},Ln.Leg.prototype.toJson=function(){var e={from:this.from,to:this.to,name:this.getRouteName(),active:this.active,currentTarget:this.getCurrentTargetIdx(),approach:this.approach,approachDistance:this.approachDistance,currentRoute:this.currentRoute?this.currentRoute.toJson():void 0};return this.anchorDistance&&(e.anchorDistance=this.anchorDistance),e},Ln.Leg.prototype.fromJsonString=function(e){var t=JSON.parse(e);return this.fromJson(t)},Ln.Leg.prototype.fromJson=function(e){if(this.from=S.WayPoint.fromPlain(e.from),e.to&&(this.to=S.WayPoint.fromPlain(e.to)),this.active=e.active||!1,this.approach=e.approach,this.approachDistance=e.approachDistance,e.currentRoute&&(this.currentRoute=new Ln.Route(e.currentRoute.name),this.currentRoute.fromJson(e.currentRoute)),this.currentRoute)if(this.to.routeName=this.currentRoute.name,void 0!==e.currentTarget){var t=this.currentRoute.getPointAtIndex(e.currentTarget);t?this.to=t:(i.log("invalid leg with currentTarget, to outside route, deleting route"),this.currentRoute=void 0,this.to.routeName=void 0)}else{this.currentRoute.getIndexFromPoint(this.to)<0&&(i.log("invalid leg, to outside route, deleting route"),this.currentRoute=void 0,this.to.routeName=void 0)}else this.to.routeName=void 0;return e.anchorDistance&&(this.anchorDistance=e.anchorDistance,this.active=!1),this},Ln.Leg.prototype.differsTo=function(e){if(!e)return!0;if(e.anchorDistance&&!this.anchorDistance)return!0;if(!e.anchorDistance&&this.anchorDistance)return!0;if(this.anchorDistance&&e.anchorDistance&&this.anchorDistance!=e.anchorDistance)return!0;var t,n=this,r=!1,o=["from","to"];for(t in o){var i=o[t];n[i]?e[i]&&n[i].lat==e[i].lat&&n[i].lon==e[i].lon&&n[i].name==e[i].name||(r=!0):e[i]&&(r=!0)}return n.name!=e.name&&(r=!0),n.active!=e.active&&(r=!0),n.approach!=e.approach&&(r=!0),(n.currentRoute&&!e.currentRoute||!n.currentRoute&&e.currentRoute)&&(r=!0),n.currentRoute&&e.currentRoute&&!r&&(r=n.currentRoute.differsTo(e.currentRoute)),r},Ln.Leg.prototype.getCurrentTargetIdx=function(){return this.to&&this.currentRoute?this.currentRoute.getIndexFromPoint(this.to):-1},Ln.Leg.prototype.isRouting=function(){return this.active&&!this.anchorWatchDistance},Ln.Leg.prototype.hasRoute=function(){return!!this.isRouting()&&void 0!==this.currentRoute},Ln.Leg.prototype.isCurrentTarget=function(e){return!!this.isRouting()&&(!!this.to.compare(e)||void 0)},Ln.Leg.prototype.setNewTargetIndex=function(e,t){if(void 0===e||e<0)return!1;if(!this.hasRoute())return!1;var n=this.route.getPointAtIndex(e);return!!n&&(this.to=n,t&&(this.from=t),!0)},Ln.Leg.prototype.getRouteName=function(){if(this.hasRoute())return this.currentRoute.name},Ln.Leg.prototype.setAnchorWatch=function(e,t){this.from=e,this.to=void 0,this.active=!1,this.approach=!1,this.currentRoute=void 0,this.anchorDistance=t},Ln.Leg.prototype.anchorWatch=function(){return this.anchorDistance},Ln.Leg.prototype.isApproaching=function(){return this.active&&this.approach},Ln.Route=function(e,t){this.name=e,this.name||(this.name="default"),this.points=t||[],this.time=(new Date).getTime(),this.server=!1},Ln.Route.prototype.fromJsonString=function(e){var t=JSON.parse(e);return this.fromJson(t)},Ln.Route.prototype.fromJson=function(e){var t,n;if(this.name=e.name||"default",this.time=e.time||0,this.server=e.server||!1,this.points=[],e.points)for(t=0;t<e.points.length;t++)(n=S.WayPoint.fromPlain(e.points[t])).name||(n.name=this.findFreeName()),n.name==S.WayPoint.MOB&&(n.name=this.findFreeName()),n.routeName=this.name.slice(0),this.points.push(n);return this},Ln.Route.prototype.toJson=function(){var e,t={};for(t.name=this.name,t.time=this.time,t.server=this.server,t.points=[],e=0;e<this.points.length;e++){var n=this.points[e].clone();n.routeName=void 0,t.points.push(n)}return t},Ln.Route.prototype.toJsonString=function(){return JSON.stringify(this.toJson())},Ln.Route.prototype.differsTo=function(e){if(!e)return!0;if(this.name!=e.name)return!0;if(this.server!=e.server)return!0;if(this.points.length!=e.points.length)return!0;var t;for(t=0;t<this.points.length;t++){if(this.points[t].lon!=e.points[t].lon)return!0;if(this.points[t].lat!=e.points[t].lat)return!0;if(this.points[t].name!=e.points[t].name)return!0}return!1},Ln.Route.prototype.clone=function(){var e=this.toJsonString(),t=new Ln.Route;return t.fromJsonString(e),t.server=this.server,t},Ln.Route.prototype.fromXml=function(e){this.name=void 0;var t=d.parseXml(e),n=this,r=t.getElementsByTagName("rte")[0];if(r){var o=r.getElementsByTagName("name")[0];o&&(n.name=o.textContent),Array.from(r.getElementsByTagName("rtept")).forEach((function(e){var t=new S.WayPoint(0,0);t.lon=parseFloat(e.getAttribute("lon")),t.lat=parseFloat(e.getAttribute("lat"));var r=e.getElementsByTagName("name")[0];r&&(t.name=r.textContent),t.routeName=n.name.slice(0),t.name||(t.name=n.findFreeName()),n.points.push(t)}))}return this},Ln.Route.prototype.toXml=function(e){var t=new An(!0);t.startDocument("1.0","UTF-8");var n=t.startElement("gpx").startElement("rte");n.startElement("name").text(this.name).endElement();for(var r=0;r<this.points.length;r++){var o=n.startElement("rtept");o.writeAttribute("lon",this.points[r].lon),o.writeAttribute("lat",this.points[r].lat),o.startElement("name").text(this.points[r].name).endElement(),o.endElement()}return t.toString()},Ln.Route.prototype.deletePoint=function(e){if(!(e<0||e>=this.points.length))return this.points.splice(e,1),e<this.points.length?this.points[e]:void 0},Ln.Route.prototype.getPointAtIndex=function(e){if(!(e<0||e>=this.points.length))return this.points[e]},Ln.Route.prototype.getIndexFromPoint=function(e,t){if(!e||void 0===e.name)return-1;if(void 0===e.routeName||e.routeName!=this.name)return-1;var n;for(n=0;n<this.points.length;n++)if(t){if(this.points[n].name==e.name)return n}else if(this.points[n].compare(e))return n;return-1},Ln.Route.prototype.getPointAtOffset=function(e,t){var n=this.getIndexFromPoint(e);if(!(n<0||n+t<0||n+t>=this.points.length))return this.points[n+t]},Ln.Route.prototype.changePoint=function(e,t){var n=this.getIndexFromPoint(e);return this.changePointAtIndex(n,t)},Ln.Route.prototype.changePointAtIndex=function(e,t){if(!(e<0||e>=this.points.length)){t=this._toWayPoint(t);var n=this.points[e].clone();if(!(t.name&&t.name!=n.name&&this.checkName(t.name)||t.routeName&&t.routeName!=this.name))return this.points[e].update(t),this.points[e]}},Ln.Route.prototype.checkChangePossible=function(e,t){if(e<0||e>this.points.length)return!1;if(this.points[e].name==t.name)return!0;var n=0;for(n=0;n<this.points.length;n++)if(n!=e&&this.points[n].name==t.name)return!1;return!0},Ln.Route.prototype.checkName=function(e){var t=0;for(t=0;t<this.points.length;t++)if(this.points[t].name==e)return!0;return!1},Ln.Route.prototype._createNameFromId=function(e){return"WP"+W.formatDecimal(e,2,0)},Ln.Route.prototype.findFreeName=function(){var e=this.points.length,t=0;for(t=0;t<this.points.length;t++)try{if(this.points[t].name){var n=this.points[t].name.replace(/^[^0-9]*/,"").replace(/ .*/,""),r=parseInt(n);r>e&&(e=r)}}catch(e){}for(e++,t=0;t<this.points.length+1;t++){var o=this._createNameFromId(e);if(!this.checkName(o))return o;e++}return i.log("no free name found for wp"),"no free name found"},Ln.Route.prototype.addPoint=function(e,t,n){var r=(t=this._toWayPoint(t)).clone();r.name&&this.checkName(r.name)&&(i.log("name "+r.name+" already exists in route, create a new one"),r.name=void 0),r.name||(r.name=this.findFreeName()),r.routeName=this.name.slice(0);var o=n?e:e+1;return o<0||o>=this.points.length?(this.points.push(r),o=this.points.length-1):this.points.splice(o,0,r),o},Ln.Route.prototype.setName=function(e){this.name=e,this.points.forEach((function(t){t.routeName=e.slice(0)}))},Ln.Route.prototype.swap=function(){for(var e=0;e<this.points.length/2;e++){var t=this.points.length-e-1,n=this.points[e];this.points[e]=this.points[t],this.points[t]=n}return this},Ln.Route.prototype.assignFrom=function(e){if(!e)return!1;this.name=e.name,this.server=e.server,this.points=[];for(var t=0;t<e.points.length;t++)this.points.push(e.points[t].clone());return!0},Ln.Route.prototype._toWayPoint=function(e){return e instanceof S.WayPoint||(e=S.WayPoint.fromPlain(e)),e},Ln.RouteInfo=function(e,t){this.type="route",this.name=e||"default",this.server=t||!1,this.length=0,this.numpoints=0,this.time=0,this.active=!1},Ln.FormattedPoint=function(){this.idx=0,this.name="",this.latlon="---",this.course="---",this.distance="---"},Ln.RoutePoint=function(e){S.WayPoint.call(this),this.update(e),this.idx=0,this.course=void 0,this.distance=void 0,e&&(this.idx=e.idx||0,this.course=e.course,this.distance=e.distance),this.selected=!1},i.inherits(Ln.RoutePoint,S.WayPoint),Ln.Route.prototype.getRoutePoints=function(e,t){var n=[],r=0;for(r=0;r<this.points.length;r++){var o=new Ln.RoutePoint(this.points[r]);if(o.idx=r,o.name=this.points[r].name?this.points[r].name:r+"",o.routeName=this.name,r>0){var i=P.computeDistance(this.points[r-1],this.points[r],t);o.course=i.course,o.distance=i.dts}r==e&&(o.selected=!0),n.push(o)}return n},Ln.Route.prototype.computeLength=function(e,t){var n=0;if(e<0&&(e=0),this.points.length<e+2)return n;var r=this.points[e];for(e++;e<this.points.length;e++){var o=this.points[e];n+=P.computeDistance(r,o,t).dts,r=o}return n},Ln.Route.prototype.findBestMatchingIdx=function(e){var t,n,r=void 0,o=-1;if(!e)return o;for(t=0;t<this.points.length;t++)n=P.computeDistance(e,this.points[t]),(-1==o||n.dts<r)&&(o=t,r=n.dts);return o};var In=Ln;function Mn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],l=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){u=!0,o=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return _n(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_n(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Fn(e){return Fn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fn(e)}function Bn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Wn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Vn(r.key),r)}}function Hn(e,t,n){return t&&Wn(e.prototype,t),n&&Wn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Vn(e){var t=function(e,t){if("object"!=Fn(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Fn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Fn(t)?t:t+""}var Kn="either provide leg or route,index and activeName as keys",Un=function(){return Hn((function e(t){Bn(this,e),this.callback=t}),[{key:"dataChanged",value:function(e){this.callback(e)}}])}(),qn=new Un((function(e){throw new Error("access to "+e+" outside of route editor")})),zn=function(e,t){var n=Oe.getMultiple(e);if(e.leg){var r=n.leg;return t&&r&&(r=r.clone()),r||(r=new In.Leg(new S.WayPoint,new S.WayPoint,!1)),{leg:r,route:r.hasRoute()?r.currentRoute:void 0,index:n.index,activeName:n.activeName,useRhumbLine:n.useRhumbLine}}var o=n.route;return t&&o&&(o=o.clone()),{route:o,index:n.index,activeName:n.activeName,useRhumbLine:n.useRhumbLine}},Gn=function(e,t,n){var r=y()({},e);delete r.useRhumbLine;var o=Oe.getMultiple(r),i=!1;if(r.leg){if(!t.leg)throw new Error("missing leg on write");t.leg.currentRoute=t.route,i=o.index!=t.index||t.leg.differsTo(o.leg)}else{var a=Mn(Xn.getRouteIndexFlag(o),3),s=a[0],l=a[1];a[2];(i=t.index!==l)||(!t.route&&s&&(i=!0),t.route&&!i&&(i=t.route.differsTo(s)))}if(e.activeName&&t.leg){var u=t.leg.getRouteName();u!=t.activeName&&(t.activeName=u),t.activeName!=o.activeName&&(i=!0)}i&&(void 0===n||!0===n?Oe.storeMultiple(t,r,qn):Oe.storeMultiple(t,r,[qn].concat(n)))},Zn=function(){function e(t,n){if(Bn(this,e),this.storeKeys={},void 0===t.storeKeys||void 0===t.writable)throw new Error("invalid mode spec");var r=t.storeKeys;if(void 0!==r.leg){if(this.storeKeys.leg=r.leg,void 0===r.index||void 0!==r.route)throw new Error(Kn);this.storeKeys.index=r.index}else{if(void 0===r.index||void 0===r.route||void 0===r.activeName)throw new Error(Kn);this.storeKeys.route=r.route,this.storeKeys.index=r.index}this.writable=t.writable&&!n,this.writeKeys=y()({},this.storeKeys),this.storeKeys.activeName=r.activeName,t.writeActiveName&&(this.writeKeys.activeName=r.activeName)}return Hn(e,[{key:"checkWritable",value:function(){if(!this.writable)throw new Error("this route editor is not writable")}},{key:"getStoreKeys",value:function(e){return y()({},e,this.storeKeys)}},{key:"addMultipleWaypoints",value:function(e,t){if(e&&e.length){this.checkWritable();var n=zn(this.storeKeys,!0);if(n.route){if(t)for(var r=e.length-1;r>=0;r--)n.index=n.route.addPoint(n.index,e[r],!0);else for(var o=0;o<e.length;o++)n.index=n.route.addPoint(n.index,e[o],!1);Gn(this.writeKeys,n)}}}},{key:"addWaypoint",value:function(e,t){this.checkWritable();var n=zn(this.storeKeys,!0);n.route&&(n.index=n.route.addPoint(n.index,e,t),Gn(this.writeKeys,n))}},{key:"emptyRoute",value:function(){this.checkWritable();var e=zn(this.storeKeys,!0);e.route&&(e.route.points=[],Gn(this.writeKeys,e))}},{key:"removeRoute",value:function(){this.checkWritable();var e=zn(this.storeKeys,!0);e.route&&(e.route=void 0,e.index=-1,Gn(this.writeKeys,e))}},{key:"invertRoute",value:function(){this.checkWritable();var e=zn(this.storeKeys,!0);if(e.route){var t=e.route.getPointAtIndex(e.index);e.route.swap(),t&&(e.index=e.route.getIndexFromPoint(t)),Gn(this.writeKeys,e)}}},{key:"setNewRoute",value:function(e,t){if(e){this.checkWritable();var n=zn(this.storeKeys,!0),r=void 0,o=void 0,i=void 0;if(this.storeKeys.leg&&n.route){i=n.route.name,r=n.leg.to;var a=n.route.getIndexFromPoint(r);a>=0&&(o=n.route.getPointAtIndex(a+1))}var s=n.route?n.route.getPointAtIndex(n.index):void 0;if(n.route=e.clone(),n.index=s?n.route.findBestMatchingIdx(s):0,this.storeKeys.leg&&r){var l=-1;i==n.route.name?((l=n.route.getIndexFromPoint(r,!0))<0&&o&&(l=n.route.getIndexFromPoint(o,!0)),l<0&&(l=n.route.findBestMatchingIdx(r))):l=n.route.findBestMatchingIdx(r);var u=n.route.getPointAtIndex(l);u?n.leg.to=u:(n.leg.to=void 0,n.leg.active=!1)}void 0!==t&&(n.index=t),n.route.getPointAtIndex(n.index)||(n.index=0),Gn(this.writeKeys,n)}}},{key:"changeSelectedWaypoint",value:function(e,t){this.checkWritable();var n=zn(this.storeKeys,!0);if(n.route){void 0!==t&&(n.index=t);var r=!1;this.storeKeys.leg&&n.leg.getCurrentTargetIdx()==n.index&&(r=!0);var o=n.route.changePointAtIndex(n.index,e);r&&o&&(n.leg.to=o),Gn(this.writeKeys,n)}}},{key:"changeTargetWaypoint",value:function(e){var t=zn(this.storeKeys,!0);t.leg&&(t.route||(t.leg.to=e,Gn(this.writeKeys,t)))}},{key:"deleteWaypoint",value:function(){this.checkWritable();var e=zn(this.storeKeys,!0);if(!(e.index<0)&&e.route){var t=!1;this.storeKeys.leg&&(t=e.leg.getCurrentTargetIdx()==e.index);var n=e.route.deletePoint(e.index);t&&(e.leg.to=n,n||(e.leg.active=!1)),!n&&e.index>0&&(e.index-=1),Gn(this.writeKeys,e)}}},{key:"checkChangePossible",value:function(e,t){if(!this.writable)return!1;var n=zn(this.storeKeys);return void 0!==t&&(n.index=t),!(n.index<0||!n.route)&&n.route.checkChangePossible(n.index,e)}},{key:"setNewIndex",value:function(e){this.checkWritable();var t=zn(this.storeKeys,!0);t.route&&t.route.getPointAtIndex(e)&&(t.index=e,Gn(this.writeKeys,t))}},{key:"setRouteAndIndex",value:function(e,t){this.setNewRoute(e,t)}},{key:"moveIndex",value:function(e){this.checkWritable();var t=zn(this.storeKeys,!0);if(t.route){var n=t.index>=0?t.index:0;t.route.getPointAtIndex(n+e)&&(t.index=n+e,Gn(this.writeKeys,t))}}},{key:"setIndexToTarget",value:function(){this.checkWritable();var e=zn(this.storeKeys,!0);e.leg?e.index=e.leg.getCurrentTargetIdx():e.index=-1,Gn(this.writeKeys,e)}},{key:"modify",value:function(e,t){this.checkWritable();var n=zn(this.storeKeys,!0);e(n)&&Gn(this.writeKeys,n,t)}},{key:"syncTo",value:function(t){var n=t;t instanceof e||(n=new e(t));var r=zn(this.storeKeys);n.setRouteAndIndex(r.route,r.index)}},{key:"getIndex",value:function(){return zn(this.storeKeys).index}},{key:"getPointAt",value:function(e){var t=zn(this.storeKeys);return void 0===e||e<0?Xn.getSelectedWaypoint(t):t.route?t.route.getPointAtIndex(e):void 0}},{key:"getRoutePoints",value:function(e){var t=zn(this.storeKeys);return t.route?t.route.getRoutePoints(e,t.useRhumbLine):[]}},{key:"getRouteName",value:function(){var e=zn(this.storeKeys);if(Mn(Xn.getRouteIndexFlag(e),1)[0])return e.route.name}},{key:"getIndexFromPoint",value:function(e,t){var n=zn(this.storeKeys);return n.route?t?n.route.findBestMatchingIdx(e):n.route.getIndexFromPoint(e):-1}},{key:"getRoute",value:function(){return zn(this.storeKeys).route}},{key:"isRouteWritable",value:function(){if(this.writable){var e=zn(this.storeKeys);return!!e.route&&!(e.route.server&&!Oe.getData(ve.properties.connectedMode,!1))}}},{key:"hasRoute",value:function(){var e=zn(this.storeKeys);return Xn.hasRoute(e)}},{key:"getRawData",value:function(){return zn(this.storeKeys)}},{key:"hasActiveTarget",value:function(){var e=zn(this.storeKeys);return Xn.hasActiveTarget(e)}},{key:"getCurrentTarget",value:function(){var e=zn(this.storeKeys);if(e.leg&&e.leg.active)return e.leg.to}},{key:"getNextWaypoint",value:function(){var e=zn(this.storeKeys);if(e.leg&&e.leg.active&&e.route){var t=e.route.getIndexFromPoint(e.leg.to);if(!(t<0))return e.route.getPointAtIndex(t+1)}}},{key:"getCurrentFrom",value:function(){var e=zn(this.storeKeys);if(e.leg)return e.leg.from}},{key:"anchorWatch",value:function(){var e=zn(this.storeKeys);if(e.leg)return e.leg.anchorWatch()}},{key:"isApproaching",value:function(){var e=zn(this.storeKeys);return!!e.leg&&e.leg.isApproaching()}}])}();Zn.MODES={PAGE:{storeKeys:{route:ve.nav.routeHandler.routeForPage,index:ve.nav.routeHandler.pageRouteIndex,activeName:ve.nav.routeHandler.activeName,useRhumbLine:ve.nav.routeHandler.useRhumbLine},writable:!0},EDIT:{storeKeys:{route:ve.nav.routeHandler.editingRoute,index:ve.nav.routeHandler.editingIndex,activeName:ve.nav.routeHandler.activeName,useRhumbLine:ve.nav.routeHandler.useRhumbLine},writable:!0},ACTIVE:{storeKeys:{leg:ve.nav.routeHandler.currentLeg,index:ve.nav.routeHandler.currentIndex,activeName:ve.nav.routeHandler.activeName,useRhumbLine:ve.nav.routeHandler.useRhumbLine},writable:!0,writeActiveName:!0}};var Xn=function(){function e(){Bn(this,e)}return Hn(e,null,[{key:"getRouteIndexFlag",value:function(e){return e.leg?e.leg.isRouting()?[e.leg.currentRoute,void 0!==e.index?e.index:-1,e.leg.getRouteName()===e.activeName]:[void 0,-1,!1]:e.route?[e.route,void 0!==e.index?e.index:-1,e.route.name==e.activeName]:[void 0,-1,!1]}},{key:"getPointAtOffset",value:function(t,n){var r=Mn(e.getRouteIndexFlag(t),2),o=r[0],i=r[1];if(o)return o.getPointAtIndex(i+(n||0))}},{key:"isActiveRoute",value:function(t){var n=Mn(e.getRouteIndexFlag(t),3);n[0],n[1];return n[2]}},{key:"hasPointAtOffset",value:function(t,n){var r=Mn(e.getRouteIndexFlag(t),3),o=r[0],i=r[1];r[2];return!!o&&void 0!==o.getPointAtIndex(i+n)}},{key:"getSelectedWaypoint",value:function(t){return e.getPointAtOffset(t)}},{key:"hasActiveTarget",value:function(e){return!!e.leg&&e.leg.isRouting()}},{key:"targetName",value:function(t){if(e.hasActiveTarget(t)&&t.leg.to)return t.leg.to.name}},{key:"selectedIsActiveTarget",value:function(t){return!!e.hasActiveTarget(t)&&t.leg.getCurrentTargetIdx()==t.index}},{key:"hasRoute",value:function(e){return!!e.route||!!e.leg&&e.leg.hasRoute()}}])}(),Jn=[];for(var Yn in[Zn.MODES.EDIT,Zn.MODES.PAGE]){var Qn=y()({},Yn);delete Qn.activeName,Jn=Jn.concat(de.flattenedKeys(Qn))}var $n=Zn,er=n.p+"images/Boat-NoNeedle.png",tr=n.p+"images/BoatHdg.png",nr=n.p+"images/BoatSteady.png",rr=n.p+"images/Marker2.png",or=n.p+"images/measure.png";function ir(e){return ir="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ir(e)}var ar=new $n($n.MODES.ACTIVE,!0),sr=function(e){this.mapholder=e,this.boatStyle={anchor:[15,0],size:[30,48],src:er,rotation:20/180*Math.PI,rotateWithView:!0,image:new Image},this.boatStyleHdg=y()({},this.boatStyle,{image:new Image,src:tr,anchor:[15,5]}),this.boatStyleSteady=y()({},this.boatStyle,{image:new Image,src:nr,anchor:[10,10],size:[20,20]}),this.boatStyle.image.src=this.boatStyle.src,this.boatStyleHdg.image.src=this.boatStyleHdg.src,this.boatStyleSteady.image.src=this.boatStyleSteady.src,this.circleStyle={},this.anchorCircleStyle={},this.measureLineStyle={},this.measureTextStyle={},this.centerStyle={anchor:[20,20],size:[40,40],src:rr,image:new Image},this.centerStyle.image.src=this.centerStyle.src,this.anchorStyle={anchor:[20,20],size:[40,40],src:jn,image:new Image},this.anchorStyle.image.src=this.anchorStyle.src,this.measureStyle={anchor:[17,38],size:[40,40],src:or,image:new Image},this.measureStyle.image.src=this.measureStyle.src,this.setStyle(),Oe.register(this,ve.gui.global.propertySequence)};sr.prototype.setStyle=function(){this.circleStyle={color:Oe.getData(ve.properties.navCircleColor),width:Oe.getData(ve.properties.navCircleWidth)},this.anchorCircleStyle={color:this.anchorStyle.courseVectorColor?this.anchorStyle.courseVectorColor:Oe.getData(ve.properties.anchorCircleColor),width:Oe.getData(ve.properties.anchorCircleWidth)},this.measureLineStyle={color:this.measureStyle.courseVectorColor?this.measureStyle.courseVectorColor:Oe.getData(ve.properties.measureColor),width:Oe.getData(ve.properties.navCircleWidth)},this.measureTextStyle={stroke:"#fff",color:this.measureStyle.courseVectorColor?this.measureStyle.courseVectorColor:Oe.getData(ve.properties.measureColor),width:3,fontSize:Oe.getData(ve.properties.aisTextSize),fontBase:"Calibri,sans-serif",offsetY:-20}};var lr={course:ve.nav.gps.course,speed:ve.nav.gps.speed,position:ve.nav.gps.position,valid:ve.nav.gps.valid,hdm:ve.nav.gps.headingMag,hdt:ve.nav.gps.headingTrue,stw:ve.nav.gps.waterSpeed,boatDirection:ve.nav.display.boatDirection,directionMode:ve.nav.display.directionMode,isSteady:ve.nav.display.isSteady};sr.prototype.onPostCompose=function(e,t){var n=this,r=ar.anchorWatch(),o=Oe.getMultiple(lr),i=o.boatDirection,a="cog"!==o.directionMode,s=y()({},o.isSteady?this.boatStyleSteady:a?this.boatStyleHdg:this.boatStyle),l=o.course;void 0===l&&(l=0),!1===s.rotate?s.rotation=0:s.rotation=void 0!==i?i*Math.PI/180:0;var u=this.mapholder.transformToMap(o.position.toCoord());if(Oe.getData(ve.properties.layers.boat)&&o.valid){var c,p=parseInt(Oe.getData(ve.properties.navBoatCourseTime,600)),f=Oe.getData(ve.properties.boatIconScale,1);if(s.size=[s.size[0]*f,s.size[1]*f],s.anchor=[s.anchor[0]*f,s.anchor[1]*f],t.drawImageToContext(u,s.image,s),!o.isSteady){var h=y()({},this.circleStyle);if(void 0!==s.courseVectorColor&&(h.color=s.courseVectorColor),!1!==s.courseVector){var m=void 0!==o.speed?o.speed*p:0;if(m>0&&(c=this.computeTarget(u,l,m),t.drawLineToContext([u,c],h)),a&&void 0!==i&&Oe.getData(ve.properties.boatDirectionVector)){var d=void 0!==o.stw?o.stw*p:m;d>0&&(c=this.computeTarget(u,i,d),t.drawLineToContext([u,c],y()({dashed:!0},h)))}}}if(!r){var v=parseInt(Oe.getData(ve.properties.navCircle1Radius));v>10&&(c=this.computeTarget(u,l,v),t.drawCircleToContext(u,c,this.circleStyle));var g=parseInt(Oe.getData(ve.properties.navCircle2Radius));g>10&&g>v&&(c=this.computeTarget(u,l,g),t.drawCircleToContext(u,c,this.circleStyle));var b=parseInt(Oe.getData(ve.properties.navCircle3Radius));b>10&&b>g&&b>v&&(c=this.computeTarget(u,l,b),t.drawCircleToContext(u,c,this.circleStyle))}}if(!Oe.getData(ve.map.lockPosition,!1)){t.drawImageToContext(e,this.centerStyle.image,this.centerStyle);var w=Oe.getData(ve.map.measurePosition);if(w&&w.lat&&w.lon){var k=Oe.getData(ve.properties.measureRhumbLine),C=this.mapholder.transformToMap(new S.Point(w.lon,w.lat).toCoord());t.drawImageToContext(C,this.measureStyle.image,this.measureStyle);var E=new S.Point;if(E.fromCoord(this.mapholder.transformFromMap(e)),k)t.drawLineToContext([C,e],this.measureLineStyle);else{var O=P.computeCoursePoints(E,w,3),D=[];O.forEach((function(e){return D.push(n.mapholder.transformToMap([e.lon,e.lat]))})),t.drawLineToContext(D,this.measureLineStyle)}var T=P.computeDistance(w,E,k),N=W.formatDirection(T.course)+"°\n"+W.formatDistance(T.dts)+"nm";t.drawTextToContext(e,N,this.measureTextStyle)}}if(r){var R=ar.getCurrentFrom();if(R){var x=this.mapholder.transformToMap(R.toCoord());t.drawImageToContext(x,this.anchorStyle.image,this.anchorStyle);var j=this.computeTarget(x,0,r);t.drawCircleToContext(x,j,this.anchorCircleStyle)}}},sr.prototype.computeTarget=function(e,t,n){var r=new S.Point;r.fromCoord(this.mapholder.transformFromMap(e));var o=P.computeTarget(r,t,n,Oe.getData(ve.nav.routeHandler.useRhumbLine));return this.mapholder.transformToMap(o.toCoord())},sr.prototype.dataChanged=function(){this.setStyle()},sr.prototype.setImageStyles=function(e){var t={anchorImage:"anchorStyle",measureImage:"measureStyle",boatImage:"boatStyle",boatImageHdg:"boatStyleHdg",boatImageSteady:"boatStyleSteady"};for(var n in t){var r=t[n];if(e[n]){var o=e[n];"object"===ir(o)&&(o.src&&(this[r].image.src=o.src,this[r].src=o.src),o.anchor&&o.anchor instanceof Array&&2===o.anchor.length&&(this[r].anchor=o.anchor),o.size&&o.size instanceof Array&&2===o.size.length&&(this[r].size=o.size),void 0!==o.rotate&&(this[r].rotate=o.rotate),void 0!==o.courseVector&&(this[r].courseVector=o.courseVector),void 0!==o.courseVectorColor&&(this[r].courseVectorColor=o.courseVectorColor))}}this.setStyle()};var ur=sr,cr=n.p+"images/MarkerOrange.png";function pr(e){return pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pr(e)}function fr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function hr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,dr(r.key),r)}}function mr(e,t,n){return t&&hr(e.prototype,t),n&&hr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function dr(e){var t=function(e,t){if("object"!=pr(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=pr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==pr(t)?t:t+""}var vr=new $n($n.MODES.ACTIVE),yr=new $n($n.MODES.EDIT),gr=function(){return mr((function e(t){fr(this,e),this.callback=t}),[{key:"dataChanged",value:function(e){this.callback(e)}}])}(),br=function(){return mr((function e(t){fr(this,e),this.mapholder=t,this.points=[],this.segments=[],this.filled=!1,this.targetIndex=void 0}),[{key:"reset",value:function(){this.points=[],this.segments=[],this.filled=!1,this.targetIndex=void 0}},{key:"fillIfNeeded",value:function(e,t){if(!this.filled){this.points=[],this.segments=[];var n=void 0;for(var r in this.targetIndex=void 0,e)if(e[r]){void 0!==t&&e[r].compare(t)&&(this.targetIndex=r);var o=this.mapholder.pointToMap(e[r].toCoord());if(this.points.push(o),void 0!==n)if(Oe.getData(ve.nav.routeHandler.useRhumbLine))this.segments.push([this.mapholder.pointToMap(n.toCoord()),o]);else{var i=[],a=P.computeCoursePoints(n,e[r],3);for(var s in a)i.push(this.mapholder.pointToMap([a[s].lon,a[s].lat]));this.segments.push(i)}n=e[r]}this.filled=!0}}},{key:"getPoints",value:function(){return this.points}},{key:"getSegments",value:function(){return this.segments}},{key:"getTargetIndex",value:function(){return this.targetIndex}}])}(),wr=function(e){var t=this;this.mapholder=e,this.visible=Oe.getData(ve.properties.layers.nav);var n=this;this.routePixel=[],this.wpPixel=[],this._routeName=void 0,this._displayEditing=!1,this.lineStyle={},this.activeWpStyle={},this.normalWpStyle={},this.routeTargetStyle={},this.markerStyle={},this.courseStyle={},this.textStyle={},this.dashedStyle={},this.setStyle(),this.navChangedCb=new gr((function(e){n.mapholder.triggerRender()}));var r=[ve.nav.gps.position,ve.nav.gps.valid];r=r.concat(de.flattenedKeys(vr.getStoreKeys()),de.flattenedKeys(yr.getStoreKeys())),Oe.register(this.navChangedCb,r),Oe.register(this,ve.gui.global.propertySequence),this.routeDisplay=new br(this.mapholder),Oe.register((function(){t.routeDisplay.reset()}),vr.getStoreKeys(yr.getStoreKeys({seq:ve.gui.global.propertySequence,rl:ve.nav.routeHandler.useRhumbLine}))),this.currentCourse=new br(this.mapholder),Oe.register((function(){t.currentCourse.reset()}),vr.getStoreKeys({lat:ve.nav.gps.lat,lon:ve.nav.gps.lon,seq:ve.gui.global.propertySequence,rl:ve.nav.routeHandler.useRhumbLine})),this.currentLeg=new br(this.mapholder),Oe.register((function(){t.currentLeg.reset()}),vr.getStoreKeys({seq:ve.gui.global.propertySequence,rl:ve.nav.routeHandler.useRhumbLine}))};wr.prototype.setStyle=function(e){this.lineStyle={color:Oe.getData(ve.properties.routeColor),width:Oe.getData(ve.properties.routeWidth),arrow:{width:3*Oe.getData(ve.properties.routeWidth),length:7*Oe.getData(ve.properties.routeWidth),offset:20,open:!0}},this.dashedStyle={color:Oe.getData(ve.properties.routeColor),width:Oe.getData(ve.properties.routeWidth),dashed:!0},this.normalWpStyle={color:"yellow",width:1,background:"yellow"},this.activeWpStyle={color:"red",width:1,background:"red"},this.routeTargetStyle={color:Oe.getData(ve.properties.bearingColor),width:1,background:Oe.getData(ve.properties.bearingColor)},e||(this.markerStyle={anchor:[20,20],size:[40,40],src:cr,image:new Image},this.markerStyle.image.src=this.markerStyle.src),this.courseStyle={color:Oe.getData(ve.properties.bearingColor),width:Oe.getData(ve.properties.bearingWidth)},this.textStyle={stroke:"#fff",color:"#000",width:3,fontSize:Oe.getData(ve.properties.routingTextSize),fontBase:"Calibri,sans-serif",offsetY:15}},wr.prototype.showEditingRoute=function(e){var t=this._displayEditing;this._displayEditing=e,e!=t&&this.mapholder.triggerRender()},wr.prototype.onPostCompose=function(e,t){if(this.routePixel=[],this.wpPixel=[],this.visible){var n,r,o=this._displayEditing?yr:vr,i=Oe.getData(ve.nav.gps.position),a=Oe.getData(ve.nav.gps.valid),s=vr.getCurrentTarget(),l=vr.getCurrentFrom(),u=Oe.getData(ve.properties.layers.boat),c=Oe.getData(ve.properties.layers.nav),p=Oe.getData(ve.properties.routeWpSize),f=u&&c,h=o.getRoute();if(f){if(l&&s&&a){this.currentCourse.fillIfNeeded([i,s]);var m=this.currentCourse.getSegments()[0];t.drawLineToContext(m,this.courseStyle),l&&(this.currentLeg.fillIfNeeded([l,s]),m=this.currentLeg.getSegments()[0],t.drawLineToContext(m,this.dashedStyle))}if(s&&!h){var d=this.mapholder.pointToMap(s.toCoord());this.wpPixel.push(t.drawImageToContext(d,this.markerStyle.image,this.markerStyle)),s.name&&t.drawTextToContext(d,s.name,this.textStyle)}if(h){this.routeDisplay.fillIfNeeded(h.points,s);var v=this.routeDisplay.getTargetIndex();this.routePixel=[];var y=this.routeDisplay.getSegments();for(var g in y){var b=y[g];t.drawLineToContext(b,this.lineStyle)}var w,k,C=this.routeDisplay.getPoints(),S=o.getIndex();for(w=0;w<C.length;w++)k=this.normalWpStyle,w==S?k=this.activeWpStyle:w==v&&(k=this.routeTargetStyle),this.routePixel.push(t.drawBubbleToContext(C[w],p,k)),n=(r=h.points[w])&&r.name?r.name:w+"",t.drawTextToContext(C[w],n,this.textStyle)}else this.routePixel=[]}else this.routePixel=[]}},wr.prototype.findTarget=function(e){var t=Oe.getData(ve.properties.clickTolerance)/2,n=this._displayEditing?yr:vr;if(this.routePixel){var r=this.mapholder.findTarget(e,this.routePixel,t);if(r>=0)return n.getPointAt(r)}if(this.wpPixel&&0==this.mapholder.findTarget(e,this.wpPixel,t))return n.getCurrentTarget()},wr.prototype.dataChanged=function(){this.visible=Oe.getData(ve.properties.layers.nav),this.setStyle(!0),this.mapholder.triggerRender()},wr.prototype.setImageStyles=function(e){var t=e.markerImage;"object"===pr(t)&&(t.src&&(this.markerStyle.src=t.src,this.markerStyle.image.src=t.src),t.size&&(this.markerStyle.size=t.size),t.anchor&&(this.markerStyle.anchor=t.anchor))};var kr=wr;function Cr(e){return Cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cr(e)}function Sr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Er(r.key),r)}}function Er(e){var t=function(e,t){if("object"!=Cr(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Cr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Cr(t)?t:t+""}var Or=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.callback=t},t=[{key:"dataChanged",value:function(e){this.callback(e)}}],t&&Sr(e.prototype,t),n&&Sr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}(),Pr=function(e){this.mapholder=e,this.visible=Oe.getData(ve.properties.layers.track),this.trackPoints=[],this.trackPixel=[],this.lineStyle={},this.setStyle();var t=this;Oe.register(this,ve.gui.global.propertySequence),this.newTrackCallback=new Or((function(e){t.navEvent()})),Oe.register(this.newTrackCallback,ve.nav.track)};Pr.prototype.setStyle=function(){this.lineStyle={color:Oe.getData(ve.properties.trackColor),width:Oe.getData(ve.properties.trackWidth)}},Pr.prototype.navEvent=function(){if(!this.visible)return this.currentTrack=[],void(this.trackPoints=[]);var e=Oe.getData(ve.nav.track.currentTrack);if(e.length<2)return this.currentTrack=[],void(this.trackPoints=[]);var t=e[0].ts,n=this.currentTrack.length?this.currentTrack[0].ts:0;if(n>0&&t-n>3600||0==n){this.currentTrack=e.slice(0),this.trackPoints=[];for(var r=0;r<this.currentTrack.length;r++)this.trackPoints.push(this.mapholder.pointToMap([this.currentTrack[r].lon,this.currentTrack[r].lat]))}else{for(var o=this.currentTrack.length>0?this.currentTrack[this.currentTrack.length-1].ts:0,i=-1,a=0;a<e.length;a++)if(e[a].ts>o){i=a;break}if(i<0)return;for(var s=i;s<e.length;s++){this.currentTrack.push(e[s]);var l=this.mapholder.pointToMap([e[s].lon,e[s].lat]);this.trackPoints.push(l)}}},Pr.prototype.onPostCompose=function(e,t){this.visible?this.trackPixel=t.drawLineToContext(this.trackPoints,this.lineStyle):this.trackPixel=[]},Pr.prototype.dataChanged=function(){this.visible=Oe.getData(ve.properties.layers.track),this.setStyle(),this.currentTrack=[],this.trackPoints=[],this.trackPixel=[]},Pr.prototype.setImageStyles=function(e){},Pr.prototype.findTarget=function(e){var t=Oe.getData(ve.properties.clickTolerance)/2;if(this.trackPixel&&this.trackPixel.length){var n=this.mapholder.findTarget(e,this.trackPixel,t);return n>=0&&n<this.trackPoints.length?Wi.pointFromMap(this.trackPoints[n]):void 0}};var Dr=Pr;function Tr(e){return Tr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tr(e)}var Nr=function(){};Nr.prototype.coordToPixel=function(e){},Nr.prototype.pixelToCoord=function(e){return[0,0]},Nr.prototype.pointToMap=function(e){return[0,0]},Nr.prototype.pointFromMap=function(e){return[0,0]};var Rr=function(e,t){this.devPixelRatio=1,this.rotation=0,this.converter=e,this.context=void 0,this.useHdpi=t||!1};Rr.prototype.setUseHdpi=function(e){this.useHdpi=e||!1},Rr.prototype.getUseHdpi=function(){return this.useHdpi},Rr.prototype.drawCircleToContext=function(e,t,n){if(this.context){this.setLineStyles(n);var r=this.pointToCssPixel(e),o=this.pixelToDevice(r),i=this.pixelToDevice(this.pointToCssPixel(t)),a=i[0]-o[0],s=i[1]-o[1],l=Math.sqrt(a*a+s*s);return this.context.beginPath(),this.context.arc(o[0],o[1],l,0,2*Math.PI),this.context.stroke(),r}},Rr.prototype.drawImageToContext=function(e,t,n){if(this.context&&(n||(n={}),0!=t.naturalHeight&&0!=t.naturalWidth)){var r=this.pointToCssPixel(e),o=this.pixelToDevice(r);void 0!==n.fixX&&(o[0]=n.fixX*this.devPixelRatio),void 0!==n.fixY&&(o[1]=n.fixY*this.devPixelRatio);var i,a=this.devPixelRatio,s=[0,0];if(n.anchor&&(s[0]+=n.anchor[0]*a,s[1]+=n.anchor[1]*a),!((i=n.size?n.size:[t.naturalWidth,t.naturalHeight])[0]<=0||i[1]<=0)){var l=this.context;l.save(),l.translate(o[0],o[1]);var u=0;if(n.rotation&&(u=n.rotation),n.rotateWithView&&(u+=this.rotation),u&&l.rotate(u),n.background||n.backgroundCircle){l.beginPath(),n.background?(l.fillStyle=n.background,l.rect(-s[0],-s[1],i[0]*a,i[1]*a)):(l.fillStyle=n.backgroundCircle,l.arc(0,0,Math.max(i[0]*a,i[1]*a)/2,0,2*Math.PI));var c=l.globalAlpha;n.backgroundAlpha&&(l.globalAlpha=n.backgroundAlpha),l.fill(),l.globalAlpha=c}if(void 0!==n.alpha){l.globalAlpha;l.globalAlpha=n.alpha}return l.drawImage(t,-s[0],-s[1],i[0]*a,i[1]*a),l.restore(),r}}},Rr.prototype.dashedLine=function(e,t,n,r,o){var i=n-e,a=r-t,s=Math.max(Math.floor(Math.sqrt(i*i+a*a)/Math.max(1,o)),3);i/=s+=1-s%2,a/=s;for(var l=0;l<=s;l++){var u=e+l*i,c=t+l*a;this.context[l%2?"lineTo":"moveTo"](u,c)}},Rr.prototype.arrow=function(e,t,n,r,o,i,a,s){var l=n-e,u=r-t;if(!(Math.abs(l)<1e-4)){var c=Math.atan(u/l),p=l*l+u*u,f=Math.sqrt(i*i/p),h=Math.sqrt(a*a/p),m=e+h*l,d=t+h*u;this.context.moveTo(m,d),n=m+(l*=f),r=d+(u*=f);var v=Math.cos(c),y=Math.sin(c);this.context.lineTo(n-y*o,r+v*o),s?this.context.moveTo(n+y*o,r-v*o):this.context.lineTo(n+y*o,r-v*o),this.context.lineTo(m,d),this.context.moveTo(e,t)}},Rr.prototype.drawLineToContext=function(e,t){if(e&&!(e.length<2)&&this.context){var n=[];this.setLineStyles(t),this.context.beginPath();var r,o=this.pointToCssPixel(e[0]);n.push(o),o=this.pixelToDevice(o),this.context.moveTo(o[0],o[1]);var i=0;t&&t.dashed&&(i=6,i*=this.devPixelRatio);var a,s=o,l=void 0;if(t&&t.arrow){var u=!0,c=!0;if("object"===Tr(t.arrow))try{a={},void 0!==t.arrow.width?a.width=t.arrow.width:(a.width=3*(this.context.lineWidth||1),u=!1),void 0!==t.arrow.length?a.length=t.arrow.length:(a.length=8*(this.context.lineWidth||1),c=!1),a.offset=t.arrow.offset||10,a.open=t.arrow.open||!1}catch(e){}else(a={}).width=3*(this.context.lineWidth||1),u=!1,a.length=8*(this.context.lineWidth||1),c=!1,a.offset=10,a.open=!1;this.useHdpi&&(u&&(a.width*=this.devPixelRatio),c&&(a.length*=this.devPixelRatio))}for(r=1;r<e.length;r++)o=this.pointToCssPixel(e[r]),n.push(o),o=this.pixelToDevice(o),this.context.lineTo(o[0],o[1]),i&&this.context.setLineDash([i,i]),a&&(void 0===l||Math.abs(s[0]-o[0]))>.01&&(l=s),s=o,a&&r>=e.length-1&&void 0!==l&&this.arrow(s[0],s[1],l[0],l[1],a.width,a.length,a.offset,a.open);return this.context.stroke(),this.context.setLineDash([]),n}},Rr.prototype.drawBubbleToContext=function(e,t,n){if(this.context){var r;this.setLineStyles(n);var o=this.pointToCssPixel(e);r=o,o=this.pixelToDevice(o);var i=t*this.devPixelRatio;return this.context.beginPath(),this.context.arc(o[0],o[1],i,0,2*Math.PI),this.context.stroke(),n&&n.background&&(this.context.fillStyle=n.background,this.context.fill()),r}},Rr.prototype.drawTextToContext=function(e,t,n){if(this.context&&e){var r,o=!1,i=!0,a=this.pointToCssPixel(e),s=this.pixelToDevice(a),l=[0,0];if(n){if(n.fontBase){var u=n.fontSize||10;this.useHdpi&&(u*=this.devPixelRatio),this.context.font=u+"px "+n.fontBase}n.color&&(this.context.fillStyle=n.color),n.stroke&&(o=!0,this.context.strokeStyle=n.stroke),n.width&&(this.context.lineWidth=this.useHdpi?n.width*this.devPixelRatio:n.width),n.rotateWithView&&(i=!1),void 0!==n.fixX&&(s[0]=n.fixX*this.devPixelRatio),void 0!==n.fixY&&(s[1]=n.fixY*this.devPixelRatio),n.offsetX&&(l[0]=n.offsetX),n.offsetY&&(l[1]=n.offsetY),n.alpha&&(r=this.context.globalAlpha,this.context.globalAlpha=n.alpha)}return l=this.pixelToDevice(l),this.context.textAlign=n.align||"center",this.context.textBaseline=n.baseline||"middle",this.rotation&&i?(this.context.save(),this.context.translate(s[0],s[1]),this.context.rotate(0),o&&this.context.strokeText(t,l[0],l[1]),this.context.fillText(t,l[0],l[1]),this.context.restore()):(o&&this.context.strokeText(t,s[0]+l[0],s[1]+l[1]),this.context.fillText(t,s[0]+l[0],s[1]+l[1])),void 0!==r&&(this.context.globalAlpha=r),a}},Rr.prototype.getContext=function(){return this.context},Rr.prototype.getDevPixelRatio=function(){return this.devPixelRatio},Rr.prototype.getRotation=function(){return this.rotation},Rr.prototype.pointToCssPixel=function(e){return this.converter.coordToPixel(e)},Rr.prototype.pixelToDevice=function(e){var t=[];return t[0]=e[0]*this.devPixelRatio,t[1]=e[1]*this.devPixelRatio,t},Rr.prototype.setDevPixelRatio=function(e){this.devPixelRatio=e},Rr.prototype.setContext=function(e){this.context=e},Rr.prototype.setRotation=function(e){this.rotation=e},Rr.prototype.setLineStyles=function(e){e&&(e.color&&(this.context.strokeStyle=e.color),e.width&&(this.context.lineWidth=this.useHdpi?e.width*this.devPixelRatio:e.width),e.cap&&(this.context.lineCap=e.cap),e.join&&(this.context.lineJoin=e.join))},Rr.prototype.cssPixelToCoord=function(e){return this.converter.pixelToCoord(e)},Rr.prototype.pointToMap=function(e){return this.converter.pointToMap(e)};var xr=n.p+"images/nadel_mit.png";function jr(e){return jr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jr(e)}function Ar(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Lr(r.key),r)}}function Lr(e){var t=function(e,t){if("object"!=jr(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=jr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==jr(t)?t:t+""}var Ir=function(e,t){if(!e||!e.users)return 0;for(var n in e.users)if(e.users[n]==t)return e.users.splice(n),e.users.length;return e.users.length},Mr=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.loadedTokenScripts={},this.heartBeatTime=2e4,this.heartBeat=this.heartBeat.bind(this),this.timer=window.setInterval(this.heartBeat,this.heartBeatTime)},t=[{key:"heartBeat",value:function(){for(var e in this.loadedTokenScripts){var t=this.loadedTokenScripts[e];t.heartBeatFunction&&t.users&&t.users.length>0&&t.heartBeatFunction()}}},{key:"resetHartbeats",value:function(){for(var e in this.loadedTokenScripts)this.loadedTokenScripts[e].heartBeatFunction=void 0,this.loadedTokenScripts[e].encryptFunction=void 0,this.loadedTokenScripts[e].users=[]}},{key:"removeChartEntry",value:function(e){for(var t in this.loadedTokenScripts){var n=this.loadedTokenScripts[t];0==Ir(n,e)&&(this.loadedTokenScripts[t].encryptFunction=void 0,this.loadedTokenScripts[t].heartBeatFunction=void 0)}}},{key:"createOrActivateEncrypt",value:function(e,t,n){var r=this,o=this,a=function(e,t){return(t||"none")+"-"+e}(t,n);return new Promise((function(s,l){var u=n;if(u||(u="tokenHandler"+(new Date).getTime()),r.loadedTokenScripts[a]){if(r.loadedTokenScripts[a].encryptFunction)return function(e,t){if(e){if(!e.users)return e.users=[t],!0;for(var n in e.users)if(e.users[n]==t)return!1;e.users.push(t)}}(r.loadedTokenScripts[a],e),void s({encryptFunction:r.loadedTokenScripts[a].encryptFunction});var c=window.avnav[u];c&&c.heartBeat||l("unable to install crypto handler"),c.heartBeat().then((function(t){o.loadedTokenScripts[a]={heartBeatFunction:c.heartBeat,encryptFunction:c.encryptUrl,users:[e]},s({encryptFunction:c.encryptUrl})})).catch((function(e){l("error initializing chart access: "+e)}))}else{i.log("load new tokenhandler "+t);var p=document.createElement("script");p.setAttribute("type","text/javascript"),document.getElementsByTagName("head")[0].appendChild(p),p.setAttribute("id",u),p.onload=function(){i.log("token handler "+u+" loaded"),r.loadedTokenScripts[a]={};var t=window.avnav[u];t&&t.heartBeat?t.heartBeat().then((function(n){o.loadedTokenScripts[a]={heartBeatFunction:t.heartBeat,encryptFunction:t.encryptUrl,users:[e]},s({encryptFunction:t.encryptUrl})})).catch((function(e){l("error initializing chart access: "+e)})):l("unable to install crypto handler")},p.setAttribute("src",t)}}))}}],t&&Ar(e.prototype,t),n&&Ar(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}(),_r=new Mr,Fr={formatNone:function(e){return{}},genericHtmlInfo:function(e,t){if(!t)return{};var n='<div class="featureInfoHtml">';for(var r in e)e[r]&&(""!==n&&(n+="<br/>"),n+=d.escapeHtml(r)+"="+d.escapeHtml(e[r]));return{htmlInfo:n+="</div>"}}};function Br(e){return Br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Br(e)}function Wr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Hr(r.key),r)}}function Hr(e){var t=function(e,t){if("object"!=Br(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Br(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Br(t)?t:t+""}var Vr=function(e){return e.overlayConfig||e.chartKey},Kr=function(){return e=function e(t,n){for(var r in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mapholder=t,this.chartEntry=y()({},n),this.chartEntry)"function"==typeof this.chartEntry[r]&&delete this.chartEntry[r];if(this.featureFormatter=void 0,n.featureFormatter){var o=n.featureFormatter;"string"==typeof o&&(o=Fr[o]),o&&(this.featureFormatter=o)}this.encryptFunction=void 0,this.isReadyFlag=!1,this.layers=[],this.sequence="",this.removeSequence=0,this.visible=!0},t=[{key:"getConfig",value:function(){return y()({},this.chartEntry)}},{key:"isReady",value:function(){return this.isReadyFlag}},{key:"getLayers",value:function(){return this.isReadyFlag?this.layers:[]}},{key:"redraw",value:function(){return!1}},{key:"getScale",value:function(){try{var e=this.mapholder.olmap.getView(),t=1,n=e.getZoom();return this.chartEntry.minScale&&n<this.chartEntry.minScale&&(t=1/Math.pow(2,this.chartEntry.minScale-n)),this.chartEntry.maxScale&&n>this.chartEntry.maxScale&&(t=Math.pow(2,n-this.chartEntry.maxScale)),t}catch(e){}return 1}},{key:"checkSequence",value:function(e){var t=this,n=this.removeSequence;return new Promise((function(r,o){Oe.getData(ve.gui.capabilities.fetchHead,!1)&&t.visible?fetch(t.getUrl(),{method:"HEAD"}).then((function(o){if(t.removeSequence===n&&(t.isReady()||e)){var i=o.headers.get("last-modified");if(i!==t.sequence){t.sequence=i;var a=t.redraw();r(a?0:1)}else r(0)}else r(0)})).catch((function(e){return r(0)})):r(0)}))}},{key:"isEqual",value:function(e){return this.mapholder===e.mapholder&&f(this.chartEntry,e.chartEntry)}},{key:"getUrl",value:function(){return this.chartEntry.url}},{key:"getChartKey",value:function(){var e=this.chartEntry.chartKey;return e||(e=this.chartEntry.url),e}},{key:"getOverlayConfigName",value:function(){return Vr(this.chartEntry)}},{key:"prepareInternal",value:function(){return new Promise((function(e,t){t("prepareInternal not implemented in base class")}))}},{key:"prepare",value:function(){var e=this,t=function(t,n){e.checkSequence(!0).then((function(r){e.prepareInternal().then((function(n){n.forEach((function(t){t.avnavOptions||(t.avnavOptions={}),t.avnavOptions.chartSource=e})),e.layers=n,e.chartEntry.enabled||(e.visible=!1,e.layers.forEach((function(e){return e.setVisible(!1)}))),e.isReadyFlag=!0,t(e.layers)})).catch((function(e){n(e)}))})).catch((function(e){return n(e)}))};return new Promise((function(n,r){e.chartEntry.tokenUrl?_r.createOrActivateEncrypt(e.getChartKey(),e.chartEntry.tokenUrl,e.chartEntry.tokenFunction).then((function(o){e.encryptFunction=o.encryptFunction,t(n,r)})).catch((function(e){r(e)})):t(n,r)}))}},{key:"destroy",value:function(){_r.removeChartEntry(this.getChartKey()),this.isReadyFlag=!1,this.layers=[],this.removeSequence++}},{key:"setVisible",value:function(e){this.visible=e,this.isReady()&&this.layers.forEach((function(t){return t.setVisible(e)}))}},{key:"resetVisible",value:function(){var e=this;this.isReady()&&(this.visible=this.chartEntry.enabled,this.layers.forEach((function(t){return t.setVisible(e.chartEntry.enabled)})))}},{key:"featureToInfo",value:function(e,t,n){return{}}},{key:"getSymbolUrl",value:function(e,t){var n;if(e)return!e.match(/\./)&&t&&(e+=t),e.match(/^https*:/)||e.match(/^\//)?e:this.chartEntry.icons?(n=this.chartEntry.icons+"/"+e,this.chartEntry.defaultIcon&&(n+="?fallback="+encodeURIComponent(this.chartEntry.defaultIcon)),n):this.chartEntry.defaultIcon}},{key:"getLinkUrl",value:function(e){if(e){if(e.match(/^https*:/))return e;if(e.match(/^\//))return e;if(this.chartEntry.icons)return this.chartEntry.icons+"/"+e}}},{key:"formatFeatureInfo",value:function(e,t,n,r){if(!e||!t)return{};if(this.featureFormatter)try{var o=y()({},t.getProperties());for(var a in o)"string"!=typeof o[a]&&"number"!=typeof o[a]&&delete o[a];n&&(o.lat=n[1],o.lon=n[0]),y()(e,d.filteredAssign({sym:!0,name:!0,desc:!0,link:!0,htmlInfo:!0,time:!0},this.featureFormatter(o,r)))}catch(e){i.log("error in feature info formatter : "+e)}return e.icon=this.getSymbolUrl(e.sym,".png"),e.link=this.getLinkUrl(e.link),e}},{key:"setEnabled",value:function(e,t){this.mapholder.setEnabled(this,e,t)}},{key:"getChartFeaturesAtPixel",value:function(e){return new Promise((function(e,t){e([])}))}},{key:"hasFeatureInfo",value:function(){return this.isReady()&&this.chartEntry.hasFeatureInfo||!1}}],t&&Wr(e.prototype,t),n&&Wr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();Kr.StyleParam={lineWidth:{type:"NUMBER",list:[1,10],displayName:"line width",default:3},lineColor:{type:"COLOR",displayName:"line color",default:"#000000"},fillColor:{type:"COLOR",displayName:"fill color",default:"rgba(255,255,0,0.4)"},strokeWidth:{type:"NUMBER",displayName:"stroke width",default:3,list:[1,40]},circleWidth:{type:"NUMBER",displayName:"circle width",default:10,list:[1,40]},showName:{type:"BOOLEAN",displayName:"show feature name",default:!1},textSize:{type:"NUMBER",displayName:"font size",default:16},textOffset:{type:"NUMBER",displayName:"text offset",default:32}};var Ur=Kr,qr=n(49998),zr=n(2126),Gr=n(98329),Zr=n(7054),Xr=n(53479),Jr=n(14180),Yr=n(742),Qr=n(16988),$r=n(74006),eo=n(87966);function to(e){return to="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},to(e)}function no(){return no="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=uo(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},no.apply(null,arguments)}function ro(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ao(r.key),r)}}function io(e,t,n){return t&&oo(e.prototype,t),n&&oo(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function ao(e){var t=function(e,t){if("object"!=to(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=to(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==to(t)?t:t+""}function so(e,t,n){return t=uo(t),function(e,t){if(t&&("object"==to(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,lo()?Reflect.construct(t,n||[],uo(e).constructor):t.apply(e,n))}function lo(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(lo=function(){return!!e})()}function uo(e){return uo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},uo(e)}function co(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&po(e,t)}function po(e,t){return po=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},po(e,t)}var fo="data:image/png;base64,i",ho=function(e,t){if(t){var n=t,r=n[0],o=n[1],i=n[2];if(e.zoomLayerBoundings){var a=!1;if(!e.zoomLayerBoundings[r])return fo;for(var s in e.zoomLayerBoundings[r]){var l=e.zoomLayerBoundings[r][s];if(l.minx<=o&&l.maxx>=o&&l.miny<=i&&l.maxy>=i){a=!0;break}}if(!a)return fo}if(e.wms){var u,c,p=e.source.getTileGrid(),f=[-20037508.342789244,-20037508.342789244],h=p.getResolution(r),m=p.getTileSize(r),v=f[0]+o*m*h,y=f[1]+(i=(1<<r)-i-1)*m*h,g=v+m*h,b=y+m*h,w=Gr.Jt("EPSG:3857",e.projection||"EPSG:4326")([v,y,g,b]),k=e.layerurl+"SERVICE=WMS&REQUEST=GetMap&FORMAT=image/png&WIDTH="+m+"&HEIGHT="+m+"&SRS="+encodeURI(e.projection);for(u in e.wmslayermap[r]&&(c=e.wmslayermap[r]),e.wmsparam){var C=e.wmsparam[u];!c||"LAYERS"!=u&&"layers"!=u||(C=c),k+="&"+u+"="+C}return k+="&BBOX="+w[0]+","+w[1]+","+w[2]+","+w[3]}if(e.inversy&&(i=(1<<r)-i-1),e.replaceInUrl)return e.layerurl.replace("{x}",o).replace("{y}",i).replace("{z}",r);var S=r+"/"+o+"/"+i+".png";return e.encryptFunction&&(S="##encrypt##"+S),d.endsWith(e.layerurl,"/")?e.layerurl+S:e.layerurl+"/"+S}},mo=function(e){function t(){return ro(this,t),so(this,t,arguments)}return co(t,e),io(t,[{key:"drawTileImage",value:function(e,t,n,r,o,i,a,s,l){var u=this.getTileImage(e);if(u){var c=(0,eo.v6)(this),p=s?e.getAlpha(c,t.time):1,f=l*p,h=f!==this.context.globalAlpha;h&&(this.context.save(),this.context.globalAlpha=f);var m={x:0,y:0,w:u.width,h:u.height};e.getImageProps&&(m=e.getImageProps()),this.context.drawImage(u,m.x+a,m.y+a,m.w-2*a,m.h-2*a,n,r,o,i),h&&this.context.restore(),1!==p?t.animate=!0:s&&e.endTransition(c)}}}])}($r.A),vo=function(e){function t(e,n){var r;return ro(this,t),(r=so(this,t,[e,n])).destroySequence=0,r}return co(t,e),io(t,[{key:"prepareInternal",value:function(){var e=this,t=this.chartEntry.url,n=0;return(void 0===this.chartEntry.upzoom||null===this.chartEntry.upzoom||this.chartEntry.upzoom)&&(n=t.match(/^https*[:]/)?Oe.getData(ve.properties.mapOnlineUpZoom):Oe.getData(ve.properties.mapUpZoom)),new Promise((function(r,o){if(t){var i=t+"/avnav.xml";wt.getHtmlOrText(i,{useNavUrl:!1,timeout:parseInt(Oe.getData(ve.properties.chartQueryTimeout||1e4))}).then((function(o){var i=e.parseLayerlist(o,t,n);r(i)})).catch((function(e){o("unable to load map: "+e)}))}else o("no map url for "+(e.chartEntry.name||e.chartEntry.chartKey))}))}},{key:"e2f",value:function(e,t){return parseFloat(e.getAttribute(t))}},{key:"encryptUrl",value:function(e){if(this.encryptFunction){var t=e.replace(/.*##encrypt##/,"");return e.replace(/##encrypt##.*/,"")+this.encryptFunction(t)}return e}},{key:"parseLayerlist",value:function(e,t,n){var r=this,o=[],a=d.parseXml(e);return Array.from(a.getElementsByTagName("TileMap")).forEach((function(e){var a={};a.encryptFunction=r.encryptFunction,a.inversy=!1,a.wms=!1;var s=e.getAttribute("profile");if(s){if("global-mercator"!=s&&"zxy-mercator"!=s&&"wms"!=s)throw new Error("unsupported profile in tilemap.xml "+s);"global-mercator"==s&&(a.inversy=!0),"wms"==s&&(a.wms=!0)}a.url=e.getAttribute("href"),a.title=e.getAttribute("title"),a.minZoom=parseInt(e.getAttribute("minzoom")),a.maxZoom=parseInt(e.getAttribute("maxzoom")),a.projection=e.getAttribute("projection"),Array.from(e.childNodes).forEach((function(e){"BoundingBox"==e.tagName&&(a.layerExtent=[r.e2f(e,"minlon"),r.e2f(e,"minlat"),r.e2f(e,"maxlon"),r.e2f(e,"maxlat")])}));var l=[];Array.from(e.getElementsByTagName("LayerBoundings")).forEach((function(e){Array.from(e.getElementsByTagName("BoundingBox")).forEach((function(e){var t=[r.e2f(e,"minlon"),r.e2f(e,"maxlat"),r.e2f(e,"maxlon"),r.e2f(e,"minlat")];l.push(t)}))})),a.boundings=l;var u=[];Array.from(e.getElementsByTagName("LayerZoomBoundings")).forEach((function(e){Array.from(e.getElementsByTagName("ZoomBoundings")).forEach((function(e){var t=parseInt(e.getAttribute("zoom")),n=[];Array.from(e.getElementsByTagName("BoundingBox")).forEach((function(e){var t={minx:parseInt(e.getAttribute("minx")),miny:parseInt(e.getAttribute("miny")),maxx:parseInt(e.getAttribute("maxx")),maxy:parseInt(e.getAttribute("maxy"))};n.push(t)})),n.length&&(u[t]=n)}))})),u.length&&(a.zoomLayerBoundings=u);var c="";if(void 0===a.url)throw new Error("missing href in layer");if(c=a.url.match(/^https*:/)?a.url:t+"/"+a.url,a.layerurl=c,a.replaceInUrl=!1,c.indexOf("{x}")>=0&&c.indexOf("{y}")>=0&&c.indexOf("{z}")>=0&&(a.replaceInUrl=!0),a.extent=qr.NW(a.layerExtent,r.mapholder.transformToMap),a.wms){var p={};Array.from(e.getElementsByTagName("WMSParameter")).forEach((function(e){var t=e.getAttribute("name"),n=e.getAttribute("value");void 0!==t&&void 0!==n&&(p[t]=n)})),a.wmsparam=p;var f={};Array.from(e.getElementsByTagName("WMSLayerMapping")).forEach((function(e){var t,n=e.getAttribute("zooms"),r=e.getAttribute("layers"),o=n.split(/,/);for(t in o)try{var i=parseInt(o[t]);f[i]=r}catch(e){}})),a.wmslayermap=f}var h,m,d,v,y=void 0;y=new zr.A({tileUrlFunction:function(e){return ho(a,e)},extent:a.extent,tileLoadFunction:function(e,t){e.getImage().src=r.encryptUrl(t)},tileSize:256*Oe.getData(ve.properties.mapScale,1)}),n>0&&(y.tileClass=(h=function(e){return ho(a,e)},m=n,d=a.inversy,v=function(e){function t(e,n,r,o,i,a){var s;return ro(this,t),(s=so(this,t,arguments)).ownImage=new Image,s.ownTileLoadFunction=i,s.ownSrc=r,s.listenerKeys=[],s.tileUrlFunction=h,s.downZoom=0,s}return co(t,e),io(t,[{key:"getModifiedUrl",value:function(){for(var e=this.tileCoord.slice(0),t=0;t<this.downZoom;t++)e[0]=e[0]-1,e[1]=Math.floor(e[1]/2),e[2]=Math.floor(e[2]/2);return this.tileUrlFunction(e)}},{key:"computeImageProps",value:function(){var e=this.tileCoord[1],t=this.tileCoord[2],n=1<<this.downZoom,r=Math.floor(e/n),o=Math.floor(t/n),i=this.ownImage.width,a=this.ownImage.height;return i=Math.floor(i/n),a=Math.floor(a/n),{x:(e-r*n)%n*i,y:d?(n-(t-o*n)%n-1)*a:(t-o*n)%n*a,w:i,h:a}}},{key:"getImage",value:function(){return this.ownImage}},{key:"getImageProps",value:function(){return this.computeImageProps()}},{key:"load",value:function(){var e=this;this.state===Qr.A.ERROR&&(this.state=Qr.A.IDLE,this.ownImage=new Image),(this.state===Qr.A.IDLE||this.downZoom>0)&&(this.state=Qr.A.LOADING,this.downZoom||this.changed(),this.ownTileLoadFunction(this,this.getModifiedUrl()),this.listenerKeys=[(0,Xr.Jz)(this.ownImage,Jr.A.LOAD,(function(t){e.ownImage.naturalWidth&&e.ownImage.naturalHeight?(e.downZoom>0&&i.log("downzoom loaded, dz="+e.downZoom+" for "+e.ownSrc+", "+e.tileCoord.join(",")),e.state=Qr.A.LOADED):e.state=Qr.A.EMPTY,e.unlisten(),e.changed()})),(0,Xr.Jz)(this.ownImage,Jr.A.ERROR,(function(t){if(e.unlisten(),e.downZoom<m){e.downZoom++;var n=e.downZoom;return i.log("dz: "+n+" for "+e.ownSrc),void window.setTimeout((function(){e.load()}),1)}e.state=Qr.A.ERROR,e.changed()}))])}},{key:"unlisten",value:function(){this.listenerKeys.forEach((function(e){(0,Xr.JH)(e)}))}}])}(Yr.A),v)),a.source=y;var g={source:y};a.extent;void 0!==r.chartEntry.opacity&&(g.opacity=parseFloat(r.chartEntry.opacity));var b=new Zr.A(g);n>0&&(b.createRenderer=function(){return new mo(b)}),a.isTileLayer=!0,b.avnavOptions=a,o.push(b)})),o.reverse()}},{key:"checkSequence",value:function(){var e=this,t=this,n=this.destroySequence;return new Promise((function(r,o){t.isReady()&&n===e.destroySequence||r(0);var a=e.chartEntry.url+"/sequence?_="+(new Date).getTime();wt.getJson(a,{useNavUrl:!1,noCache:!1}).then((function(o){if(o.sequence&&e.destroySequence===n)return o.sequence!==t.chartEntry.sequence?(i.log("Sequence changed from "+t.chartEntry.sequence+" to "+o.sequence+" reload map"),t.chartEntry.sequence=o.sequence,void r(1)):void r(0);r(0)})).catch((function(e){o(e)}))}))}},{key:"destroy",value:function(){no(uo(t.prototype),"destroy",this).call(this),this.destroySequence++}},{key:"getChartFeaturesAtPixel",value:function(e){var t=this;return new Promise((function(n,r){t.isReady()||n([]);for(var o=t.mapholder.pixelToCoord(e),i=t.mapholder.transformFromMap(o),a=t.mapholder.pixelToCoord([e[0]+Oe.getData(ve.properties.clickTolerance)/2,e[1]]),s=t.mapholder.transformFromMap(a),l=Math.abs(s[0]-i[0]),u=[],c=function(){var e=t.layers[p];if(!e.getVisible())return 0;if(!e.avnavOptions)return 0;if(!e.avnavOptions.isTileLayer)return 0;var n=t.mapholder.getView().getResolution(),r=(Math.round(t.mapholder.getView().getZoom()),e.getSource().getTileGrid().getTileCoordForCoordAndResolution(o,n)),a=ho(e.avnavOptions,r),s=new Promise((function(e,n){var r=t.encryptUrl(a);wt.getJson(r,{useNavUrl:!1,noCache:!1},{featureInfo:1,lat:i[1],lon:i[0],tolerance:l}).then((function(t){t.data?e([t.data]):e([])})).catch((function(t){return e([])}))}));u.push(s)},p=t.layers.length-1;p>=0;p--)c();u.length<1&&n([]),Promise.all(u).then((function(e){for(var r,o=0;o<e.length;o++)if(e[o].length>0){r=e[o][0];break}if(r){var a=y()({},r,{overlayType:"chart",chartKey:t.getChartKey(),source:t,overlayName:t.chartEntry.name,coordinates:i},r);n([a])}else n([])})).catch((function(e){return r(e)}))}))}}])}(Ur),yo=vo,go=n(2463),bo=n(25612),wo=n(63129),ko=n(54964),Co=n(36735),So=n(25575),Eo=n(98509),Oo=n(15283),Po=n(56346),Do=n(15963),To=n(31651);function No(e){return No="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},No(e)}function Ro(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,xo(r.key),r)}}function xo(e){var t=function(e,t){if("object"!=No(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=No(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==No(t)?t:t+""}function jo(e,t,n){return t=Lo(t),function(e,t){if(t&&("object"==No(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Ao()?Reflect.construct(t,n||[],Lo(e).constructor):t.apply(e,n))}function Ao(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ao=function(){return!!e})()}function Lo(e){return Lo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Lo(e)}function Io(e,t){return Io=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Io(e,t)}var Mo="style.",_o=function(e){function t(e,n){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=jo(this,t,[e,n])).styleMap={},r.styleFunction=r.styleFunction.bind(r);var o={lineWidth:3,lineColor:"#000000",fillColor:"rgba(255,255,0,0.4)",strokeWidth:3,circleWidth:10};for(var i in o)void 0!==n[Mo+i]&&(o[i]=n[Mo+i]);return r.styles={Point:new go.Ay({image:new bo.A({fill:new wo.A({color:o.fillColor}),radius:o.circleWidth/2,stroke:new ko.A({color:o.lineColor,width:o.strokeWidth})})}),LineString:new go.Ay({stroke:new ko.A({color:o.lineColor,width:o.lineWidth})}),MultiLineString:new go.Ay({stroke:new ko.A({color:o.lineColor,width:o.lineWidth})})},r.source=void 0,r.isRoute=!1,Oe.register((function(){r.isRoute&&r.redraw()}),[ve.nav.routeHandler.useRhumbLine]),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Io(e,t)}(t,e),n=t,r=[{key:"redraw",value:function(){if(this.source)return this.source.clear(),this.source.refresh(),!0}},{key:"styleFunction",value:function(e,t){var n=this,r=e.getGeometry().getType();if("Point"===r){if(!this.chartEntry.icons&&!this.chartEntry.defaultIcon){var o=this.styles[r];return o.getImage().setScale(this.getScale()),o}var i=e.get("sym");if(!i&&this.chartEntry.defaultIcon&&(i="defaultIcon"),i){if(!this.styleMap[i]){var a=new go.Ay({image:new Co.A({src:this.getSymbolUrl(i,".png")})});this.styleMap[i]=a}var s=this.styleMap[i],l=(this.mapholder.olmap.getView(),this.getScale());return s.getImage().setScale(l),s}}if("LineString"===r){var u=e.getGeometry(),c=[this.styles[r]],p=!0;return u.forEachSegment((function(e,t){p&&(c.push(n.getRoutePointStyle(e)),p=!1),c.push(n.getRoutePointStyle(t))})),c}if("MultiLineString"===r){var f=e.getGeometry(),h=[this.styles[r]],m=!0;return f.getLineStrings().forEach((function(e){var t=e.getCoordinates();t.length>1&&(m&&(h.push(n.getRoutePointStyle(t[0])),m=!1),h.push(n.getRoutePointStyle(t[t.length-1])))})),h}return this.styles[e.getGeometry().getType()]}},{key:"getRoutePointStyle",value:function(e){return new go.Ay({geometry:new Oo.A(e),image:new bo.A({fill:new wo.A({color:this.styles.LineString.getStroke().getColor()}),radius:Oe.getData(ve.properties.routeWpSize)*this.getScale()})})}},{key:"prepareInternal",value:function(){var e=this,t=this.chartEntry.url;return new Promise((function(n,r){if(t){e.source=new So.A({format:new To.A,loader:function(n,r,o){wt.getHtmlOrText(t,{},{_:(new Date).getTime()}).then((function(t){t=Bo(t);var r=e.source.getFormat().readFeatures(t,{extent:n,featureProjection:o});r&&r.forEach((function(t){var n=t.getGeometry();if(n instanceof Po.A){e.isRoute=1;var r=n.getCoordinates();if(r.length>1&&!Oe.getData(ve.nav.routeHandler.useRhumbLine)){var o=new Do.A([]),i=new S.Point;i.fromCoord(e.mapholder.transformFromMap(r[0]));for(var a=new S.Point,s=function(){var t=[];a.fromCoord(e.mapholder.transformFromMap(r[l])),P.computeCoursePoints(i,a,3).forEach((function(n){t.push(e.mapholder.transformToMap([n.lon,n.lat]))})),i.lat=a.lat,i.lon=a.lon,o.appendLineString(new Po.A(t))},l=1;l<r.length;l++)s();t.setGeometry(o)}}})),e.source.addFeatures(r)})).catch((function(e){}))},wrapX:!1});var o={source:e.source,style:e.styleFunction,opacity:void 0!==e.chartEntry.opacity?parseFloat(e.chartEntry.opacity):1};void 0!==e.chartEntry.minZoom&&(o.minZoom=e.chartEntry.minZoom),void 0!==e.chartEntry.maxZoom&&(o.maxZoom=e.chartEntry.maxZoom),n([new Eo.A(o)])}else r("no url for "+e.chartEntry.name)}))}},{key:"featureToInfo",value:function(e,t){var n={overlayName:this.chartEntry.name,overlayType:this.chartEntry.type,overlayUrl:this.chartEntry.url,overlaySource:this};if(!e)return n;var r,o=e.getGeometry();for(var i in o instanceof Oo.A?(n.kind="point",r=this.mapholder.transformFromMap(o.getCoordinates()),n.nextTarget=r):o?(r=this.mapholder.transformFromMap(o.getClosestPoint(this.mapholder.pixelToCoord(t))),n.nextTarget=r):r=this.mapholder.transformFromMap(this.mapholder.pixelToCoord(t)),n.coordinates=r,["desc","name","sym","time","height","sym","link","linkText"].forEach((function(t){return n[t]=e.get(t)})),this.formatFeatureInfo(n,e,r.true),this.chartEntry)d.startsWith(i,Mo)&&(n[i]=this.chartEntry[i]);return n}}],r&&Ro(n.prototype,r),o&&Ro(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ur),Fo=_o,Bo=function(e){if(e)return e.replace(/<extensions.*?>.*?<\/extensions.*?>/g,"")},Wo=n(68346),Ho=n(45789),Vo=n(48593),Ko=n(52275),Uo=n(97752),qo=n(17857),zo=n(62086);function Go(e){return Go="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Go(e)}function Zo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Xo(r.key),r)}}function Xo(e){var t=function(e,t){if("object"!=Go(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Go(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Go(t)?t:t+""}var Jo=function(e,t){var n="H";n=t.isDefault?void 0===t.bucket||t.bucket.match(/^H/)?"H":"L":void 0===t.bucket||["L1","L2","H1","H2"].indexOf(t.bucket)<0?"H2":t.bucket,t.bucket=n,e[n]||(e[n]=[]),e[n].push(t)},Yo=function(e){var t=void 0;if("chart"===e.type){var n={chartKey:!0,type:!0,opacity:!0,enabled:!0,bucket:!0};n[Qo]=!0,t=d.filteredAssign(n,e)}else t=y()({},e);for(var r in t)"function"==typeof t[r]&&delete t[r];return delete t.selected,delete t.index,delete t.isDefault,t},Qo="overlayId",$o={enabled:!0},ei=function(e){if(e)return e[Qo]},ti=function(){function e(t,n){var r=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t||{},this.mutable=n||!1,this.config.defaults){var o=[];this.config.defaults.forEach((function(e){void 0!==ei(e)&&o.push(y()({enabled:!0},e,{isDefault:!0}))})),this.config.defaults=o}else this.config.defaults=[];if(this.config.overlays){var i=[];this.config.overlays.forEach((function(e){void 0!==ei(e)&&i.push(y()({enabled:!0},e,{isDefault:!1}))})),this.config.overlays=i}else this.config.overlays=[];this.nextId=-1,this.config.overlays.forEach((function(e){void 0!==ei(e)&&ei(e)>r.nextId&&(r.nextId=ei(e))})),this.nextId++,this.config.defaultsOverride||(this.config.defaultsOverride={}),void 0===this.config.useDefault&&(this.config.useDefault=!0),this.hasChanges=!1}return t=e,n=[{key:"createNewOverlay",value:function(e){this.checkMutable();var t=this.nextId;this.nextId++;var n={isDefault:!1};n[Qo]=t;var r=y()(e,n);return void 0===r.enabled&&(r.enabled=!0),r}},{key:"copy",value:function(){var t=this,n={useDefault:this.config.useDefault,name:this.config.name,defaults:[],overlays:[],defaultsOverride:{}};for(var r in["defaults","overlays"].forEach((function(e){t.config[e].forEach((function(t){n[e].push(y()({},t))}))})),this.config.defaultsOverride)n.defaultsOverride[r]=y()({},this.config.defaultsOverride[r]);return new e(n,!0)}},{key:"getOverlayBuckets",value:function(t){var n={};if(e.getBucketNames().forEach((function(e){n[e]=[]})),n.M=[{bucket:"M",type:"base"}],!this.config)return n;var r=this.config.defaults,o=this.config.overlays,i=this.config.defaultsOverride;return(this.config.useDefault||t)&&r.forEach((function(e){void 0!==ei(e)&&Jo(n,y()({},e,i[ei(e)],{isDefault:!0}))})),o.forEach((function(e){void 0!==ei(e)&&Jo(n,y()({},e,{isDefault:!1}))})),n}},{key:"getOverlayList",value:function(t){var n=[],r=this.getOverlayBuckets(t);return e.getBucketNames().forEach((function(e){r[e]&&(n=n.concat(r[e]))})),n}},{key:"checkMutable",value:function(){if(!this.mutable)throw new Error("overlay config not mutable")}},{key:"writeBack",value:function(t){var n=this;this.checkMutable();var r=this;if(!t)return!1;var o=[],i=[],a=e.getBucketNames(),s="L2",l=["L2","L1","H1","H2"];if(t.forEach((function(e){if(r.isChartBucket(e))s="M";else if(void 0!==ei(e)){if(e.isDefault){var t=a.indexOf(s);return s=t<a.indexOf("M")?"L":"H",e.bucket=s,void o.push(e)}for(var n=a.indexOf(s);l.indexOf(s)<0&&n>=0&&n<a.length-1;)n++,s=a[n];e.bucket=s,i.push(e)}})),i.length!==this.config.overlays.length)this.hasChanges=!0,this.config.overlays=i;else{for(var u=!1,c=[],p=0;p<i.length;p++)f(this.config.overlays[p],i[p])||(u=!0),c.push(Yo(i[p]));u&&(this.config.overlays=c,this.hasChanges=!0)}var h={};for(var m in o.forEach((function(e){var t=ei(e);if(void 0!==t){var r=void 0;if(n.config.defaults.forEach((function(e){ei(e)===t&&(r=e)})),r){var o=d.filteredAssign($o,e);f(d.filteredAssign($o,r),o)||(h[t]=o)}}})),this.config.defaultsOverride)f(this.config.defaultsOverride[m],h[m])||(this.hasChanges=!0);for(var v in h)f(this.config.defaultsOverride[v],h[v])||(this.hasChanges=!0);return this.config.defaultsOverride=h,this.hasChanges}},{key:"setUseDefault",value:function(e){this.checkMutable(),e!==this.config.useDefault&&(this.config.useDefault=e,this.hasChanges=!0)}},{key:"getUseDefault",value:function(){return void 0===this.config.useDefault||this.config.useDefault}},{key:"getWriteBackData",value:function(){return{useDefault:this.config.useDefault,name:this.config.name,overlays:this.config.overlays,defaultsOverride:this.config.defaultsOverride}}},{key:"mergeOverrides",value:function(e){var t=this,n={enabled:!0};this.checkMutable(),this.config.overlays.forEach((function(t){var r=e.getCurrentItemConfig(t);y()(t,d.filteredAssign(n,r))})),this.config.defaults.forEach((function(r){var o=ei(r);if(void 0!==o){var i=e.getCurrentItemConfig(r),a=t.getCurrentItemConfig(r),s=d.filteredAssign(n,a,i);t.config.defaultsOverride[o]=y()({},t.config.defaultsOverride[o],s)}}))}},{key:"reset",value:function(){this.checkMutable();var e=0;for(var t in this.config.defaultsOverride)e++;return(this.config.overlays.length>0||e||!this.config.useDefault)&&(this.hasChanges=!0),this.config.overlays=[],this.config.defaultsOverride={},this.config.useDefault=!0,this.hasChanges}},{key:"isEmpty",value:function(){if(!1===this.config.useDefault)return!1;if(this.config.overlays.length>0)return!1;for(var e in this.config.defaults){var t=this.config.defaults[e];if(void 0!==ei(t)){var n=this.config.defaultsOverride[ei(t)];if(n&&!f(n,d.filteredAssign($o,t)))return!1}}return!0}},{key:"changed",value:function(){return this.hasChanges}},{key:"isChartBucket",value:function(e){return"M"===e.bucket}},{key:"getCurrentItemConfig",value:function(e){var t=[];if(void 0===ei(e))return e;var n=e.isDefault,r=n?this.config.defaults:this.config.overlays,o=ei(e);for(var i in r)ei(r[i])===o&&t.push(r[i]);n&&t.push(this.config.defaultsOverride[ei(e)]);var a=y()({},e);return t.forEach((function(e){y()(a,e)})),a}},{key:"setAllEnabled",value:function(e){var t=this;this.config.overlays.forEach((function(n){t.setEnabled(n,e)})),this.config.defaults.forEach((function(n){t.setEnabled(n,e)}))}},{key:"setEnabled",value:function(e,t){this.checkMutable();var n=ei(e);if(void 0!==n){if(e.isDefault)return this.config.defaultsOverride[n]=y()(this.config.defaultsOverride[n],{enabled:t}),this.hasChanges=!0,!0;for(var r=0;r<this.config.overlays.length;r++)if(ei(this.config.overlays[r])===n)return y()(this.config.overlays[r],{enabled:t}),this.hasChanges=!0,!0}}},{key:"getName",value:function(){return this.config.name}},{key:"hasDefaults",value:function(){return this.config.defaults.length>0}}],r=[{key:"getBucketNames",value:function(){return["L2","L","L1","M","H1","H","H2"]}},{key:"getKeyFromOverlay",value:function(e){return ei(e)}}],n&&Zo(t.prototype,n),r&&Zo(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}(),ni=n(61890);function ri(e){return ri="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ri(e)}function oi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ii(r.key),r)}}function ii(e){var t=function(e,t){if("object"!=ri(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=ri(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ri(t)?t:t+""}function ai(e,t,n){return t=li(t),function(e,t){if(t&&("object"==ri(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,si()?Reflect.construct(t,n||[],li(e).constructor):t.apply(e,n))}function si(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(si=function(){return!!e})()}function li(e){return li=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},li(e)}function ui(e,t){return ui=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ui(e,t)}var ci=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=ai(this,t,[e,n])).styleMap=[],r.source=void 0,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ui(e,t)}(t,e),n=t,r=[{key:"redraw",value:function(){if(this.source)return this.source.clear(),this.source.refresh(),!0}},{key:"replacePointStyle",value:function(e,t){if("Point"===e.getGeometry().getType())try{var n,r=t.getImage().getSrc();if(r.startsWith(this.chartEntry.icons)||r.startsWith(this.chartEntry.defaultIcon))return t.getImage().setScale(this.getScale()),t;var o=window.location.href.replace(/\/[^/]*$/,"");if(r.startsWith(o)&&(r=r.substr(o.length)).startsWith("/")&&(r=r.substr(1)),r.startsWith("http")){if(this.chartEntry.allowOnline)return t;n=this.chartEntry.defaultIcon}else n=this.chartEntry.icons?this.chartEntry.icons+"/"+r+"?fallback="+encodeURIComponent(this.chartEntry.defaultIcon):this.chartEntry.defaultIcon;n?t.setImage(new Co.A({src:n})):t.setImage(new bo.A({fill:new wo.A({color:this.chartEntry[Mo+"fillColor"]||"#000000"}),radius:(this.chartEntry[Mo+"circleWidth"]||10)/2})),t.getImage().setScale(this.getScale())}catch(e){i.log("exception in kml style: "+e.message)}return t}},{key:"prepareInternal",value:function(){var e=this,t=this.chartEntry.url;return new Promise((function(n,r){if(t){e.source=new So.A({format:new ni.Ay({showPointNames:e.chartEntry.showText||!1}),wrapX:!1,loader:function(n,r,o){wt.getHtmlOrText(t,{},{_:(new Date).getTime()}).then((function(t){var r=e.source.getFormat().readFeatures(t,{extent:n,featureProjection:o});r.forEach((function(t){var n=t.getStyleFunction();"function"==typeof n&&t.setStyle((function(r,o){var i=n(r,o);if(i instanceof Array){var a=[];return i.forEach((function(n){a.push(e.replacePointStyle(t,n))})),a}return e.replacePointStyle(t,i)}))})),e.source.addFeatures(r)})).catch((function(e){}))}});var o={source:e.source,opacity:void 0!==e.chartEntry.opacity?parseFloat(e.chartEntry.opacity):1};void 0!==e.chartEntry.minZoom&&(o.minZoom=e.chartEntry.minZoom),void 0!==e.chartEntry.maxZoom&&(o.maxZoom=e.chartEntry.maxZoom),n([new Eo.A(o)])}else r("no url for "+e.chartEntry.name)}))}},{key:"featureToInfo",value:function(e,t){var n=this,r={overlayName:this.chartEntry.name,overlayType:this.chartEntry.type,overlayUrl:this.chartEntry.url,overlaySource:this};if(!e)return r;var o,i=e.getGeometry();return i instanceof Oo.A?(r.kind="point",o=this.mapholder.transformFromMap(i.getCoordinates()),r.nextTarget=o):i?(o=this.mapholder.transformFromMap(i.getClosestPoint(this.mapholder.pixelToCoord(t))),r.nextTarget=o):o=this.mapholder.transformFromMap(this.mapholder.pixelToCoord(t)),r.coordinates=o,r.desc=e.get("desc")||e.get("description"),r.desc&&r.desc.indexOf("<")>=0&&this.chartEntry.allowHtml&&(r.htmlInfo=r.desc.replace(/src *= *"([^"]*)"/g,(function(e,t){return t.startsWith("http")?n.chartEntry.allowOnline?e:'src=""':'src="'+(n.chartEntry.icons+"/"+t).replace('"','\\"')+'" '})),r.desc=void 0),r.name=e.get("name"),r.sym=e.get("sym"),this.formatFeatureInfo(r,e,o,!0),r}}],r&&oi(n.prototype,r),o&&oi(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ur),pi=ci,fi=n(41423);function hi(e){return hi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hi(e)}function mi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,di(r.key),r)}}function di(e){var t=function(e,t){if("object"!=hi(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=hi(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==hi(t)?t:t+""}function vi(e,t,n){return t=gi(t),function(e,t){if(t&&("object"==hi(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,yi()?Reflect.construct(t,n||[],gi(e).constructor):t.apply(e,n))}function yi(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(yi=function(){return!!e})()}function gi(e){return gi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},gi(e)}function bi(e,t){return bi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},bi(e,t)}var wi={lineWidth:3,lineColor:"#000000",fillColor:"rgba(255,255,0,0.4)",strokeWidth:3,circleWidth:10,showName:!1,textSize:16,textOffset:32},ki=function(e){function t(e,n){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=vi(this,t,[e,n])).styleMap={},r.userIcons={},r.styleFunction=r.styleFunction.bind(r);var o,i=y()({},wi);for(var a in i)void 0!==n[Mo+a]&&(i[a]=n[Mo+a]);return o=r.chartEntry.defaultIcon?new Co.A({src:r.chartEntry.defaultIcon}):new bo.A({radius:i.circleWidth/2,fill:new wo.A({color:i.fillColor})}),r.styles={Point:new go.Ay({image:o}),LineString:new go.Ay({stroke:new ko.A({color:i.lineColor,width:i.lineWidth})}),MultiLineString:new go.Ay({stroke:new ko.A({color:i.lineColor,width:i.lineWidth})}),MultiPoint:new go.Ay({image:o}),MultiPolygon:new go.Ay({stroke:new ko.A({color:i.lineColor,width:i.lineWidth}),fill:new wo.A({color:i.fillColor})}),Polygon:new go.Ay({stroke:new ko.A({color:i.lineColor,width:i.lineWidth}),fill:new wo.A({color:i.fillColor})}),GeometryCollection:new go.Ay({stroke:new ko.A({color:i.lineColor,width:i.lineWidth}),fill:new wo.A({color:i.fillColor}),image:o}),Circle:new go.Ay({stroke:new ko.A({color:i.lineColor,width:i.lineWidth}),fill:new wo.A({color:i.fillColor})})},r.source=void 0,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&bi(e,t)}(t,e),n=t,r=[{key:"redraw",value:function(){if(this.source)return this.source.clear(),this.source.refresh(),!0}},{key:"setIconScale",value:function(e,t){var n=e.getImage();n&&n.setScale(this.getScale())}},{key:"styleFunction",value:function(e,t){var n,r=this,o=e.getGeometry().getType(),i=this.styles[o],a={},s=!1;if(this.featureFormatter){if((a=this.formatFeatureInfo({},e,!1)).sym){var l=this.userIcons(a.sym);l||(l=new Co.A({src:a.sym}),this.userIcons[a.sym]=l),s=!0,(i=i.clone()).setImage(l)}n=a.name}else n=e.getProperties().name;return this.chartEntry["style.showName"]&&void 0!==n&&(s||(i=i.clone()),i.setText(new fi.A({text:n,textAlign:"start",font:this.chartEntry["style.textSize"]||wi.textSize+"px",offsetX:this.chartEntry["style.textOffset"]||wi.textOffset}))),this.setIconScale(i),e.setStyle((function(e,t){return r.setIconScale(i),i})),i}},{key:"prepareInternal",value:function(){var e=this,t=this.chartEntry.url;return new Promise((function(n,r){if(t){e.source=new So.A({format:new qo.A,url:t,wrapX:!1});var o={source:e.source,style:e.styleFunction,opacity:void 0!==e.chartEntry.opacity?parseFloat(e.chartEntry.opacity):1};void 0!==e.chartEntry.minZoom&&(o.minZoom=e.chartEntry.minZoom),void 0!==e.chartEntry.maxZoom&&(o.maxZoom=e.chartEntry.maxZoom),n([new Eo.A(o)])}else r("no url for "+e.chartEntry.name)}))}},{key:"featureToInfo",value:function(e,t){var n={overlayName:this.chartEntry.name,overlayType:this.chartEntry.type,overlayUrl:this.chartEntry.url,overlaySource:this};if(!e)return n;var r,o=e.getGeometry();for(var i in o instanceof Oo.A?(n.kind="point",r=this.mapholder.transformFromMap(o.getCoordinates()),n.nextTarget=r):o?(r=this.mapholder.transformFromMap(o.getClosestPoint(this.mapholder.pixelToCoord(t))),n.nextTarget=r):r=this.mapholder.transformFromMap(this.mapholder.pixelToCoord(t)),n.coordinates=r,["desc","name","sym","link","linkText"].forEach((function(t){return n[t]=e.get(t)})),this.chartEntry)d.startsWith(i,Mo)&&(n[i]=this.chartEntry[i]);return this.formatFeatureInfo(n,e,r,!0),n.link&&this.chartEntry.icons&&(n.link=this.getLinkUrl(n.link)),n}}],r&&mi(n.prototype,r),o&&mi(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ur),Ci=ki,Si=n(54108),Ei=n(74357),Oi=n(9343),Pi=n(27314);function Di(e){return Di="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Di(e)}function Ti(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ni(r.key),r)}}function Ni(e){var t=function(e,t){if("object"!=Di(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Di(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Di(t)?t:t+""}var Ri=function(){return e=function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mapholder=t,this.visible=Oe.getData(ve.properties.layers.user),this.userOverlays={},this.lineStyle={},this.setStyle(),this.panelPage=void 0,Oe.register((function(){n.visible=Oe.getData(ve.properties.layers.user)}),ve.gui.global.propertySequence)},t=[{key:"setStyle",value:function(){this.lineStyle={color:Oe.getData(ve.properties.trackColor),width:Oe.getData(ve.properties.trackWidth)}}},{key:"onPostCompose",value:function(e,t){if(this.visible)for(var n in this.userOverlays)try{this.userOverlays[n](t,e)}catch(e){i.log("error in user overlay "+n+": "+e)}}},{key:"dataChanged",value:function(){this.visible=Oe.getData(ve.properties.layers.user),this.setStyle()}},{key:"setImageStyles",value:function(e){}},{key:"registerMapWidget",value:function(e,t,n){if((this.panelPage===e||n)&&t){if(this.panelPage!==e&&(this.userOverlays={}),this.panelPage=e,n)return this.userOverlays[t]=n,!0;delete this.userOverlays[t]}}},{key:"unregisterPageWidgets",value:function(e){this.panelPage===e&&(this.userOverlays={},this.panelPage=void 0)}}],t&&Ti(e.prototype,t),n&&Ti(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function xi(e){return xi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xi(e)}function ji(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ai(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ii(r.key),r)}}function Li(e,t,n){return t&&Ai(e.prototype,t),n&&Ai(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ii(e){var t=function(e,t){if("object"!=xi(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=xi(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==xi(t)?t:t+""}var Mi=function(){return Li((function e(t){ji(this,e),this.callback=t}),[{key:"dataChanged",value:function(e){this.callback(e)}}])}(),_i={SELECTAIS:1,SELECTWP:2,RELOAD:3,LOAD:4,FEATURE:5,SHOWMAP:6,HIDEMAP:7},Fi=function(){return Li((function e(){ji(this,e),this.width=void 0,this.height=void 0,this.context=void 0}),[{key:"check",value:function(e,t,n){if(e!==this.width||t!==this.height){this.width=e,this.height=t;var r=document.createElement("canvas");r.width=e,r.height=t,this.context=r.getContext("2d")}else n&&this.clear()}},{key:"clear",value:function(){this.context&&(this.context.canvas.width=this.width)}}])}(),Bi=function(){var e=this;Nr.call(this),this.olmap=null,this.defaultDiv=document.createElement("div"),this.courseUp=!1,this.averageCourse=0,this.transformFromMap=Gr.Jt("EPSG:3857","EPSG:4326"),this.transformToMap=Gr.Jt("EPSG:4326","EPSG:3857"),this.mapEventSubscriptionId=0,this.mapEventSubscriptions={},this.userLayerContext=new Fi,this.aislayer=new xn(this),this.navlayer=new ur(this),this.tracklayer=new Dr(this),this.routinglayer=new kr(this),this.userLayer=new Ri(this),this.minzoom=32,this.mapMinZoom=32,this.maxzoom=0,this.referencePoint=[0,0],this.boatOffset={x:50,y:50},this.zoom=-1,this.lastCenter=[-1,-1],this.requiredZoom=-1,this.forceZoom=!1,this.mapZoom=-1;try{var t=Fe.getItem(Me.CENTER);if(t){var n=JSON.parse(t);this.referencePoint=n.center,this.zoom=n.zoom,this.requiredZoom=n.requiredZoom||this.zoom,n.boatOffset&&(this.boatOffset={x:n.boatOffset.x,y:decode.boatOffset.y})}}catch(e){}this.slideIn=0,this.drawing=new Rr(this,Oe.getData(ve.properties.style.useHdpi,!1)),this.northImage=new Image,this.northImage.src=xr,this.routingActive=!1,this.compassOffset=0,this.needsRedraw=!1;var r=this;this.storeKeys=de.flattenedKeys(ve.nav.gps).concat(de.flattenedKeys(ve.nav.center),de.flattenedKeys(ve.nav.wp),de.flattenedKeys(ve.nav.anchor),de.flattenedKeys(ve.nav.track),de.flattenedKeys(ve.nav.display)),this.userKeys={},this.navChanged=new Mi((function(){r.navEvent()})),this.propertyChange=new Mi((function(){r.drawing.setUseHdpi(Oe.getData(ve.properties.style.useHdpi,!1)),r.needsRedraw=!0})),this.editMode=new Mi((function(){Oe.getData(ve.gui.global.layoutEditing)&&(r.setCourseUp(!1),r.setGpsLock(!1))})),Oe.register(this.navChanged,this.storeKeys),Oe.register(this.propertyChange,ve.gui.global.propertySequence),Oe.register(this.editMode,ve.gui.global.layoutEditing),Oe.register((function(){e.gpsLocked=Oe.getData(ve.map.lockPosition)}),ve.map.lockPosition),this.gpsLocked=Oe.getData(ve.map.lockPosition),Oe.register((function(){e.updateSize()}),ve.gui.global.windowDimensions),this._baseChart=void 0,this.sources=[],this.overlayConfig=new ti,this.overlayOverrides=this.overlayConfig.copy(),this._lastMapDiv=void 0,this._lastSequenceQuery=0,Oe.storeData(ve.map.courseUp,this.courseUp),this.timer=void 0,rn.registerHandler((function(){r.changeZoom(1)}),"map","zoomIn"),rn.registerHandler((function(){r.changeZoom(-1)}),"map","zoomOut"),rn.registerHandler((function(){r.setGpsLock(!0)}),"map","lockGps"),rn.registerHandler((function(){r.setGpsLock(!1)}),"map","unlockGps"),rn.registerHandler((function(){r.setGpsLock(!r.getGpsLock())}),"map","toggleGps"),rn.registerHandler((function(){r.moveCenterPercent(-10,0)}),"map","left"),rn.registerHandler((function(){r.moveCenterPercent(10,0)}),"map","right"),rn.registerHandler((function(){r.moveCenterPercent(0,-10)}),"map","up"),rn.registerHandler((function(){r.moveCenterPercent(0,10)}),"map","down"),rn.registerHandler((function(){r.setCourseUp(!r.getCourseUp())}),"map","toggleCourseUp"),rn.registerHandler((function(){r.centerToGps()}),"map","centerToGps"),this.remoteChannel=Xt,this.remoteChannel.subscribe(Gt.setChart,(function(t){try{var n=JSON.parse(t);e.setChartEntry(n,!0)}catch(e){i.log("unable to decode chartEntry")}})),this.remoteChannel.subscribe(Gt.setCenter,(function(t){if(!e.isInUserActionGuard())try{var n=new S.Point,r=JSON.parse(t);n.fromPlain(r),e.setCenter(n,!0,{x:void 0!==r.offsetx?r.offsetx:50,y:void 0!==r.offsety?r.offsety:50})}catch(e){}})),this.remoteChannel.subscribe(Gt.setZoom,(function(t){if(!e.isInUserActionGuard())try{var n=parseFloat(t)-e.requiredZoom;e.changeZoom(n,!1,!0)}catch(e){}})),this.remoteChannel.subscribe(Gt.courseUp,(function(t){if(!e.isInUserActionGuard())try{e.setCourseUp("true"===t,!0)}catch(e){}})),this.remoteChannel.subscribe(Gt.lock,(function(t){if(!e.isInUserActionGuard())try{e.setGpsLock("true"===t,!0)}catch(e){}})),this.eventGuards=[],this.evDispatcher=void 0,this.lastUserAction=0,this.lastMapUserAction=0,this.scaleControl=void 0,this.lastRender=void 0};i.inherits(Bi,Nr),Bi.prototype.updateStoreKeys=function(e,t,n){var r=this;void 0!==t&&void 0!==n&&(e?(this.userKeys[t]||(this.userKeys[t]={}),this.userKeys[t][n]=de.flattenedKeys(e)):this.userKeys[t]&&delete this.userKeys[t][n]);var o=[];for(var i in this.userKeys)for(var a in this.userKeys[i]){var s=this.userKeys[i][a];s&&s.forEach((function(e){o.indexOf(e)<0&&r.storeKeys.indexOf(e)<0&&o.push(e)}))}Oe.register(this.navChanged,this.storeKeys.concat(o))},Bi.prototype.EventTypes=_i,Bi.prototype.subscribe=function(e){for(var t in this.mapEventSubscriptions)if(this.mapEventSubscriptions[t]===e)return t;var n=this.mapEventSubscriptionId++;return this.mapEventSubscriptions[n]=e,n},Bi.prototype._callHandlers=function(e){for(var t in this.mapEventSubscriptions){var n=this.mapEventSubscriptions[t](e);if(n)return n}return!1},Bi.prototype.unsubscribe=function(e){void 0!==e&&delete this.mapEventSubscriptions[e]},Bi.prototype.coordToPixel=function(e){return this.olmap.getPixelFromCoordinate(e)},Bi.prototype.pixelToCoord=function(e){return this.olmap.getCoordinateFromPixel(e)},Bi.prototype.getView=function(){return this.olmap?this.olmap.getView():null},Bi.prototype.getZoom=function(){var e=this.olmap?this.olmap.getView():void 0;return e?{required:this.requiredZoom,current:e.getZoom()}:{required:this.requiredZoom,current:this.zoom}},Bi.prototype.userAction=function(e){var t=(new Date).getTime();this.lastUserAction=t,this.lastMapUserAction=e?t:0},Bi.prototype.isInUserActionGuard=function(e){return(new Date).getTime()<=(e?this.lastMapUserAction:this.lastUserAction)+1e3*Oe.getData(ve.properties.remoteGuardTime,2)},Bi.prototype.renderTo=function(e){if(this.timer&&!e&&(window.clearInterval(this.timer),this.timer=void 0,this._lastMapDiv=void 0),this.olmap){this._callHandlers({type:e?this.EventTypes.SHOWMAP:this.EventTypes.HIDEMAP});var t=e||this.defaultDiv;this.olmap.setTarget(t),this._lastMapDiv=e;var n=this;if(!this.timer&&e&&(this.timer=window.setInterval((function(){n.timerFunction()}),1e3)),e){if(!window.PointerEvent){var r=document.querySelectorAll(".ol-viewport")[0];r&&(this.evDispatcher||(this.evDispatcher=Si.A,"ontouchstart"in window?this.evDispatcher.registerSource("touch",Ei.A):this.evDispatcher.registerSource("mouse",Oi.A)),r.hasAttribute("touch-action")||r.setAttribute("touch-action","none"),i.log("register map in pepjs"),this.evDispatcher.register(document.querySelectorAll(".map")[0]))}var o=Oe.getData(ve.properties.layers.base,!1);this.olmap.getLayers().forEach((function(e){e.avnavOptions&&e.avnavOptions.isBase&&e.setVisible(o)}))}else if(this.evDispatcher){var a=document.querySelectorAll(".map")[0];a&&(i.log("unregister map in pepjs"),this.evDispatcher.unregister(a))}this.updateSize()}},Bi.prototype.setChartEntry=function(e,t){this._baseChart=this.createChartSource(y()({},e,{type:"chart",enabled:!0,baseChart:!0}));try{Fe.setItem(Me.LASTCHART,void 0,this._baseChart.getChartKey())}catch(e){}if(!t)try{this.remoteChannel.sendMessage(Gt.setChart+" "+JSON.stringify(e))}catch(e){}},Bi.prototype.getLastChartKey=function(){try{return Fe.getItem(Me.LASTCHART)}catch(e){}},Bi.prototype.prepareSourcesAndCreate=function(e){var t=this;return new Promise((function(n,r){for(var o in t.sources)t.sources[o].destroy();e&&(t.sources=e),_r.resetHartbeats(),t.sources.length<1&&r("no sources");var i=0;for(var a in t.sources)t.sources[a].prepare().then((function(){i++;var e=!0;for(var o in t.sources)if(!t.sources[o].isReady()){e=!1;break}e?(t.updateOverlayConfig(),t.initMap(),n(1)):i>=t.sources.length&&r("internal error: not all sources are ready")})).catch((function(e){r(e)}))}))},Bi.prototype.createChartSource=function(e){if("chart"==e.type)return new yo(this,e);if(!e.url)throw Error("missing url for overlay");if(e.url.match(/\.gpx$/))return new Fo(this,e);if(e.url.match(/\.kml$/))return new pi(this,e);if(e.url.match(/\.geojson$/))return new Ci(this,e);throw Error("unsupported overlay: "+e.url)},Bi.prototype.getBaseChart=function(){if(this.sources&&!(this.sources.length<1))for(var e=0;e<this.sources.length;e++)if(this.sources[e].getConfig().baseChart)return this.sources[e]},Bi.prototype.loadMap=function(e){var t=this;e&&(this._lastMapDiv=e);var n=this;return new Promise((function(e,r){if(t._baseChart.getConfig().url){var o=t._baseChart;o||r("chart not set");var i=t.getBaseChart(),a=!1;(t.sources.length<1||i&&i.getChartKey()!==o.getChartKey())&&(a=!0);var s=function(o){t.prepareSourcesAndCreate(o).then((function(r){n.updateOverlayConfig(),t._callHandlers({type:t.EventTypes.RELOAD}),e(r)})).catch((function(e){r(e)}))},l=function(){if(t.needsRedraw)return t.needsRedraw=!1,void s(u);if(t.sources.length===u.length){for(var n=0;n<t.sources.length;n++)if(!t.sources[n].isEqual(u[n]))return void s(u);t.renderTo(t._lastMapDiv),t._callHandlers({type:t.EventTypes.LOAD}),e(0)}else s(u)},u=[];if(!Oe.getData(ve.gui.capabilities.uploadOverlays))return t.overlayConfig=new ti,t.overlayOverrides=t.overlayConfig.copy(),u.push(o),void l();var c={request:"api",type:"chart",overlayConfig:o.getOverlayConfigName(),command:"getConfig",expandCharts:!0,mergeDefault:!0};wt.getJson("",{},c).then((function(e){if(!(e=e.data))return t.overlayConfig=new ti,a&&(t.overlayOverrides=t.overlayConfig.copy()),void l();if(t.overlayConfig=new ti(e),a)t.overlayOverrides=t.overlayConfig.copy();else{var n=t.overlayConfig.copy();n.mergeOverrides(t.overlayOverrides),t.overlayOverrides=n}t.overlayConfig.getOverlayList().forEach((function(e){if("base"!==e.type){var n=t.createChartSource(e);n&&u.push(n)}else u.push(o)})),l()})).catch((function(e){r("unable to query overlays:"+e)}))}else r("no map selected")}))},Bi.prototype.getCurrentMergedOverlayConfig=function(){var e=this.overlayConfig.copy();return e.mergeOverrides(this.overlayOverrides),e},Bi.prototype.updateOverlayConfig=function(e){e&&(this.overlayOverrides=this.overlayConfig.copy(),this.overlayOverrides.mergeOverrides(e));for(var t=this.getCurrentMergedOverlayConfig(),n=0;n<this.sources.length;n++){var r=this.sources[n],o=r.getConfig(),i=y()({},o,t.getCurrentItemConfig(o));i?r.setVisible(void 0===i.enabled||i.enabled):r.resetVisible()}},Bi.prototype.resetOverlayConfig=function(){this.overlayOverrides=this.overlayConfig.copy(),this.updateOverlayConfig()},Bi.prototype.setEnabled=function(e,t,n){e&&(this.overlayOverrides.setEnabled(e.getConfig(),t)&&n&&this.updateOverlayConfig())},Bi.prototype.getBaseLayer=function(e){var t={MultiPolygon:new go.Ay({stroke:new ko.A({color:"blue",width:1}),fill:new wo.A({color:"rgba(0, 0, 255, 0.1)"})}),Polygon:new go.Ay({stroke:new ko.A({color:"blue",width:1}),fill:new wo.A({color:"rgba(0, 0, 255, 0.1)"})})},n=new So.A({format:new qo.A,url:"countries-110m.json",wrapX:!1}),r=new Eo.A({source:n,style:function(e){return t[e.getGeometry().getType()]},visible:e});return r.avnavOptions={isBase:!0},r},Bi.prototype.getMapOutlineLayer=function(e,t){var n=new go.Ay({stroke:new ko.A({color:"red",width:2})}),r=new So.A({wrapX:!1});if(e&&e.length>0){var o=qr.S5();e.forEach((function(e){if(e.avnavOptions&&e.avnavOptions.extent){var t=e.avnavOptions.extent;o=qr.X$(o,t)}}));var i=new Wo.A(new Uo.Ay([[qr.R(o),qr.k_(o),qr.WU(o),qr.Py(o)]]));i.setStyle(n),r.addFeature(i)}var a=new Eo.A({source:r,visible:t});return a.avnavOptions={isBase:!0},a},Bi.prototype.updateStateControl=function(){this.scaleControl&&(this.olmap.removeControl(this.scaleControl),this.scaleControl=void 0);Oe.getData(ve.properties.layers.scale,!1)&&(this.scaleControl=new zo.A({units:"nautical",steps:4,bar:!0,text:Oe.getData(ve.properties.mapScaleBarText,!0),minWidth:140})),this.scaleControl&&this.olmap.addControl(this.scaleControl)},Bi.prototype.initMap=function(){var e=this,t=this._lastMapDiv,n=this,r=[],o=[];this.minzoom=32,this.mapMinZoom=this.minzoom,this.maxzoom=0;for(var i=function(t){e.sources[t].getLayers().forEach((function(n){e.sources[t].getConfig().baseChart&&n.avnavOptions&&(n.avnavOptions.minZoom<e.minzoom&&(e.minzoom=n.avnavOptions.minZoom),n.avnavOptions.maxZoom>e.maxzoom&&(e.maxzoom=n.avnavOptions.maxZoom),o.push(n)),r.push(n)}))},a=0;a<this.sources.length;a++)i(a);var s=new Eo.A({source:new So.A({features:[new Wo.A(new Oo.A([0,0]))]}),style:new go.Ay({image:new bo.A({radius:.6})}),renderBuffer:1/0,zIndex:1/0});r.push(s),this.mapMinZoom=this.minzoom;var l=Oe.getData(ve.properties.layers.base,!0);if(l&&(this.minzoom=2),this.olmap){var u=this.olmap.getLayers();if(u&&u.getArray().length){var c;c=u.getArray().slice(0);for(var p=0;p<c.length;p++)this.olmap.removeLayer(c[p])}this.olmap.addLayer(this.getBaseLayer(l)),o.length>0&&this.olmap.addLayer(this.getMapOutlineLayer(o,l));for(var f=0;f<r.length;f++)this.olmap.addLayer(r[f]);this.renderTo(t)}else{var h=[];h.push(this.getBaseLayer(l)),o.length>0&&h.push(this.getMapOutlineLayer(o,l));var m=void 0;try{void 0===document.body.style.transform&&(console.log("browser has no transform feature, keeping pixelRatio at 1"),m=1)}catch(e){console.log("unable to detect transform feature")}var d=Ko.NT({altShiftDragRotate:!1,pinchRotate:!1,mouseWheelZoom:!1});d.push(new Pi.A({condition:function(t){return t.type===Jr.A.WHEEL&&(e.gpsLocked&&(t.coordinate=e.transformToMap(e.referencePoint)),e.userAction(!0)),!0}})),this.olmap=new Ho.A({pixelRatio:m,target:t||n.defaultDiv,layers:h.concat(r),interactions:d,controls:[],view:new Vo.Ay({center:this.transformToMap([13.8,54.1]),zoom:9,extent:this.transformToMap([-200,-89,200,89])})}),this.olmap.on("click",(function(e){return n._callGuards("click"),n.userAction(!0),n.onClick(e)})),this.olmap.on("pointerdrag",(function(){return n.userAction(!0)})),this.olmap.on("pointermove",(function(){return n.userAction(!0)})),this.olmap.on("singleclick",(function(){return n.userAction(!0)})),this.olmap.on("postrender",(function(e){return n.postrender(e)})),this.olmap.getView().on("change:resolution",(function(e){return n.onZoomChange(e)}))}r.length>0&&r[r.length-1].on("postrender",(function(e){return n.onPostCompose(e)})),this.updateStateControl(),this.renderTo(t);var v,y=!0;if(this.requiredZoom<0&&(this.requiredZoom=this.minzoom),this.zoom<0&&(this.zoom=this.minzoom),this.requiredZoom&&(this.zoom=this.requiredZoom),this.referencePoint&&this.zoom>0){this._centerToReference(),this.zoom<this.minzoom&&(this.zoom=this.minzoom),this.zoom>this.maxzoom+Oe.getData(ve.properties.maxUpscale)&&(this.zoom=this.maxzoom+Oe.getData(ve.properties.maxUpscale));var g=0;Oe.getData(ve.properties.mapUpZoom)<Oe.getData(ve.properties.slideLevels)&&(g=Oe.getData(ve.properties.slideLevels)-Oe.getData(ve.properties.mapUpZoom)),g>0&&this.zoom>=this.minzoom+g&&(this.zoom-=g,this.doSlide(g)),this.requiredZoom=this.zoom,this.setZoom(this.zoom),y=!1;var b=void 0;if(o.length>0&&void 0!==(b=o[0].avnavOptions.extent)&&!qr.Ym(b,this.pointToMap(this.referencePoint))){if(o.length>0){var w=n.getView();void 0!==(b=o[0].avnavOptions.extent)&&w.fit(b,n.olmap.getSize()),n.setZoom(n.minzoom),n.center=n.pointFromMap(w.getCenter()),n.zoom=w.getZoom()}n.saveCenter()}}if(y&&o.length>0){v=this.getView();var k=o[0].avnavOptions.extent;void 0!==k&&v.fit(k,n.olmap.getSize()),this.setZoom(this.minzoom),this.referencePoint=this.pointFromMap(v.getCenter()),this.zoom=v.getZoom()}this.saveCenter(),Oe.getData(ve.properties.layers.boat)||(this.gpsLocked=!1),Oe.storeData(ve.map.lockPosition,this.gpsLocked)},Bi.prototype.sendReference=function(){this.isInUserActionGuard()&&this.remoteChannel.sendMessage(Gt.setCenter+" "+JSON.stringify({lat:this.referencePoint[1],lon:this.referencePoint[0],offsetx:this.boatOffset.x,offsety:this.boatOffset.y}))},Bi.prototype.postrender=function(e){var t=this.getView();if(t){var n=t.getCenter(),r=t.getZoom(),o=new S.Point;if(o.fromCoord(this.pointFromMap(n)),Oe.storeData(ve.map.centerPosition,o),!this.lastCenter||this.lastCenter[0]!==n[0]||this.lastCenter[1]!==n[1]||r!==this.zoom){this.lastCenter=n;this.zoom;this.zoom=r;var i=Oe.getData(ve.properties.mapLockMove)&&this.isInUserActionGuard(!0);if(this.gpsLocked){if(i){var a=Oe.getMultiple(ve.nav.gps);if(a.valid){var s=this.boatOffset;this.setBoatOffset(a),s.x===this.boatOffset.x&&s.y===this.boatOffset.y||(this.saveCenter(),this.sendReference())}}}else this.referencePoint=this.transformFromMap(n),this.boatOffset={x:50,y:50},this.saveCenter(),this.sendReference()}}},Bi.prototype.timerFunction=function(){var e=this.getZoom();Oe.storeMultiple(e,{required:ve.map.requiredZoom,current:ve.map.currentZoom});var t=this,n=(new Date).getTime();if(this.lastRender+1e3<n&&(this.olmap.render(),this.lastRender=n),this._lastSequenceQuery<n-Oe.getData(ve.properties.mapSequenceTime,5e3)&&(this._lastSequenceQuery=n,this.sources.length>0&&this._lastMapDiv))for(var r in this.sources)this.sources[r].checkSequence().then((function(e){e&&t.prepareSourcesAndCreate(void 0)})).catch((function(e){}))},Bi.prototype.changeZoom=function(e,t,n){n||this.userAction();var r=this.requiredZoom;Oe.getData(ve.properties.mapZoomLock)&&(e>0?Math.ceil(r)!=r&&(r=Math.ceil(r),e--):Math.floor(r)!=r&&(r=Math.floor(r),e<0&&e++)),(r+=e)<this.minzoom&&(r=this.minzoom),r>this.maxzoom+Oe.getData(ve.properties.maxUpscale)&&(r=this.maxzoom+Oe.getData(ve.properties.maxUpscale)),this.requiredZoom=r,this.forceZoom=t||!1,this.setZoom(r),this.checkAutoZoom(),this.timerFunction()},Bi.prototype.setZoom=function(e){this.olmap&&(this.mapZoom=e,this.olmap.getView().getZoom()!=e&&(i.log("set new zoom "+e),this.olmap.getView().setZoom(e),this._centerToReference()))},Bi.prototype.drawGrid=function(){if(Oe.getData(ve.properties.layers.grid)&&this.olmap){var e={width:1,color:"grey"},t=this.drawing.getContext();if(t){var n=t.canvas.width,r=t.canvas.height,o=this.pointFromMap(this.olmap.getCoordinateFromPixel([0,0])),i=this.pointFromMap(this.olmap.getCoordinateFromPixel([n,0])),a=this.pointFromMap(this.olmap.getCoordinateFromPixel([0,r])),s=this.pointFromMap(this.olmap.getCoordinateFromPixel([n,r])),l=[Math.min(o[0],i[0],a[0],s[0]),Math.max(o[0],i[0],a[0],s[0])],u=[Math.min(o[1],i[1],a[1],s[1]),Math.max(o[1],i[1],a[1],s[1])],c=5/60;if(!((l[1]-l[0])/c>n/60||(u[1]-u[0])/c>r/60)){for(var p=!this.drawing.getRotation(),f={color:"grey",fontSize:12,fontBase:"Calibri,sans-serif",offsetY:7,fixY:0},h=Math.floor(l[0]);h<=l[1];h+=c)if(this.drawing.drawLineToContext([this.pointToMap([h,u[0]]),this.pointToMap([h,u[1]])],e),p){var m=W.formatLonLatsDecimal(h,"lon");this.drawing.drawTextToContext(this.pointToMap([h,u[0]]),m,f)}f.offsetY=-7,f.offsetX=30,f.fixY=void 0,f.fixX=0;for(var d=Math.floor(u[0]);d<=u[1];d+=c)if(this.drawing.drawLineToContext([this.pointToMap([l[0],d]),this.pointToMap([l[1],d])],e),p){var v=W.formatLonLatsDecimal(d,"lat");this.drawing.drawTextToContext(this.pointToMap([l[0],d]),v,f)}}}}},Bi.prototype.drawNorth=function(){Oe.getData(ve.properties.layers.compass)&&this.olmap&&this.drawing.drawImageToContext([0,0],this.northImage,{fixX:45,fixY:45+this.compassOffset,rotateWithView:!0,size:[80,80],anchor:[40,40],backgroundCircle:"#333333",backgroundAlpha:.25})},Bi.prototype.getCourseUp=function(){return this.courseUp},Bi.prototype.getGpsLock=function(){return this.gpsLocked},Bi.prototype.getBoatOffset=function(){return this.boatOffset},Bi.prototype.setBoatOffset=function(e){if(!e)return this.boatOffset={x:50,y:50},!0;var t=this.olmap.getPixelFromCoordinate(this.pointToMap([e.lon,e.lat])),n=this.olmap.getSize();if(t&&n&&n[0]>0&&n[1]>0){var r=100*t[0]/n[0],o=100*t[1]/n[1];return this.boatOffset={x:r,y:o},!0}},Bi.prototype.navEvent=function(){var e=Oe.getMultiple(ve.nav.gps);if(e.valid){var t=Oe.getData(ve.properties.mapLockMove)&&this.isInUserActionGuard(!0);if(this.gpsLocked&&!t){if(this.courseUp){var n=Oe.getData(ve.nav.display.mapDirection);this.setMapRotation(n)}this.setCenter(e,!0,this.getBoatOffset())}this.checkAutoZoom()}this.olmap&&this.olmap.render()},Bi.prototype.centerToGps=function(e){if(Oe.getData(ve.nav.gps.valid)){e||this.userAction();var t=Oe.getData(ve.nav.gps.position);this.setBoatOffset(),this.setCenter(t),this.sendReference()}},Bi.prototype.checkAutoZoom=function(e){var t=Oe.getData(ve.properties.autoZoom)||e;if(this.forceZoom&&(t=!1),this.olmap)if(t&&(this.gpsLocked||e)){if(!this.slideIn){var n=this.olmap.getView().getCenter(),r=!1,o=!1,a=2;for(a=Math.floor(this.requiredZoom);a>=this.mapMinZoom;a--){o=!1;for(var s=this.olmap.getLayers().getArray(),l=0;l<s.length&&!o;l++){var u=s[l];if(u.avnavOptions&&u.avnavOptions.zoomLayerBoundings){var c=u.get("source");if(c&&c instanceof zr.A){r=!0;var p=u.avnavOptions.zoomLayerBoundings,f=c.getTileGrid().getTileCoordForCoordAndZ(n,a),h=f[0],m=f[1],d=f[2];if(d=-d-1,p[h])for(var v in p[h]){var y=p[h][v];if(y.minx<=m&&y.maxx>=m&&y.miny<=d&&y.maxy>=d){o=!0;break}}}}}if(o){a!=Math.floor(this.olmap.getView().getZoom())?(i.log("autozoom change to "+a),e&&(this.requiredZoom=a),this.setZoom(a)):e&&a!=this.requiredZoom&&(this.requiredZoom=a);break}}if(!o&&r&&this.minzoom==this.mapMinZoom){var g=a+1;g>this.requiredZoom&&(g=this.requiredZoom),g!=this.olmap.getView().getZoom&&(i.log("autozoom change to "+a),e&&(this.requiredZoom=g),this.setZoom(g))}r||this.setZoom(this.requiredZoom)}}else this.olmap.getView().getZoom()!=this.requiredZoom&&this.setZoom(this.requiredZoom)},Bi.prototype.pointToMap=function(e){return this.transformToMap(e)},Bi.prototype.pointFromMap=function(e){return this.transformFromMap(e)},Bi.prototype._centerToReference=function(){if(this.getView()){var e=this.olmap.getSize(),t=this.pointToMap(this.referencePoint);if(null==e||50===this.boatOffset.x&&50===this.boatOffset.y)this.getView().setCenter(t);else{var n=[e[0]*this.boatOffset.x/100,e[1]*this.boatOffset.y/100];this.getView().centerOn(t,e,n)}}},Bi.prototype.setCenter=function(e,t,n){e&&(t||this.userAction(),this.referencePoint=[e.lon,e.lat],this.boatOffset=void 0!==n?n:{x:50,y:50},this._centerToReference())},Bi.prototype.getCenter=function(){var e=new S.Point;return e.fromCoord(this.pointFromMap(this.getView().getCenter())),e},Bi.prototype.pixelDistance=function(e,t){if(!this.olmap)return 0;var n=this.pointToMap(e.toCoord()),r=this.pointToMap(t.toCoord()),o=this.coordToPixel(n),i=this.coordToPixel(r),a=o[0]-i[0],s=o[1]-i[1];return Math.sqrt(s*s+a*a)},Bi.prototype.setMapRotation=function(e,t){if(void 0!==e){var n=this.getView();if(n){var r=(0==e?0:(360-e)*Math.PI/180)-n.getRotation();n.adjustRotation(r,this.transformToMap(void 0!==t?t:this.referencePoint))}}},Bi.prototype.moveCenterPercent=function(e,t){if(this.olmap){var n=this.coordToPixel(this.transformToMap(this.referencePoint)),r=this.olmap.getSize();if(r){var o=r[0]*e/100,i=r[1]*t/100;n[0]+=o,n[1]+=i,this.referencePoint=this.transformFromMap(this.pixelToCoord(n)),this._centerToReference()}}},Bi.prototype.setCourseUp=function(e,t){if(t||Xt.sendMessage(Gt.courseUp,e?"true":"false"),this.courseUp===e)return e;var n=void 0;if(!this.gpsLocked){var r=Oe.getMultiple(ve.nav.gps);r.valid&&(n=[r.position.lon,r.position.lat])}if(e){var o=Oe.getData(ve.nav.display.mapDirection);return void 0!==o&&(this.setMapRotation(o,n),this.courseUp=e,Oe.storeData(ve.map.courseUp,e)),e}this.courseUp=e,Oe.storeData(ve.map.courseUp,e),this.setMapRotation(0,n)},Bi.prototype.setGpsLock=function(e,t){t||Xt.sendMessage(Gt.lock,e?"true":"false"),e!==this.gpsLocked&&(e&&Oe.storeData(ve.map.measurePosition,void 0),!Oe.getData(ve.nav.gps.valid)&&e||!Oe.getData(ve.properties.layers.boat)&&e||(Oe.storeData(ve.map.lockPosition,e),e?this.setCenter(Oe.getData(ve.nav.gps.position),t,this.getBoatOffset()):this.setBoatOffset(),this.sendReference(),this.checkAutoZoom()))},Bi.prototype.onClick=function(e){var t=this;e.preventDefault(),e.stopPropagation();var n=this.routinglayer.findTarget(e.pixel);if(n&&this._callHandlers({type:this.EventTypes.SELECTWP,wp:n}))return!1;var r=this.aislayer.findTarget(e.pixel);if(r&&this._callHandlers({type:_i.SELECTAIS,aisparam:r}))return!1;if(!Oe.getData(ve.properties.featureInfo,!0))return!0;if(n){var o={coordinates:[n.lon,n.lat]},a=n.routeName;if(a?("gpx"!==d.getExt(a)&&(a+=".gpx"),y()(o,{overlayType:"route",overlayName:a,activeRoute:!0,nextTarget:[n.lon,n.lat],name:n.name})):y()(o,{overlayType:"target",overlayName:"current target",name:n.name}),this._callHandlers({type:_i.FEATURE,feature:o}))return!1}var s=this.tracklayer.findTarget(e.pixel);if(s){var l=this.pixelToCoord(e.pixel),u={overlayType:"track",overlayName:"current",coordinates:this.transformFromMap(l),nextTarget:s};if(this._callHandlers({type:_i.FEATURE,feature:u}))return!1}var c,p=[],f=function(n){if(n){var r=n.source.featureToInfo(n.feature,e.pixel);return t._callGuards("click"),t._callHandlers({type:_i.FEATURE,feature:r})}if(Oe.getData(ve.properties.emptyFeatureInfo)){var o=t.getBaseChart();if(!o)return;var i=t.transformFromMap(t.pixelToCoord(e.pixel)),a={overlayType:"chart",overlayName:o.getConfig().name,coordinates:i,nextTarget:i};return t._callGuards("click"),t._callHandlers({type:_i.FEATURE,feature:a})}};this.olmap.forEachFeatureAtPixel(e.pixel,(function(e,t){t.avnavOptions&&t.avnavOptions.chartSource&&p.push({feature:e,layer:t,source:t.avnavOptions.chartSource})}),{hitTolerance:Oe.getData(ve.properties.clickTolerance)/2});for(var h=this.sources.length-1;h>=0&&!c;h--)for(var m=0;m<p.length;m++)if(p[m].source===this.sources[h]){c=p[m];break}for(var v=[],g=this.sources.length-1;g>=0&&(!c||c.source!==this.sources[g]);g--)this.sources[g].hasFeatureInfo()&&v.push(this.sources[g].getChartFeaturesAtPixel(e.pixel));return v.length<1?f(c):(Promise.all(v).then((function(n){for(var r,o,i,a=t.getBaseChart(),s=0;s<n.length;s++)if(!(void 0===n[s]||n[s].length<1)){var l=n[s][0];if(l){if(l.nextTarget){r=l;break}a&&a.getChartKey()===l.chartKey&&(o=l),!i&&l.htmlInfo&&(i=l)}}var u=r;if(u||(u=i),u||(u=o),u){if(!u.nextTarget){var p=t.pixelToCoord(e.pixel),h=t.transformFromMap(p);u.nextTarget=h}return t._callGuards("click"),t._callHandlers({type:_i.FEATURE,feature:u}),!0}return f(c)})).catch((function(e){i.log("error in query features: "+e)})),!1)},Bi.prototype.onZoomChange=function(e){if(e.preventDefault(),i.log("zoom changed"),this.mapZoom>=0){var t=this.getView().getZoom();t!=this.mapZoom&&(t<this.minzoom&&(t=this.minzoom),t>this.maxzoom+Oe.getData(ve.properties.maxUpscale)&&(t=this.maxzoom+Oe.getData(ve.properties.maxUpscale)),i.log("zoom required from map: "+t),this.requiredZoom=t,t!=this.getView().getZoom()&&this.getView().setZoom(t)),this.isInUserActionGuard()&&this.remoteChannel.sendMessage(Gt.setZoom+" "+t)}},Bi.prototype.findTarget=function(e,t,n){i.log("findTarget "+e[0]+","+e[1]);var r,o=n||10,a=e[0]-o,s=e[0]+o,l=e[1]-o,u=e[1]+o,c=[];for(r=0;r<t.length;r++){var p=t[r];p instanceof Array||(p=p.pixel),p[0]>=a&&p[0]<=s&&p[1]>=l&&p[1]<=u&&c.push({idx:r,pixel:p})}return c.length?(1==c.length||c.sort((function(t,n){return(t.pixel[0]-e[0])*(t.pixel[0]-e[0])+(t.pixel[1]-e[1])*(t.pixel[1]-e[1])-((n.pixel[0]-e[0])*(n.pixel[0]-e[0])+(n.pixel[1]-e[1])*(n.pixel[1]-e[1]))})),c[0].idx):-1},Bi.prototype.onPostCompose=function(e){this.lastRender=(new Date).getTime(),this.drawing.setContext(e.context),this.drawing.setDevPixelRatio(e.frameState.pixelRatio),this.drawing.setRotation(e.frameState.viewState.rotation),(new S.Point).fromCoord(this.pointFromMap(e.frameState.viewState.center)),this.drawGrid(),this.drawNorth(),this.tracklayer.onPostCompose(e.frameState.viewState.center,this.drawing),this.aislayer.onPostCompose(e.frameState.viewState.center,this.drawing),this.routinglayer.onPostCompose(e.frameState.viewState.center,this.drawing),this.navlayer.onPostCompose(e.frameState.viewState.center,this.drawing),this.userLayerContext.check(e.context.canvas.width,e.context.canvas.height,!0),this.drawing.setContext(this.userLayerContext.context),this.userLayer.onPostCompose(e.frameState.viewState.center,this.drawing),e.context.drawImage(this.userLayerContext.context.canvas,0,0,this.userLayerContext.width,this.userLayerContext.height)},Bi.prototype.doSlide=function(e){if(e)this.slideIn=e;else{if(!this.slideIn)return;if(this.changeZoom(1,!1,!0),this.slideIn--,!this.slideIn)return}var t=this,n=Oe.getData(ve.properties.slideTime);window.setTimeout((function(){t.doSlide()}),n)},Bi.prototype.updateSize=function(){this.olmap&&this.olmap.updateSize()},Bi.prototype.triggerRender=function(){this.olmap&&this.olmap.render()},Bi.prototype.saveCenter=function(){var e=JSON.stringify({center:this.referencePoint,zoom:this.zoom,requiredZoom:this.requiredZoom,boatOffset:this.getBoatOffset()});Fe.setItem(Me.CENTER,void 0,e)},Bi.prototype.setRoutingActive=function(e){var t=this.routingActive;this.routingActive=e,t!=e&&this.triggerRender()},Bi.prototype.getRoutingActive=function(){return this.routingActive},Bi.prototype.showEditingRoute=function(e){this.routinglayer.showEditingRoute(e)},Bi.prototype.setCompassOffset=function(e){this.compassOffset=e},Bi.prototype.getCurrentChartEntry=function(){if(this._baseChart)return this._baseChart.getConfig()},Bi.prototype.setImageStyles=function(e){e&&"object"===xi(e)&&(this.navlayer.setImageStyles(e),this.aislayer.setImageStyles(e),this.routinglayer.setImageStyles(e),this.tracklayer.setImageStyles(e),this.userLayer.setImageStyles(e))},Bi.prototype.registerEventGuard=function(e){e&&(this.eventGuards.indexOf(e)>=0||this.eventGuards.push(e))},Bi.prototype._callGuards=function(e){this.eventGuards.forEach((function(t){t(e)}))},Bi.prototype.registerMapWidget=function(e,t,n){if(this.userLayer&&t.name){var r=this.userLayer.registerMapWidget(e,t.name,n);(t.storeKeys&&r||!n)&&this.updateStoreKeys(n?t.storeKeys:void 0,e,t.name)}},Bi.prototype.unregisterPageWidgets=function(e){this.userLayer&&(this.userLayer.unregisterPageWidgets(e),delete this.userKeys[e],this.updateStoreKeys())};var Wi=new Bi,Hi=["onClick"];function Vi(){return Vi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Vi.apply(null,arguments)}var Ki=void 0;Wi.registerEventGuard((function(e){"click"===e&&(Ki=(new Date).getTime())}));var Ui=function(e,t){return Ue.forwardRef((function(t,n){var r=t.onClick,o=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(t,Hi),i=r?function(){var e=Oe.getData(ve.properties.mapClickWorkaroundTime,300);if(void 0!==Ki&&(new Date).getTime()-e<=Ki)return;t.onClick&&t.onClick.apply(this,Array.prototype.slice.call(arguments))}:void 0;return Ue.createElement(e,Vi({ref:n,onClick:i},o))}))};function qi(e){return qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qi(e)}function zi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Gi(r.key),r)}}function Gi(e){var t=function(e,t){if("object"!=qi(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=qi(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==qi(t)?t:t+""}function Zi(e,t,n){return t=Ji(t),function(e,t){if(t&&("object"==qi(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Xi()?Reflect.construct(t,n||[],Ji(e).constructor):t.apply(e,n))}function Xi(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Xi=function(){return!!e})()}function Ji(e){return Ji=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ji(e)}function Yi(e,t){return Yi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Yi(e,t)}var Qi=Ui(Ue.forwardRef((function(e,t){return Ue.createElement("div",{className:"overlay_cover_active",onClick:e.onClick,ref:t},e.children)}))),$i=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Zi(this,t,[e])).container=null,n.state={update:0},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Yi(e,t)}(t,e),n=t,(r=[{key:"render",value:function(){var e=this,t=this.props.content,n="dialog";return this.props.className&&(n+=" "+this.props.className),Ue.createElement(Qi,{ref:function(t){return e.container=t},onClick:this.props.closeCallback},Ue.createElement("div",{ref:function(t){return e.box=t},className:n,onClick:function(e){e.preventDefault(),e.stopPropagation()}},Ue.createElement(t,{closeCallback:this.props.closeCallback})))}}])&&zi(n.prototype,r),o&&zi(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);$i.propTypes={parent:Ge().element,onClick:Ge().func,closeCallback:Ge().func,className:Ge().string};var ea=$i;function ta(e){return ta="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ta(e)}function na(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ra(r.key),r)}}function ra(e){var t=function(e,t){if("object"!=ta(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=ta(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ta(t)?t:t+""}function oa(e,t,n){return t=aa(t),function(e,t){if(t&&("object"==ta(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ia()?Reflect.construct(t,n||[],aa(e).constructor):t.apply(e,n))}function ia(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ia=function(){return!!e})()}function aa(e){return aa=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},aa(e)}function sa(e,t){return sa=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},sa(e,t)}var la={},ua=0;function ca(e,t){var n=t||Oe,r=function(t){function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=oa(this,r,[e])).id=0,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&sa(e,t)}(r,t),o=r,(i=[{key:"componentDidMount",value:function(){ua++,this.id=ua,la[this.id]=!0,n.storeData(ve.gui.global.hasActiveInputs,Object.keys(la).length>0)}},{key:"componentWillUnmount",value:function(){delete la[this.id],n.storeData(ve.gui.global.hasActiveInputs,Object.keys(la).length>0)}},{key:"render",value:function(){return Ue.createElement(e,this.props)}}])&&na(o.prototype,i),a&&na(o,a),Object.defineProperty(o,"prototype",{writable:!1}),o;var o,i,a}(Ue.Component);return r}var pa=n(14295);function fa(e){return fa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fa(e)}var ha=["ItemClass"],ma=["ItemClass"];function da(){return da=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},da.apply(null,arguments)}function va(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function ya(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ga(r.key),r)}}function ga(e){var t=function(e,t){if("object"!=fa(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=fa(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==fa(t)?t:t+""}function ba(e,t,n){return t=ka(t),function(e,t){if(t&&("object"==fa(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,wa()?Reflect.construct(t,n||[],ka(e).constructor):t.apply(e,n))}function wa(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(wa=function(){return!!e})()}function ka(e){return ka=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ka(e)}function Ca(e,t){return Ca=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ca(e,t)}var Sa=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=ba(this,t,[e])).onSortEnd=n.onSortEnd.bind(n),n.Content=n.Content.bind(n),n.ItemWrapper=n.ItemWrapper.bind(n),n.ItemWrapperNoClick=n.ItemWrapperNoClick.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ca(e,t)}(t,e),n=t,(r=[{key:"onSortEnd",value:function(e){var t=this.props.itemList?this.props.itemList.length:0;this.props.reverse?this.props.onSortEnd&&this.props.onSortEnd(t-e.oldIndex,t-e.newIndex):this.props.onSortEnd&&this.props.onSortEnd(e.oldIndex,e.newIndex)}},{key:"ItemWrapper",value:function(e){var t=this,n=e.ItemClass,r=va(e,ha),o=Ue.useCallback((function(e){if(e&&e.stopPropagation&&e.stopPropagation(),e&&e.preventDefault&&e.preventDefault(),t.props.reverse){var n=t.props.itemList?t.props.itemList.length:0;t.props.onItemClick(y()({},r,{index:n-r.index}),e)}else t.props.onItemClick(r,e)}),[r]);return Ue.createElement(n,da({},r,{onClick:o}))}},{key:"ItemWrapperNoClick",value:function(e){var t=e.ItemClass,n=va(e,ma);return Ue.createElement(t,n)}},{key:"Content",value:function(e){var t=this,n=0,r={};return Ue.createElement("div",{className:e.className,style:e.style,ref:function(t){e.listRef&&e.listRef(t)},onClick:function(e){t.props.onClick&&(e.stopPropagation(),t.props.onClick(e))}},e.allitems.map((function(o){for(var i,a,s,l,u=y()({},o),c=void 0!==(a=(i=o).key)?a:a=i.name,p=20;p>0&&(!c||r[c]);)c+="_"+n,p--;if(u.index=t.props.reverse?e.allitems.length-n:n,u.key=c,r[c]=!0,void 0!==t.props.selectedIndex&&(n==t.props.selectedIndex?u.selected=!0:u.selected=!1),t.props.itemCreator){if(!(s=t.props.itemCreator(o)))return null}else s=t.props.itemClass;return t.props.dragdrop&&(s=(0,pa.Zj)(s)),l=!u.onClick&&t.props.onItemClick?t.ItemWrapper:t.ItemWrapperNoClick,n++,Ue.createElement(l,da({ItemClass:s,key:c},u))})))}},{key:"render",value:function(){var e=this.props.itemList||[];if(this.props.hideOnEmpty&&e.length<1)return null;var t=this,n="listContainer";this.props.scrollable&&(n+=" scrollable"),this.props.className&&(n+=" "+this.props.className),this.props.horizontal&&(n+=" horizontal");var r=this.props.style||{};this.props.fontSize&&(r.fontSize=this.props.fontSize);var o={},i=this.Content;return this.props.dragdrop&&(i=(0,pa.q6)(i),o.axis=t.props.horizontal?"x":"y",o.distance=20,o.onSortEnd=t.onSortEnd,o.helperClass="sortableHelper"),this.props.scrollable?Ue.createElement("div",{onClick:t.props.onClick,className:n,style:r,ref:function(e){t.props.listRef&&t.props.listRef(e)}},Ue.createElement(i,da({className:"listScroll",allitems:e},o))):Ue.createElement(i,da({className:n,allitems:e,style:r,listRef:t.props.listRef},o))}}])&&ya(n.prototype,r),o&&ya(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);Sa.propTypes={onItemClick:Ge().func,itemClass:Ge().any,itemCreator:Ge().func,itemList:Ge().array,className:Ge().string,scrollable:Ge().bool,hideOnEmpty:Ge().bool,fontSize:Ge().any,listRef:Ge().func,selectedIndex:Ge().number,onClick:Ge().func,dragdrop:Ge().bool,horizontal:Ge().bool,reverse:Ge().bool,onSortEnd:Ge().func};var Ea=Sa;function Oa(e){return Oa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Oa(e)}var Pa=["icon","style","disabled"];function Da(){return Da=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Da.apply(null,arguments)}function Ta(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Na(r.key),r)}}function Na(e){var t=function(e,t){if("object"!=Oa(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Oa(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Oa(t)?t:t+""}function Ra(e,t,n){return t=ja(t),function(e,t){if(t&&("object"==Oa(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,xa()?Reflect.construct(t,n||[],ja(e).constructor):t.apply(e,n))}function xa(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(xa=function(){return!!e})()}function ja(e){return ja=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ja(e)}function Aa(e,t){return Aa=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Aa(e,t)}var La=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=n=Ra(this,t,[e]);return rn.registerDialogComponent("dialogButton"),It.keyEventHandler(n,(function(e,t){r.props.onClick&&!r.props.disabled&&r.props.onClick()}),"dialogButton",n.props.name),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Aa(e,t)}(t,e),n=t,r=[{key:"render",value:function(){var e=this.props.className||"";e+=" dialogButton "+this.props.name;var t=this.props,n=t.icon,r=(t.style,t.disabled),o=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(t,Pa),i={};void 0!==n&&(e+=" icon",i.backgroundImage="url("+n+")"),e+=this.props.toggle?" active":" inactive";var a={};return r&&(a.disabled=!0),Ue.createElement("button",Da({},o,a,{className:e}),Ue.createElement("span",{style:i}),this.props.children)}}],r&&Ta(n.prototype,r),o&&Ta(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);La.propTypes={onClick:Ge().func,className:Ge().string,name:Ge().string.isRequired,icon:Ge().string,style:Ge().object,disabled:Ge().bool,toggle:Ge().bool};var Ia=La;function Ma(e){return Ma="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ma(e)}function _a(){return _a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_a.apply(null,arguments)}function Fa(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ba(r.key),r)}}function Ba(e){var t=function(e,t){if("object"!=Ma(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Ma(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Ma(t)?t:t+""}function Wa(e,t,n){return t=Va(t),function(e,t){if(t&&("object"==Ma(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Ha()?Reflect.construct(t,n||[],Va(e).constructor):t.apply(e,n))}function Ha(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ha=function(){return!!e})()}function Va(e){return Va=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Va(e)}function Ka(e,t){return Ka=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ka(e,t)}var Ua=1,qa=function(){window.avnav.android&&window.avnav.android.dialogClosed&&window.avnav.android.dialogClosed()},za=function(){return++Ua},Ga=function(e,t,n,r,o){e||(e=za());var i={content:t,parent:n,cancelCallback:r,closeCallback:function(){Za(e)},onClick:function(){Za(e)}},a=y()({},Oe.getData(ve.gui.global.currentDialog,{}));return o&&(i.timeoutHandler=window.setTimeout(Za(e),o)),a[e]=i,Oe.storeData(ve.gui.global.currentDialog,a),e},Za=function(e,t){var n=y()({},Oe.getData(ve.gui.global.currentDialog,{})),r=n[e];return void 0!==r&&(delete n[e],r.timeoutHandler&&window.clearTimeout(r.timeout)),Oe.storeData(ve.gui.global.currentDialog,n),r&&r.cancelCallback&&!t&&r.cancelCallback(),qa(),void 0!==r},Xa={createSelectDialog:function(e,t,n,r,o){return function(i){return Ue.createElement("div",{className:"selectDialog inner"},Ue.createElement("h3",{className:"dialogTitle"},e||""),Ue.createElement("div",{className:"selectList"},t.map((function(e){return Ue.createElement("div",{className:"listEntry "+(e.selected&&"selectedItem"),onClick:function(){n&&n(e),i.closeCallback&&i.closeCallback()},key:e.value+":"+e.label},e.label)}))),Ue.createElement("div",{className:"dialogButtons"},o&&Ue.createElement(Ia,{name:"reset",onClick:function(e){i.closeCallback&&i.closeCallback(),o(e)}},"Reset"),Ue.createElement(Ia,{name:"cancel",onClick:function(e){i.closeCallback&&i.closeCallback(),r&&r(e)}},"Cancel")))}},createValueDialog:function(e,t,n,r,o){var i=function(i){function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=Wa(this,a,[e])).state={value:t},n.valueChanged=n.valueChanged.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ka(e,t)}(a,i),s=a,(l=[{key:"valueChanged",value:function(e){this.setState({value:e.target.value})}},{key:"render",value:function(){var t=this;return Ue.createElement("div",{className:"inner"},Ue.createElement("h3",{className:"dialogTitle"},e||"Input"),Ue.createElement("div",null,Ue.createElement("div",{className:"dialogRow"},Ue.createElement("span",{className:"inputLabel"},o),Ue.createElement("input",{type:"text",name:"value",value:this.state.value,onChange:this.valueChanged}))),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"cancel",onClick:r},"Cancel"),Ue.createElement(Ia,{name:"ok",onClick:function(){return n(t.state.value)}},"Ok")))}}])&&Fa(s.prototype,l),u&&Fa(s,u),Object.defineProperty(s,"prototype",{writable:!1}),s;var s,l,u}(Ue.Component);return i},createConfirmDialog:function(e,t,n,r){return function(o){return Ue.createElement("div",{className:"inner"},Ue.createElement("h3",{className:"dialogTitle"},r||""),Ue.createElement("div",{className:"dialogText"},e),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"cancel",onClick:function(){n&&n(),o.closeCallback&&o.closeCallback()}},"Cancel"),Ue.createElement(Ia,{name:"ok",onClick:function(){t&&t(),o.closeCallback&&o.closeCallback()}},"Ok")))}},getDialogContainer:function(e){var t=ca(ea),n=ot(Ea);return Ue.createElement(n,_a({},e,{itemClass:t,storeKeys:{items:ve.gui.global.currentDialog},updateFunction:function(e){var t=[];for(var n in e.items){var r=y()({key:n},e.items[n]);delete r.timeoutHandler,t.push(r)}return{itemList:t}}}))},createAlertDialog:function(e,t){return function(n){return Ue.createElement("div",{className:"inner"},Ue.createElement("h3",{className:"dialogTitle"},"Alert"),Ue.createElement("div",{className:"dialogText"},e),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"ok",onClick:t},"Ok")))}},alert:function(e,t){return new Promise((function(n,r){var o=za();Ga(o,Xa.createAlertDialog(e,(function(){Za(o,!0),n()})),t,(function(){n()}))}))},confirm:function(e,t,n){return new Promise((function(r,o){var i=za(),a=Xa.createConfirmDialog(e,(function(e){r(1)}),(function(e){o()}),n);Ga(i,a,t,(function(){o()}))}))},valueDialog:function(e,t,n,r,o,i){var a=za(),s=Xa.createValueDialog(e,t,(function(e){Za(a,!0),n(e)}),(function(){Za(a,!0)&&i&&i()}),o);Ga(a,s,r,(function(){i&&i()}))},valueDialogPromise:function(e,t,n,r){var o=za();return new Promise((function(i,a){var s=Xa.createValueDialog(e,t,(function(e){return Za(o,!0),i(e),!0}),(function(){Za(o,!0),a()}),r);Ga(o,s,n,(function(){a()}))}))},selectDialogPromise:function(e,t,n){return new Promise((function(r,o){var i=za(),a=Xa.createSelectDialog(e,t,(function(e){r(e)}),(function(){o()}));Ga(i,a,n,(function(){o()}))}))},dialog:function(e,t,n,r){var o=za();return Ga(o,e,t,n,r)},hide:function(){Oe.storeData(ve.gui.global.currentDialog,{})}},Ja=function(e,t){var n=ca(ea);return Ue.createElement(n,{className:"nested",content:e,closeCallback:t})},Ya=function(e,t,n){t||(t="dialog");var r={showDialog:function(n){var o={};o[t]=function(e){return Ue.createElement(n,_a({},e,{closeCallback:function(){r.hideDialog()}}))},e.setState(o)},hideDialog:function(){var r={};r[t]=void 0,e.setState(r),qa(),n&&n()},filterState:function(e){var n=y()({},e);return delete n[t],n},getRender:function(){var n=this;return e.state[t]?Ja(e.state[t],(function(){n.hideDialog()})):null},isShowing:function(){return!!e.state[t]}};r.showDialog=r.showDialog.bind(r),r.hideDialog=r.hideDialog.bind(r),r.filterState=r.filterState.bind(r),r.getRender=r.getRender.bind(r);var o=e.render;return e.render=function(){return Ue.createElement(Ue.Fragment,null,r.getRender(),o.call(e))}.bind(e),r},Qa=function(e){return Ue.createElement("div",{className:"dialogRow "+e.className},Ue.createElement("span",{className:"inputLabel"},e.label),Ue.createElement("span",{className:"itemInfo"},e.value))};Qa.show=function(e,t){var n=e[t.value];return void 0===n||t.formatter&&void 0===(n=t.formatter(n,e))?null:Ue.createElement(Qa,{label:t.label,value:n})};var $a=Xa;function es(e){return es="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},es(e)}function ts(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ns(r.key),r)}}function ns(e){var t=function(e,t){if("object"!=es(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=es(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==es(t)?t:t+""}var rs=Gt.setPage,os=function(){return e=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.history=[],this.callback=t,this.pop=this.pop.bind(this),this.push=this.push.bind(this),this.updateCallback=this.updateCallback.bind(this),this.reset=this.reset.bind(this),this.replace=this.replace.bind(this),this.setOptions=this.setOptions.bind(this),this.remoteChannel=Xt,n&&this.push(n,r)},(t=[{key:"setCallback",value:function(e){this.callback=e}},{key:"setFromRemote",value:function(e,t){this.history.splice(1,this.history.length),this.history.push({location:e,options:y()({},t,{remote:!0})}),this.updateCallback(!1,!0)}},{key:"replace",value:function(e,t){if(this.history.length<1)this.push(e,t);else{var n=this.history[this.history.length-1];this.history.splice(-1,1,{location:e,options:t||{},back:n}),this.updateCallback()}}},{key:"backFromReplace",value:function(e){if(this.history.length<1)return!1;var t=this.history[this.history.length-1];return t.back?(t.location=t.back.location,t.options=t.back.options,t.back=t.back.back,this.updateCallback(),!0):!!e&&(this.pop(),!0)}},{key:"setOptions",value:function(e){if(this.history[this.history.length-1],this.history.length<1)return!1;var t=this.history[this.history.length-1];t.options=y()({},t.options,e),this.updateCallback()}},{key:"push",value:function(e,t){this.history.push({location:e,options:t||{}}),this.updateCallback()}},{key:"pop",value:function(){this.history.splice(-1,1),this.updateCallback(!0)}},{key:"currentLocation",value:function(e){if(!(this.history.length<1)){if(e){var t=this.history[this.history.length-1];return{location:t.location,options:t.options}}return this.history[this.history.length-1].location}}},{key:"reset",value:function(){this.history.splice(1,this.history.length),this.updateCallback()}},{key:"updateCallback",value:function(e,t){var n={};this.history.length>0&&(n=this.history[this.history.length-1],e&&(n.options||(n.options={}),n.options.returning=!0)),this.callback&&this.callback(n),t||this.remoteChannel.sendMessage(rs+" "+n.location+" "+JSON.stringify(n.options))}},{key:"isTop",value:function(){return this.history.length<=1}}])&&ts(e.prototype,t),n&&ts(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function is(e){return is="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},is(e)}var as=["toggle","icon","style","disabled","overflow","editDisable","editOnly","visible","dummy"];function ss(){return ss=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ss.apply(null,arguments)}function ls(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,us(r.key),r)}}function us(e){var t=function(e,t){if("object"!=is(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=is(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==is(t)?t:t+""}function cs(e,t,n){return t=fs(t),function(e,t){if(t&&("object"==is(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ps()?Reflect.construct(t,n||[],fs(e).constructor):t.apply(e,n))}function ps(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ps=function(){return!!e})()}function fs(e){return fs=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},fs(e)}function hs(e,t){return hs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},hs(e,t)}var ms=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=n=cs(this,t,[e]);return It.keyEventHandler(n,(function(e,t){r.props.onClick&&!r.props.disabled&&r.props.onClick()}),"button",n.props.name),n.spanRef=n.spanRef.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&hs(e,t)}(t,e),n=t,r=[{key:"spanRef",value:function(e){if(e){var t=window.getComputedStyle(e).backgroundImage;t&&(e.style.backgroundImage=t)}}},{key:"render",value:function(){var e=this.props.className||"";e+=" button "+this.props.name,void 0!==this.props.toggle&&(e+=("function"==typeof this.props.toggle?this.props.toggle():this.props.toggle)?" active":" inactive");var t=this.props,n=(t.toggle,t.icon),r=(t.style,t.disabled),o=(t.overflow,t.editDisable,t.editOnly,t.visible,t.dummy,function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(t,as)),i={};void 0!==n&&(i.backgroundImage="url("+n+")");var a={};return r&&(a.disabled="disabled"),Ue.createElement("button",ss({},o,a,{className:e}),Ue.createElement("span",{style:i,ref:this.spanRef}))}}],r&&ls(n.prototype,r),o&&ls(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);ms.propTypes={onClick:Ge().func,className:Ge().string,toggle:Ge().bool,name:Ge().string.isRequired,icon:Ge().string,style:Ge().object,disabled:Ge().bool};var ds=ms,vs=function(){this.currentTrack=[],this.trackValid=!1,this.lastTrackQuery=(new Date).getTime(),this.timer=null,this.trackErrors=0,this.trackRequestSequence=0,Oe.register(this,ve.gui.global.propertySequence)};vs.prototype.handleTrackResponse=function(e){var t=0;this.currentTrack.length>0&&(t=this.currentTrack[this.currentTrack.length-1].ts);for(var n=0;n<e.length;n++){var r=e[n];e[n].ts<=t||this.currentTrack.push(new S.TrackPoint(r.lon,r.lat,r.ts,r.speed,r.course))}var o=3600*Oe.getData(ve.properties.initialTrackLength),a=Oe.getMultiple(ve.nav.gps),s=new Date;a.rtime&&(s=a.rtime);var l=s.getTime()/1e3-o;for(i.log("removing track data older then "+l);this.currentTrack.length>0&&!(this.currentTrack[0].ts>l);)this.currentTrack.shift();Oe.storeData(ve.nav.track.currentTrack,this.currentTrack.slice(0))},vs.prototype.startQuery=function(){var e="?request=track&command=getTrack",t=parseInt(Oe.getData(ve.properties.trackQueryTimeout)),n=parseInt(Oe.getData(ve.properties.trackInterval)),r=this,o=(new Date).getTime(),a=0;if(0==this.currentTrack.length)a=3600*Oe.getData(ve.properties.initialTrackLength)/Oe.getData(ve.properties.trackInterval);else{var s=o-this.lastTrackQuery+2*t;(a=(s/=1e3)/n)<10&&(a=10)}0==(a=Math.floor(a))&&(a=1),e+="&maxnum="+a+"&interval="+n;var l=r.trackRequestSequence;wt.getJson(e,{checkOk:!1,timeout:t}).then((function(e){l==r.trackRequestSequence&&(r.lastTrackQuery=(new Date).getTime(),r.handleTrackResponse(e),i.log("trackdatadata"),r.handleTrackStatus(!0),r.timer=window.setTimeout((function(){r.startQuery()}),t))})).catch((function(e){i.log("query track error"),r.handleTrackStatus(!1),r.timer=window.setTimeout((function(){r.startQuery()}),t)}))},vs.prototype.handleTrackStatus=function(e){if(e)this.trackErrors=0,this.trackValid=!0;else{if(this.trackErrors++,!(this.trackErrors>10))return;i.log("lost track"),this.trackValid=!1}},vs.prototype.getTrackData=function(){return this.currentTrack},vs.prototype.dataChanged=function(){this.resetTrack()},vs.prototype.resetTrack=function(){self.trackRequestSequence++,this.currentTrack=[],Oe.storeData(ve.nav.track.currentTrack,[])};var ys=vs;function gs(e,t,n){return t=ws(t),function(e,t){if(t&&("object"==Cs(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,bs()?Reflect.construct(t,n||[],ws(e).constructor):t.apply(e,n))}function bs(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(bs=function(){return!!e})()}function ws(e){return ws=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ws(e)}function ks(e,t){return ks=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ks(e,t)}function Cs(e){return Cs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cs(e)}function Ss(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Es(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ps(r.key),r)}}function Os(e,t,n){return t&&Es(e.prototype,t),n&&Es(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ps(e){var t=function(e,t){if("object"!=Cs(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Cs(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Cs(t)?t:t+""}var Ds=function(){return Os((function e(t){Ss(this,e),this.length=parseInt(t||0),this.currentValue=void 0,this.values=[]}),[{key:"isum",value:function(e,t){return e+t}},{key:"idiff",value:function(e,t){return e-t}},{key:"inorm",value:function(e,t){return e/t}},{key:"encode",value:function(e){return e}},{key:"decode",value:function(e){return e}},{key:"reset",value:function(e){this.currentValue=void 0,this.values=[],void 0!==e&&(this.length=parseInt(e))}},{key:"getLength",value:function(){return this.length}},{key:"add",value:function(e){var t=e;if(void 0!==(e=this.encode(e)))return void 0===this.currentValue||this.values.length<1?(this.currentValue=e,this.length<1||(this.values.push(e),this.values.length>=this.length&&this.values.shift()),t):(this.values.length>=this.length&&(this.currentValue=this.idiff(this.currentValue,this.values.shift())),this.currentValue=this.isum(this.currentValue,e),this.values.push(e),this.decode(this.inorm(this.currentValue,this.values.length)));if(this.values.length>0){var n=this.values.shift();this.values.length>0?this.currentValue=this.idiff(this.currentValue,n):this.currentValue=void 0}else this.currentValue=void 0}},{key:"val",value:function(){return this.values.length<1?this.decode(this.currentValue):this.decode(this.inorm(this.currentValue,this.values.length))}}])}(),Ts=function(e){function t(e){return Ss(this,t),gs(this,t,[e])}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ks(e,t)}(t,e),Os(t,[{key:"isum",value:function(e,t){return[e[0]+t[0],e[1]+t[1]]}},{key:"idiff",value:function(e,t){return[e[0]-t[0],e[1]-t[1]]}},{key:"inorm",value:function(e,t){return[e[0]/t,e[1]/t]}},{key:"inRange",value:function(e){for(;e>=360;)e-=360;for(;e<0;)e+=360;return e}},{key:"linSin",value:function(e){return(e=this.inRange(e))>=0&&e<90?e:e>=90&&e<180?90-(e-90):e>=180&&e<270?-(e-180):e-270-90}},{key:"linCos",value:function(e){return(e=this.inRange(e))>=0&&e<90?90-e:e>=90&&e<180?-(e-90):e>=180&&e<270?e-180-90:e-270}},{key:"encode",value:function(e){return void 0===e?e:(e=this.inRange(e),[this.linSin(e),this.linCos(e)])}},{key:"decode",value:function(e){if(void 0===e)return e;var t=e[0],n=e[1],r=Math.abs(t)<=Math.abs(n);return t>=0?n>=0?r?t:90-n:r?90-t+90:180-(90+n):n>=0?r?360+t:270+n:r?180-t:270+n}},{key:"fract",value:function(e,t,n){if(void 0===t||n<0||n>1)return e;var r=this.encode(e),o=this.encode(t),i=[r[0]+n*(o[0]-r[0]),r[1]+n*(o[1]-r[1])];return this.decode([i[0],i[1]])}}])}(Ds);function Ns(e){return Ns="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ns(e)}function Rs(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xs(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,As(r.key),r)}}function js(e,t,n){return t&&xs(e.prototype,t),n&&xs(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function As(e){var t=function(e,t){if("object"!=Ns(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Ns(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Ns(t)?t:t+""}function Ls(e,t,n){return t=Ms(t),function(e,t){if(t&&("object"==Ns(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Is()?Reflect.construct(t,n||[],Ms(e).constructor):t.apply(e,n))}function Is(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Is=function(){return!!e})()}function Ms(e){return Ms=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ms(e)}function _s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Fs(e,t)}function Fs(e,t){return Fs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Fs(e,t)}var Bs=["source","tag","mode"],Ws=["time","track","course","courseAverageOn","speedAverageOn","positionAverageOn"],Hs=function(){var e=this;this.timer=null,this.gpsErrors=0,this.resetAverages(),Oe.register((function(){return e.resetAverages()}),[ve.properties.positionAverageInterval,ve.properties.courseAverageInterval,ve.properties.speedAverageInterval,ve.gui.global.propertiesLoaded]),this.additionalKeys={};var t=this.getStoreKeys();for(var n in this.filteredStoreKeys={},this.genericStoreKeys={},t)Bs.indexOf(n)>=0||(this.filteredStoreKeys[n]=t[n],Ws.indexOf(n)>=0||(this.genericStoreKeys[n]=t[n]))},Vs=function(e){return Oe.getData(de.keyNodeToString(ve.properties)+"."+e+"AverageInterval")},Ks=function(e){function t(e){var n;return Rs(this,t),(n=Ls(this,t,[Vs(e)])).key=e,n}return _s(t,e),js(t,[{key:"setEnabled",value:function(e){e&&(e[this.key+"AverageOn"]=this.getLength()>0)}}])}(Ds),Us=function(e){function t(e){var n;return Rs(this,t),(n=Ls(this,t,[Vs(e)])).key=e,n}return _s(t,e),js(t,[{key:"setEnabled",value:function(e){e&&(e[this.key+"AverageOn"]=this.getLength()>0)}}])}(Ts);Hs.prototype.resetAverages=function(){this.averages={lat:new Ks("position"),lon:new Ks("position"),course:new Us("course"),speed:new Ks("speed")}},Hs.prototype.average=function(e){var t=e;for(var n in this.averages){var r=this.averages[n];r.getLength()&&(void 0!==e[n]&&r.add(e[n]),t[n]=r.val()),r.setEnabled(t)}return t},Hs.prototype.writeToStore=function(e,t){var n=y()({},e,{position:new S.Point(e.lon,e.lat),sequence:Oe.getData(ve.nav.gps.sequence,0)+1});Oe.storeMultiple(n,y()({},this.filteredStoreKeys,t))},Hs.prototype.handleGpsResponse=function(e,t){var n={lat:void 0,lon:void 0,course:void 0,speed:void 0};if(n.connectionLost=!this.handleGpsStatus(t),t){for(var r in n.valid=null!==e.lat&&void 0!==e.lat&&null!==e.lon&&void 0!==e.lon,n.rtime=void 0,null!==e.time&&void 0!==e.time&&(n.rtime=new Date(e.time)),delete e.time,n.course=e.course,delete e.course,void 0===n.course&&(n.course=e.track),delete e.track,this.genericStoreKeys)void 0!==e[r]&&(n[r]=e[r],delete e[r]);n=this.average(n)}if(!n.valid)for(var o in this.averages)this.averages[o].reset();if(t||n.connectionLost){var i=de.keyNodeToString(ve.nav.gps);for(var a in e)Bs.indexOf(a)>=0||this.filteredStoreKeys[a]||(this.additionalKeys[a]=this.computeKeys(a,e[a],i),n[a]=e[a]);this.writeToStore(n,this.additionalKeys)}},Hs.prototype.computeKeys=function(e,t,n){var r=n+"."+e;if(t instanceof Object){var o={};for(var i in t)o[i]=this.computeKeys(i,t[i],r);return o}return r},Hs.prototype.startQuery=function(){var e=this,t=parseInt(Oe.getData(ve.properties.positionQueryTimeout,1e3));wt.getJson("?request=gps",{checkOk:!1}).then((function(n){e.handleGpsResponse(n,!0),e.timer=window.setTimeout((function(){e.startQuery()}),t)})).catch((function(n){i.log("query position error"),e.handleGpsResponse({},!1),e.timer=window.setTimeout((function(){e.startQuery()}),t)}))},Hs.prototype.handleGpsStatus=function(e){return e?(this.gpsErrors=0,!0):(this.gpsErrors++,!(this.gpsErrors>Oe.getData(ve.properties.maxGpsErrors))||(i.log("lost gps"),!1))},Hs.prototype.getStoreKeys=function(){return ve.nav.gps.getKeys()},Hs.getStoreKeys=Hs.prototype.getStoreKeys;var qs=Hs;function zs(e){return zs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zs(e)}function Gs(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Zs(r.key),r)}}function Zs(e){var t=function(e,t){if("object"!=zs(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=zs(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==zs(t)?t:t+""}var Xs=new $n($n.MODES.ACTIVE),Js=new $n($n.MODES.EDIT),Ys=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.callback=t},t=[{key:"dataChanged",value:function(e){this.callback(e)}}],t&&Gs(e.prototype,t),n&&Gs(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}(),Qs=function(){var e=this;this.lastReceivedLeg=void 0,this.lastSentLeg=void 0,this.lastReceivedRoute=void 0,this.lastSentRoute=void 0,Xs.modify((function(t){var n=!1;t.leg||(t.leg=new In.Leg(new S.WayPoint(0,0),new S.WayPoint(0,0),!1),t.leg.approachDistance=parseFloat(Oe.getData(ve.properties.routeApproach,-1)),n=!0);try{var r=Fe.getItem(Me.ROUTING);r&&(t.leg.fromJsonString(r),n=!0)}catch(e){i.log("Exception reading currentLeg "+e)}if(t.leg.currentRoute&&e._saveRouteLocal(t.leg.currentRoute,!0),t.leg.name&&!t.leg.currentRoute){var o=e._loadRoute(t.leg.name,!0);t.leg.currentRoute=o||new In.Route(t.leg.name),n=!0,delete t.leg.name}return t.route=t.leg.currentRoute,n})),this.DEFAULTROUTE="default",this.FALLBACKROUTENAME=Me.DEFAULTROUTE,this.connectMode=Oe.getData(ve.properties.connectedMode)||void 0!==avnav.android,this.readOnlyServer=Oe.getData(ve.properties.readOnlyServer),this.timer=null,this.routeErrors=0,this.serverConnected=!1,this.lastDistanceToCurrent=-1,this.lastDistanceToNext=-1,this.lastApproachStarted=void 0,this.formatter=W;var t=this;Oe.register(this,ve.gui.global.propertySequence),this.activeRouteChanged=new Ys((function(){var e=Xs.getRawData();t._legChangedLocally(e.leg),t.isEditingActiveRoute()&&Js.setRouteAndIndex(e.route,e.index)})),this.editingRouteChanged=new Ys((function(){var t=Js.getRoute();if(t&&(e._saveRouteLocal(t),e.connectMode&&!e.isEditingActiveRoute())){t.differsTo(e.lastSentRoute)&&(e.lastSentRoute=t.clone());var n=!0;e.lastReceivedRoute&&e.lastReceivedRoute.name==t.name||(n=!1),e._sendRoute(t,(function(){return!1}),n)}})),Oe.register(this.activeRouteChanged,Xs.getStoreKeys()),Oe.register(this.editingRouteChanged,Js.getStoreKeys()),this.lastLegSequence=Oe.getData(ve.nav.gps.updateleg),this.currentRoutePage=void 0};Qs.prototype.isActiveRoute=function(e){return e==Xs.getRouteName()},Qs.prototype.saveRoute=function(e,t){var n=this;return new Promise((function(r,o){e||o("no route"),!t&&n._localRouteExists(e)&&o("route already exists"),n._saveRouteLocal(e),n.connectMode?n._sendRoute(e,(function(e){e&&o(e),r(0)}),t):r(0)}))},Qs.prototype.saveRouteString=function(e,t){if(this.connectMode){var n=new In.Route;try{n.fromXml(e)}catch(e){return t&&setTimeout((function(){t("error parsing route: "+e)}),0),e+""}this._sendRoute(n,(function(e){t&&t(e)}),!0)}else t&&t("can only save in connected mode")},Qs.prototype.isEditingActiveRoute=function(){var e=Xs.getRouteName();return e&&e==Js.getRouteName()},Qs.prototype.wpOn=function(e,t){if(e){var n=new S.WayPoint.fromPlain(e);if(e.routeName){n.routeName=e.routeName;var r=this._loadRoute(e.routeName);r&&r.getIndexFromPoint(n)>=0||(n.routeName=void 0)}n.routeName?this._startRouting(In.RoutingMode.ROUTE,n,t):this._startRouting(In.RoutingMode.WP,n,t)}else this.routeOff()},Qs.prototype.anchorOn=function(e,t,n){if(!e&&n){if(!Oe.getData(ve.nav.gps.valid))return;e=Oe.getData(ve.nav.gps.position)}if(e){if(!(e instanceof S.WayPoint)){var r=new S.WayPoint;r.update(e),e=r}void 0===t&&(t=Oe.getData(ve.properties.anchorWatchDefault)),Xs.modify((function(n){return n.leg&&n.leg.setAnchorWatch(e,t),!0}))}},Qs.prototype.anchorOff=function(){Xs.modify((function(e){if(e.leg)return e.leg.anchorDistance=void 0,e.leg.to=new S.WayPoint(0,0),e.leg.active=!1,!0}))},Qs.prototype._startRouting=function(e,t,n){var r=this;Xs.modify((function(o){var i;o.leg||(o.leg=new In.Leg),o.leg.approachDistance=parseFloat(Oe.getData(ve.properties.routeApproach,-1));var a=Oe.getData(ve.nav.gps.position),s=Oe.getData(ve.map.centerPosition);if(Oe.getData(ve.nav.gps.valid)?i=new S.WayPoint(a.lon,a.lat):(i=new S.WayPoint,s.assign(i)),o.leg.active?o.leg.hasRoute()?(e==In.RoutingMode.WP||e==In.RoutingMode.WPINACTIVE||t&&t.routeName!=o.leg.getRouteName())&&(n=!1):e==In.RoutingMode.ROUTE&&(n=!1):n=!1,n||(o.leg.from=i),o.leg.active=!1,e==In.RoutingMode.WP)return o.leg.to=t,o.leg.name=void 0,o.route=void 0,o.leg.currentRoute=void 0,o.leg.active=!0,o.leg.anchorDistance=void 0,!0;if(e==In.RoutingMode.WPINACTIVE)return o.leg.to=t,o.leg.name=void 0,o.leg.currentRoute=void 0,o.leg.active=!1,o.leg.anchorDistance=void 0,o.route=void 0,!0;if(e==In.RoutingMode.ROUTE){if(!t||!t.routeName)return;var l=r._loadRoute(t.routeName);if(!l)return;if(l.getIndexFromPoint(t)<0)return;return o.leg.currentRoute=l,o.route=l,o.leg.name=void 0,o.leg.to=t,o.leg.active=!0,o.leg.anchorDistance=void 0,!0}return!1}))},Qs.prototype.legRestart=function(){Xs.modify((function(e){if(!e.leg||!e.leg.active)return!1;var t=Oe.getData(ve.nav.gps.position);return!!Oe.getData(ve.nav.gps.valid)&&(e.leg.from=new S.WayPoint(t.lon,t.lat),!0)}))},Qs.prototype.routeOff=function(){Xs.hasActiveTarget()&&Xs.modify((function(e){return e.leg.active=!1,e.leg.name=void 0,e.leg.currentRoute=void 0,e.leg.to.routeName=void 0,e.activeName=void 0,e.route=void 0,!0}))},Qs.prototype.listRoutes=function(e){var t=this;return new Promise((function(n,r){var o=t._listRoutesLocal();if(e&&Oe.getData(ve.gui.capabilities.uploadRoute,!1)){var i=Js.getRouteName(),a=Oe.getData(ve.properties.connectedMode,!1);wt.getJson("",{},{request:"list",type:"route"}).then((function(e){for(var r=0;r<e.items.length;r++){var s=new In.RouteInfo;y()(s,e.items[r]),s.server=!0,!1!==s.canDelete&&(s.canDelete=a),s.name===i&&(s.canDelete=!1),t.isActiveRoute(s.name)&&(s.active=!0);for(var l=!1,u=0;u<o.length;u++)if(o[u].name===s.name){o[u]=s,l=!0;break}l||o.push(s)}n(o)})).catch((function(e){r(e)}))}else n(o)}))},Qs.prototype.getInfoFromRoute=function(e){if(e){var t=new In.RouteInfo(e.name);try{e.points&&(t.numpoints=e.points.length),t.length=e.computeLength(0,Oe.getData(ve.nav.routeHandler.useRhumbLine)),t.time=e.time}catch(e){}return t}},Qs.prototype._listRoutesLocal=function(){var e,t,n=[],r=0,o=Fe.listByPrefix(Me.ROUTE),i=Js.getRouteName(),a=Oe.getData(ve.nav.routeHandler.useRhumbLine);for(r=0;r<o.length;r++){var s=o[r].substr(Me.ROUTE.length);e=new In.RouteInfo(this._ensureGpx(s));try{(t=new In.Route).fromJsonString(Fe.getItem(Me.ROUTE,s)),t.points&&(e.numpoints=t.points.length),e.length=t.computeLength(0,a),e.time=t.time,this.isActiveRoute(e.name)&&(e.active=!0),e.name===i&&(e.canDelete=!1)}catch(e){}n.push(e)}return n},Qs.prototype.deleteRoute=function(e,t,n,r){var o=e.replace(/\.gpx$/,""),i=this._loadRoute(o,!0);if((!i||i.server)&&!this.connectMode&&!r)return n&&setTimeout((function(){n("server route and we are disconnected")}),0),!1;try{Fe.removeItem(Me.ROUTE,o)}catch(e){}this.connectMode&&!r?wt.getJson("",{},{request:"delete",type:"route",name:this._ensureGpx(e)}).then((function(e){t&&t()})).catch((function(e){n&&n(e)})):t&&setTimeout((function(){t()}),0)},Qs.prototype.getLocalRouteXml=function(e){e=e.replace(/\.gpx$/,"");var t=this._loadRoute(e,!0);if(t)return t.toXml()},Qs.prototype._ensureGpx=function(e){return e.match(/\.gpx$/)||(e+=".gpx"),e},Qs.prototype._downloadRoute=function(e,t,n){e=this._ensureGpx(e),wt.getHtmlOrText("",{useNavUrl:!0},{request:"download",type:"route",name:e}).then((function(r){var o=new In.Route;o.fromXml(r);var a=e.replace(/\.gpx$/,"");if(o.name===a)t(o);else{var s="downloaded route has invalid name expected="+a+", current="+o.name;n?n(s):i.log(s)}})).catch((function(e){n&&n(e)}))},Qs.prototype.fetchRoute=function(e,t,n,r){var o,i=this,a=function(t){(o=i._loadRoute(e,!0))?setTimeout((function(){n(o)}),0):r&&setTimeout((function(){r(t+": "+e)}),0)};t?a("unable to fetch locally"):this._downloadRoute(e,(function(e){e.server=!0,i._saveRouteLocal(e,!0),n&&n(e)}),(function(e){a("unable to fetch from server and locally")}))},Qs.prototype._inQuadrant=function(e,t){var n=[],r=e-90;r<0&&(n.push([360+r,360]),r=0);var o=e+90;for(var i in o>=360&&(n.push([0,o-360]),o=360),n.push([r,o]),n){var a=n[i];if(a[0]<=t&&a[1]>t)return!0}return!1},Qs.prototype._checkNextWp=function(){var e=this;Xs.modify((function(t){if(t.leg&&t.leg.isRouting()){var n=t.leg.approach;if(!t.leg.to||t.leg.to.name!=S.WayPoint.MOB){var r=Oe.getData(ve.nav.gps.position);if(Oe.getData(ve.nav.gps.valid)){var o=Oe.getData(ve.nav.routeHandler.useRhumbLine),a=t.leg.getCurrentTargetIdx()+1,s=t.route?t.route.getPointAtIndex(a):void 0,l=t.leg.approachDistance,u=l/10;try{var c=P.computeDistance(r,t.leg.to,o);if(!(c.dts<=l))return t.leg.approach=!1,e.lastApproachStarted=void 0,t.leg.approach!=n;if(t.leg.approach=!0,!t.leg.hasRoute())return t.leg.approach!==n;var p=(new Date).getTime();n||(e.lastApproachStarted=p);var f=Oe.getData(ve.nav.routeHandler.nextWpMode,"late"),h=!1;if("early"===f){if(!e.lastApproachStarted||!s)return t.leg.approach!==n;var m=Oe.getData(ve.nav.routeHandler.nextWpTime,10);e.lastApproachStarted+1e3*m<=p&&(h=!0)}if("90"===f){var d=new E.A(t.leg.from.lat,t.leg.from.lon),v=new E.A(r.lat,r.lon),y=new E.A(t.leg.to.lat,t.leg.to.lon),g=o?y.rhumbBearingTo(d):y.initialBearingTo(d),b=o?y.rhumbBearingTo(v):y.initialBearingTo(v);e._inQuadrant(g,b)||(h=!0)}if("late"===f){var w=new S.Distance;if(s&&(w=P.computeDistance(r,s,o)),e.lastDistanceToCurrent<0||e.lastDistanceToNext<0)return e.lastDistanceToCurrent=c.dts,e.lastDistanceToNext=w.dts,!0;var k=c.dts-e.lastDistanceToCurrent;if(k<=u)return k<=0&&(e.lastDistanceToCurrent=c.dts,e.lastDistanceToNext=w.dts),!0;var C=w.dts-e.lastDistanceToNext;if(s&&C>-u)return C>0&&(e.lastDistanceToCurrent=c.dts,e.lastDistanceToNext=w.dts),!0;h=!0}h&&(s?(t.leg.from=t.leg.to,t.leg.to=s,i.log("switching to next WP"),e.lastDistanceToCurrent=-1,e.lastDistanceToNext=-1,t.leg.approach=!1):(window.setTimeout((function(){e.routeOff()}),0),i.log("end of route reached")))}catch(e){}return!0}}}}))},Qs.prototype._handleLegResponse=function(e){var t=this;if(!e)return!1;if(["useRhumbLine","nextWpMode","nextWpTime"].forEach((function(t){void 0!==e[t]&&(Oe.storeData(ve.nav.routeHandler[t],e[t]),delete e[t])})),this.routeErrors=0,!this.connectMode)return!1;var n=new In.Leg;if(n.fromJson(e),n.currentRoute&&(n.currentRoute.server=!0),this.lastSentLeg&&!n.differsTo(this.lastReceivedLeg))return!1;this.lastSentLeg||(this.lastSentLeg=n),this.lastReceivedLeg=n,this.isEditingActiveRoute()&&n.currentRoute&&(this.lastReceivedRoute=n.currentRoute.clone()),Xs.modify((function(e){if(t.lastReceivedLeg.differsTo(e.leg)){if(e.leg=t.lastReceivedLeg.clone(),e.leg.name){if(!e.leg.currentRoute){var n=t._loadRoute(e.leg.name);e.leg.currentRoute=n||new In.Route(e.leg.name)}delete e.leg.name}return e.route=e.leg.currentRoute,!0}}))},Qs.prototype.startQuery=function(){this._checkNextWp();var e=Oe.getData(ve.properties.routeQueryTimeout),t=this;if(!this.connectMode)return this.lastReceivedLeg=void 0,this.lastReceivedRoute=void 0,this.lastSentRoute=void 0,this.lastSentLeg=void 0,void(t.timer=window.setTimeout((function(){t.startQuery()}),e));var n=Oe.getData(ve.nav.gps.updateleg);if(void 0===this.lastLegSequence||this.lastLegSequence!==n?(this.lastLegSequence=n,wt.getJson("?request=route&command=getleg",{checkOk:!1}).then((function(n){var r=t._handleLegResponse(n);i.log("leg data change="+r),t.timer=window.setTimeout((function(){t.startQuery()}),e)})).catch((function(n){i.log("query leg error"),t.routeErrors++,t.routeErrors>10&&(i.log("lost route"),t.serverConnected=!1),t.timer=window.setTimeout((function(){t.startQuery()}),e)}))):t.timer=window.setTimeout((function(){t.startQuery()}),e),!this.isEditingActiveRoute()){if(!Js.hasRoute())return;if(void 0===this.currentRoutePage)return;this._downloadRoute(Js.getRouteName(),(function(e){if(!t.isEditingActiveRoute()){e.server=!0;var n=e.differsTo(t.lastReceivedRoute);i.log("route data change="+n),n&&(t.lastReceivedRoute=e,Js.modify((function(n){if(n.route&&n.route.name==e.name&&e.differsTo(n.route)){var r=n.route.getPointAtIndex(n.index);return n.route=t.lastReceivedRoute.clone(),n.index=n.route.findBestMatchingIdx(r),n.index<0&&(n.index=0),!0}})))}}),(function(e){}))}},Qs.prototype._saveRouteLocal=function(e,t){if(e){t&&e.time||(e.time=(new Date).getTime()/1e3);var n=e.toJsonString();return Fe.setItem(Me.ROUTE,e.name,n),e}},Qs.prototype._localRouteExists=function(e){return!!e&&!!Fe.getItem(Me.ROUTE,e.name)},Qs.prototype._loadRoute=function(e,t){e.match(/\.gpx$/)&&(e=e.replace(/\.gpx$/,""));var n=new In.Route(e);try{var r=Fe.getItem(Me.ROUTE,e);if(r||e!=this.DEFAULTROUTE||(r=Fe.getItem(this.FALLBACKROUTENAME)),r)return i.log("route "+e+" successfully loaded"),n.fromJsonString(r),this.readOnlyServer&&(n.server=!1),n;if(t)return}catch(e){if(t)return}return n},Qs.prototype._sendRoute=function(e,t,n){e.clone();wt.postPlain("",e.toXml(),{},{request:"upload",type:"route",name:this._ensureGpx(e.name),overwrite:n}).then((function(e){i.log("route sent to server"),t&&t()})).catch((function(e){var n=!0;t&&(n=t(e)),n&&Oe.getData(ve.properties.routingServerError)&&ct("unable to send route to server:"+e)}))},Qs.prototype._legChangedLocally=function(e){this.lastDistanceToCurrent=-1,this.lastDistanceToNext=-1;var t=e.toJsonString();Fe.setItem(Me.ROUTING,void 0,t),e.currentRoute&&this._saveRouteLocal(e.currentRoute,!0);var n=this;if(this.lastReceivedLeg&&e.differsTo(this.lastSentLeg)){if(!avnav.android){var r=e.toJson();if(this.connectMode){if(this.lastSentLeg=e,!Oe.getData(ve.gui.capabilities.uploadRoute))return void i.log("upload leg disabled by capabilities");e.hasRoute()&&this._sendRoute(e.currentRoute,void 0,!0),wt.postJson("?request=route&command=setleg",r).then((function(e){i.log("new leg sent to server")})).catch((function(e){n.lastSentLeg=void 0,Oe.getData(ve.properties.routingServerError)&&ct("unable to send leg to server:"+e)}))}return!0}this.lastSentLeg=e;var o=avnav.android.setLeg(e.toJsonString());if(e.hasRoute()&&this._sendRoute(e.currentRoute,void 0,!0),o)try{if((o=JSON.parse(o)).status&&"OK"===o.status)return}catch(e){}ct("unable to save leg: "+(o&&o.status?o.status:""))}},Qs.prototype.dataChanged=function(){var e=this.connectMode;this.connectMode=Oe.getData(ve.properties.connectedMode),this.readOnlyServer=Oe.getData(ve.properties.readOnlyServer),e!=this.connectMode&&(this.connectMode?this.lastLegSequence=void 0:Xs.anchorWatch()&&this.anchorOff())},Qs.prototype.setCurrentRoutePage=function(e){this.currentRoutePage=e},Qs.prototype.unsetCurrentRoutePage=function(e){this.currentRoutePage===e&&(this.currentRoutePage=void 0)};var $s=Qs;function el(e){return el="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},el(e)}function tl(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,nl(r.key),r)}}function nl(e){var t=function(e,t){if("object"!=el(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=el(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==el(t)?t:t+""}var rl=d.keysToStr({connectionLost:1,AIS:2}),ol=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.timerFunction=this.timerFunction.bind(this),this.startTimer=this.startTimer.bind(this),this.timer=void 0,this.lastSequence=Oe.getData(ve.nav.gps.updatealarm),this.localAlarms={},this.sounds={},this.alarmBlocks={},this.blockId=1},t=[{key:"addBlock",value:function(e){return this.blockId++,this.alarmBlocks[this.blockId]=e,this.blockId}},{key:"removeBlock",value:function(e){delete this.alarmBlocks[e]}},{key:"start",value:function(){var e=this;this.startTimer();var t=function(t){if(e.sounds[t])return 1;var n=e.getAlarmSound({name:t},!0);try{n&&n.src&&fetch(new Request(n.src)).then((function(e){return e.blob()})).then((function(n){return e.sounds[t]=n})).catch((function(e){}))}catch(e){}};for(var n in rl)t(n)}},{key:"compareAlarms",value:function(e,t){if(!e!=!t)return!1;if(!(e instanceof Object&&t instanceof Object))return!1;var n={};for(var r in e){if(!t[r])return!1;if(e[r].name!==t[r].name)return!1;if(e[r].running!==t[r].running)return!1;if(e[r].category!==t[r].category)return!1;n[r]=!0}for(var o in t)if(!n[o])return!1;return!0}},{key:"startTimer",value:function(){this.timer&&window.clearTimeout(this.timer),this.timer=void 0;var e=Oe.getData(ve.properties.positionQueryTimeout);window.setTimeout(this.timerFunction,e)}},{key:"timerFunction",value:function(){var e=this,t=Oe.getData(ve.nav.gps.updatealarm);void 0===this.lastSequence||this.lastSequence!=t?(this.lastSequence=t,wt.getJson("?request=alarm&status=all").then((function(t){e.startTimer();var n=Oe.getData(ve.nav.alarms.all);e.compareAlarms(n,t.data)||Oe.storeData(ve.nav.alarms.all,y()({},t.data,e.localAlarms))})).catch((function(t){e.startTimer(),i.log("alarm query error: "+t)}))):this.startTimer()}},{key:"startLocalAlarm",value:function(e,t){if(rl[e]){for(var n in this.alarmBlocks)if(this.alarmBlocks[n]===e)return;t||(t="info");var r=y()({},Oe.getData(ve.nav.alarms.all)),o={category:t,name:e,isLocal:!0,running:!0,repeat:1};this.localAlarms[e]=o,r[e]=o,Oe.storeData(ve.nav.alarms.all,r)}}},{key:"stopAlarm",value:function(e){var t=y()({},Oe.getData(ve.nav.alarms.all));delete t[e],Oe.storeData(ve.nav.alarms.all,t),rl[e]?delete this.localAlarms[e]:wt.getJson("?request=alarm&stop="+e).then((function(e){})).catch((function(t){i.log("unable to stop alarm "+e)}))}},{key:"getAlarmSound",value:function(e,t){return!t&&this.sounds[e.name]?{src:URL.createObjectURL(this.sounds[e.name]),repeat:e.repeat,enabled:!0}:{src:Oe.getData(ve.properties.navUrl)+"?request=download&type=alarm&name="+encodeURIComponent(e.name),repeat:e.repeat,enabled:!0}}},{key:"sortedActiveAlarms",value:function(e){var t=[];for(var n in e){var r=e[n];r.running&&t.push({name:n,category:r.category,repeat:r.repeat})}return t.sort((function(e,t){return e.category===t.category?0:void 0===e.category&&void 0!==t.category?1:void 0!==e.category&&void 0===t.category||void 0===t.category||"critical"===e.category?-1:"info"===e.category&&"critical"===t.category?1:0})),t}}],t&&tl(e.prototype,t),n&&tl(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}(),il=new ol,al=(S.Ais,function(e){this.navdata=e,this.currentAis=[],this.lastAisQuery=(new Date).getTime(),this.timer=null,this.aisErrors=0,this.trackedAIStarget=null,this.computedNearestMmsi=null,this.computedWarningMmsi=null,this.nearestAisTarget={},Oe.register(this,[ve.nav.gps,ve.nav.routeHandler.useRhumbLine]),this.formatter=W,this.hiddenTargets={},this.lastAisCenter=void 0});al.prototype._computeAisTarget=function(e,t){var n=Oe.getData(ve.nav.routeHandler.useRhumbLine);t.warning=!1,t.tracking=!1,t.nearest=!1;var r=Oe.getMultiple({minAISspeed:ve.properties.minAISspeed}),o=P.computeDistance(e,new S.Point(parseFloat(t.lon||0),parseFloat(t.lat||0)),n),i=P.computeCpa({lon:e.lon,lat:e.lat,course:e.course||0,speed:e.speed||0},{lon:parseFloat(t.lon||0),lat:parseFloat(t.lat||0),course:parseFloat(t.course||0),speed:parseFloat(t.speed||0)},r,n);t.distance=o.dts,t.headingTo=o.course,void 0!==i.tcpa&&void 0!==i.cpa?(t.cpa=i.cpa,t.tcpa=i.tcpa):(t.cpa=0,t.tcpa=0),t.passFront=i.front,t.shipname||(t.shipname="unknown"),t.callsign||(t.callsign="????")},al.prototype.handleAisData=function(){var e=Oe.getMultiple(ve.nav.gps),t=null,n=null,r=[],o=Oe.getData(ve.properties.aisOnlyShowMoving,!1),i=Oe.getData(ve.properties.aisShowA,!0),a=Oe.getData(ve.properties.aisShowB,!0),s=Oe.getData(ve.properties.aisShowOther,!1),l=parseFloat(Oe.getData(ve.properties.aisMinDisplaySpeed,0)),u=1e3*parseFloat(Oe.getData(ve.properties.aisHideTime,30)),c=!1,p=(new Date).getTime();for(var f in this.currentAis){var h=this.currentAis[f];h.receiveTime=p;var m=!o||parseFloat(h.speed)>=l;if(m){var d=Z.format("clazz",h);m="A"===d?i:"B"===d?a:s}if(m){void 0!==h.heading&&511===parseInt(h.heading)&&(h.heading=void 0);var v=this.hiddenTargets[h.mmsi];if(void 0!==v&&(v>p||v+u<p)&&(delete this.hiddenTargets[h.mmsi],v=void 0),void 0!==v&&(h.hidden=!0),r.push(h),e.valid){this._computeAisTarget(e,h);var y=Oe.getData(ve.properties.aisWarningCpa);h.cpa&&h.cpa<y&&h.tcpa&&h.tcpa>=0&&Math.abs(h.tcpa)<Oe.getData(ve.properties.aisWarningTpa)&&(n?h.tcpa>=0?(n.tcpa>h.tcpa||n.tcpa<0)&&(n=h):n.tcpa<0&&n.tcpa<h.tcpa&&(n=h):n=h)}h.mmsi==this.trackedAIStarget&&(c=!0,h.tracking=!0,t=h)}}c||(this.trackedAIStarget=null),r&&(r.sort(this.aisSort),r.length&&(r[0].nearest=!0,this.computedNearestMmsi=r[0].mmsi)),n?(n.warning=!0,this.computedWarningMmsi=n.mmsi,il.localAlarms[rl.AIS]||il.startLocalAlarm(rl.AIS)):(this.computedWarningMmsi=null,il.stopAlarm(rl.AIS)),r.length?this.nearestAisTarget=n||(t||r[0]):(this.nearestAisTarget={},this.computedWarningMmsi=null,this.computedNearestMmsi=null);var g={nearestAisTarget:ve.nav.ais.nearest,currentAis:ve.nav.ais.list,updateCount:ve.nav.ais.updateCount};Oe.storeMultiple({nearestAisTarget:this.nearestAisTarget,currentAis:r,updateCount:Oe.getData(ve.nav.ais.updateCount,0)+1},g)},al.prototype.dataChanged=function(){this.handleAisData()},al.prototype.aisSort=function(e,t){try{return e.distance==t.distance?0:e.distance<t.distance?-1:1}catch(e){return 0}},al.prototype.startQuery=function(){var e=this.navdata.getAisCenter(),t=this,n=parseInt(Oe.getData(ve.properties.aisQueryTimeout));if(e?this.lastAisCenter=e:e=this.lastAisCenter,!e)return window.clearTimeout(this.timer),void(this.timer=window.setTimeout((function(){t.startQuery()}),n));for(var r={request:"ais",distance:this.formatter.formatDecimal(Oe.getData(ve.properties.aisDistance)||10,4,1)},o=0;o<e.length;o++)if(e[o]){var a=0!==o?o+"":"";r["lat"+a]=this.formatter.formatDecimal(e[o].lat,3,5,!1,!0),r["lon"+a]=this.formatter.formatDecimal(e[o].lon,3,5,!1,!0)}wt.getJson(r,{checkOk:!1,timeout:n}).then((function(e){t.aisErrors=0,t.lastAisQuery=(new Date).getTime();var r=[];r=e.class&&"error"==e.class?[]:e,t.currentAis=r;try{t.handleAisData()}catch(e){}window.clearTimeout(t.timer),t.timer=window.setTimeout((function(){t.startQuery()}),n)})).catch((function(e){i.log("query ais error"),t.aisErrors+=1,t.aisErrors>=Oe.getData(ve.properties.maxAisErrors)&&(t.currentAis=[],t.handleAisData()),window.clearTimeout(t.timer),t.timer=window.setTimeout((function(){t.startQuery()}),n)}))},al.prototype.getAisByMmsi=function(e){var t=void 0;if(0!=e&&null!=e||(t=y()({},this.nearestAisTarget)),!t)for(var n in this.currentAis)this.currentAis[n].mmsi===e&&(t=y()({},this.currentAis[n]));if(t)return this.computedNearestMmsi===t.mmsi&&(t.nearest=!0),this.computedWarningMmsi===t.mmsi&&(t.warning=!0),t},al.prototype.getAisPositionByMmsi=function(e){var t=this.getAisByMmsi(e);if(t)return new S.Point(parseFloat(t.lon||0),parseFloat(t.lat||0))},al.prototype.getTrackedTarget=function(){return this.trackedAIStarget},al.prototype.setHidden=function(e){var t=(new Date).getTime();this.hiddenTargets[e]=t,this.handleAisData()},al.prototype.unsetHidden=function(e){void 0!==this.hiddenTargets[e]&&(delete this.hiddenTargets[e],this.handleAisData())},al.prototype.isHidden=function(e){var t=(new Date).getTime(),n=this.hiddenTargets[e];return void 0!==n&&(!(n>t||n+1e3*Oe.getData(ve.properties.aisHideTime,30)<t)||(delete this.hiddenTargets[e],!1))},al.prototype.setTrackedTarget=function(e){this.trackedAIStarget!=e&&(this.trackedAIStarget=e,Oe.storeData(ve.nav.ais.trackedMmsi,e),this.handleAisData())};var sl=al;function ll(e){return ll="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ll(e)}function ul(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,cl(r.key),r)}}function cl(e){var t=function(e,t){if("object"!=ll(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=ll(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ll(t)?t:t+""}var pl=new $n($n.MODES.ACTIVE),fl=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.callback=t},t=[{key:"dataChanged",value:function(e){this.callback(e)}}],t&&ul(e.prototype,t),n&&ul(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}(),hl=function(){var e=this;this.formatter=W,this.gpsdata=new qs,this.trackHandler=new ys,this.routeHandler=new $s,this.aisMode=S.AisCenterMode.GPS,this.speedAverage=new Ds(10),this.mapAverageCog=new Ts(Oe.getData(ve.properties.courseAverageLength)),this.mapAverageHdt=new Ts(Oe.getData(ve.properties.courseAverageLength)),this.mapAverageHdm=new Ts(Oe.getData(ve.properties.courseAverageLength)),Oe.register((function(){e.mapAverageCog.reset(Oe.getData(ve.properties.courseAverageLength)),e.mapAverageHdt.reset(Oe.getData(ve.properties.courseAverageLength)),e.mapAverageHdm.reset(Oe.getData(ve.properties.courseAverageLength))}),[ve.gui.global.propertiesLoaded]);var t=this;this.changeCallback=new fl((function(e){t.computeValues()})),Oe.register(this.changeCallback,de.flattenedKeys(pl.getStoreKeys()).concat(de.flattenedKeys(this.gpsdata.getStoreKeys()),[ve.map.centerPosition,ve.nav.routeHandler.useRhumbLine])),this.storeKeys=qs.getStoreKeys(),this.aisData=new sl(this)};hl.prototype.startQuery=function(){this.gpsdata.startQuery(),this.trackHandler.startQuery(),this.routeHandler.startQuery(),this.aisData.startQuery()},hl.prototype.computeValues=function(){var e=y()({centerCourse:ve.nav.center.course,centerDistance:ve.nav.center.distance,markerCourseRhumbLine:ve.nav.wp.courseRhumbLine,markerCourseGreatCircle:ve.nav.wp.courseGreatCircle,markerCourse:ve.nav.wp.course,markerDistanceRhumbLine:ve.nav.wp.distanceRhumbLine,markerDistanceGreatCircle:ve.nav.wp.distanceGreatCircle,markerDistance:ve.nav.wp.distance,markerEta:ve.nav.wp.eta,markerXte:ve.nav.wp.xte,markerVmg:ve.nav.wp.vmg,markerWp:ve.nav.wp.position,anchorDirection:ve.nav.anchor.direction,anchorDistance:ve.nav.anchor.distance,anchorWatchDistance:ve.nav.anchor.watchDistance,centerMarkerCourse:ve.nav.center.markerCourse,centerMarkerDistance:ve.nav.center.markerDistance,routeName:ve.nav.route.name,routeNumPoints:ve.nav.route.numPoints,routeLen:ve.nav.route.len,routeRemain:ve.nav.route.remain,routeEta:ve.nav.route.eta,routeNextCourse:ve.nav.route.nextCourse,isApproaching:ve.nav.route.isApproaching,wpName:ve.nav.wp.name},ve.nav.display),t=y()({},e);for(var n in t)t[n]=void 0;var r=Oe.getMultiple(this.storeKeys);t.markerWp=pl.getCurrentTarget(),t.routeNextWp=pl.getNextWaypoint();var o=Oe.getData(ve.map.centerPosition,new S.Point(0,0)),i=pl.getCurrentFrom(),a=Oe.getData(ve.nav.routeHandler.useRhumbLine);if(r.valid){if(pl.hasActiveTarget()){var s=P.computeLegInfo(t.markerWp,r,i);y()(t,s)}var l=P.computeDistance(r,o,a);if(t.centerCourse=l.course,t.centerDistance=l.dts,void 0!==pl.anchorWatch()){var u=pl.getCurrentFrom();if(t.anchorWatchDistance=pl.anchorWatch(),u){var c=P.computeLegInfo(u,r);t.anchorDistance=c.markerDistance,t.anchorDirection=c.markerCourse}}}if(t.markerWp){var p=P.computeDistance(t.markerWp,o,a);t.centerMarkerCourse=p.course,t.centerMarkerDistance=p.dts}var f=pl.hasActiveTarget()?pl.getRoute():void 0;if(t.isApproaching=pl.isApproaching(),f){t.routeName=f.name,t.routeNumPoints=f.points.length,t.routeLen=f.computeLength(0,a);var h=f.getIndexFromPoint(t.markerWp);h<0&&(h=0),t.routeRemain=f.computeLength(h,a)+t.markerDistance;var m=r.rtime?r.rtime.getTime():0;if(t.markerVmg&&t.markerVmg>0){m+=t.routeRemain/t.markerVmg*1e3;var d=new Date(Math.round(m));t.routeEta=d}if(r.valid&&t.routeNextWp){var v=P.computeDistance(r,t.routeNextWp);t.routeNextCourse=v.course}}var g=this;t.wpName=t.markerWp?t.markerWp.name:"",t.directionMode="cog",t.isSteady=!1,this.speedAverage.add(r.speed),this.mapAverageCog.add(r.course),this.mapAverageHdt.add(r.headingTrue),this.mapAverageHdm.add(r.headingMag);var b=Oe.getData(ve.properties.boatDirectionMode,"cog");t.boatDirection=r.course;var w=this.mapAverageCog.val(),k=!Oe.getData(ve.properties.courseUpAlwaysCOG);if("hdt"===b&&void 0!==r.headingTrue&&(t.boatDirection=r.headingTrue,t.directionMode=b,k&&(w=this.mapAverageHdt.val())),"hdm"===b&&void 0!==r.headingMag&&(t.boatDirection=r.headingMag,t.directionMode=b,k&&(w=this.mapAverageHdm.val())),Oe.getData(ve.properties.boatSteadyDetect)&&"cog"===t.directionMode){var C=parseFloat(Oe.getData(ve.properties.boatSteadyMax))*P.NM/3600;(void 0===this.speedAverage.val()||this.speedAverage.val()<C)&&(t.isSteady=!0),void 0===t.boatDirection&&(t.isSteady=!0)}var E=Oe.getData(ve.properties.courseAverageTolerance),O=Oe.getData(ve.nav.display.mapDirection,0);if(void 0===w||t.isSteady)O=void 0;else{var D=w-O;if(E>0&&D<E&&D>-E){var T=1-(E-Math.abs(D))/E;w=T<1&&T>=.2?this.mapAverageCog.fract(O,w,T):O}O=w}t.mapDirection=O,window.setTimeout((function(){Oe.storeMultiple(t,e,g.changeCallback)}),0)},hl.prototype.getAisCenter=function(){if(this.aisMode!=S.AisCenterMode.NONE)return this.aisMode==S.AisCenterMode.GPS?Oe.getData(ve.nav.gps.valid)?[Oe.getData(ve.nav.gps.position)]:void 0:Oe.getData(ve.nav.gps.valid)?[Oe.getData(ve.map.centerPosition),Oe.getData(ve.nav.gps.position)]:[Oe.getData(ve.map.centerPosition)]},hl.prototype.setAisCenterMode=function(e){this.aisMode=e},hl.prototype.getRoutingHandler=function(){return this.routeHandler},hl.prototype.getGpsHandler=function(){return this.gpsdata},hl.prototype.resetTrack=function(){return this.trackHandler.resetTrack()},hl.prototype.getCurrentPosition=function(){if(Oe.getData(ve.nav.gps.valid))return Oe.getData(ve.nav.gps.position)},hl.prototype.getAisHandler=function(){return this.aisData};var ml=new hl;n(98621);function dl(e){return dl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dl(e)}function vl(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,yl(r.key),r)}}function yl(e){var t=function(e,t){if("object"!=dl(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=dl(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==dl(t)?t:t+""}function gl(e,t,n){return t=wl(t),function(e,t){if(t&&("object"==dl(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,bl()?Reflect.construct(t,n||[],wl(e).constructor):t.apply(e,n))}function bl(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(bl=function(){return!!e})()}function wl(e){return wl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},wl(e)}function kl(e,t){return kl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},kl(e,t)}function Cl(e){return e.touches&&e.touches.length?{x:e.touches[0].pageX,y:e.touches[0].pageY}:e.changedTouches&&e.changedTouches.length?{x:e.changedTouches[0].pageX,y:e.changedTouches[0].pageY}:{x:e.pageX,y:e.pageY}}var Sl=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=gl(this,t))._handleSwipeStart=e._handleSwipeStart.bind(e),e._handleSwipeMove=e._handleSwipeMove.bind(e),e._handleSwipeEnd=e._handleSwipeEnd.bind(e),e._cancelSwipe=e._cancelSwipe.bind(e),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&kl(e,t)}(t,e),n=t,r=[{key:"componentDidMount",value:function(){this.props.includeMouse&&document.addEventListener("mouseup",this._handleSwipeEnd)}},{key:"componentWillUnmount",value:function(){this.props.includeMouse&&document.removeEventListener("mouseup",this._handleSwipeEnd),this._handleSwipeEnd()}},{key:"_handleSwipeStart",value:function(e){var t=Cl(e),n=t.x,r=t.y;this.touchStart={x:n,y:r};var o=e.target.getBoundingClientRect();this.touchStartXY={x:n-o.left,y:r-o.top},this.touchPosition={deltaX:0,deltaY:0},this.props.onSwipeStart&&this.props.onSwipeStart(this.touchStartXY),e.preventDefault()}},{key:"_handleSwipeMove",value:function(e){if(this.touchStart){var t=Cl(e),n=t.x,r=t.y,o=n-this.touchStart.x,i=r-this.touchStart.y;this.swiping=!0,this.touchPosition={deltaX:o,deltaY:i},this.props.onSwipeMove&&this.props.onSwipeMove({x:o,y:i},this._getAbsolutePosition()),e.preventDefault()}}},{key:"_getAbsolutePosition",value:function(){return{x:this.touchStartXY.x+this.touchPosition.deltaX,y:this.touchStartXY.y+this.touchPosition.deltaY}}},{key:"_handleSwipeEnd",value:function(e){e&&e.preventDefault&&e.preventDefault(),this.touchStart&&this.touchPosition&&(this.swiping&&(this.touchPosition.deltaX<0?this.props.onSwipeLeft&&this.props.onSwipeLeft(1):this.touchPosition.deltaX>0&&this.props.onSwipeRight&&this.props.onSwipeRight(1),this.touchPosition.deltaY<0?this.props.onSwipeUp&&this.props.onSwipeUp(1):this.touchPosition.deltaY>0&&this.props.onSwipeDown&&this.props.onSwipeDown(1)),this.props.onSwipeEnd&&this.props.onSwipeEnd(this._getAbsolutePosition()),this.touchStart=null,this.swiping=!1,this.touchPosition=null)}},{key:"_cancelSwipe",value:function(){}},{key:"render",value:function(){var e={onTouchMove:this._handleSwipeMove,onTouchStart:this._handleSwipeStart,onTouchEnd:this._handleSwipeEnd,onTouchCancel:this._handleSwipeEnd,className:this.props.className,style:this.props.style};return this.props.includeMouse&&(e.onMouseDown=this._handleSwipeStart,e.onMouseMove=this._handleSwipeMove,e.onMouseUp=this._handleSwipeEnd),Ue.createElement("div",e,this.props.children)}}],r&&vl(n.prototype,r),o&&vl(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);Sl.displayName="ReactSwipe",Sl.propTypes={className:Ge().string,style:Ge().object,children:Ge().node,onSwipeUp:Ge().func,onSwipeDown:Ge().func,onSwipeLeft:Ge().func,onSwipeRight:Ge().func,onSwipeStart:Ge().func,onSwipeMove:Ge().func,onSwipeEnd:Ge().func,includeMouse:Ge().bool};var El=Sl;function Ol(e){return Ol="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ol(e)}function Pl(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Dl(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Nl(r.key),r)}}function Tl(e,t,n){return t&&Dl(e.prototype,t),n&&Dl(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Nl(e){var t=function(e,t){if("object"!=Ol(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Ol(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Ol(t)?t:t+""}function Rl(e,t,n){return t=jl(t),function(e,t){if(t&&("object"==Ol(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,xl()?Reflect.construct(t,n||[],jl(e).constructor):t.apply(e,n))}function xl(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(xl=function(){return!!e})()}function jl(e){return jl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},jl(e)}function Al(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ll(e,t)}function Ll(e,t){return Ll=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ll(e,t)}var Il=function(e){return(0,yn.A)(e).toHsv()},Ml=function(e){function t(e){var n;return Pl(this,t),(n=Rl(this,t,[e])).mainRef=n.mainRef.bind(n),n.state={redraw:0},n.main=void 0,n}return Al(t,e),Tl(t,[{key:"mainRef",value:function(e){this.main!==e&&(this.main=e,e&&this.setState({redraw:this.state.redraw+1}))}},{key:"getPointerSize",value:function(){return this.props.pointerSize||3}},{key:"render",value:function(){var e=Il(this.props.value),t=y()({},this.props.style);this.props.height&&(t.height=this.props.height),this.props.width&&(t.width=this.props.width);var n={height:this.getPointerSize()},r=this.getDragPosition(e);return null!=r&&(n.top=r,n.display="block",n.position="absolute"),Ue.createElement("div",{className:"alpha-spectrum",style:t,ref:this.mainRef},Ue.createElement("div",{className:"alpha-gradient"}),Ue.createElement("div",{className:"alpha-drag",style:n},Ue.createElement("div",{className:"hue-inner"})))}},{key:"getDragPosition",value:function(e){if(!this.props.height&&!this.main)return null;var t=this.props.height||this.main.getBoundingClientRect().height,n=this.getPointerSize();return Math.round(e.a*t)-Math.round(n/2)}}])}(Ue.Component),_l=function(e){function t(e){var n;return Pl(this,t),(n=Rl(this,t,[e])).mainRef=n.mainRef.bind(n),n.state={redraw:0},n.main=void 0,n}return Al(t,e),Tl(t,[{key:"mainRef",value:function(e){this.main!==e&&(this.main=e,e&&this.setState({redraw:this.state.redraw+1}))}},{key:"getPointerSize",value:function(){return this.props.pointerSize||3}},{key:"render",value:function(){var e=Il(this.props.value),t=y()({},this.props.style);this.props.height&&(t.height=this.props.height),this.props.width&&(t.width=this.props.width);var n={height:this.getPointerSize()},r=this.getDragPosition(e);return null!=r&&(n.top=r,n.display="block",n.position="absolute"),Ue.createElement("div",{className:"hue-spectrum",style:t,ref:this.mainRef},Ue.createElement("div",{className:"hue-drag",style:n},Ue.createElement("div",{className:"hue-inner"})))}},{key:"getDragPosition",value:function(e){if(!this.props.height&&!this.main)return null;var t=this.props.height||this.main.getBoundingClientRect().height,n=this.getPointerSize();return Math.round(e.h*t/360)-Math.round(n/2)}}])}(Ue.Component),Fl=function(e){function t(e){var n;return Pl(this,t),(n=Rl(this,t,[e])).mainRef=n.mainRef.bind(n),n.state={redraw:0},n.main=void 0,n}return Al(t,e),Tl(t,[{key:"mainRef",value:function(e){this.main!==e&&(this.main=e,e&&this.setState({redraw:this.state.redraw+1}))}},{key:"getPointerSize",value:function(){return this.props.pointerSize||7}},{key:"prepareBackgroundColor",value:function(e){return yn.A.fromRatio({h:e.h%360/360,s:1,v:1}).toRgbString()}},{key:"render",value:function(){var e=Il(this.props.value),t=y()({},this.props.style);this.props.height&&(t.height=this.props.height),this.props.width&&(t.width=this.props.width),t.backgroundColor=this.prepareBackgroundColor(e);var n={height:this.getPointerSize(),width:this.getPointerSize()},r=this.getDragPosition(e);return null!=r&&(n.top=r.top,n.left=r.left,n.display="block",n.position="absolute"),Ue.createElement("div",{className:"saturation-spectrum",style:t,ref:this.mainRef},Ue.createElement("div",{className:"saturation-white"},Ue.createElement("div",{className:"saturation-black"})),Ue.createElement("div",{className:"saturation-drag",style:n},Ue.createElement("div",{className:"saturation-inner"})))}},{key:"getDragPosition",value:function(e){var t=this.props.height,n=this.props.width;if(void 0===t||void 0===n){if(!this.main)return null;var r=this.main.getBoundingClientRect();t=r.height,n=r.width}var o=this.getPointerSize(),i=t-e.v*t,a=e.s*n,s=Math.round(o/2);return{left:a-s,top:i-s}}}])}(Ue.Component),Bl=function(e){function t(e){var n;return Pl(this,t),(n=Rl(this,t,[e])).onHueSwipeStart=n.onHueSwipeStart.bind(n),n.onSatSwipeStart=n.onSatSwipeStart.bind(n),n.onSwipeH=n.onSwipeH.bind(n),n.onSwipeSV=n.onSwipeSV.bind(n),n.onSwipeAlpha=n.onSwipeAlpha.bind(n),n.onHueSwipeMove=n.onHueSwipeMove.bind(n),n.onSatSwipeMove=n.onSatSwipeMove.bind(n),n.onSatSwipeEnd=n.onSatSwipeEnd.bind(n),n.onHueSwipeEnd=n.onHueSwipeEnd.bind(n),n.onAlphaSwipeStart=n.onAlphaSwipeStart.bind(n),n.onAlphaSwipeMove=n.onAlphaSwipeMove.bind(n),n.onAlphaSwipeEnd=n.onAlphaSwipeEnd.bind(n),n.handleChange=n.handleChange.bind(n),n.state={},n}return Al(t,e),Tl(t,[{key:"render",value:function(){var e=y()({},this.props);e.className?e.className+=" colorPicker":e.className="colorPicker";var t=this.props.hueStyle||{};t.marginLeft=this.props.hueMargin;var n=this.props.alphaStyle||{};n.marginLeft=this.props.alphaMargin;var r=e.value?this.toColorValue(this.props.value):null,o={onDrag:this.handleChange,onChange:this.handleChange,onMouseDown:this.handleSaturationMouseDown,height:e.saturationHeight,width:e.saturationWidth},i={height:e.hueHeight||e.saturationHeight,width:e.hueWidth,style:t},a={height:e.alphaHeight||e.saturationHeight,width:e.alphaWidth||e.hueWidth,style:n};return o.value=r,i.value=r,a.value=r,Ue.createElement("div",e,Ue.createElement(El,{className:"inner",onSwipeStart:this.onSatSwipeStart,onSwipeMove:this.onSatSwipeMove,onSwipeEnd:this.onSatSwipeEnd,includeMouse:!0},Ue.createElement(Fl,o)),Ue.createElement(El,{className:"inner",onSwipeStart:this.onHueSwipeStart,onSwipeMove:this.onHueSwipeMove,onSwipeEnd:this.onHueSwipeEnd,includeMouse:!0},Ue.createElement(_l,i)),this.props.showAlpha?Ue.createElement(El,{className:"inner",onSwipeStart:this.onAlphaSwipeStart,onSwipeMove:this.onAlphaSwipeMove,onSwipeEnd:this.onAlphaSwipeEnd,includeMouse:!0},Ue.createElement(Ml,a)):null)}},{key:"onHueSwipeStart",value:function(e){return this.swipe=this.toColorValue(this.props.value),i.log("hue swipe start"),this.onSwipeH(e.y)}},{key:"onSatSwipeStart",value:function(e){return this.swipe=this.toColorValue(this.props.value),i.log("sat swipe start"),this.onSwipeSV(e.x,e.y)}},{key:"onAlphaSwipeStart",value:function(e){return this.swipe=this.toColorValue(this.props.value),i.log("swipe start"),this.onSwipeAlpha(e.y)}},{key:"onSwipeH",value:function(e){if(this.swipe){i.log("swipeH y="+e+", oldh="+this.swipe.h);var t=360*e/(this.props.hueHeight||this.props.saturationHeight),n=y()({},this.swipe);return n.h=t,n.h>359&&(n.h=359),n.h<0&&(n.h=0),i.log("new h="+n.h),this.handleChange(n),!0}}},{key:"onSwipeSV",value:function(e,t){if(this.swipe){i.log("Satswipe "+e+","+t+", olds="+this.swipe.s+",oldv="+this.swipe.v);var n=e/this.props.saturationWidth,r=(this.props.saturationHeight-t)/this.props.saturationHeight,o=y()({},this.swipe);return o.s=n,o.v=r,o.v>1&&(o.v=1),o.v<0&&(o.v=0),o.s>1&&(o.s=1),o.s<0&&(o.s=0),i.log("new s="+o.s+", newv="+o.v),this.handleChange(o),!0}}},{key:"onSwipeAlpha",value:function(e){if(this.swipe){i.log("swipeAlpha y="+e+", olda="+this.swipe.a);var t=e/(this.props.alphaHeight||this.props.saturationHeight),n=y()({},this.swipe);return n.a=t,n.a>1&&(n.a=1),n.a<0&&(n.a=0),i.log("new a="+n.a),this.handleChange(n),!0}}},{key:"onHueSwipeEnd",value:function(e){return i.log("hue swipe end y="+e.y),this.onSwipeH(e.y)}},{key:"onHueSwipeMove",value:function(e,t){return i.log("hue swipe move y="+t.y),this.onSwipeH(t.y)}},{key:"onSatSwipeMove",value:function(e,t){return this.onSwipeSV(t.x,t.y)}},{key:"onSatSwipeEnd",value:function(e){return this.onSwipeSV(e.x,e.y)}},{key:"onAlphaSwipeMove",value:function(e,t){return this.onSwipeAlpha(t.y)}},{key:"onAlphaSwipeEnd",value:function(e){return this.onSwipeAlpha(e.y)}},{key:"toColorValue",value:function(e){return"string"==typeof e?Il(e):e}},{key:"handleChange",value:function(e){var t=function(e){var t=(0,yn.A)(e);return 1==t.getAlpha()?t.toHexString():t.toRgbString()}(e=y()({},e));this.props.onChange&&this.props.onChange(t)}}])}(Ue.Component);Bl.displayName="ColorPicker";var Wl=Bl;function Hl(e){return Hl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hl(e)}function Vl(){return Vl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Vl.apply(null,arguments)}function Kl(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ul(r.key),r)}}function Ul(e){var t=function(e,t){if("object"!=Hl(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Hl(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Hl(t)?t:t+""}function ql(e,t,n){return t=Gl(t),function(e,t){if(t&&("object"==Hl(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,zl()?Reflect.construct(t,n||[],Gl(e).constructor):t.apply(e,n))}function zl(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(zl=function(){return!!e})()}function Gl(e){return Gl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Gl(e)}function Zl(e,t){return Zl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Zl(e,t)}var Xl=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=ql(this,t,[e])).state={value:e.value},n.state.value||(n.state.value="#ffffff"),n.valueChange=n.valueChange.bind(n),n.buttonClick=n.buttonClick.bind(n),n.onColorChange=n.onColorChange.bind(n),n.colorInput=n.colorInput.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Zl(e,t)}(t,e),n=t,(r=[{key:"valueChange",value:function(e){this.setState({value:e.target.value})}},{key:"buttonClick",value:function(e){var t=e.target.name;"ok"==t&&this.props.okCallback&&this.props.okCallback(this.state.value),"unset"==t&&this.props.okCallback&&this.props.okCallback(),"reset"!=t?this.props.closeCallback():this.setState({value:this.props.default})}},{key:"onColorChange",value:function(e,t){this.setState({value:e})}},{key:"colorInput",value:function(e){this.setState({value:e.target.value})}},{key:"render",value:function(){var e={backgroundColor:this.state.value,width:30,height:30},t={saturationWidth:250,saturationHeight:250,hueWidth:30,showAlpha:!0},n=Oe.getData(ve.gui.global.windowDimensions,{}),r=n.height,o=250;return r&&(t.saturationHeight=r<t.saturationHeight+o?r-o:t.saturationHeight),t.saturationHeight<50&&(t.saturationHeight=50),o=70,(r=n.width)&&(t.saturationWidth=r<t.saturationWidth+o?r-o:t.saturationWidth),t.saturationWidth<50&&(t.saturationWidth=50),Ue.createElement("div",{className:"settingsDialog colorDialog inner"},this.props.title?Ue.createElement("h3",null,this.props.title):null,Ue.createElement(Wl,Vl({value:this.state.value,onChange:this.onColorChange},t)),Ue.createElement("div",{className:"colorFrame"},Ue.createElement("div",{style:e,className:"colorValue"}),Ue.createElement("input",{className:"colorName",onChange:this.colorInput,value:this.state.value})),Ue.createElement("div",{className:"dialogButtons"},void 0!==this.props.default?Ue.createElement(Ia,{name:"reset",onClick:this.buttonClick},"Reset"):null,void 0!==this.props.showUnset?Ue.createElement(Ia,{name:"unset",onClick:this.buttonClick},"Unset"):null,Ue.createElement(Ia,{name:"cancel",onClick:this.buttonClick},"Cancel"),Ue.createElement(Ia,{name:"ok",onClick:this.buttonClick},"Ok")))}}])&&Kl(n.prototype,r),o&&Kl(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);Xl.propTypes={closeCallback:Ge().func.isRequired,okCallback:Ge().func,value:Ge().string.isRequired,default:Ge().string,title:Ge().string,showUnset:Ge().bool};var Jl=Xl,Yl=["value"];function Ql(){return Ql=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ql.apply(null,arguments)}function $l(e){return $l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$l(e)}var eu={value:Ge().any,label:Ge().string,className:Ge().string,onChange:Ge().func,dialogRow:Ge().bool},tu=function(e){var t=e.dialogRow?"dialogRow":"";e.className&&(t+=" "+e.className);var n=void 0;return e.minSize&&(n=(e.value||"").length)<e.minSize&&(n=e.minSize),void 0!==n&&e.maxSize&&n>e.maxSize&&(n=e.maxSize),e.checkFunction&&(e.checkFunction(e.value)||(t+=" error")),Ue.createElement("div",{className:t},Ue.createElement("span",{className:"inputLabel"},e.label),Ue.createElement("input",{size:n,type:e.type||"text",value:e.value,onChange:function(t){t.stopPropagation(),e.onChange(t.target.value)}}),e.children)};tu.propTypes=y()({},eu,{type:Ge().string,minSize:Ge().number,maxSize:Ge().number,checkFunction:Ge().func});var nu=function(e){var t="checkBox";e.value&&(t+=" checked");var n=e.dialogRow?"dialogRow":"";e.className&&(n+=" "+e.className);return Ue.createElement("div",{className:n,onClick:function(t){if(e.onClick)return e.onClick(t);e.onChange&&(t.stopPropagation(),e.onChange(!e.value))}},Ue.createElement("span",{className:"inputLabel"},e.label),Ue.createElement("span",{className:t}),e.children)};nu.propTypes=y()({},eu,{onClick:Ge().func});var ru=function(e){var t=e.dialogRow?"dialogRow":"";return e.className&&(t+=" "+e.className),Ue.createElement("div",{className:t},e.label&&Ue.createElement("span",{className:"inputLabel"},e.label),e.itemList.map((function(t){var n="radio";return e.value==t.value&&(n+=" checked"),Ue.createElement("div",{className:"radioInner",onClick:function(n){n.stopPropagation(),e.onChange(t.value)},key:t.label},Ue.createElement("span",{className:"inputLabel"},t.label),Ue.createElement("span",{className:n}))})),e.children)};ru.propTypes=y()({},eu,{itemList:Ge().array});var ou=function(e){var t=e.dialogRow?"dialogRow":"";e.className&&(t+=" "+e.className),e.onClick||(t+=" disabled");var n=e.frameClick?e.onClick:void 0;return Ue.createElement("div",{className:t,onClick:n},Ue.createElement("span",{className:"inputLabel"},e.label),Ue.createElement("div",{className:"input",onClick:n?void 0:e.onClick},e.value),e.children)},iu=function(e){var t=e.onClick,n=e.value,r=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,Yl),o=n;"object"===$l(n)&&(o=n.label,n=n.value);var i=e.list||e.itemList;return e.onChange&&i&&(t=function(){var t,r=function(t){e.onChange(e.changeOnlyValue?(t||{}).value:t)},o=e.resetCallback?e.resetCallback:void 0,a=function(t){var n=$a.createSelectDialog(e.label,t,r,void 0,o);e.showDialogFunction?e.showDialogFunction(n):$a.dialog(n)};"function"==typeof i?t=i(e.value):(t=i.slice()).forEach((function(e){e.value==n&&(e.selected=!0)})),t instanceof Promise?t.then((function(e){return a(e)})).catch((function(e){return ct(e)})):a(t)}),Ue.createElement(ou,Ql({},r,{onClick:t,value:o,frameClick:!0}))};iu.propTypes=y()({},eu,{onChange:Ge().func,list:Ge().any,showDialogFunction:Ge().func,changeOnlyValue:Ge().bool,resetCallback:Ge().func});var au=function(e){var t=e.onClick;if(e.onChange){var n=function(t){e.onChange(t)};t=function(t){t.stopPropagation();var r=function(t){return Ue.createElement(Jl,Ql({},t,{value:e.value,okCallback:n,showUnset:e.showUnset,default:e.default}))};e.showDialogFunction?e.showDialogFunction(r):$a.dialog(r)}}var r=e.style||{backgroundColor:e.value},o=e.dialogRow?"dialogRow":"";return e.className&&(o+=" "+e.className),Ue.createElement("div",{className:o+" colorSelector",onClick:t},Ue.createElement("span",{className:"inputLabel"},e.label),Ue.createElement("div",{className:"colorValue",style:r}),Ue.createElement("div",{className:"input"},e.value),e.children)};function su(e){return su="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},su(e)}function lu(){return lu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},lu.apply(null,arguments)}function uu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,cu(r.key),r)}}function cu(e){var t=function(e,t){if("object"!=su(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=su(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==su(t)?t:t+""}function pu(e,t,n){return t=hu(t),function(e,t){if(t&&("object"==su(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,fu()?Reflect.construct(t,n||[],hu(e).constructor):t.apply(e,n))}function fu(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(fu=function(){return!!e})()}function hu(e){return hu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},hu(e)}function mu(e,t){return mu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},mu(e,t)}au.propTypes=y()({},eu,{onClick:Ge().func,showDialogFunction:Ge().func,style:Ge().object});var du=new $n($n.MODES.ACTIVE,!0),vu=function(e){return new Promise((function(t,n){void 0!==du.anchorWatch()?$a.confirm("Really stop the anchor watch?").then((function(){return t(!0)})).catch((function(e){return n(e)})):e?t(!0):n("inactive")}))},yu=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=pu(this,t,[e]);var r=Oe.getData(ve.properties.anchorWatchDefault);return n.state={radius:r,bearing:0,distance:0,refPoint:void 0},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&mu(e,t)}(t,e),n=t,(r=[{key:"computeRefPoint",value:function(e,t){var n=y()({},e);if(n.refPoint=t?Wi.getCenter():ml.getCurrentPosition(),0!=n.bearing||0!=n.dispatcher){var r=P.computeTarget(n.refPoint,n.bearing,n.distance,Oe.getData(ve.nav.routeHandler.useRhumbLine));n.refPoint=r}return n}},{key:"render",value:function(){var e=this,t=this.props.active?"Update Anchor Watch":"Start Anchor Watch",n=void 0!==this.props.position;return Ue.createElement("div",{className:"AnchorWatchDialog flexInner"},Ue.createElement("h3",{className:"dialogTitle"},t),n&&Ue.createElement(Ue.Fragment,null,Ue.createElement(tu,{dialogRow:!0,type:"number",value:this.state.radius,onChange:function(t){return e.setState({radius:parseFloat(t)})},label:"Radius(m)"}),Ue.createElement(tu,{dialogRow:!0,type:"number",value:this.state.distance,onChange:function(t){return e.setState({distance:parseFloat(t)})},label:"Distance(m)"}),Ue.createElement(tu,{dialogRow:!0,type:"number",value:this.state.bearing,onChange:function(t){return e.setState({bearing:parseFloat(t)})},label:"Bearing(°)"})),!n&&Ue.createElement(ou,{label:"No Position",dialogRow:!0}),Ue.createElement("div",{className:"dialogButtons"},n&&Ue.createElement(Ue.Fragment,null,Ue.createElement(Ia,{name:"boat",onClick:function(){e.props.closeCallback(),e.props.setCallback(e.computeRefPoint(e.state,!1))}},"Boat"),Ue.createElement(Ia,{name:"center",onClick:function(){e.props.closeCallback(),e.props.setCallback(e.computeRefPoint(e.state,!0))}},"Center")),this.props.active&&Ue.createElement(Ia,{name:"stop",onClick:function(){vu().then((function(){e.props.stopCallback(),e.props.closeCallback()})).catch((function(){}))}},"Stop"),Ue.createElement(Ia,{name:"cancel",onClick:function(){return e.props.closeCallback()}},"Cancel")))}}])&&uu(n.prototype,r),o&&uu(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component),gu=function(e){var t=ml.getRoutingHandler(),n=ml.getCurrentPosition(),r=!1;void 0!==du.anchorWatch()&&(r=!0),n||r?$a.dialog((function(e){return Ue.createElement(yu,lu({},e,{active:r,position:n,setCallback:function(e){il.stopAlarm("anchor"),t.anchorOn(e.refPoint,e.radius)},stopCallback:function(){t.anchorOff(),il.stopAlarm("anchor"),il.stopAlarm("gps")}}))})):ct("no gps position")},bu={watchDistance:ve.nav.anchor.watchDistance,connected:ve.properties.connectedMode},wu=function(e){return void 0===e?void 0!==du.anchorWatch():void 0!==e.watchDistance},ku=function(e){return{name:"AnchorWatch",storeKeys:bu,updateFunction:function(t){var n={toggle:wu(t),visible:t.connected};return e&&(n.visible=n.visible&&wu(t)),n},onClick:function(){gu()},editDisable:!0}},Cu=function(e){if(!e.show)return null;var t="iconContainer ";e.className&&(t+=e.className);var n=void 0!==e.watchDistance;return Ue.createElement("div",{className:t},n&&Ue.createElement("span",{className:"anchorWatchIcon",onClick:function(){return gu()}}),!e.connected&&Ue.createElement("span",{className:"disconnectedIcon",onClick:function(){!Oe.getData(ve.gui.global.onAndroid)&&Oe.getData(ve.gui.capabilities.canConnect)&&$a.confirm("End disconnected mode?").then((function(){return Oe.storeData(ve.properties.connectedMode,!0)})).catch((function(){}))}}))};Cu.propTypes={watchDistance:Ge().number,connected:Ge().bool,show:Ge().bool};var Su=ot(Cu,{storeKeys:Cu.storeKeys=Object.assign({},bu,{show:ve.properties.titleIcons})});function Eu(e){var t="header ";return e.className&&(t+=e.className),e.connectionLost&&(t+=" connectionLost"),Ue.createElement("div",{className:t},Ue.createElement("span",null,e.title),Ue.createElement(Su,null))}function Ou(e){return Ou="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ou(e)}function Pu(){return Pu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Pu.apply(null,arguments)}function Du(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Tu(r.key),r)}}function Tu(e){var t=function(e,t){if("object"!=Ou(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Ou(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Ou(t)?t:t+""}function Nu(e,t,n){return t=xu(t),function(e,t){if(t&&("object"==Ou(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Ru()?Reflect.construct(t,n||[],xu(e).constructor):t.apply(e,n))}function Ru(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ru=function(){return!!e})()}function xu(e){return xu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},xu(e)}function ju(e,t){return ju=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ju(e,t)}var Au=function(e){function t(e){var n;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Nu(this,t,[e])).itemSort=n.itemSort.bind(n),n.buttonChanged=n.buttonChanged.bind(n),n.state={showOverflow:!1},n.props.itemList)for(var r in n.props.itemList){var o=n.getStateKey(n.props.itemList[r]);if(o){var i=n.buttonVisible(n.props.itemList[r]);n.state[o]=i}}return n.buttonListRef=n.buttonListRef.bind(n),n.buttonList=void 0,n.buttonListWidth=0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ju(e,t)}(t,e),n=t,r=[{key:"itemSort",value:function(e){if(!this.props.cancelTop)return e;for(var t=[],n=function(n){e.forEach((function(e){(0===n&&"Cancel"===e.name||0!==n&&"Cancel"!==e.name)&&t.push(e)}))},r=0;r<2;r++)n(r);return t}},{key:"getStateKey",value:function(e){if(e&&e.name)return"button-"+e.name}},{key:"buttonChanged",value:function(e){if(e&&e.name){var t=this.buttonVisible(e),n=this.getStateKey(e);if(this.state[n]!==t){var r={};r[n]=t,this.setState(r)}}}},{key:"buttonVisible",value:function(e){return!(void 0!==e.visible&&!e.visible||e.editDisable&&this.props.isEditing||e.editOnly&&!this.props.isEditing)}},{key:"buttonListRef",value:function(e){this.buttonList=e}},{key:"handleListCols",value:function(){if(this.buttonList){var e=this.buttonList.getBoundingClientRect();e.width!==this.buttonListWidth&&(this.props.widthChanged&&this.props.widthChanged(e.width),this.buttonListWidth=e.width)}}},{key:"componentDidMount",value:function(){this.handleListCols()}},{key:"componentDidUpdate",value:function(e,t,n){this.handleListCols()}},{key:"render",value:function(){var e=this,t=this.props.className||"";t+=" buttonContainer ",this.props.hidden&&(t+=" buttonsHidden");var n=this.props.dimensions?this.props.dimensions.height:0,r=[],o=[],i=0;for(var a in this.props.itemList){var s=this.getStateKey(this.props.itemList[a]);s&&(this.props.hidden||void 0!==this.state[s]&&!this.state[s]?o.push(this.props.itemList[a]):(r.push(this.props.itemList[a]),this.props.itemList[a].overflow&&i++))}r=this.itemSort(r);var l=1,u=!1,c=0;if(!this.props.hidden&&n&&this.props.buttonHeight){var p=r.length;if(p*this.props.buttonHeight>n){for(this.props.buttonCols||(p+=1),i>p/2&&(i=Math.floor(p/2));c<i&&(p-c)*this.props.buttonHeight>n;)c++;l=n/(this.props.buttonHeight*(p-c))}l>1&&(l=1)}var f=this.props.buttonSize*l/4,h=[],m=[];if(!this.props.hidden){for(var d=r.length-1;d>=0;d--)r[d].overflow&&c>0?(m.splice(0,0,r[d]),c--,u=!0):h.splice(0,0,r[d]);m.length>0&&!this.props.buttonCols&&h.push({name:"Overflow",toggle:this.state.showOverflow,onClick:function(t){e.setState({showOverflow:!e.state.showOverflow})}})}return u&&(this.state.showOverflow||this.props.buttonCols||(o=o.concat(m))),Ue.createElement("div",{className:"buttonContainerWrap ",ref:this.buttonListRef},!this.props.hidden&&Ue.createElement(Ea,Pu({},this.props,{fontSize:f,className:t+" main",itemList:h,itemClass:ot(ds,{changeCallback:this.buttonChanged})})),u&&(this.state.showOverflow||this.props.buttonCols)?Ue.createElement(Ea,Pu({},this.props,{fontSize:f,className:t+" overflow",itemList:m,itemClass:ot(ds,{changeCallback:this.buttonChanged})})):null,Ue.createElement(Ea,{className:"hidden",itemList:o,itemClass:ot(ds,{changeCallback:this.buttonChanged})}),this.props.hidden&&Ue.createElement("div",{className:"buttonShade "+(this.props.showShade?"shade":""),style:{width:this.props.buttonWidth},onClick:this.props.shadeCallback}))}}],r&&Du(n.prototype,r),o&&Du(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component),Lu=ot(Au,{storeKeys:{maxButtons:ve.properties.maxButtons,buttonHeight:ve.gui.global.computedButtonHeight,buttonWidth:ve.gui.global.computedButtonWidth,buttonSize:ve.properties.style.buttonSize,dimensions:ve.gui.global.windowDimensions,buttonCols:ve.properties.buttonCols,cancelTop:ve.properties.cancelTop,isEditing:ve.gui.global.layoutEditing}});function Iu(e){return Iu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Iu(e)}function Mu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_u(r.key),r)}}function _u(e){var t=function(e,t){if("object"!=Iu(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Iu(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Iu(t)?t:t+""}function Fu(e,t,n){return t=Wu(t),function(e,t){if(t&&("object"==Iu(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Bu()?Reflect.construct(t,n||[],Wu(e).constructor):t.apply(e,n))}function Bu(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Bu=function(){return!!e})()}function Wu(e){return Wu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Wu(e)}function Hu(e,t){return Hu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Hu(e,t)}var Vu=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=Fu(this,t,[e]),It.nameKeyEventHandler(n,"widget"),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Hu(e,t)}(t,e),n=t,(r=[{key:"shouldComponentUpdate",value:function(e,n){return d.compareProperties(this.props,e,t.storeKeys)}},{key:"render",value:function(){var e=this.props.eta?W.formatTime(this.props.eta):"--:--:--",t="widget etaWidget "+this.props.className||0;return Ue.createElement("div",{className:t,onClick:this.props.onClick,style:this.props.style||{}},Ue.createElement("div",{className:"infoLeft"},this.props.caption),Ue.createElement("div",{className:"widgetData markerEta"},e),Ue.createElement("div",{className:"widgetData markerName"},this.props.wpname))}}])&&Mu(n.prototype,r),o&&Mu(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);Vu.propTypes={onClick:Ge().func,className:Ge().string,style:Ge().object,caption:Ge().string,eta:Ge().objectOf(Date),wpname:Ge().string},Vu.storeKeys={eta:ve.nav.wp.eta,wpname:ve.nav.wp.name};var Ku=Vu;function Uu(e){return Uu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Uu(e)}function qu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,zu(r.key),r)}}function zu(e){var t=function(e,t){if("object"!=Uu(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Uu(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Uu(t)?t:t+""}function Gu(e,t,n){return t=Xu(t),function(e,t){if(t&&("object"==Uu(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Zu()?Reflect.construct(t,n||[],Xu(e).constructor):t.apply(e,n))}function Zu(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Zu=function(){return!!e})()}function Xu(e){return Xu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Xu(e)}function Ju(e,t){return Ju=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ju(e,t)}var Yu=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=Gu(this,t,[e]),It.nameKeyEventHandler(n,"widget"),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ju(e,t)}(t,e),n=t,(r=[{key:"shouldComponentUpdate",value:function(e,n){return d.compareProperties(this.props,e,t.storeKeys)}},{key:"render",value:function(){var e="widget timeStatusWidget "+this.props.className||0,t=Oe.getData(this.props.gpsValid?ve.properties.statusOkImage:ve.properties.statusErrorImage),n="----";return void 0!==this.props.time&&(n=W.formatTime(this.props.time)),Ue.createElement("div",{className:e,onClick:this.props.onClick,style:this.props.style||{}},Ue.createElement("div",{className:"infoLeft"},this.props.caption),Ue.createElement("img",{className:"status",src:t}),Ue.createElement("div",{className:"widgetData"},n))}}])&&qu(n.prototype,r),o&&qu(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);Yu.propTypes={onClick:Ge().func,className:Ge().string,time:Ge().objectOf(Date),gpsValid:Ge().bool},Yu.storeKeys={time:ve.nav.gps.rtime,gpsValid:ve.nav.gps.valid};var Qu=Yu;function $u(e){return $u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$u(e)}function ec(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,tc(r.key),r)}}function tc(e){var t=function(e,t){if("object"!=$u(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=$u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==$u(t)?t:t+""}function nc(e,t,n){return t=oc(t),function(e,t){if(t&&("object"==$u(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,rc()?Reflect.construct(t,n||[],oc(e).constructor):t.apply(e,n))}function rc(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(rc=function(){return!!e})()}function oc(e){return oc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},oc(e)}function ic(e,t){return ic=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ic(e,t)}var ac=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=nc(this,t,[e])).click=n.click.bind(n),It.nameKeyEventHandler(n,"widget",n.click),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ic(e,t)}(t,e),n=t,(r=[{key:"shouldComponentUpdate",value:function(e,t){return!f(this.props.current,e.current)}},{key:"componentDidUpdate",value:function(){}},{key:"render",value:function(){var e=this.props.current||{},t="widget aisTargetWidget "+this.props.className||0,n="horizontal"===this.props.mode,r={},o=void 0;e.mmsi&&""!==e.mmsi&&(r.warning=e.warning||!1,r.nearest=e.nearest||!1,r.tracking=e.mmsi===this.props.trackedMmsi,o=vn.getAisColor(r));var i=Z.format("passFront",e);if(void 0!==e.mmsi||"gps"===this.props.mode||this.props.isEditing){var a=y()({},this.props.style,{backgroundColor:o});return Ue.createElement("div",{className:t,style:a,onClick:this.click},Ue.createElement("div",{className:"infoLeft"},"AIS"),Ue.createElement("div",{className:"aisPart"},!n&&Ue.createElement("div",{className:"widgetData"},Ue.createElement("span",{className:"label "},"D"),Ue.createElement("span",{className:"aisData"},Z.format("distance",e)),Ue.createElement("span",{className:"unit"},"nm")),!n&&Ue.createElement("div",{className:"widgetData"},Ue.createElement("span",{className:"label "},"C"),Ue.createElement("span",{className:"aisData"},Z.format("cpa",e)),Ue.createElement("span",{className:"unit"},"nm"))),Ue.createElement("div",{className:"aisPart"},void 0!==e.mmsi&&Ue.createElement("div",{className:"widgetData"},Ue.createElement("span",{className:"label "},"T"),Ue.createElement("span",{className:"aisData"},Z.format("tcpa",e)),Ue.createElement("span",{className:"unit"},"h")),void 0!==e.mmsi&&Ue.createElement("div",{className:"widgetData"},Ue.createElement("span",{className:"aisFront aisData"},i))))}return null}},{key:"click",value:function(e){e.stopPropagation&&e.stopPropagation(),this.props.onClick(y()({},this.props,{mmsi:this.props.current?this.props.current.mmsi:void 0}))}}])&&ec(n.prototype,r),o&&ec(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);ac.storeKeys={current:ve.nav.ais.nearest,isEditing:ve.gui.global.layoutEditing,trackedMmsi:ve.nav.ais.trackedMmsi},ac.propTypes={onClick:Ge().func,className:Ge().string,current:Ge().object,mode:Ge().string};var sc=ac;function lc(e){return lc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lc(e)}function uc(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,cc(r.key),r)}}function cc(e){var t=function(e,t){if("object"!=lc(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=lc(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==lc(t)?t:t+""}function pc(e,t,n){return t=hc(t),function(e,t){if(t&&("object"==lc(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,fc()?Reflect.construct(t,n||[],hc(e).constructor):t.apply(e,n))}function fc(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(fc=function(){return!!e})()}function hc(e){return hc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},hc(e)}function mc(e,t){return mc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},mc(e,t)}var dc=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=pc(this,t,[e]),It.nameKeyEventHandler(n,"widget"),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&mc(e,t)}(t,e),n=t,(r=[{key:"shouldComponentUpdate",value:function(e,n){return d.compareProperties(this.props,e,t.storeKeys)}},{key:"componentDidUpdate",value:function(){}},{key:"render",value:function(){if(!this.props.routeName&&!this.props.isEditing)return null;var e="widget activeRouteWidget "+this.props.className||0;return this.props.isApproaching&&(e+=" approach "),Ue.createElement("div",{className:e,onClick:this.props.onClick,style:this.props.style},Ue.createElement("div",{className:"infoLeft"},"RTE"),Ue.createElement("div",{className:"widgetData"},Ue.createElement("div",{className:"routeName"},this.props.routeName),Ue.createElement("div",null,Ue.createElement("span",{className:"routeRemain"},W.formatDistance(this.props.remain)),Ue.createElement("span",{className:"unit"},"nm")),Ue.createElement("div",{className:"routeEta"},W.formatTime(this.props.eta)),this.props.isApproaching?Ue.createElement("div",{className:"routeNext"},Ue.createElement("span",{className:"routeNextCourse"},W.formatDirection(this.props.nextCourse)),Ue.createElement("span",{className:"unit"},"°")):Ue.createElement("div",null)))}}])&&uc(n.prototype,r),o&&uc(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);dc.propTypes={onClick:Ge().func,className:Ge().string,updateCallback:Ge().func,isAproaching:Ge().bool,routeName:Ge().string,eta:Ge().objectOf(Date),remain:Ge().number,nextCourse:Ge().number},dc.storeKeys={isApproaching:ve.nav.route.isApproaching,routeName:ve.nav.route.name,eta:ve.nav.route.eta,remain:ve.nav.route.remain,nextCourse:ve.nav.route.nextCourse,isEditing:ve.gui.global.layoutEditing};var vc=dc;function yc(e){return yc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yc(e)}function gc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],l=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){u=!0,o=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return bc(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?bc(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function wc(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,kc(r.key),r)}}function kc(e){var t=function(e,t){if("object"!=yc(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=yc(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==yc(t)?t:t+""}function Cc(e,t,n){return t=Ec(t),function(e,t){if(t&&("object"==yc(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Sc()?Reflect.construct(t,n||[],Ec(e).constructor):t.apply(e,n))}function Sc(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Sc=function(){return!!e})()}function Ec(e){return Ec=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ec(e)}function Oc(e,t){return Oc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Oc(e,t)}var Pc=new $n($n.MODES.EDIT),Dc=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=Cc(this,t,[e]),It.nameKeyEventHandler(n,"widget"),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Oc(e,t)}(t,e),n=t,(r=[{key:"shouldComponentUpdate",value:function(e,n){return d.compareProperties(this.props,e,t.storeKeys)}},{key:"render",value:function(){var e=gc(Xn.getRouteIndexFlag(this.props),3),t=e[0],n=(e[1],e[2]),r="widget editRouteWidget "+this.props.className||0;if(n&&(r+=" activeRoute "),!t)return Ue.createElement("div",{className:r,onClick:this.props.onClick,style:this.props.style},Ue.createElement("div",{className:"infoLeft"},"RTE"),Ue.createElement("div",{className:"routeName"},"No Route"));var o=t.name,i=t.points.length,a=t.computeLength(0,this.props.useRhumbLine),s=n?this.props.remain:void 0,l=n?this.props.eta:void 0;return Ue.createElement("div",{className:r,onClick:this.props.onClick,style:this.props.style},Ue.createElement("div",{className:"infoLeft"},"RTE"),Ue.createElement("div",{className:"routeName widgetData"},o),Ue.createElement("div",{className:"widgetData"},Ue.createElement("span",{className:"label"},"PTS:"),Ue.createElement("span",{className:"routeInfo"},W.formatDecimal(i,3))),Ue.createElement("div",{className:"widgetData"},Ue.createElement("span",{className:"label"},"DST:"),Ue.createElement("span",{className:"routeInfo"},W.formatDistance(a))),"horizontal"!==this.props.mode?Ue.createElement("div",{className:"widgetData"},Ue.createElement("span",{className:"label"},"RTG:"),Ue.createElement("span",{className:"routeInfo"},W.formatDistance(s))):null,"horizontal"!==this.props.mode?Ue.createElement("div",{className:"widgetData"},Ue.createElement("span",{className:"label"},"ETA:"),Ue.createElement("span",{className:"routeInfo"},W.formatTime(l))):null)}}])&&wc(n.prototype,r),o&&wc(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);Dc.propTypes={onClick:Ge().func,className:Ge().string,mode:Ge().string,route:Ge().objectOf(In.Route),remain:Ge().number,eta:Ge().objectOf(Date),isApproaching:Ge().bool,isActive:Ge().bool,useRhumbLine:Ge().bool},Dc.storeKeys=Pc.getStoreKeys({remain:ve.nav.route.remain,eta:ve.nav.route.eta,isApproaching:ve.nav.route.isApproaching,useRhumbLine:ve.nav.routeHandler.useRhumbLine});var Tc=Dc;function Nc(e){return Nc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nc(e)}function Rc(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,xc(r.key),r)}}function xc(e){var t=function(e,t){if("object"!=Nc(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Nc(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Nc(t)?t:t+""}function jc(e,t,n){return t=Lc(t),function(e,t){if(t&&("object"==Nc(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Ac()?Reflect.construct(t,n||[],Lc(e).constructor):t.apply(e,n))}function Ac(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ac=function(){return!!e})()}function Lc(e){return Lc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Lc(e)}function Ic(e,t){return Ic=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ic(e,t)}var Mc=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=jc(this,t,[e]),It.nameKeyEventHandler(n,"widget"),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ic(e,t)}(t,e),n=t,(r=[{key:"shouldComponentUpdate",value:function(e,n){return d.compareProperties(this.props,e,t.storeKeys)}},{key:"render",value:function(){var e,t="widget centerDisplayWidget "+this.props.className||0,n="horizontal"==this.props.mode,r=this.props.measurePosition;return r&&(e=P.computeDistance(r,this.props.centerPosition,this.props.measureRhumbLine)),Ue.createElement("div",{className:t,onClick:this.props.onClick,style:this.props.style||{}},Ue.createElement("div",{className:"infoLeft"},"Center"),!n&&Ue.createElement("div",{className:"widgetData"},W.formatLonLats(this.props.centerPosition)),void 0!==r&&Ue.createElement("div",{className:"widgetData"},Ue.createElement("div",{className:"label measure"}),Ue.createElement("div",{className:"value"},Ue.createElement("span",null,W.formatDirection(e.course)),Ue.createElement("span",{className:"unit"},"°")),Ue.createElement("div",{className:"value"},"/"),Ue.createElement("div",{className:"value"},Ue.createElement("span",null,W.formatDistance(e.dts)),Ue.createElement("span",{className:"unit"},"nm"))),Ue.createElement("div",{className:"widgetData"},Ue.createElement("div",{className:"label marker"}),Ue.createElement("div",{className:"value"},Ue.createElement("span",null,W.formatDirection(this.props.markerCourse)),Ue.createElement("span",{className:"unit"},"°")),Ue.createElement("div",{className:"value"},"/"),Ue.createElement("div",{className:"value"},Ue.createElement("span",null,W.formatDistance(this.props.markerDistance)),Ue.createElement("span",{className:"unit"},"nm"))),Ue.createElement("div",{className:"widgetData"},Ue.createElement("div",{className:"label boat"}),Ue.createElement("div",{className:"value"},Ue.createElement("span",null,W.formatDirection(this.props.centerCourse)),Ue.createElement("span",{className:"unit"},"°")),Ue.createElement("div",{className:"value"},"/"),Ue.createElement("div",{className:"value"},Ue.createElement("span",null,W.formatDistance(this.props.centerDistance)),Ue.createElement("span",{className:"unit"},"nm"))))}}])&&Rc(n.prototype,r),o&&Rc(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);Mc.storeKeys={markerCourse:ve.nav.center.markerCourse,markerDistance:ve.nav.center.markerDistance,centerCourse:ve.nav.center.course,centerDistance:ve.nav.center.distance,centerPosition:ve.map.centerPosition,measurePosition:ve.map.measurePosition,measureRhumbLine:ve.properties.measureRhumbLine},Mc.propTypes={onClick:Ge().func,className:Ge().string,markerCourse:Ge().number,markerDistance:Ge().number,centerCourse:Ge().number,centerDistance:Ge().number,centerPosition:Ge().object,measurePosition:Ge().object,measureRhumbLine:Ge().bool};var _c=Mc;function Fc(e){return Fc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fc(e)}function Bc(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Wc(r.key),r)}}function Wc(e){var t=function(e,t){if("object"!=Fc(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Fc(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Fc(t)?t:t+""}function Hc(e,t,n){return t=Kc(t),function(e,t){if(t&&("object"==Fc(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Vc()?Reflect.construct(t,n||[],Kc(e).constructor):t.apply(e,n))}function Vc(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Vc=function(){return!!e})()}function Kc(e){return Kc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Kc(e)}function Uc(e,t){return Uc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Uc(e,t)}var qc=function(e){var t,n,r=e.kind,o="";return"true"!==r&&"apparent"!==r&&"trueAngle"!==r&&"trueDirection"!==r&&(r="auto"),"auto"===r&&(void 0!==e.windAngle&&void 0!==e.windSpeed?(n=e.windAngle,t=e.windSpeed,o="A"):void 0!==e.windAngleTrue?(n=e.windAngleTrue,t=e.windSpeedTrue,o="TA"):(n=e.windDirectionTrue,t=e.windSpeedTrue,o="TD")),"apparent"===r&&(n=e.windAngle,t=e.windSpeed,o="A"),"true"!==r&&"trueAngle"!==r||(n=e.windAngleTrue,t=e.windSpeedTrue,o="TA"),"trueDirection"===r&&(n=e.windDirectionTrue,t=e.windSpeedTrue,o="TD"),{windAngle:n,windSpeed:t,suffix:o}},zc=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=Hc(this,t,[e]),It.nameKeyEventHandler(n,"widget"),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Uc(e,t)}(t,e),n=t,(r=[{key:"shouldComponentUpdate",value:function(e,n){return d.compareProperties(this.props,e,t.storeKeys)}},{key:"render",value:function(){var e=qc(this.props),t={A:{speed:"AWS",angle:"AWA"},TD:{speed:"TWS",angle:"TWD"},TA:{speed:"TWS",angle:"TWA"}},n="widget windWidget "+this.props.className||0,r=this.props.style||{},o="";try{o=parseFloat(e.windSpeed),isNaN(o)?o="---":(this.props.showKnots&&(o=3600*o/P.NM),o=o<10?W.formatDecimal(o,2,1):W.formatDecimal(o,3,0))}catch(e){}return this.props.show360||"TD"===e.suffix||e.windAngle>180&&(e.windAngle-=360),Ue.createElement("div",{className:n,onClick:this.props.onClick,style:r},"horizontal"===this.props.mode?Ue.createElement(Ue.Fragment,null,Ue.createElement("div",{className:"infoLeft"},"W"+e.suffix),Ue.createElement("div",{className:"widgetData"},W.formatDirection(e.windAngle),Ue.createElement("span",{className:"unit"},"°"),"/",o,Ue.createElement("span",{className:"unit"},this.props.showKnots?"kn":"m/s"))):Ue.createElement(Ue.Fragment,null,Ue.createElement("div",{className:"resize"},Ue.createElement("div",{className:"windInner"},Ue.createElement("div",{className:"widgetData"},W.formatDirection(e.windAngle)),Ue.createElement("div",{className:"infoLeft"},t[e.suffix].angle),Ue.createElement("div",{className:"infoRight"},"°")),Ue.createElement("div",{className:"windInner"},Ue.createElement("div",{className:"widgetData"},o),Ue.createElement("div",{className:"infoLeft"},t[e.suffix].speed),Ue.createElement("div",{className:"infoRight"},this.props.showKnots?"kn":"m/s")))))}}])&&Bc(n.prototype,r),o&&Bc(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);zc.propTypes={onClick:Ge().func,className:Ge().string,windAngle:Ge().number,windSpeed:Ge().number,windAngleTrue:Ge().number,windSpeedTrue:Ge().number,enabled:Ge().bool,kind:Ge().string},zc.storeKeys={windAngle:ve.nav.gps.windAngle,windSpeed:ve.nav.gps.windSpeed,windAngleTrue:ve.nav.gps.trueWindAngle,windSpeedTrue:ve.nav.gps.trueWindSpeed,windDirectionTrue:ve.nav.gps.trueWindDirection,visible:ve.properties.showWind,showKnots:ve.properties.windKnots},zc.editableParameters={show360:{type:"BOOLEAN",default:!1},kind:{type:"SELECT",list:["auto","trueAngle","trueDirection","apparent"],default:"auto"}};var Gc=zc;function Zc(e){return Zc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zc(e)}function Xc(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Jc(r.key),r)}}function Jc(e){var t=function(e,t){if("object"!=Zc(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Zc(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Zc(t)?t:t+""}function Yc(e,t,n){return t=$c(t),function(e,t){if(t&&("object"==Zc(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Qc()?Reflect.construct(t,n||[],$c(e).constructor):t.apply(e,n))}function Qc(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Qc=function(){return!!e})()}function $c(e){return $c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},$c(e)}function ep(e,t){return ep=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ep(e,t)}var tp="#000000",np="rgba(252, 11, 11, 0.6)",rp=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Yc(this,t,[e])).canvasRef=n.canvasRef.bind(n),n.drawXte=n.drawXte.bind(n),It.nameKeyEventHandler(n,"widget"),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ep(e,t)}(t,e),n=t,(r=[{key:"shouldComponentUpdate",value:function(e,n){return d.compareProperties(this.props,e,t.storeKeys)}},{key:"render",value:function(){var e="widget xteWidget "+this.props.className||0,t=this.props.style||{};return setTimeout(this.drawXte,0),Ue.createElement("div",{className:e,onClick:this.props.onClick,style:t},Ue.createElement("canvas",{className:"widgetData",ref:this.canvasRef}),Ue.createElement("div",{className:"infoLeft"},"XTE"),Ue.createElement("div",{className:"infoRight"},"nm"))}},{key:"canvasRef",value:function(e){this.canvas=e,setTimeout(self.drawXte,0)}},{key:"drawXte",value:function(){var e=this.canvas;if(e){var t=e.getContext("2d"),n=this.props.xteMax,r=W.formatDecimal(n,1,1),o=e.style.color;o||(o=this.props.nightMode?np:tp);var i=e.getBoundingClientRect(),a=i.width,s=i.height;e.width=a,e.height=s,t.clearRect(0,0,a,s),t.canvas.style.visibility="hidden",t.canvas.offsetHeight,t.canvas.style.visibility="inherit",t.fillStyle=o,t.strokeStyle=o;var l=.9*s,u=.2*s,c=.1*a,p=.9*a,f=.4*s,h=.3*s,m=.6*s,d=.45*s,v=.3*s,y=.03*a;t.font="normal "+Math.ceil(u)+"px Arial",t.textAlign="center",t.fillText(r,c,l),t.fillText(r,p,l),t.fillText("0",.5*a,l),t.lineWidth=3,t.beginPath(),t.moveTo(c,f-.5*h),t.lineTo(c,f+.5*h),t.moveTo(c,f),t.lineTo(p,f),t.moveTo(p,f-.5*h),t.lineTo(p,f+.5*h),t.moveTo(.5*a,f-.5*m),t.lineTo(.5*a,f+.5*m),t.stroke(),t.closePath();var g=this.props.markerXte/P.NM;if(void 0!==g){var b=parseFloat(g)/n;b<-1.1&&(b=-1.1),b>1.1&&(b=1.1),b=b*(p-c)/2+c+(p-c)/2,t.beginPath(),t.moveTo(b,d),t.lineTo(b-y,d+v),t.lineTo(b+y,d+v),t.lineTo(b,d),t.fill(),t.closePath()}}}}])&&Xc(n.prototype,r),o&&Xc(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);rp.propTypes={onClick:Ge().func,className:Ge().string,markerXte:Ge().number,xteMax:Ge().number},rp.storeKeys={markerXte:ve.nav.wp.xte,xteMax:ve.properties.gpsXteMax};var op=rp;function ip(e){return ip="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ip(e)}function ap(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,sp(r.key),r)}}function sp(e){var t=function(e,t){if("object"!=ip(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=ip(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ip(t)?t:t+""}function lp(e,t,n){return t=cp(t),function(e,t){if(t&&("object"==ip(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,up()?Reflect.construct(t,n||[],cp(e).constructor):t.apply(e,n))}function up(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(up=function(){return!!e})()}function cp(e){return cp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},cp(e)}function pp(e,t){return pp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},pp(e,t)}var fp=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),lp(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pp(e,t)}(t,e),n=t,(r=[{key:"render",value:function(){var e="widget "+this.props.classes||0;this.props.className&&(e+=" "+this.props.className);var t=this.props.style||{};return Ue.createElement("div",{className:e,onClick:this.props.onClick,style:t})}}])&&ap(n.prototype,r),o&&ap(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);fp.propTypes={onClick:Ge().func,classes:Ge().string};var hp=fp;function mp(e){return mp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mp(e)}function dp(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,vp(r.key),r)}}function vp(e){var t=function(e,t){if("object"!=mp(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=mp(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==mp(t)?t:t+""}function yp(e,t,n){return t=bp(t),function(e,t){if(t&&("object"==mp(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,gp()?Reflect.construct(t,n||[],bp(e).constructor):t.apply(e,n))}function gp(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(gp=function(){return!!e})()}function bp(e){return bp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},bp(e)}function wp(e,t){return wp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},wp(e,t)}var kp={green:"rgba(5, 128, 30, 0.57)",red:"rgba(255, 20, 7, 0.54)",circle:"#888888",scale:"#666666",pointer:"#000000",text:"#000000"},Cp={green:"rgba(5, 128, 30, 0.57)",red:"rgba(255, 20, 7, 0.54)",circle:"#888888",scale:"#666666",pointer:"rgba(252, 11, 11, 0.6)",text:"rgba(252, 11, 11, 0.6)"},Sp=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=yp(this,t,[e])).canvasRef=n.canvasRef.bind(n),n.drawWind=n.drawWind.bind(n),It.nameKeyEventHandler(n,"widget"),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&wp(e,t)}(t,e),n=t,r=[{key:"shouldComponentUpdate",value:function(e,n){return d.compareProperties(this.props,e,t.storeKeys)}},{key:"getValues",value:function(){return qc(this.props)}},{key:"render",value:function(){var e="widget windGraphics "+this.props.classes||0,t=this.props.style||{};setTimeout(this.drawWind,0);var n=this.getValues(),r="",o=this.props.showKnots;try{r=parseFloat(n.windSpeed),o&&(r=3600*r/P.NM),r=r<10?W.formatDecimal(r,1,2):W.formatDecimal(r,3,0)}catch(e){}return Ue.createElement("div",{className:e,onClick:this.props.onClick,style:t},Ue.createElement("canvas",{className:"widgetData",ref:this.canvasRef}),Ue.createElement("div",{className:"infoLeft"},"Wind"),Ue.createElement("div",{className:"infoRight"},o?"kn":"m/s"),Ue.createElement("div",{className:"windSpeed"},r),Ue.createElement("div",{className:"windReference"},n.suffix))}},{key:"canvasRef",value:function(e){this.canvas=e,setTimeout(this.drawWind,0)}},{key:"drawWind",value:function(){var e=this.getValues(),t=this.props.nightMode?Cp:kp,n=this.canvas;if(n){var r=n.getContext("2d"),o=n.getBoundingClientRect(),i=o.width,a=o.height;n.width=i,n.height=a;var s=200,l=200,u=i/s,c=a/l,p=Math.min(u,c),f=p*l/5,h=(i-s*p)/2,m=(a-l*p)/2;r.translate(h>0?.9*h:0,m>0?m:0),r.scale(p,p);var d=this.props.scaleAngle||50;d=parseFloat(d);var v,y,g=parseFloat(e.windAngle),b=1*g+0;r.beginPath(),r.lineWidth=1,r.arc(100,100,97,0,2*Math.PI),r.stroke(),"A"===e.suffix&&(r.beginPath(),r.strokeStyle=t.red,r.lineWidth=15,v=270-d,y=250,r.arc(100,100,90,2*Math.PI/360*v,2*Math.PI/360*y),r.stroke(),r.beginPath(),r.strokeStyle=t.green,r.lineWidth=15,v=290,y=270+d,r.arc(100,100,90,2*Math.PI/360*v,2*Math.PI/360*y),r.stroke(),r.beginPath(),r.strokeStyle=t.circle,r.lineWidth=15,v=40,y=140,r.arc(100,100,90,2*Math.PI/360*v,2*Math.PI/360*y),r.stroke());for(var w=0;w<12;w++)r.beginPath(),r.strokeStyle=t.scale,r.lineWidth=10,v=30*w-1,y=30*w+1,r.arc(100,100,90,2*Math.PI/360*v,2*Math.PI/360*y),r.stroke();r.translate(100,100),r.font=f+"px Arial",this.props.show360||"TD"===e.suffix||g>180&&(g-=360);var k=W.formatDirection(g).replace(/ /g,"0"),C=-.8;g<0&&(C=-1),r.fillStyle=t.text,r.fillText(k,C*f,.4*f),r.rotate(b*Math.PI/180),r.beginPath(),r.lineWidth=6,r.lineCap="round",r.strokeStyle=t.pointer,r.moveTo(0,-40),r.lineTo(0,-73),r.stroke()}}}],r&&dp(n.prototype,r),o&&dp(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);Sp.propTypes={onClick:Ge().func,classes:Ge().string,windSpeed:Ge().number,windAngle:Ge().number,windAngleTrue:Ge().number,windSpeedTrue:Ge().number,showKnots:Ge().bool,scaleAngle:Ge().number,nightMode:Ge().bool,kind:Ge().string},Sp.storeKeys={windSpeed:ve.nav.gps.windSpeed,windAngle:ve.nav.gps.windAngle,windAngleTrue:ve.nav.gps.trueWindAngle,windDirectionTrue:ve.nav.gps.trueWindDirection,windSpeedTrue:ve.nav.gps.trueWindSpeed,visible:ve.properties.showWind,showKnots:ve.properties.windKnots,scaleAngle:ve.properties.windScaleAngle},Sp.editableParameters={show360:{type:"BOOLEAN",default:!1},kind:{type:"SELECT",list:["auto","trueAngle","trueDirection","apparent"],default:"auto"}};var Ep=Sp,Op=function(e){if(!e.value)return null;var t=(e.value+"").replace(/[^ ].*/,""),n=(e.value+"").replace(/^ */,"");return Ue.createElement(Ue.Fragment,null,Ue.createElement("span",{className:"valuePrefix"},t.replace(/ /g,"0")),Ue.createElement("span",{className:"valueData"},n))};Op.propTypes={value:Ge().string};var Pp=Op;function Dp(e){return Dp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dp(e)}function Tp(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Np(r.key),r)}}function Np(e){var t=function(e,t){if("object"!=Dp(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Dp(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Dp(t)?t:t+""}function Rp(e,t,n){return t=jp(t),function(e,t){if(t&&("object"==Dp(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,xp()?Reflect.construct(t,n||[],jp(e).constructor):t.apply(e,n))}function xp(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(xp=function(){return!!e})()}function jp(e){return jp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},jp(e)}function Ap(e,t){return Ap=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ap(e,t)}var Lp=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=Rp(this,t,[e]),It.nameKeyEventHandler(n,"widget"),n.getProps=n.getProps.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ap(e,t)}(t,e),n=t,(r=[{key:"shouldComponentUpdate",value:function(e,t){return d.compareProperties(this.getProps(this.props),this.getProps(e),{value:1,isAverage:1})}},{key:"getProps",value:function(e){return this.props.translateFunction?this.props.translateFunction(y()({},e)):e}},{key:"render",value:function(){var e,t="widget ",n=this.getProps(this.props);n.isAverage&&(t+=" average"),n.className&&(t+=" "+n.className);var r=n.default||"0";e=void 0!==n.value?this.props.formatter?this.props.formatter(n.value):r+"":!isNaN(r)&&this.props.formatter?this.props.formatter(r):r+"";var o=n.style||{};return Ue.createElement("div",{className:t,onClick:this.props.onClick,style:o},Ue.createElement("div",{className:"resize"},Ue.createElement("div",{className:"widgetData"},Ue.createElement(Pp,{value:e}))),Ue.createElement("div",{className:"infoLeft"},n.caption),void 0!==this.props.unit?Ue.createElement("div",{className:"infoRight"},n.unit):Ue.createElement("div",{className:"infoRight"}))}}])&&Tp(n.prototype,r),o&&Tp(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);Lp.propTypes={name:Ge().string,unit:Ge().string,caption:Ge().string,value:Ge().any,isAverage:Ge().bool,formatter:Ge().func.isRequired,onClick:Ge().func,className:Ge().string,style:Ge().object,default:Ge().string,translateFunction:Ge().func},Lp.editableParameters={caption:!0,unit:!0,formatter:!0,formatterParameters:!0,value:!0};var Ip=Lp;function Mp(e){return Mp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mp(e)}function _p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Fp(r.key),r)}}function Fp(e){var t=function(e,t){if("object"!=Mp(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Mp(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Mp(t)?t:t+""}function Bp(e,t,n){return t=Hp(t),function(e,t){if(t&&("object"==Mp(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Wp()?Reflect.construct(t,n||[],Hp(e).constructor):t.apply(e,n))}function Wp(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Wp=function(){return!!e})()}function Hp(e){return Hp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Hp(e)}function Vp(e,t){return Vp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Vp(e,t)}var Kp=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=Bp(this,t,[e]),It.nameKeyEventHandler(n,"widget"),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Vp(e,t)}(t,e),n=t,(r=[{key:"shouldComponentUpdate",value:function(e,t){return this.props.zoom!=e.zoom||this.props.requiredZoom!=e.requiredZoom}},{key:"render",value:function(){var e="widget zoomWidget ";this.props.className&&(e+=" "+this.props.className);var t=this.props.style||{},n=this.props.default||"--";void 0!==this.props.zoom&&(n=W.formatDecimalOpt(this.props.zoom,2,1));var r=void 0;return this.props.requiredZoom&&this.props.requiredZoom!=this.props.zoom&&(r=W.formatDecimalOpt(this.props.requiredZoom,2,1)),Ue.createElement("div",{className:e,onClick:this.props.onClick,style:t},Ue.createElement("div",{className:"widgetData"},n,void 0!==r?Ue.createElement("div",{className:"rzoom"},"(",r,")"):""),Ue.createElement("div",{className:"infoLeft"},this.props.caption))}}])&&_p(n.prototype,r),o&&_p(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);Kp.propTypes={name:Ge().string,caption:Ge().string,onClick:Ge().func,classes:Ge().string,style:Ge().object,zoom:Ge().number,requiredZoom:Ge().number},Kp.storeKeys={zoom:ve.map.currentZoom,requiredZoom:ve.map.requiredZoom,visible:ve.properties.showZoom};var Up=Kp;function qp(e){return qp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qp(e)}function zp(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Gp(r.key),r)}}function Gp(e){var t=function(e,t){if("object"!=qp(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=qp(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==qp(t)?t:t+""}function Zp(e,t,n){return t=Jp(t),function(e,t){if(t&&("object"==qp(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Xp()?Reflect.construct(t,n||[],Jp(e).constructor):t.apply(e,n))}function Xp(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Xp=function(){return!!e})()}function Jp(e){return Jp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Jp(e)}function Yp(e,t){return Yp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Yp(e,t)}var Qp=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Zp(this,t,[e])).onClick=n.onClick.bind(n);var r=n;return It.keyEventHandler(n,(function(e,t){"stop"==t&&r.props.onClick&&r.props.onClick()}),"alarm",["stop"]),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Yp(e,t)}(t,e),n=t,(r=[{key:"componentDidMount",value:function(){}},{key:"shouldComponentUpdate",value:function(e,t){return!il.compareAlarms(e.alarmInfo,this.props.alarmInfo)}},{key:"render",value:function(){if(this.props.disabled)return null;var e="widget alarmWidget "+this.props.className||0,t=void 0;return this.props.alarmInfo&&il.sortedActiveAlarms(this.props.alarmInfo).forEach((function(e){t?t+=","+e.name:t=e.name})),t?Ue.createElement("div",{className:e,onClick:this.onClick,style:this.props.style},Ue.createElement("div",{className:"infoLeft"},"Alarm"),Ue.createElement("div",null,Ue.createElement("span",{className:"alarmInfo"},t))):this.props.isEditing&&this.props.mode?Ue.createElement("div",{className:e,onClick:this.props.onClick,style:this.props.style},Ue.createElement("div",{className:"infoLeft"},"Alarm")):null}},{key:"onClick",value:function(e){this.props.onClick&&this.props.onClick(e),e.stopPropagation()}}])&&zp(n.prototype,r),o&&zp(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);Qp.propTypes={className:Ge().string,onClick:Ge().func,alarmInfo:Ge().object,isEditing:Ge().bool,style:Ge().object},Qp.storeKeys={alarmInfo:ve.nav.alarms.all,isEditing:ve.gui.global.layoutEditing,disabled:ve.gui.global.preventAlarms};var $p=Qp,ef=function(e){var t;t=e.showLatLon?Ue.createElement("div",{className:"info"},W.formatLonLats(e)):Ue.createElement("div",{className:"info"},W.formatDirection(e.course),"°/",W.formatDistance(e.distance),"nm");var n="routeInfoPoint "+e.className||0;return e.selected&&(n+=" activeEntry"),Ue.createElement("div",{className:n,onClick:function(t){e.onClick&&e.onClick(t)}},Ue.createElement("div",{className:"info"},e.name),Ue.createElement("span",{className:"more"}),t)};ef.propTypes={idx:Ge().number,name:Ge().string,lat:Ge().number,lon:Ge().number,course:Ge().number,distance:Ge().number,className:Ge().string,showLatLon:Ge().bool,onClick:Ge().func,selected:Ge().bool};var tf=ef;function nf(e){return nf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nf(e)}function rf(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],l=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){u=!0,o=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return of(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?of(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function of(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function af(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,sf(r.key),r)}}function sf(e){var t=function(e,t){if("object"!=nf(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=nf(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==nf(t)?t:t+""}function lf(e,t,n){return t=cf(t),function(e,t){if(t&&("object"==nf(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,uf()?Reflect.construct(t,n||[],cf(e).constructor):t.apply(e,n))}function uf(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(uf=function(){return!!e})()}function cf(e){return cf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},cf(e)}function pf(e,t){return pf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},pf(e,t)}function ff(){return ff=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ff.apply(null,arguments)}var hf=new $n($n.MODES.EDIT),mf=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=lf(this,t,[e])).scrollSelected=n.scrollSelected.bind(n),It.nameKeyEventHandler(n,"widget"),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pf(e,t)}(t,e),n=t,r=[{key:"shouldComponentUpdate",value:function(e,n){for(var r in t.propTypes)if("route"!=r&&e[r]!==this.props[r])return!0;return!e.route!=!this.props.route||!!e.route&&e.route.differsTo(this.props.route)}},{key:"scrollSelected",value:function(){if(this.listRef){var e=this.listRef.querySelector(".activeEntry");if(e){var t=It.scrollInContainer(this.listRef,e);if(t<1||t>2)return;e.scrollIntoView(1==t)}}}},{key:"componentDidMount",value:function(){this.scrollSelected()}},{key:"componentDidUpdate",value:function(){this.scrollSelected()}},{key:"render",value:function(){var e=this,t=this,n=rf(Xn.getRouteIndexFlag(this.props),3),r=n[0],o=n[1],i=n[2];if((!r||!r.points||r.points.length<1)&&!this.props.isEditing)return null;var a="widget routePointsWidget "+this.props.className||0;return i&&(a+=" activeRoute "),"horizontal"!=this.props.mode||this.props.isEditing?Ue.createElement(Ea,{style:this.props.style,className:a,itemList:r?r.getRoutePoints(o,this.props.useRhumbLine):[],itemCreator:function(t){return n=e.props.showLatLon,function(e){return Ue.createElement(tf,ff({},e,{showLatLon:n}))};var n},scrollable:!0,onItemClick:function(e,n){t.props.onClick&&t.props.onClick(new In.RoutePoint(e))},onClick:function(e){t.props.isEditing&&t.props.onClick&&t.props.onClick(e)},listRef:function(e){t.listRef=e}}):null}}],r&&af(n.prototype,r),o&&af(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);mf.propTypes={onClick:Ge().func,className:Ge().string,mode:Ge().string,route:Ge().objectOf(In.Route),isActive:Ge().bool,index:Ge().number,showLatLon:Ge().bool,isEditing:Ge().bool,useRhumbLine:Ge().bool},mf.storeKeys=hf.getStoreKeys({showLatLon:ve.properties.routeShowLL,isEditing:ve.gui.global.layoutEditing,useRhumbLine:ve.nav.routeHandler.useRhumbLine});var df=mf;function vf(e){return vf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vf(e)}function yf(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,gf(r.key),r)}}function gf(e){var t=function(e,t){if("object"!=vf(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=vf(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==vf(t)?t:t+""}function bf(e,t,n){return t=kf(t),function(e,t){if(t&&("object"==vf(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,wf()?Reflect.construct(t,n||[],kf(e).constructor):t.apply(e,n))}function wf(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(wf=function(){return!!e})()}function kf(e){return kf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},kf(e)}function Cf(e,t){return Cf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Cf(e,t)}var Sf=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=bf(this,t,[e]),It.nameKeyEventHandler(n,"widget"),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Cf(e,t)}(t,e),n=t,(r=[{key:"shouldComponentUpdate",value:function(e,n){return d.compareProperties(this.props,e,t.storeKeys)}},{key:"render",value:function(){var e="widget dateTimeWidget "+this.props.className||0,t="----";this.props.time&&(t=W.formatTime(this.props.time));var n="----";return this.props.time&&(n=W.formatDate(this.props.time)),Ue.createElement("div",{className:e,onClick:this.props.onClick,style:this.props.style||{}},Ue.createElement("div",{className:"infoLeft"},"Date"),Ue.createElement("div",{className:"resize"},Ue.createElement("div",{className:"widgetData date"},n),Ue.createElement("div",{className:"widgetData time"},t)))}}])&&yf(n.prototype,r),o&&yf(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);Sf.propTypes={onClick:Ge().func,className:Ge().string,time:Ge().objectOf(Date),gpsValid:Ge().bool},Sf.storeKeys={time:ve.nav.gps.rtime,gpsValid:ve.nav.gps.valid};var Ef=Sf,Of=n(87068);function Pf(e){return Pf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pf(e)}function Df(){return Df=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Df.apply(null,arguments)}function Tf(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Nf(r.key),r)}}function Nf(e){var t=function(e,t){if("object"!=Pf(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Pf(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Pf(t)?t:t+""}function Rf(e,t,n){return t=jf(t),function(e,t){if(t&&("object"==Pf(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,xf()?Reflect.construct(t,n||[],jf(e).constructor):t.apply(e,n))}function xf(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(xf=function(){return!!e})()}function jf(e){return jf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},jf(e)}function Af(e,t){return Af=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Af(e,t)}var Lf=function(e,t,n){if(void 0!==e&&void 0!==t&&void 0!==n){var r=[],o=Math.floor((parseFloat(t)-parseFloat(e))/n);o<1&&(o=1);for(var i=Math.round(e);i<=t;i+=o)r.push(i);return r}},If=function(e){var t=e,n=e.nightMode?_f:Mf;t.colorText||(t.colorText=n.text);return void 0!==t.colorText&&["colorTitle","colorUnits","colorNumbers","colorStrokeTicks","colorMajorTicks","colorMinorTicks","colorValueText"].forEach((function(e){void 0===t[e]&&(t[e]=t.colorText)})),void 0===t.colorNeedle&&(t.colorNeedle=n.needle),void 0!==t.colorNeedle&&void 0===t.colorNeedleEnd&&(t.colorNeedleEnd=t.colorNeedle),void 0===t.majorTicks&&(t.majorTicks=Lf(e.minValue,e.maxValue,10)),t},Mf={text:"#000000",needle:"#c71d1d"},_f={text:"rgba(252, 11, 11, 0.6)",needle:"rgba(252, 11, 11, 0.6)"},Ff=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Rf(this,t,[e])).canvasRef=n.canvasRef.bind(n),n.renderCanvas=n.renderCanvas.bind(n),It.nameKeyEventHandler(n,"widget"),n.gauge=void 0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Af(e,t)}(t,e),n=t,r=[{key:"getProps",value:function(){var e=y()({},this.props),t=this.props.translateFunction?If(this.props.translateFunction(e)):If(e);for(var n in t)void 0===t[n]&&delete t[n];return void 0!==e.minValue&&(e.minValue=parseFloat(e.minValue)),void 0!==e.maxValue&&(e.maxValue=parseFloat(e.maxValue)),t}},{key:"render",value:function(){var e=this.getProps(),t=e.nightMode?_f:Mf,n="widget canvasGauge";e.className&&(n+=" "+e.className),e.typeClass&&(n+=" "+e.typeClass);var r=e.style||{},o=e.value;"function"==typeof this.props.formatter&&(o=this.props.formatter(o));var i={color:e.colorText?e.colorText:t.text};return Ue.createElement("div",{className:n,onClick:e.onClick,style:r},Ue.createElement("div",{className:"canvasFrame",ref:"frame"},e.drawValue?Ue.createElement("div",{className:"gaugeValue",ref:"value",style:i},o):null,Ue.createElement("canvas",{className:"widgetData",ref:this.canvasRef})),void 0!==e.caption?Ue.createElement("div",{className:"infoLeft"},e.caption):null,void 0!==e.unit?Ue.createElement("div",{className:"infoRight"},e.unit):null)}},{key:"componentDidUpdate",value:function(){this.renderCanvas()}},{key:"canvasRef",value:function(e){this.canvas=e,setTimeout(this.renderCanvas,0)}},{key:"renderCanvas",value:function(){if(this.canvas){var e=void 0;e=this.refs.frame?this.refs.frame.getBoundingClientRect():this.canvas.getBoundingClientRect();var t=this.getProps();if(void 0!==t.minValue&&void 0!==t.maxValue){var n=void 0===t.makeSquare||t.makeSquare,r=e.width,o=e.height,a=Math.min(e.width,e.height);if(n&&(r=a,o=a),this.refs.value)try{var s=parseFloat(t.valueFontFactor||12),l=parseFloat(window.getComputedStyle(this.refs.value).fontSize);this.refs.value.style.fontSize=l!=a/s?a/s+"px":void 0}catch(e){}var u=t.value;if("function"==typeof t.formatter&&(u=t.formatter(u)),(u=parseFloat(u))<t.minValue&&(u=t.minValue),u>t.maxValue&&(u=t.maxValue),!this.gauge)try{var c=y()({},t,{renderTo:this.canvas,width:r,height:o,value:u});return void(this.gauge=new this.props.gauge(c).draw())}catch(e){i.log("gauge error:"+e)}this.gauge&&(this.gauge.value=u,this.gauge.update(y()({},t,{width:r,height:o,value:u})))}}}}],r&&Tf(n.prototype,r),o&&Tf(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);Ff.propTypes={gauge:Ge().oneOfType([Ge().object,Ge().func]).isRequired,name:Ge().string,unit:Ge().string,caption:Ge().string,onClick:Ge().func,className:Ge().string,typeClass:Ge().string,style:Ge().object,default:Ge().string,value:Ge().number,drawValue:Ge().bool,colorText:Ge().string,formatter:Ge().oneOfType([Ge().string,Ge().func]),formatterParameters:Ge().array,translateFunction:Ge().func,valueFontFactor:Ge().number},Ff.editableParameters={caption:!0,unit:!0,value:!0,formatter:!0,formatterParameters:!0,drawValue:{type:"BOOLEAN",default:!0,description:"Show Value"},valueFontFactor:{type:"NUMBER",default:12},colorPlate:{type:"COLOR"},colorText:{type:"COLOR"},colorNeedle:{type:"COLOR"}};var Bf=function(e){return Ue.createElement(Ff,Df({},e,{gauge:Of.RadialGauge,typeClass:"radial"}))};delete(Bf.propTypes=y()({},Ff.propTypes)).gauge,Bf.editableParameters=y()({},Ff.editableParameters,{valueBox:{type:"BOOLEAN",default:!1,description:"Show the original canvas gauges value box"}});var Wf=function(e){return Ue.createElement(Ff,Df({},e,{gauge:Of.LinearGauge,makeSquare:!1,typeClass:"linear"}))};function Hf(e){return Hf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hf(e)}function Vf(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Kf(r.key),r)}}function Kf(e){var t=function(e,t){if("object"!=Hf(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Hf(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Hf(t)?t:t+""}function Uf(e,t,n){return t=zf(t),function(e,t){if(t&&("object"==Hf(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,qf()?Reflect.construct(t,n||[],zf(e).constructor):t.apply(e,n))}function qf(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(qf=function(){return!!e})()}function zf(e){return zf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},zf(e)}function Gf(e,t){return Gf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Gf(e,t)}delete(Wf.propTypes=y()({},Ff.propTypes)).gauge,Wf.editableParameters=y()({},Ff.editableParameters,{drawValue:!1,valueFontFactor:!1});var Zf=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=Uf(this,t,[e]),It.nameKeyEventHandler(n,"widget"),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Gf(e,t)}(t,e),n=t,(r=[{key:"shouldComponentUpdate",value:function(e,t){return!1}},{key:"render",value:function(){return Ue.createElement("div",{className:"widget undefinedWidget",onClick:this.props.onClick,style:this.props.style},Ue.createElement("div",{className:"resize"},Ue.createElement("div",{className:"widgetData"},this.props.name)),Ue.createElement("div",{className:"infoLeft"},"Undefined Widget"))}}])&&Vf(n.prototype,r),o&&Vf(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);Zf.propTypes={};var Xf=Zf;function Jf(e){return Jf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jf(e)}function Yf(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Qf(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,eh(r.key),r)}}function $f(e,t,n){return t&&Qf(e.prototype,t),n&&Qf(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function eh(e){var t=function(e,t){if("object"!=Jf(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Jf(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Jf(t)?t:t+""}function th(e,t,n){return t=rh(t),function(e,t){if(t&&("object"==Jf(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,nh()?Reflect.construct(t,n||[],rh(e).constructor):t.apply(e,n))}function nh(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(nh=function(){return!!e})()}function rh(e){return rh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},rh(e)}function oh(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ih(e,t)}function ih(e,t){return ih=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ih(e,t)}var ah=function(e,t){return t?parseFloat(e):parseFloat(e)/Math.PI*180},sh=function(e,t){return void 0===e?"???":avnav.api.formatter.formatDecimal(Math.abs(ah(e,t)),4,0)},lh=function(e){function t(e){var n;return Yf(this,t),n=th(this,t,[e]),It.nameKeyEventHandler(n,"widget"),n}return oh(t,e),$f(t,[{key:"render",value:function(){var e=sh(this.props.value,this.props.inDegree),t="0";this.props.value<0&&0!==this.props.value&&(t="⇐"+e),this.props.value>0&&0!==this.props.value&&(t=e+" ⇒");var n="widget SKRollWidget "+this.props.className||0,r="widgetData";return Math.abs(ah(this.props.value,this.props.inDegree))>=this.props.criticalValue&&(r+=" critical"),Ue.createElement("div",{className:n,onClick:this.props.onClick,style:this.props.style||{}},Ue.createElement("div",{className:"infoLeft"},this.props.caption),Ue.createElement("div",{className:"infoRight"},this.props.unit),Ue.createElement("div",{className:r},t))}}])}(Ue.Component);lh.propTypes={onClick:Ge().func,className:Ge().string,style:Ge().object,caption:Ge().string,unit:Ge().string,value:Ge().oneOfType([Ge().string,Ge().number]),criticalValue:Ge().number,inDegree:Ge().bool},lh.editableParameters={formatter:!1,formatterParameters:!1,value:{type:"KEY",default:"nav.gps.signalk.navigation.attitude.roll"},unit:{type:"STRING",default:"°"},inDegree:{type:"BOOLEAN",default:!1,description:"set to true if input is in deg instead of rad"},criticalValue:{type:"NUMBER",default:45},caption:{type:"STRING",default:"Roll"}};var uh=function(e){function t(e){var n;return Yf(this,t),n=th(this,t,[e]),It.nameKeyEventHandler(n,"widget"),n}return oh(t,e),$f(t,[{key:"render",value:function(){var e=sh(this.props.value,this.props.inDegree),t="0";this.props.value<0&&0!==this.props.value&&(t=e+" ⇓"),this.props.value>0&&0!==this.props.value&&(t=e+" ⇑");var n="widget SKPitchWidget "+this.props.className||0,r="widgetData";return Math.abs(ah(this.props.value,this.props.inDegree))>=this.props.criticalValue&&(r+=" critical"),Ue.createElement("div",{className:n,onClick:this.props.onClick,style:this.props.style||{}},Ue.createElement("div",{className:"infoLeft"},this.props.caption),Ue.createElement("div",{className:"infoRight"},this.props.unit),Ue.createElement("div",{className:r},t))}}])}(Ue.Component);uh.propTypes={onClick:Ge().func,className:Ge().string,style:Ge().object,caption:Ge().string,unit:Ge().string,value:Ge().oneOfType([Ge().string,Ge().number]),criticalValue:Ge().number,inDegree:Ge().bool},uh.editableParameters={formatter:!1,formatterParameters:!1,value:{type:"KEY",default:"nav.gps.signalk.navigation.attitude.pitch"},unit:{type:"STRING",default:"°"},inDegree:{type:"BOOLEAN",default:!1,description:"set to true if input is in deg instead of rad"},criticalValue:{type:"NUMBER",default:45},caption:{type:"STRING",default:"Pitch"}};var ch=[{name:"SOG",default:"0.0",unit:"kn",caption:"SOG",storeKeys:{value:ve.nav.gps.speed,isAverage:ve.nav.gps.speedAverageOn},formatter:"formatSpeed"},{name:"COG",default:"---",unit:"°",caption:"COG",storeKeys:{value:ve.nav.gps.course,isAverage:ve.nav.gps.courseAverageOn},formatter:"formatDirection",editableParameters:{formatterParameters:!1}},{name:"HDM",default:"---",unit:"°",caption:"HDM",storeKeys:{value:ve.nav.gps.headingMag},formatter:"formatDirection",editableParameters:{formatterParameters:!1}},{name:"HDT",default:"---",unit:"°",caption:"HDT",storeKeys:{value:ve.nav.gps.headingTrue},formatter:"formatDirection",editableParameters:{formatterParameters:!1}},{name:"Position",default:"-------------",caption:"BOAT",storeKeys:{value:ve.nav.gps.position,isAverage:ve.nav.gps.positionAverageOn},formatter:"formatLonLats"},{name:"TimeStatus",caption:"GPS",wclass:Qu,storeKeys:Qu.storeKeys},{name:"ETA",caption:"ETA",wclass:Ku,storeKeys:Ku.storeKeys},{name:"DST",default:"----",unit:"nm",caption:"DST",storeKeys:{value:ve.nav.wp.distance},formatter:"formatDistance"},{name:"BRG",default:"---",unit:"°",caption:"BRG",storeKeys:{value:ve.nav.wp.course},formatter:"formatDirection",editableParameters:{formatterParameters:!1}},{name:"VMG",default:"0.0",unit:"kn",caption:"VMG",storeKeys:{value:ve.nav.wp.vmg},formatter:"formatSpeed"},{name:"STW",default:"0.0",unit:"kn",caption:"STW",storeKeys:{value:ve.nav.gps.waterSpeed},formatter:"formatSpeed"},{name:"WindAngle",default:"---",unit:"°",caption:"Wind Angle",storeKeys:{windAngle:ve.nav.gps.windAngle,windDirectionTrue:ve.nav.gps.trueWindDirection,windAngleTrue:ve.nav.gps.trueWindAngle},formatter:"formatDirection",editableParameters:{formatterParameters:!1,value:!1,caption:!1,kind:{type:"SELECT",list:["auto","trueAngle","trueDirection","apparent"],default:"auto"}},translateFunction:function(e){var t=qc(e);return y()({},e,{value:t.windAngle,caption:{A:"AWA",TD:"TWD",TA:"TWA"}[t.suffix]})}},{name:"WindSpeed",default:"---",unit:"m/s",caption:"Wind Speed",storeKeys:{windSpeed:ve.nav.gps.windSpeed,windSpeedTrue:ve.nav.gps.trueWindSpeed,showKnots:ve.properties.windKnots},formatter:"formatSpeed",editableParameters:{formatterParameters:!1,value:!1,caption:!1,kind:{type:"SELECT",list:["auto","true","apparent"],default:"auto"}},translateFunction:function(e){var t=qc(e);return y()({},e,{value:t.windSpeed,caption:{A:"AWS",TD:"TWS",TA:"TWS"}[t.suffix],formatterParameters:e.showKnots?"k":"m",unit:e.showKnots?"kn":"m/s"})}},{name:"WaterTemp",default:"---",unit:"°",caption:"Water Temp",storeKeys:{value:ve.nav.gps.waterTemp},formatter:"formatTemperature",formatterParameters:"celsius"},{name:"AnchorBearing",default:"---",unit:"°",caption:"ACHR-BRG",storeKeys:{value:ve.nav.anchor.direction},formatter:"formatDirection",editableParameters:{formatterParameters:!1}},{name:"AnchorDistance",default:"---",unit:"m",caption:"ACHR-DST",storeKeys:{value:ve.nav.anchor.distance},formatter:"formatDistance",formatterParameters:["m"]},{name:"AnchorWatchDistance",default:"---",unit:"m",caption:"ACHR-WATCH",storeKeys:{value:ve.nav.anchor.watchDistance},formatter:"formatDecimal",formatterParameters:[3,1]},{name:"RteDistance",default:" ----- ",unit:"nm",caption:"RTE-Dst",storeKeys:{value:ve.nav.route.remain},formatter:"formatDistance"},{name:"RteEta",default:" --:--:-- ",unit:"h",caption:"RTE-ETA",storeKeys:{value:ve.nav.route.eta},formatter:"formatTime"},{name:"LargeTime",default:"--:--",caption:"Time",storeKeys:{value:ve.nav.gps.rtime,visible:ve.properties.showClock},formatter:"formatClock"},{name:"WpPosition",default:"-------------",caption:"MRK",storeKeys:{value:ve.nav.wp.position},formatter:"formatLonLats"},{name:"Zoom",caption:"Zoom",wclass:Up,storeKeys:Up.storeKeys},{name:"AisTarget",wclass:sc,storeKeys:sc.storeKeys},{name:"ActiveRoute",wclass:vc,storeKeys:vc.storeKeys},{name:"EditRoute",wclass:Tc,storeKeys:Tc.storeKeys},{name:"CenterDisplay",caption:"Center",wclass:_c,storeKeys:_c.storeKeys},{name:"WindDisplay",caption:"Wind",wclass:Gc,storeKeys:Gc.storeKeys},{name:"DepthDisplay",caption:"DPT",unit:"m",storeKeys:{value:ve.nav.gps.depthBelowTransducer,visible:ve.properties.showDepth},formatter:"formatDecimal",formatterParameters:[3,1,!0]},{name:"XteDisplay",wclass:op,storeKeys:op.storeKeys},{name:"WindGraphics",wclass:Ep,storeKeys:Ep.storeKeys},{name:"DateTime",wclass:Ef},{name:"Empty",wclass:hp},{name:"RteCombine",caption:"",children:[{name:"RteDistance"},{name:"RteEta"}],editableParameters:{formatter:!1,unit:!1,formatterParameters:!1,value:!1,caption:!1}},{name:"Alarm",wclass:$p,storeKeys:$p.storeKeys},{name:"RoutePoints",wclass:df,storeKeys:df.storeKeys},{name:"Default"},{name:"RadialGauge",wclass:Bf,editableParameters:{minValue:{type:"NUMBER",default:0},maxValue:{type:"NUMBER",default:100}}},{name:"Undefined",wclass:Xf},{name:"signalKPressureHpa",unit:"hPa",formatter:"skPressure"},{name:"signalKCelsius",unit:"°",formatter:"skTemperature"},{name:"signalKRoll",wclass:lh},{name:"signalKPitch",wclass:uh}],ph=["visible"];var fh=function(e){return function(t){if(void 0!==t.visible&&!t.visible)return null;t.visible;var n=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(t,ph);return Ue.createElement(e,n)}},hh=n(25263),mh=n.n(hh);function dh(e){return dh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dh(e)}function vh(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,yh(r.key),r)}}function yh(e){var t=function(e,t){if("object"!=dh(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=dh(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==dh(t)?t:t+""}function gh(e,t,n){return t=wh(t),function(e,t){if(t&&("object"==dh(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,bh()?Reflect.construct(t,n||[],wh(e).constructor):t.apply(e,n))}function bh(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(bh=function(){return!!e})()}function wh(e){return wh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},wh(e)}function kh(e,t){return kh=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},kh(e,t)}var Ch="onCopy onCut onPaste onCompositionEnd onCompositionStart onCompositionUpdate onKeyDown onKeyPress onKeyUp onFocus onBlur onChange onInput onInvalid onReset onSubmit onError onLoad onClick onContextMenu onDoubleClick onDrag onDragEnd onDragEnter onDragExit onDragLeave onDragOver onDragStart onDrop onMouseDown onMouseEnter onMouseLeave onMouseMove onMouseOut onMouseOver onMouseUp onPointerDown onPointerMove onPointerUp onPointerCancel onGotPointerCapture onLostPointerCapture onPointerEnter onPointerLeave onPointerOver onPointerOut onSelect onTouchCancel onTouchEnd onTouchMove onTouchStart onScroll onWheel onAbort onCanPlay onCanPlayThrough onDurationChange onEmptied onEncrypted onEnded onError onLoadedData onLoadedMetadata onLoadStart onPause onPlay onPlaying onProgress onRateChange onSeeked onSeeking onStalled onSuspend onTimeUpdate onVolumeChange onWaiting onLoad onError onAnimationStart onAnimationEnd onAnimationIteration onTransitionEnd onToggle".split(/  */),Sh={};Ch.forEach((function(e){Sh[e.toLowerCase()]=e}));var Eh=function(e,t,n){if(t&&t.attribs){var r=function(){if(o.match(/^on../)){var n=t.attribs[o];if(!e.eventHandler||!e.eventHandler[n])return i.log("external widget, no event handler for "+n),1;var r,a=Sh[o];r=a||"on"+o.substr(2,1).toUpperCase()+o.substring(3),t.attribs[r]=function(t){t.stopPropagation(),t.preventDefault(),e.eventHandler[n].call(e,t)},delete t.attribs[o]}};for(var o in t.attribs)r()}return(0,hh.convertNodeToElement)(t,n,(function(t,n){Eh(e,t,n)}))},Oh=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=n=gh(this,t,[e]);return n.state={updateCount:1},n.canvasRef=n.canvasRef.bind(n),n.renderCanvas=n.renderCanvas.bind(n),It.nameKeyEventHandler(n,"widget"),n.userData={eventHandler:[],triggerRedraw:function(){r.setState({updateCount:r.state.updateCount+1})}},"function"==typeof n.props.initFunction&&n.props.initFunction.call(n.userData,n.userData,n.props),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&kh(e,t)}(t,e),n=t,r=[{key:"getProps",value:function(){return this.props.translateFunction?this.props.translateFunction(y()({},this.props)):this.props}},{key:"render",value:function(){var e=this,t=this.getProps(),n="widget externalWidget";t.className&&(n+=" "+t.className);var r=t.style||{},o=null;if(this.props.renderHtml){try{o=this.props.renderHtml.apply(this.userData,[t])}catch(e){i.log("External Widget: render error "+e),o="<p>render error </p>"}if(null===o)return null}var a=null!=o?mh()(o,{transform:function(t,n){Eh(e.userData,t,n)}}):null;return Ue.createElement("div",{className:n,onClick:this.props.onClick,style:r},this.props.renderCanvas?Ue.createElement("canvas",{className:"widgetData",ref:this.canvasRef}):null,Ue.createElement("div",{className:"resize"},a),void 0!==t.caption?Ue.createElement("div",{className:"infoLeft"},t.caption):null,void 0!==t.unit?Ue.createElement("div",{className:"infoRight"},t.unit):null)}},{key:"componentDidUpdate",value:function(){this.renderCanvas()}},{key:"componentWillUnmount",value:function(){"function"==typeof this.props.finalizeFunction&&this.props.finalizeFunction.call(this.userData,this.userData,this.getProps())}},{key:"canvasRef",value:function(e){this.canvas=e,setTimeout(this.renderCanvas,0)}},{key:"renderCanvas",value:function(){if(this.canvas)try{this.props.renderCanvas.apply(this.userData,[this.canvas,this.getProps()])}catch(e){i.log("GaugeRadial: canvas render error "+e)}}}],r&&vh(n.prototype,r),o&&vh(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);Oh.propTypes={name:Ge().string,unit:Ge().string,caption:Ge().string,onClick:Ge().func,className:Ge().string,style:Ge().object,default:Ge().string,renderHtml:Ge().func,renderCanvas:Ge().func,initFunction:Ge().func,finalizeFunction:Ge().func,translateFunction:Ge().func},Oh.editableParameters={caption:!0,unit:!0};var Ph=Oh;function Dh(e){return Dh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dh(e)}function Th(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Nh(r.key),r)}}function Nh(e){var t=function(e,t){if("object"!=Dh(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Dh(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Dh(t)?t:t+""}var Rh=function(){function e(t,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.type=n,this.default=void 0,this.list=r,this.displayName=o||t,this.readOnly=!1,this.mandatory=!1,this.description=void 0,this.arrayIndex=void 0}return t=e,(n=[{key:"canEdit",value:function(){return!this.readOnly}},{key:"getTypeForEdit",value:function(e){return this.type}},{key:"getList",value:function(){return"function"==typeof this.list?this.list():this.list||[]}},{key:"setValue",value:function(e,t){if(e||(e={}),void 0===this.arrayIndex)return e[this.name]=t,e;var n=e[this.name];return n||(n=[]),"string"==typeof n&&(n=n.split(",")),n[this.arrayIndex]=t,e[this.name]=n,e}},{key:"setDefault",value:function(e){this.getValue(e),void 0!==this.default&&this.setValue(e,wn()(this.default))}},{key:"getValue",value:function(e){var t=e[this.name];if(void 0===this.arrayIndex)return t;if(void 0===t)return t;var n=t;return"string"==typeof n&&(n=n.split(",")),n[this.arrayIndex]}},{key:"getValueForDisplay",value:function(t,n){var r=this.getValue(t);return null==r&&(r=wn()(this.default)),null==r&&(r=n),null==r?this.type!==e.TYPE.BOOLEAN&&"":this.type===e.TYPE.BOOLEAN&&"string"==typeof r?"true"===r.toLowerCase():r}},{key:"isValid",value:function(e){return!0}},{key:"mandatoryOk",value:function(e){if(!this.mandatory)return!0;var t=this.getValue(e);return null!=t&&""!==t}},{key:"isChanged",value:function(e){return e!==this.default}},{key:"ensureValue",value:function(t){this.type===e.TYPE.NUMBER&&void 0!==t[this.name]&&this.setValue(t,parseFloat(this.getValue(t))),this.type===e.TYPE.BOOLEAN&&void 0!==t[this.name]&&this.setValue(t,!!this.getValue(t))}}])&&Th(t.prototype,n),r&&Th(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}();Rh.TYPE={STRING:1,NUMBER:2,FLOAT:3,SELECT:4,BOOLEAN:5,COLOR:6};var xh=function(e,t,n,r,o){if("string"!=typeof t||void 0!==(t=Rh.TYPE[t])){var i;switch(t){case Rh.TYPE.STRING:case Rh.TYPE.NUMBER:case Rh.TYPE.SELECT:case Rh.TYPE.BOOLEAN:case Rh.TYPE.COLOR:i=new Rh(e,t,n,r)}return i&&void 0!==o&&(i.default=o),i}};function jh(e){return jh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jh(e)}function Ah(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Lh(r.key),r)}}function Lh(e){var t=function(e,t){if("object"!=jh(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=jh(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==jh(t)?t:t+""}function Ih(e,t,n){return t=_h(t),function(e,t){if(t&&("object"==jh(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Mh()?Reflect.construct(t,n||[],_h(e).constructor):t.apply(e,n))}function Mh(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Mh=function(){return!!e})()}function _h(e){return _h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_h(e)}function Fh(e,t){return Fh=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Fh(e,t)}var Bh=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=Ih(this,t,[e]),It.nameKeyEventHandler(n,"widget"),n.drawing=void 0,n.initUserContext(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Fh(e,t)}(t,e),n=t,r=[{key:"initUserContext",value:function(){var e=this,t=this;this.userContext={},this.userContext.lonLatToPixel=function(t,n){if(!e.drawing)return[0,0];var r=e.drawing.pointToMap([t,n]);return e.drawing.pixelToDevice(e.drawing.pointToCssPixel(r))},this.userContext.pixelToLonLat=function(t,n){return e.drawing?(t/=e.drawing.getDevPixelRatio(),n/=e.drawing.getDevPixelRatio(),e.drawing.pointFromMap(e.drawing.cssPixelToCoord([t,n]))):[0,0]},this.userContext.getScale=function(){return e.drawing&&e.drawing.useHdpi?e.drawing.devPixelRatio:1},this.userContext.getRotation=function(){return e.drawing?e.drawing.getRotation():0},this.userContext.getContext=function(){if(e.drawing)return e.drawing.getContext()},this.userContext.getDimensions=function(){if(!e.drawing)return[0,0];var t=e.drawing.getContext().canvas;return[t.width*e.drawing.getDevPixelRatio(),t.height*e.drawing.getDevPixelRatio()]},this.userContext.triggerRender=function(){window.setTimeout((function(){return t.props.triggerRender()}),0)}}},{key:"getProps",value:function(){return this.props.translateFunction?this.props.translateFunction(y()({},this.props)):this.props}},{key:"render",value:function(){return null}},{key:"componentWillUnmount",value:function(){if("function"==typeof this.props.finalizeFunction)try{this.props.finalizeFunction.call(this.userContext,this.userContext,this.getProps())}catch(e){i.log("error in user finalize function for "+this.props.name+": "+e)}this.props.registerMap&&this.props.registerMap()}},{key:"componentDidMount",value:function(){var e=this;if("function"==typeof this.props.initFunction)try{this.props.initFunction.call(this.userContext,this.userContext,this.getProps())}catch(e){i.log("error in user init function for "+this.props.name+": "+e)}this.props.registerMap&&this.props.registerMap((function(t,n){e.drawing=t;try{e.props.renderCanvas.call(e.userContext,t.getContext().canvas,e.getProps())}catch(t){i.log("error in user renderCanvas function for "+e.props.name+": "+t)}e.drawing=void 0}))}}],r&&Ah(n.prototype,r),o&&Ah(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);Bh.propTypes={name:Ge().string,unit:Ge().string,caption:Ge().string,onClick:Ge().func,className:Ge().string,style:Ge().object,default:Ge().string,renderHtml:Ge().func,renderCanvas:Ge().func,initFunction:Ge().func,finalizeFunction:Ge().func,translateFunction:Ge().func,registerMap:Ge().func.isRequired,triggerRender:Ge().func.isRequired},Bh.editableParameters={caption:!1,unit:!1};var Wh=Bh,Hh=["style"];function Vh(){return Vh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Vh.apply(null,arguments)}function Kh(e){return Kh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kh(e)}function Uh(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qh(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Gh(r.key),r)}}function zh(e,t,n){return t&&qh(e.prototype,t),n&&qh(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Gh(e){var t=function(e,t){if("object"!=Kh(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Kh(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Kh(t)?t:t+""}function Zh(e,t,n){return t=Jh(t),function(e,t){if(t&&("object"==Kh(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Xh()?Reflect.construct(t,n||[],Jh(e).constructor):t.apply(e,n))}function Xh(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Xh=function(){return!!e})()}function Jh(e){return Jh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Jh(e)}function Yh(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Qh(e,t)}function Qh(e,t){return Qh=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Qh(e,t)}var $h=function(e,t){var n={};if(!e)return n;e.forEach((function(e){if(e.canEdit()){var r=e.getValue(t);e.setValue(n,r)}}));for(var r in["name","weight"].forEach((function(e){void 0!==t[e]&&(n[e]=t[e])})),n)"function"==typeof n[r]&&delete n[r],void 0===n[r]&&delete n[r];return n},em=function(e){function t(e,n,r,o){var i;return Uh(this,t),(i=Zh(this,t,[e,n,r,o])).list=function(){var e=de.getValueKeys().slice(0);return Oe.getKeysByPrefix("nav.gps",!0).forEach((function(t){e.indexOf(t)>=0||e.push(t)})),e},i}return Yh(t,e),zh(t,[{key:"setValue",value:function(e,t){if(void 0!==t)return e||(e={}),e.storeKeys||(e.storeKeys={}),""===t&&(t=void 0),e.storeKeys[this.name]=t,e}},{key:"getValue",value:function(e){if(e&&e.storeKeys)return e.storeKeys[this.name]}},{key:"getTypeForEdit",value:function(e){return Rh.TYPE.SELECT}},{key:"isChanged",value:function(e){return!f(e,this.default)}}])}(Rh),tm=function(e){function t(e,n,r,o){return Uh(this,t),Zh(this,t,[e,n,r,o])}return Yh(t,e),zh(t,[{key:"setValue",value:function(e,t){return e||(e={}),"string"==typeof t&&(t=t.split(",")),e[this.name]=t,e}},{key:"getValue",value:function(e){var t=e[this.name];if(t)return"string"==typeof t?t.split(","):t}},{key:"getValueForDisplay",value:function(e,t){var n=this.getValue(e);return void 0===n&&wn()(n=this.default),void 0===n&&(n=t),n?n instanceof Array?n.join(","):n:""}},{key:"getTypeForEdit",value:function(e){return Rh.TYPE.STRING}},{key:"isChanged",value:function(e){return!f(e,this.default)}}])}(Rh),nm=function(e){function t(e,n,r,o){var i;return Uh(this,t),(i=Zh(this,t,[e,n,r,o])).parameterDescriptions=void 0,i}return Yh(t,e),zh(t,[{key:"setValue",value:function(e,t){return e||(e={}),"string"==typeof t&&(t=t.split(",")),e[this.name]=t,e}},{key:"getValue",value:function(e){var t=e[this.name];if(t)return"string"==typeof t?t.split(","):t}},{key:"getValueForDisplay",value:function(e,t){var n=this.getValue(e);return void 0===n&&(n=wn()(this.default)),void 0===n&&(n=t),n?n instanceof Array?n.join(","):n:""}},{key:"getTypeForEdit",value:function(e){var t=this,n=Rh.TYPE.STRING,r=this.parameterDescriptions;if(!r&&!(r=sm(e)))return n;n=[];var o=0;return r.forEach((function(e){var r=xh(t.name,e.type,e.list,"fmt:"+e.name);r&&(r.default=e.default,r.arrayIndex=o,n.push(r),o++)})),n}},{key:"isChanged",value:function(e){var t="string"==typeof e?e.split(","):e,n="string"==typeof this.default?this.default.split(","):this.default;return!f(t,n)}}])}(Rh),rm=function(e){function t(e,n,r,o){var i;return Uh(this,t),(i=Zh(this,t,[e,n,r,o])).readOnly=!0,i}return Yh(t,e),zh(t,[{key:"getValue",value:function(e){var t=e[this.name];if(void 0!==t)return"function"==typeof t&&(t=t.name||"function"),t}},{key:"setValue",value:function(e,t){return e||(e={}),e}},{key:"getTypeForEdit",value:function(e){return"STRING"}}])}(Rh),om={KEY:30,DISPLAY:40,ARRAY:50,FORMATTER_PARAM:60},im=function(e,t,n,r){if("string"==typeof t){var o=om[t];if(void 0===o)return xh(e,t,n,r);t=o}switch(t){case om.DISPLAY:return new rm(e,t,n,r);case om.KEY:return new em(e,t,n,r);case om.ARRAY:return new tm(e,t,n,r);case om.FORMATTER_PARAM:return new nm(e,t,n,r)}return xh(e,t,n,r)},am=function(e){return"caption"===e?im("caption",Rh.TYPE.STRING):"unit"===e?im("unit",Rh.TYPE.STRING):"formatterParameters"===e?im("formatterParameters",om.FORMATTER_PARAM,void 0,"formatter parameters"):"value"===e?im("value",om.KEY):"className"===e?im("className",Rh.TYPE.STRING,void 0,"css class"):"formatter"===e?im("formatter",Rh.TYPE.SELECT,(function(){var e=[];for(var t in W)"function"==typeof W[t]&&e.push(t);return e})):void 0},sm=function(e){if(e){var t=e.formatter;return t&&("function"!=typeof t&&(t=W[t]),t&&t.parameters)?t.parameters:void 0}},lm=function(){return zh((function e(){Uh(this,e),this.createWidget=this.createWidget.bind(this),this.formatter=W,this.widgetDefinitions=[];for(var t=0;t<ch.length;t++)this.widgetDefinitions.push(ch[t]);this.getAvailableWidgets=this.getAvailableWidgets.bind(this),this.editableParametersCache={}}),[{key:"findWidget",value:function(e,t){var n=this.findWidgetIndex(e,t);if(!(n<0))return this.widgetDefinitions[n]}},{key:"getEditableWidgetParameters",value:function(e){var t=e;if(void 0===t)return[];"string"!=typeof t&&(t=t.name);var n=this.editableParametersCache[t];if(n)return n;var r=this.findWidget(e);if(!r)return[];var o,a,s=[],l=r.wclass||Ip,u=y()({className:!0},l.editableParameters,r.editableParameters),c=y()({},l.storeKeys,r.storeKeys);for(var p in u){var f=u[p];if(void 0!==f&&!1!==f){var h=am(p);if(h||"object"===Kh(f)){if(h){var m="formatter"===f.name||h.type===om.FORMATTER_PARAM;if(m||"object"===Kh(f)||(m=!0),m||h.type===(o=f.type,a=void 0,void 0!==(a=om[o])?a:Rh.TYPE[o])||(m=!0),m){if("formatter"===(f=h).name&&r.formatter&&(f=im(f.name,om.DISPLAY,void 0,"formatter")),f.type===om.KEY&&c[f.name])continue;if(f.type===om.FORMATTER_PARAM){var d=sm(r);d&&(f.parameterDescriptions=d)}}else h=void 0}if(!h){var v=im(p,f.type,f.list,f.displayName);if(!v){i.log("unknown widget parameter type: "+f.type);continue}v.default=f.default,f=v}var g=f.getValue(r);void 0!==g&&(f.default=g),s.push(f)}else i.log("invalid parameter definition in widget "+r.name+": "+p)}}return this.editableParametersCache[t]=s,s}},{key:"findWidgetIndex",value:function(e,t){if(void 0===e)return-1;var n=e;"string"!=typeof e&&(n=e.name);for(var r=0;r<this.widgetDefinitions.length;r++){var o=this.widgetDefinitions[r];if(void 0!==o.name&&o.name==n||o.caption==n)return r}return t?this.findWidgetIndex("Undefined"):-1}},{key:"createWidget",value:function(e,t){var n=this;if(e.name){var r=this.findWidget(e.name,!0);if(r){var o=this.getEditableWidgetParameters(r),i=e;o&&(i=$h(o,e));var a,s=y()({},r,i,t);if([r,i,t].forEach((function(e){e&&e.storeKeys&&(a||(a={}),y()(a,e.storeKeys))})),a&&(s.storeKeys=a),void 0===s.key&&(s.key=e.name),s.formatter){var l=s.formatter;"string"==typeof s.formatter&&"function"!=typeof(l=this.formatter[s.formatter])&&(l=function(){return"?#?#"}),s.formatter=function(e){var t=s.formatterParameters;return"string"==typeof t&&(t=t.split(",")),l.apply(n.formatter,[e].concat(t||[]))}}return function(e){var r=y()({},e,s);delete r.editableParameters;var o=t||{},i=(o.style,function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(o,Hh));if(s.children){var a=0,l=(s.className||"")+" widget combinedWidget";return Ue.createElement("div",Vh({},r,{className:l}),s.children.map((function(e){var t=n.createWidget(e,i);return a++,Ue.createElement(t,{key:a,onClick:r.onClick})})))}var u=s.wclass||Ip,c=s.storeKeys;return r.className?r.className+=" "+r.name:r.className=r.name,c||(c=u.storeKeys),r.handleVisible&&(u=fh(u),delete r.handleVisible),void 0!==r.nightMode||void 0!==c&&void 0!==c.nightMode||(c=void 0===c?{nightMode:ve.properties.nightMode}:y()({nightMode:ve.properties.nightMode},c)),c&&(u=ot(u,{storeKeys:c})),delete r.storeKeys,Ue.createElement(u,r)}}}}},{key:"getWidget",value:function(e){if(!(e<0||e>=this.widgetDefinitions.length)){var t=y()({},this.widgetDefinitions[e]);return void 0===t.name&&(t.name=t.caption),void 0===t.description&&(t.description=t.name),t}}},{key:"getAvailableWidgets",value:function(e){for(var t=this,n=[],r=function(){var r=t.getWidget(o);if(e instanceof Array&&e.length>0){var i=r.type;!i&&r.wclass&&(i=r.wclass.name);var a=!1,s=!1,l=!1;if(e.forEach((function(e){if(void 0!==e&&!e.match(/^ *$/)){var t=e;0===e.indexOf("!")?(t=t.substr(1))===i&&(s=!0):(l=!0,t===i&&(a=!0))}})),l&&!a)return 0;if(s)return 0}n.push(r)},o=0;o<this.widgetDefinitions.length;o++)r();return n}},{key:"addWidget",value:function(e,t){if(!e)throw new Error("missing parameter definition");if(!e.name)throw new Error("missing parameter name");var n=this.findWidgetIndex(e);if(n>=0){if(!t)throw new Error("widget "+e.name+" already exists");this.widgetDefinitions[n]=e}this.widgetDefinitions.push(e)}},{key:"getWidgetFromTypeName",value:function(e){switch(e){case"radialGauge":return Bf;case"linearGauge":return Wf;case"map":return Wh}}},{key:"registerWidget",value:function(e,t){var n=["onClick","wclass","editableParameters"],r=["name"].concat(n);n.forEach((function(t){if(e[t])throw new Error("you cannot set the reserved parameter "+t)})),e.storeKeys&&r.forEach((function(t){if(e.storeKeys[t])throw new Error("you cannot set the reserved parameter "+t+" as a storeKey")}));var o=y()({},e);if(o.type&&(o.wclass=this.getWidgetFromTypeName(o.type),!o.wclass))throw new Error("invalid widget type: "+o.type);if(!o.wclass)if(o.renderHtml||o.renderCanvas){if(o.renderHtml&&"function"!=typeof o.renderHtml)throw new Error("renderHtml must be a function");if(o.renderCanvas&&"function"!=typeof o.renderCanvas)throw new Error("renderCanvas must be a function");o.wclass=Ph}else if(!o.formatter)throw new Error("formatter must be set for the default widget");t&&(o.editableParameters=t),this.addWidget(o)}}])}();lm.prototype.filterListByName=function(e,t){var n=[];return e.forEach((function(e){e.name&&!1!==t[e.name]&&n.push(e)})),n},lm.prototype.loadGaugeDefinitions=function(e,t,n){var r=this;[e+".json","/user/viewer/"+e+".json"].forEach((function(e){wt.getJson(e,{useNavUrl:!1,checkOk:!1}).then((function(e){for(var o in e){var a=e[o];a.name=t+"."+o,a.wclass=n;var s=r.findWidget(a);if(s&&s.wclass!==a.wclass)return void i.log("ignoring widget "+a.name+": already exists with different class");r.addWidget(a,!0)}})).catch((function(t){i.log("unable to read widget list "+e+": "+t)}))}))},lm.prototype.loadAllGaugeDefinitions=function(){var e=this;[{name:"radialGauges",prefix:"radGauge",wclass:Bf}].forEach((function(t){e.loadGaugeDefinitions(t.name,t.prefix,t.wclass)}))},lm.prototype.registerFormatter=function(e,t){if(!e)throw new Error("registerFormatter: missing parameter name");if(!t||"function"!=typeof t)throw new Error("registerFormatter("+e+"): missing or invalid formatterFunction");if(W[e])throw new Error("registerFormatter("+e+"): formatter already exists");W[e]=t};var um=new lm;function cm(e){return cm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cm(e)}function pm(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,fm(r.key),r)}}function fm(e){var t=function(e,t){if("object"!=cm(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=cm(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==cm(t)?t:t+""}function hm(e,t,n){return t=dm(t),function(e,t){if(t&&("object"==cm(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,mm()?Reflect.construct(t,n||[],dm(e).constructor):t.apply(e,n))}function mm(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(mm=function(){return!!e})()}function dm(e){return dm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},dm(e)}function vm(e,t){return vm=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},vm(e,t)}var ym=function(){var e=Oe.getData(ve.nav.alarms.all,"");if(e)for(var t in e)e[t].running&&il.stopAlarm(t)},gm=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=hm(this,t,[e])).alarmWidget=um.createWidget({name:"Alarm"}),n.userEvent=n.userEvent.bind(n),n.timerCallback=n.timerCallback.bind(n),n.timer=It.lifecycleTimer(n,n.timerCallback,1e3,!0),n.lastUserAction=(new Date).getTime(),n.state={hideButtons:!1,connectionLost:Oe.getData(ve.nav.gps.connectionLost)},It.storeHelper(n,(function(e){n.setState(e)}),{connectionLost:ve.nav.gps.connectionLost}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&vm(e,t)}(t,e),n=t,(r=[{key:"timerCallback",value:function(e){if(void 0!==this.props.autoHideButtons){var t=(new Date).getTime();Oe.getData(ve.gui.global.hasActiveInputs)&&(this.lastUserAction=t),this.state.hideButtons||this.lastUserAction<t-this.props.autoHideButtons&&(this.setState({hideButtons:!0}),this.props.buttonWidthChanged&&this.props.buttonWidthChanged())}this.timer.startTimer(e)}},{key:"userEvent",value:function(e){var t=this;this.lastUserAction=(new Date).getTime(),this.state.hideButtons&&"click"===e.type&&window.setTimeout((function(){t.setState({hideButtons:!1}),t.props.buttonWidthChanged&&t.props.buttonWidthChanged()}),1)}},{key:"render",value:function(){var e=this.props,t="page",n=this.state.hideButtons&&e.autoHideButtons;n&&(t+=" hiddenButtons"),e.isEditing&&(t+=" editing"),e.className&&(t+=" "+e.className);var r=this.alarmWidget;return Ue.createElement("div",{className:t,id:e.id,style:e.style,onClick:this.userEvent,onTouchMove:this.userEvent,onTouchStart:this.userEvent,onMouseMove:this.userEvent,onWheel:this.userEvent},e.floatContent&&e.floatContent,Ue.createElement("div",{className:"leftPart"},e.title?Ue.createElement(Eu,{title:e.title,connectionLost:this.state.connectionLost}):null,e.mainContent?e.mainContent:null,e.bottomContent?e.bottomContent:null,Ue.createElement(r,{onClick:ym})),Ue.createElement(Lu,{itemList:e.buttonList,widthChanged:e.buttonWidthChanged,hidden:n,shadeCallback:this.userEvent,showShade:Oe.getData(ve.properties.showButtonShade)}))}},{key:"componentDidMount",value:function(){rn.setPage(this.props.id)}},{key:"componentWillUnmount",value:function(){pt()}}])&&pm(n.prototype,r),o&&pm(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);gm.pageProperties={className:Ge().string,style:Ge().object,options:Ge().object,location:Ge().string.isRequired,history:Ge().object.isRequired,small:Ge().bool.isRequired},gm.propTypes=y()({},gm.pageProperties,{id:Ge().string.isRequired,title:Ge().string,mainContent:Ge().any,floatContent:Ge().any,bottomContent:Ge().any,buttonList:Ge().any,style:Ge().object,isEditing:Ge().bool,buttonWidthChanged:Ge().func,autoHideButtons:Ge().any});var bm=gm,wm=n.p+"images/Chart60.png";function km(e){return km="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},km(e)}function Cm(){return Cm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Cm.apply(null,arguments)}function Sm(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Em(r.key),r)}}function Em(e){var t=function(e,t){if("object"!=km(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=km(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==km(t)?t:t+""}function Om(e,t,n){return t=Dm(t),function(e,t){if(t&&("object"==km(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Pm()?Reflect.construct(t,n||[],Dm(e).constructor):t.apply(e,n))}function Pm(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Pm=function(){return!!e})()}function Dm(e){return Dm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Dm(e)}function Tm(e,t){return Tm=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Tm(e,t)}var Nm=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Om(this,t,[e])).buttonFunction=n.buttonFunction.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Tm(e,t)}(t,e),n=t,(r=[{key:"buttonFunction",value:function(e){switch(e){case 1:pn.activateLayout(!0),this.props.finishCallback&&this.props.finishCallback(!0);break;case 2:pn.loadStoredLayout(),this.props.finishCallback&&this.props.finishCallback(!0)}this.props.closeCallback&&this.props.closeCallback()}},{key:"render",value:function(){var e=this;return Ue.createElement("div",null,Ue.createElement("h3",{className:"dialogTitle"},"Save Layout Changes?"),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"delete",onClick:function(){return e.buttonFunction(2)}},"Discard Changes"),Ue.createElement(Ia,{name:"cancel",onClick:function(){return e.buttonFunction(3)}},"Cancel"),Ue.createElement(Ia,{name:"ok",onClick:function(){return e.buttonFunction(1)}},"Ok")))}}])&&Sm(n.prototype,r),o&&Sm(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);Nm.propTypes={closeCallback:Ge().func.isRequired,finishCallback:Ge().func},Nm.createDialog=function(){return new Promise((function(e,t){pn.isEditing()||t("not editing"),$a.dialog((function(t){return Ue.createElement(Nm,Cm({},t,{finishCallback:function(){e(!0)}}))}),void 0,(function(){return t("cancelled")}))}))},Nm.getButtonDef=function(e){return{name:"LayoutFinished",editOnly:!0,onClick:function(){Nm.createDialog().then((function(t){e&&e(t)})).catch((function(e){}))},toggle:!0}};var Rm=Nm,xm=new $n($n.MODES.ACTIVE,!0),jm=function(e,t){var n=ml.getRoutingHandler(),r=Xn.targetName(xm.getRawData())===S.WayPoint.MOB;if(e){if(r)return;if(!Oe.getData(ve.nav.gps.valid))return;if(!Oe.getData(ve.properties.connectedMode))return;pn.isEditing()&&pn.loadStoredLayout();var o=S.WayPoint.fromPlain(Oe.getData(ve.nav.gps.position));if(o.name=S.WayPoint.MOB,n.wpOn(o,!1),Wi.setGpsLock(!0),Wi.getCurrentChartEntry()){var i=Wi.getZoom(),a=Oe.getData(ve.properties.mobMinZoom)-i.required;a<0&&(a=0),Wi.changeZoom(a,!0),t.reset(),t.push("navpage")}else t.reset(),t.push("gpspage")}else{if(!r)return;n.routeOff()}},Am=function(e){var t=Xn.targetName(xm.getRawData())===S.WayPoint.MOB;jm(!t,e)},Lm=function(e){return{name:"MOB",storeKeys:xm.getStoreKeys({visible:ve.properties.connectedMode,hasGps:ve.nav.gps.valid}),updateFunction:function(e){var t=Xn.targetName(e)===S.WayPoint.MOB;return{toggle:t,visible:t||e.visible&&e.hasGps}},onClick:function(){Am(e)},editDisable:!0}},Im=jm,Mm=Am,_m=function(e,t){return new Promise((function(n,r){Oe.getData(ve.gui.capabilities.addons)||n([]);var o={type:"addon"};t&&(o.invalid=!0),wt.getJson("?request=list",{},o).then((function(e){var t=[];for(var r in e.items){var o=e.items[r];o.key||(o.key=o.name),o.name&&t.push(o)}n(t)}),(function(t){e&&ct("reading addons failed: "+t),r(t+"")}))}))},Fm=function(e,t){if(e&&e instanceof Array&&t)for(var n in e){var r=e[n];if(r.url==t)return r}},Bm=function(e,t,n,r,o){return wt.getJson("?request=api&type=addon&command=update",{},{url:t,title:r,icon:n,name:e,newWindow:o})},Wm=function(e){return wt.getJson("?request=api&type=addon&command=delete",{},{name:e})};function Hm(e){return Hm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hm(e)}var Vm=function e(t,n){if(t instanceof Promise)return new Promise((function(r,o){t.then((function(t){return r(e(t,n))})).catch((function(e){return o(e)}))}));var r=0,o=[];return t.forEach((function(e){var t=void 0;(t="object"===Hm(e)?y()({},e):{name:e}).key=r,t.label||(t.label=t.name),r++,o.push(t)})),o.sort((function(e,t){if(!e||!e.name)return-1;if(!t||!t.name)return 1;var n="string"==typeof e.name?e.name.toUpperCase():e,r="string"==typeof t.name?t.name.toUpperCase():t;return n<r?-1:n>r?1:0})),o},Km=function e(t){var n=t.param,r=void 0,o=n.getValueForDisplay(t.currentValues),i=t.className?" "+t.className:"",a=function(e){t.onChange(n.setValue(y()({},t.onlyOwnParam?{}:t.currentValues),e))},s=n.getTypeForEdit(t.currentValues);return s instanceof Array?Ue.createElement(Ue.Fragment,null,s.map((function(n){return e(y()({},t,{param:n}))}))):(n.canEdit()?(s!==Rh.TYPE.STRING&&s!==Rh.TYPE.NUMBER&&s!==Rh.TYPE.FLOAT&&s!==Rh.TYPE.ARRAY||(r=tu),s===Rh.TYPE.SELECT&&(r=iu,a=function(e){t.onChange(n.setValue(y()({},t.onlyOwnParam?{}:t.currentValues),e.name))}),s===Rh.TYPE.BOOLEAN&&(r=nu),s===Rh.TYPE.COLOR&&(r=au)):(r=ou,i=" disabled"),r?Ue.createElement(r,{dialogRow:!0,className:"editParam "+n.name+i,key:n.name.replace(/  */,""),label:n.displayName,onChange:a,showDialogFunction:t.showDialogFunction,showUnset:!0,list:function(e){return Vm(n.getList(),e)},value:o},t.children):void 0)};Km.PropTypes={param:Ge().object.isRequired,currentValues:Ge().object.isRequired,onChange:Ge().func.isRequired,showDialogFunction:Ge().func.isRequired,className:Ge().string,onlyOwnParam:Ge().bool};var Um=n.p+"images/DefaultGpxPoint.png";function qm(e){return qm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qm(e)}function zm(){return zm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},zm.apply(null,arguments)}function Gm(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Zm(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Jm(r.key),r)}}function Xm(e,t,n){return t&&Zm(e.prototype,t),n&&Zm(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Jm(e){var t=function(e,t){if("object"!=qm(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=qm(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==qm(t)?t:t+""}function Ym(e,t,n){return t=$m(t),function(e,t){if(t&&("object"==qm(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Qm()?Reflect.construct(t,n||[],$m(e).constructor):t.apply(e,n))}function Qm(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Qm=function(){return!!e})()}function $m(e){return $m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},$m(e)}function ed(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&td(e,t)}function td(e,t){return td=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},td(e,t)}var nd=function(e,t){var n=void 0;if("chart"===e.type){var r={chartKey:!0,type:!0,opacity:!0,enabled:!0};r[Qo]=!0,n=d.filteredAssign(r,e)}else n=y()({},e);for(var o in n)"function"==typeof n[o]&&delete n[o];delete n.selected,delete n.index,delete n.disabled;return t&&(["style.lineWidth","style.lineColor"].forEach((function(e){t[e]||delete n[e]})),t.hasSymbols||t.hasLinks||delete n.icons),n},rd=["gpx","kml","kmz","geojson"],od=["zip"],id=[{label:"overlay",value:"overlay"},{label:"chart",value:"chart"},{label:"route",value:"route"},{label:"track",value:"track"}],ad=function(e,t){var n=e.name,r=t.name;return void 0===n&&void 0===r?0:void 0===n?-1:void 0===r?1:(n=n.toUpperCase())<(r=r.toUpperCase())?-1:n>r?1:0},sd=function(e,t){var n=e.time,r=t.time;return n<r?1:n>r?-1:0},ld=function(e){function t(e){var n;return Gm(this,t),(n=Ym(this,t,[e])).dialogHelper=Ya(n),n.state={itemsFetchCount:0,itemInfo:void 0,loading:!1},n.sortLists=["icons","chart","overlay","images","user","knownOverlays","iconFiles","route","track"],n.stateHelper=Lt(n,e.current||{},"item"),n.state.itemsFetchCount=0,n.itemLists={icons:[{label:"--none--"},{label:"--DefaultGpxIcon--",value:Um}],chart:[],overlay:[],images:[],user:[],knownOverlays:[],iconFiles:[{label:"--none--"}],route:[],track:[]},n.getItemList("chart"),n.getItemList("overlay"),n.getItemList("images"),n.getItemList("user"),n.getItemList("route"),n.getItemList("track"),n}return ed(t,e),Xm(t,[{key:"componentDidMount",value:function(){this.props.current&&this.props.current.url&&"chart"!==this.props.current.type&&this.analyseOverlay(this.props.current.url)}},{key:"getItemList",value:function(e){var t=this;wt.getJson("",{},{request:"listdir",type:e}).then((function(n){t.itemLists[e]=n.items,"user"!=e&&"images"!=e&&"overlay"!=e||n.items.forEach((function(e){if(It.IMAGES.indexOf(d.getExt(e.name))>=0){var n=y()({},e);n.label=n.url,n.value=n.url,t.itemLists.icons.push(n)}})),"chart"==e&&n.items.forEach((function(e){e.label=e.name,e.value=e.chartKey})),"overlay"!==e&&"route"!==e&&"track"!==e||n.items.forEach((function(n){n.type=e,"route"===e&&(n.url||(n.url=Oe.getData(ve.properties.navUrl)+"?request=download&type=route&name="+encodeURIComponent(n.name)+"&extension=.gpx"),n.name.match(/\.gpx/)||(n.name+=".gpx")),n.label=n.name,n.value=n.url,rd.indexOf(d.getExt(n.name))>=0&&t.itemLists.knownOverlays.push(n),od.indexOf(d.getExt(n.name))>=0&&t.itemLists.iconFiles.push(y()({},n,{label:n.url}))})),t.sortLists.forEach((function(e){t.itemLists[e].sort(ad)})),t.setState({itemsFetchCount:t.state.itemsFetchCount+1})})).catch((function(t){ct("error fetching list of "+e+": "+t)}))}},{key:"changeType",value:function(e){if(e!==this.stateHelper.getValue("type")){var t={type:e,name:void 0};this.stateHelper.setState(t)}}},{key:"analyseOverlay",value:function(e,t){var n=this;this.setState({loading:!0,itemInfo:void 0}),wt.getHtmlOrText(e).then((function(r){try{var o,i=d.getExt(e);"gpx"===i&&(l=r,u=new To.A,c={styles:{}},p=u.readFeatures(Bo(l)),f=!1,p.forEach((function(e){var t=!1;if(e){e.get("sym")&&(c.hasSymbols=!0,t=!0),e.get("link")&&(c.hasLinks=!0);var n=e.getGeometry();n instanceof Oo.A?(c.hasWaypoint=!0,c.hasAny=!0,t||(f=!0)):n instanceof Po.A?(c.hasRoute=!0,c[Mo+"lineColor"]=!0,c[Mo+"lineWidth"]=!0,c.hasAny=!0):n instanceof Do.A&&(c.hasTrack=!0,c[Mo+"lineColor"]=!0,c[Mo+"lineWidth"]=!0,c.hasAny=!0)}})),f&&(c[Mo+"fillColor"]=!0,c[Mo+"lineColor"]=!0,c[Mo+"circleWidth"]=!0),c.allowFormatter=!0,o=c),"kml"===i&&(o=function(e){var t=new ni.Ay,n={styles:{}};return t.readFeatures(e).forEach((function(e){if(e){var t=e.getGeometry();t&&(n.hasAny=!0),t instanceof Oo.A?n.hasWaypoint=!0:(t instanceof Po.A||t instanceof Do.A)&&(n.hasTrack=!0);var r=e.get("desc")||e.get("description");r&&r.indexOf("<")>=0&&(n.allowHtml=!0)}})),n[Mo+"fillColor"]=!0,n[Mo+"circleWidth"]=!0,n.allowOnline=!0,n.showText=!0,n.allowFormatter=!0,n}(r)),"geojson"===i&&(o=function(e){var t=new qo.A,n={styles:{}};return t.readFeatures(e).forEach((function(e){if(e){e.get("sym")&&(n.hasSymbols=!0),e.get("link")&&(n.hasLinks=!0);var t=e.getGeometry();for(var r in t&&(n.hasAny=!0),t instanceof Oo.A&&(n.hasWaypoint=!0),wi)n[Mo+r]=!0}})),n.allowFormatter=!0,n}(r)),o.hasAny||(ct(e+" is no valid overlay file"),n.setState({loading:!1,itemInfo:{}}),n.stateHelper.setValue("name",void 0));var a={loading:!1,itemInfo:o};if(n.setState(a),t){var s={};s["style.lineWidth"]=o.hasRoute?Oe.getData(ve.properties.routeWidth):Oe.getData(ve.properties.trackWidth),s["style.lineColor"]=o.hasRoute?Oe.getData(ve.properties.routeColor):Oe.getData(ve.properties.trackColor),s["style.fillColor"]=s["style.lineColor"],s["style.circleWidth"]=3*s["style.lineWidth"],n.stateHelper.setState(s)}}catch(t){ct(e+" is no valid overlay: "+t.message),n.setState({loading:!1,itemInfo:{}}),n.stateHelper.setValue("name",void 0)}var l,u,c,p,f})).catch((function(t){ct("unable to load "+e+": "+t),n.setState({loading:!1,itemInfo:{}}),n.stateHelper.setValue("name",void 0)}))}},{key:"filteredNameList",value:function(){var e=this.stateHelper.getValue("type"),t=[];return this.itemLists.knownOverlays.forEach((function(n){n.type===e&&t.push(n)})),"track"===e&&t.sort(sd),t}},{key:"render",value:function(){var e=this,t=this.stateHelper.isChanged(),n=this.stateHelper.getValue("type"),r=this.state.itemInfo||{},o=(r.hasRoute?Oe.getData(ve.properties.routeWidth):Oe.getData(ve.properties.trackWidth),r.hasRoute?Oe.getData(ve.properties.routeColor):Oe.getData(ve.properties.trackColor),"kmz"===d.getExt(this.stateHelper.getValue("name"))),i=[{label:"-- none --",value:void 0}];for(var a in Fr)"function"==typeof Fr[a]&&i.push({label:a,value:a});return Ue.createElement(Ue.Fragment,null,Ue.createElement("div",{className:"selectDialog editOverlayItemDialog"},Ue.createElement("h3",{className:"dialogTitle"},this.props.title||"Edit Overlay"),Ue.createElement("div",{className:"dialogRow info"},Ue.createElement("span",{className:"inputLabel"},"Overlay"),this.stateHelper.getValue("name")),this.state.isLoading?Ue.createElement("div",{className:"loadingIndicator"},"Analyzing..."):Ue.createElement(Ue.Fragment,null,Ue.createElement(nu,{className:"enabled",dialogRow:!0,label:"enabled",onChange:function(t){return e.stateHelper.setState({enabled:t})},value:this.stateHelper.getValue("enabled")||!1}),Ue.createElement(ru,{className:"type",dialogRow:!0,label:"type",value:n,itemList:id,onChange:function(t){return e.changeType(t)}}),Ue.createElement(tu,{className:"opacity",dialogRow:!0,label:"opacity",value:this.stateHelper.getValue("opacity"),onChange:function(t){return e.stateHelper.setValue("opacity",parseFloat(t))},type:"number"}),"chart"==n?Ue.createElement(Ue.Fragment,null,Ue.createElement(iu,{dialogRow:!0,label:"chart name",value:{value:this.stateHelper.getValue("chartKey"),label:this.stateHelper.getValue("name")},list:this.itemLists.chart,fetchCount:this.state.itemsFetchCount,showDialogFunction:this.dialogHelper.showDialog,onChange:function(t){e.stateHelper.setState({chartKey:t.chartKey,name:t.name})}})):Ue.createElement(Ue.Fragment,null,Ue.createElement(iu,{dialogRow:!0,label:"overlay name",value:this.stateHelper.getValue("name"),list:this.filteredNameList(),fetchCount:this.state.itemsFetchCount,showDialogFunction:this.dialogHelper.showDialog,onChange:function(t){var n={url:t.url,name:t.name};"kmz"===d.getExt(t.name)&&(n.icons=t.url,n.url+="/doc.kml");var r=void 0===e.stateHelper.getValue("name");e.stateHelper.setState(n),e.analyseOverlay(n.url,r)}}),!o&&(r.hasSymbols||r.hasLinks)&&Ue.createElement(iu,{dialogRow:!0,label:"icon file",value:this.stateHelper.getValue("icons"),list:this.itemLists.iconFiles,fetchCount:this.state.itemsFetchCount,showDialogFunction:this.dialogHelper.showDialog,onChange:function(t){e.stateHelper.setState({icons:t.url})}}),o&&Ue.createElement(ou,{dialogRow:!0,label:"icon file",value:this.stateHelper.getValue("icons")}),r.allowOnline&&Ue.createElement(nu,{dialogRow:!0,label:"allow online",value:this.stateHelper.getValue("allowOnline")||!1,onChange:function(t){return e.stateHelper.setValue("allowOnline",t)}}),r.showText&&Ue.createElement(nu,{dialogRow:!0,label:"show text",value:this.stateHelper.getValue("showText")||!1,onChange:function(t){return e.stateHelper.setValue("showText",t)}}),r.allowHtml&&Ue.createElement(nu,{dialogRow:!0,label:"allow html",value:this.stateHelper.getValue("allowHtml")||!1,onChange:function(t){return e.stateHelper.setValue("allowHtml",t)}}),r.allowFormatter&&Ue.createElement(iu,{dialogRow:!0,showDialogFunction:this.dialogHelper.showDialog,label:"featureFormatter",value:this.stateHelper.getValue("featureFormatter"),onChange:function(t){e.stateHelper.setValue("featureFormatter",t.value)},list:i}),function(){var e=[];for(var t in Kr.StyleParam)e.push(y()({},Kr.StyleParam[t],{name:"style."+t}));return e}().map((function(t){return r[t.name]?Ue.createElement(Km,{param:xh(t.name,t.type,t.list,t.displayName,t.default),currentValues:e.stateHelper.getValues()||{},onChange:function(t){return e.stateHelper.setState(t)},showDialogFunction:e.dialogHelper.showDialog,onlyOwnParam:!0}):null})),Ue.createElement(tu,{dialogRow:!0,type:"number",label:"min zoom",value:this.stateHelper.getValue("minZoom")||0,onChange:function(t){return e.stateHelper.setValue("minZoom",t)}}),Ue.createElement(tu,{dialogRow:!0,type:"number",label:"max zoom",value:this.stateHelper.getValue("maxZoom")||0,onChange:function(t){return e.stateHelper.setValue("maxZoom",t)}}),(r.hasSymbols||r.hasWaypoint)&&Ue.createElement(tu,{dialogRow:!0,type:"number",label:"min scale",value:this.stateHelper.getValue("minScale")||0,onChange:function(t){return e.stateHelper.setValue("minScale",t)}}),(r.hasSymbols||r.hasWaypoint)&&Ue.createElement(tu,{dialogRow:!0,type:"number",label:"max scale",value:this.stateHelper.getValue("maxScale")||0,onChange:function(t){return e.stateHelper.setValue("maxScale",t)}}),(r.hasSymbols||r.allowOnline||r.hasWaypoint)&&Ue.createElement(iu,{dialogRow:!0,label:"default icon",value:this.stateHelper.getValue("defaultIcon")||"--none--",list:this.itemLists.icons,fetchCount:this.state.itemsFetchCount,showDialogFunction:this.dialogHelper.showDialog,onChange:function(t){e.stateHelper.setState({defaultIcon:t.value})}},this.stateHelper.getValue("defaultIcon")&&Ue.createElement("span",{className:"icon",style:{backgroundImage:"url('"+this.stateHelper.getValue("defaultIcon")+"')"}}," ")))),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"cancel",onClick:this.props.closeCallback},"Cancel"),this.props.updateCallback?Ue.createElement(Ia,{name:"ok",onClick:function(){var t=e.stateHelper.getValues(!0);t.opacity=parseFloat(t.opacity),t.opacity<0&&(t.opacity=0),t.opacity>1&&(t.opacity=1),e.props.updateCallback(t)},disabled:!t&&!this.props.forceOk||!this.stateHelper.getValue("name")},"Ok"):null)))}}])}(Ue.Component),ud=function(e){return Ue.createElement("div",{className:"listEntry overlayElement baseChart"},Ue.createElement("div",{className:"itemInfo"},Ue.createElement("div",{className:"infoRow"},Ue.createElement("span",{className:"inputLabel"}," "),Ue.createElement("span",{className:"valueText"},"---chart---"))))},cd=function(e){return Ue.createElement("div",{className:"listEntry overlayElement "+(e.selected?"activeEntry":"")+(e.enabled?"":" disabled")+(e.isDefault?" defaultOverlay":""),onClick:function(){return e.onClick("select")}},Ue.createElement("div",{className:"itemInfo"},Ue.createElement("div",{className:"infoRow"},Ue.createElement("span",{className:"inputLabel"},"Name"),Ue.createElement("span",{className:"valueText"},e.name)),Ue.createElement("div",{className:"infoRow"},Ue.createElement("span",{className:"inputLabel"},"Type"),Ue.createElement("span",{className:"valueText"},e.type+(e.isDefault?"   [default]":"")))),Ue.createElement("div",{className:"actions"},"base"!==e.type&&Ue.createElement(nu,{className:"overlayEnabled",value:e.enabled||!1,onChange:function(t){e.onClick(t?"enable":"disable")}}),"base"!==e.type&&Ue.createElement(ds,{name:"Edit",className:"smallButton "+(e.isDefault||e.preventEdit?"disabled":""),onClick:function(t){t.stopPropagation(),e.onClick("edit")}})))},pd=function(e){return Ue.createElement(Ea,{className:"defaultOverlayItems",itemClass:cd,itemList:e.items,onItemClick:function(t,n){e.onClick({item:t,data:n})}})},fd=function(e){return Ue.createElement("div",{className:"empty"})},hd=function(e){var t=[];if(!e)return t;var n=void 0;return e.forEach((function(e){if(e.isDefault)return n||(n={itemClass:pd,items:[],disabled:!0}),void n.items.push(e);n&&t.push(n),n=void 0,t.push(y()({},e,{disabled:"base"===e.type}))})),n&&t.push(n),t},md=function(e,t){var n=ei(e),r=ei(t);return void 0!==n&&void 0!==r&&(n===r&&e.isDefault===t.isDefault)},dd=function(e){function t(e){var n;Gm(this,t),(n=Ym(this,t,[e])).state={},n.state.selectedIndex=-1,n.currentConfig=n.props.current.copy();var r=n.props.current.getOverlayList(!0);n.state.list=hd(r),n.state.addEntry=e.addEntry;for(var o=0;o<n.state.list.length;o++)if(void 0!==n.state.list[o].type&&"base"!==n.state.list[o].type){n.state.selectedIndex=o;break}return n.state.useDefault=n.props.current.getUseDefault(),n.state.isChanged=!1,n.dialogHelper=Ya(n),n.reset=n.reset.bind(n),n.updateList=n.updateList.bind(n),n.hideAll=n.hideAll.bind(n),n}return ed(t,e),Xm(t,[{key:"componentDidMount",value:function(){if(this.state.addEntry){var e=this.state.addEntry;this.setState({addEntry:void 0,isChanged:!0}),this.insert(!1,e)}}},{key:"updateList",value:function(e){var t=this.state.selectedIndex;t<0&&(t=0),t>=e.length&&(t=0);for(var n=e.length;(void 0===e[t].type||"base"===e[t].type)&&n>=0;)++t>=e.length&&(t=0),n--;n<0&&(t=-1),this.setState({list:e,isChanged:!0,selectedIndex:t})}},{key:"showItemDialog",value:function(e,t){var n=this;return new Promise((function(r,o){n.dialogHelper.showDialog((function(n){return Ue.createElement(ld,zm({},n,{closeCallback:function(){n.closeCallback(),o(0)},updateCallback:function(e){e.name?r(e):o("missing overlay name"),n.closeCallback()},current:e,title:e?"Edit Overlay":"New Overlay",forceOk:t}))}))}))}},{key:"insert",value:function(e,t){var n=this;if(!(this.props.preventEdit||e&&(this.state.selectedIndex<0||this.state.selectedIndex>=this.state.list.length))){var r=this.state.selectedIndex;r<0&&(r=this.state.list.length);var o=this.currentConfig.createNewOverlay(t||{type:"overlay",opacity:1});this.showItemDialog(o,void 0!==t).then((function(t){var o=n.state.list.slice();o.splice(e?r:r+1,0,t),n.updateList(o)})).catch((function(e){e&&ct(e)}))}}},{key:"editItem",value:function(e){var t=this;this.props.preventEdit||e.disabled||this.showItemDialog(e).then((function(n){t.updateItem(e,n)})).catch((function(e){e&&ct(e)}))}},{key:"updateItem",value:function(e,t){var n=this.state.list,r=!1;n.forEach((function(n){n.items?n.items.forEach((function(n){md(e,n)&&(y()(n,t),r=!0)})):md(n,e)&&(y()(n,t),r=!0)})),r&&this.updateList(n)}},{key:"deleteItem",value:function(e){if(!this.props.preventEdit&&!e.disabled&&void 0!==ei(e))for(var t=this.state.list.slice(),n=0;n<t.length;n++)md(t[n],e)&&(t.splice(n,1),this.updateList(t))}},{key:"moveItem",value:function(e,t){var n=this.state.list.slice();if(!(e<0||e>=n.length||t<0||t>=n.length)){var r=n[e];n.splice(e,1),n.splice(t,0,r),this.updateList(n)}}},{key:"reset",value:function(){if(this.props.resetCallback)return this.props.closeCallback(),void this.props.resetCallback();this.currentConfig.reset(),this.setState({useDefault:this.currentConfig.getUseDefault(),selectedIndex:0,isChanged:!0}),this.updateList(hd(this.currentConfig.getOverlayList()))}},{key:"hideAll",value:function(){this.currentConfig.setAllEnabled(!1),this.setState({isChanged:!0}),this.updateList(hd(this.currentConfig.getOverlayList()))}},{key:"render",value:function(){var e=this;if(!this.props.current)return this.props.closeCallback(),null;this.props.current.getName();var t,n=this.props.current.hasDefaults();this.state.selectedIndex>=0&&this.state.selectedIndex<=this.state.list.length&&!this.props.preventEdit&&(t=this.state.list[this.state.selectedIndex]);var r=this.props.current.getName()===vd,o=this.props.title||(r?"Edit Default Overlays":"Edit Overlays");return Ue.createElement(Ue.Fragment,null,Ue.createElement("div",{className:"selectDialog editOverlaysDialog"+(this.props.preventEdit?" preventEdit":"")},Ue.createElement("h3",{className:"dialogTitle"},o),!r&&Ue.createElement("div",{className:"dialogRow info"},Ue.createElement("span",{className:"inputLabel"},"Chart"),this.props.chartName),!this.props.noDefault&&!this.props.preventEdit&&n&&Ue.createElement(nu,{className:"useDefault",dialogRow:!0,label:"use default",onChange:function(t){e.setState({useDefault:t,isChanged:!0})},value:this.state.useDefault||!1}),Ue.createElement(Ea,{dragdrop:!this.props.preventEdit,onSortEnd:function(t,n){e.moveItem(t,n),e.setState({selectedIndex:n})},className:"overlayItems",itemCreator:function(t){return"base"===t.type?ud:t.itemClass===pd?e.state.useDefault?pd:fd:cd},selectedIndex:this.props.preventEdit?void 0:this.state.selectedIndex,onItemClick:function(t,n){if("select"!==n)if("edit"!==n)if("disable"!==n)if("enable"!==n){if("object"===qm(n)){if(!n.item)return;if("enable"===n.data)return void e.updateItem(n.item,{enabled:!0});if("disable"===n.data)return void e.updateItem(n.item,{enabled:!1})}}else e.updateItem(t,{enabled:!0});else e.updateItem(t,{enabled:!1});else e.editItem(t);else e.setState({selectedIndex:t.index})},itemList:this.state.list}),Ue.createElement("div",{className:"insertButtons"},Ue.createElement(Ia,{name:"hide",onClick:this.hideAll},"HideAll"),t?Ue.createElement(Ia,{name:"delete",onClick:function(){return e.deleteItem(t)}},"Delete"):null,t||this.props.editCallback?Ue.createElement(Ia,{name:"edit",onClick:function(){e.props.editCallback?e.props.editCallback(t)&&e.props.closeCallback():e.editItem(t)}},"Edit"):null,!this.props.preventEdit&&t?Ue.createElement(Ia,{name:"before",onClick:function(){return e.insert(!0)}},"Insert Before"):null,!this.props.preventEdit&&Ue.createElement(Ia,{name:"after",onClick:function(){return e.insert(!1)}},"Insert After")),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"reset",onClick:this.reset},"Reset"),Ue.createElement(Ia,{name:"cancel",onClick:this.props.closeCallback},"Cancel"),this.props.updateCallback?Ue.createElement(Ia,{name:"ok",onClick:function(){e.props.closeCallback();var t,n,r=e.currentConfig;r.writeBack((t=e.state.list,n=[],t?(t.forEach((function(e){e.itemClass===pd?e.items.forEach((function(e){n.push(nd(e))})):n.push(nd(e))})),n):n)),r.setUseDefault(e.state.useDefault),e.props.updateCallback(r)},disabled:!this.state.isChanged},this.props.preventEdit?"Ok":"Save"):null)))}}])}(Ue.Component);dd.propTypes={title:Ge().string,current:Ge().instanceOf(ti),updateCallback:Ge().func,resetCallback:Ge().func,editCallback:Ge().func,closeCallback:Ge().func.isRequired,preventEdit:Ge().bool,addEntry:Ge().object},dd.createDialog=function(e,t,n){if(!Vr(e))return!1;if(n){if(!n.type)return!1;var r=!1;if(id.forEach((function(e){e.value===n.type&&(r=!0)})),!r)return!1;n=y()({opacity:1,enabled:!0},n)}var o=Vr(e)===vd,i={request:"api",type:"chart",overlayConfig:Vr(e),command:"getConfig",expandCharts:!0,mergeDefault:!o};return wt.getJson("",{},i).then((function(r){if(r.data){void 0===r.data.useDefault&&(r.data.useDefault=!0);var i=new ti(r.data);$a.dialog((function(r){return Ue.createElement(dd,zm({},r,{chartName:e.name,current:i,updateCallback:function(e){if(e.isEmpty()){var n={request:"delete",type:"chart",name:i.getName()};wt.getJson("",{},n).then((function(){t&&t(e.getWriteBackData())})).catch((function(e){ct("unable to save overlay config: "+error),t&&t()}))}else{var r={request:"upload",type:"chart",name:i.getName(),overwrite:!0};wt.postPlain("",JSON.stringify(e.getWriteBackData(),void 0,2),{},r).then((function(n){t&&t(e.getWriteBackData())})).catch((function(e){ct("unable to save overlay config: "+e),t&&t()}))}},noDefault:o||!1,addEntry:n}))}))}})).catch((function(e){ct("unable to get config: "+e)})),!0};var vd="default.cfg",yd={type:"chart",name:"DefaultOverlays",chartKey:vd,overlayConfig:vd,canDelete:!1,canDownload:!1,time:(new Date).getTime()/1e3,icon:wm},gd=dd,bd=(n(24280),n.p+"images/fullscreen.svg"),wd=(n.p,!1),kd=bd,Cd=navigator.userAgent;if(Cd.match(/Chrome/)){var Sd=Cd.replace(/.*Chrome[/]*/,"").replace(/ .*/,"");Sd&&(Sd=Sd.replace(/\..*/,""))<44&&(wd=!0)}var Ed=function(){return!wd&&!!document.fullscreenEnabled},Od=function(){return!!document.fullscreenElement},Pd=function(){Ed()&&(document.fullscreenElement?document.exitFullscreen():document.body.requestFullscreen())},Dd={name:"FullScreen",storeKeys:{visible:ve.properties.showFullScreen,toggle:ve.gui.global.isFullScreen,split:ve.gui.global.splitMode},updateFunction:function(e){return{toggle:Od(),visible:e.visible&&Ed()&&!window.avnavAndroid,dummy:e.toggle,icon:kd}},onClick:function(){Pd()},editDisable:!0,overflow:!0},Td={fullScreenAvailable:Ed,fullScreenDefinition:Dd,toggleFullscreen:Pd,init:function(){try{Oe.register((function(){Oe.getData(ve.gui.global.splitMode)&&(Ed=function(){return!window.avnavAndroid},Od=function(){return Oe.getData(ve.gui.global.isFullScreen)},Pd=function(){Ke.sendToFrame("fullscreen")},Ke.subscribe("fullScreenChanged",(function(e){Oe.storeData(ve.gui.global.isFullScreen,e.isFullScreen)})))}),[ve.gui.global.splitMode]);var e=d.getParam("fullscreen");if(e)if(Ke.addUrlParameter("fullscreen",e),e.match(/^server:/)){var t=e.replace(/^server:/,"");It.getServerCommand(t).then((function(e){e?(e.icon&&(kd=e.icon),Ed=function(){return!0}):wd=!0;var t=Oe.getData(ve.gui.global.isFullScreen);Oe.storeData(ve.gui.global.isFullScreen,!t),Oe.storeData(ve.gui.global.isFullScreen,t)})).catch((function(e){ct(e)})),Ed=function(){return!1},Od=function(){},Pd=function(){wt.getJson({request:"api",type:"command",action:"runCommand",name:t}).then((function(){})).catch((function(e){return ct(e)}))}}else wd=!0;Oe.storeData(ve.gui.global.isFullScreen,Ed()&&!!document.fullscreenElement),wd||document.addEventListener("fullscreenchange",(function(){Oe.storeData(ve.gui.global.isFullScreen,Od())}))}catch(e){console.log("unable to install fullscreen handler")}},getParameter:function(){return fullscreenParameter}};function Nd(e){return Nd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nd(e)}function Rd(){return Rd=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Rd.apply(null,arguments)}function xd(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,jd(r.key),r)}}function jd(e){var t=function(e,t){if("object"!=Nd(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Nd(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Nd(t)?t:t+""}function Ad(e,t,n){return t=Id(t),function(e,t){if(t&&("object"==Nd(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Ld()?Reflect.construct(t,n||[],Id(e).constructor):t.apply(e,n))}function Ld(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ld=function(){return!!e})()}function Id(e){return Id=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Id(e)}function Md(e,t){return Md=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Md(e,t)}var _d=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Ad(this,t,[e])).state={channel:e.channel,read:e.read,write:e.write},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Md(e,t)}(t,e),n=t,(r=[{key:"render",value:function(){var e=this;return Ue.createElement("div",{className:"RemoteChannelDialog flexInner"},Ue.createElement("h3",{className:"dialogTitle"},"RemoteChannel"),Ue.createElement(iu,{dialogRow:!0,value:this.state.channel,onChange:function(t){return e.setState({channel:t})},label:"Channel",changeOnlyValue:!0,list:de.getKeyDescriptions(!0)[ve.properties.remoteChannelName].values.map((function(e){return{label:e,value:e}}))}),Ue.createElement(nu,{dialogRow:!0,value:this.state.read,onChange:function(t){return e.setState({read:!!t})},label:"Read"}),Ue.createElement(nu,{dialogRow:!0,value:this.state.write,onChange:function(t){return e.setState({write:!!t})},label:"Write"}),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"disconnect",disabled:!this.props.read&&!this.props.write,onClick:function(){e.props.closeCallback(),e.props.setCallback({})}},"Disconnect"),Ue.createElement(Ia,{name:"connect",disabled:!(this.state.read||this.state.write),onClick:function(){e.props.closeCallback(),e.props.setCallback(wn()(e.state))}},"Connect"),Ue.createElement(Ia,{name:"cancel",onClick:function(){return e.props.closeCallback()}},"Cancel")))}}])&&xd(n.prototype,r),o&&xd(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component),Fd={available:ve.gui.capabilities.remoteChannel,active:ve.gui.global.remoteChannelActive,channel:ve.properties.remoteChannelName,write:ve.properties.remoteChannelWrite,read:ve.properties.remoteChannelRead,connected:ve.properties.connectedMode},Bd=function(e){return y()({name:"RemoteChannel",storeKeys:Fd,updateFunction:function(e){var t=e.available&&e.connected&&e.active;return{toggle:t&&(e.read||e.write),visible:t}},onClick:function(){var e,t;t=function(e){var t=Oe.getMultiple(Fd);return Ue.createElement(_d,Rd({},t,e,{setCallback:function(e){e.read||e.write?Oe.storeMultiple(e,Fd,!1,!0):Oe.storeMultiple({read:!1,write:!1},Fd,!1,!0)}}))},(e=void 0)?e(t):$a.dialog(t)},editDisable:!0},e)};function Wd(e){return Wd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wd(e)}function Hd(){return Hd=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Hd.apply(null,arguments)}function Vd(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Kd(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,qd(r.key),r)}}function Ud(e,t,n){return t&&Kd(e.prototype,t),n&&Kd(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function qd(e){var t=function(e,t){if("object"!=Wd(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Wd(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Wd(t)?t:t+""}function zd(e,t,n){return t=Zd(t),function(e,t){if(t&&("object"==Wd(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Gd()?Reflect.construct(t,n||[],Zd(e).constructor):t.apply(e,n))}function Gd(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Gd=function(){return!!e})()}function Zd(e){return Zd=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Zd(e)}function Xd(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Jd(e,t)}function Jd(e,t){return Jd=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Jd(e,t)}var Yd=function(e){return"red"==e?Oe.getData(ve.properties.statusErrorImage):"green"==e?Oe.getData(ve.properties.statusOkImage):"yellow"==e?Oe.getData(ve.properties.statusYellowImage):void 0},Qd=function(e){function t(e){var n;return Vd(this,t),(n=zd(this,t,[e])).state={status:{}},n.timer=It.lifecycleTimer(n,n.timerCall,Oe.getData(ve.properties.positionQueryTimeout),!0),n.timerCall=n.timerCall.bind(n),It.storeHelperState(n,{valid:ve.nav.gps.valid,connectionLost:ve.nav.gps.connectionLost}),n}return Xd(t,e),Ud(t,[{key:"timerCall",value:function(e){var t=this;wt.getJson("?request=nmeaStatus").then((function(n){t.timer.guardedCall(e,(function(){t.setState({status:n.data}),t.timer.startTimer(e)}))})).catch((function(n){t.timer.guardedCall(e,(function(){t.setState({status:{}}),t.timer.startTimer(e)}))}))}},{key:"render",value:function(){var e=this.state.connectionLost?"red":"yellow",t=this.state.connectionLost?"red":"yellow",n=this.state.connectionLost?"server connection lost":"",r="";return this.state.connectionLost||(this.state.status&&this.state.status.nmea&&(e=this.state.status.nmea.status,n=this.state.status.nmea.source+":"+this.state.status.nmea.info),this.state.status&&this.state.status.ais&&(t=this.state.status.ais.status,r=this.state.status.ais.source+":"+this.state.status.ais.info)),Ue.createElement("div",{className:"footer"},Ue.createElement("div",{className:"inner"},Ue.createElement("div",{className:"status"},Ue.createElement("div",null,Ue.createElement("img",{className:"status_image",src:Yd(e)}),"NMEA ",n),this.state.connectionLost?null:Ue.createElement("div",null,Ue.createElement("img",{className:"status_image",src:Yd(t)}),"AIS ",r)),Ue.createElement("div",{className:"link"},Ue.createElement("div",null," AVNav Version ",Ue.createElement("span",null,avnav.version)),Ue.createElement("div",null,Ue.createElement("a",{href:"http://www.wellenvogel.de/software/avnav/index.php",className:"extLink"},"www.wellenvogel.de/software/avnav/index.php")))))}}])}(Ue.Component),$d=function(e){function t(e){var n;Vd(this,t),(n=zd(this,t,[e])).state={chartList:[],addOns:[],selectedChart:0,sequence:0,overlays:{}},n.fillList=n.fillList.bind(n),It.storeHelper(n,(function(e){n.readAddOns()}),{sequence:ve.gui.global.reloadSequence},2),It.storeHelper(n,(function(e){n.fillList()}),{sequence:ve.gui.global.reloadSequence}),n.timer=It.lifecycleTimer(n,(function(e){n.fillList(e)}),3e3,!0);var r=n;return n.selectChart(0),It.keyEventHandler(n,(function(e,t){if("selectChart"==t){var o=n.state.chartList,i=n.state.selectedChart||0;o&&o[i]&&n.showNavpage(o[i])}"nextChart"==t&&r.selectChart(1),"previousChart"==t&&r.selectChart(-1)}),"page",["selectChart","nextChart","previousChart"]),n.showNavpage=n.showNavpage.bind(n),n.ChartItem=n.ChartItem.bind(n),n}return Xd(t,e),Ud(t,[{key:"showNavpage",value:function(e){i.log("activating navpage with url "+e.url),Wi.setChartEntry(e),this.props.history.push("navpage")}},{key:"getButtons",value:function(){var e=this;return[{name:"ShowStatus",onClick:function(){e.props.history.push("statuspage")},editDisable:!0},{name:"ShowSettings",onClick:function(){e.props.history.push("settingspage")},overflow:!0},{name:"ShowDownload",onClick:function(){e.props.history.push("downloadpage")},editDisable:!0,overflow:!0},{name:"Connected",storeKeys:[ve.gui.global.onAndroid,ve.properties.connectedMode,ve.gui.capabilities.canConnect],updateFunction:function(e,t){return{visible:!e[ve.gui.global.onAndroid]&&1==e[ve.gui.capabilities.canConnect],toggle:e[ve.properties.connectedMode]}},onClick:function(){var e=Oe.getData(ve.properties.connectedMode,!1);e=!e,Oe.storeData(ve.properties.connectedMode,e)},editDisable:!0,overflow:!0},{name:"ShowGps",onClick:function(){e.props.history.push("gpspage")}},{name:"Night",storeKeys:{toggle:ve.properties.nightMode},onClick:function(){var e=Oe.getData(ve.properties.nightMode,!1);e=!e,Oe.storeData(ve.properties.nightMode,e)}},Lm(this.props.history),Rm.getButtonDef(),{name:"NavOverlays",onClick:function(){gd.createDialog(yd)},editDisable:!0,overflow:!0,storeKeys:{visible:ve.gui.capabilities.uploadOverlays,connected:ve.properties.connectedMode},updateFunction:function(e){return{visible:e.visible&&e.connected}}},{name:"MainAddOns",onClick:function(){e.props.history.push("addonpage")},visible:this.state.addOns.length>0,editDisable:!0},Bd({overflow:!0}),Td.fullScreenDefinition,Ke.buttonDef({overflow:!0}),{name:"Cancel",storeKeys:{visible:ve.gui.global.onAndroid},onClick:function(){avnav.android&&avnav.android.goBack()}}]}},{key:"ChartItem",value:function(e){var t=this,n="chartItem";e.selected&&(n+=" activeEntry"),e.originalScheme&&(n+=" userAction"),n+=e.hasOverlays?" withOverlays":" noOverlays";var r=Oe.getData(ve.properties.connectedMode,!1);return Ue.createElement("div",{className:n,onClick:e.onClick},Ue.createElement("img",{src:e.icon||wm}),Ue.createElement("span",{className:"chartName"},e.name),r&&Ue.createElement(ds,{className:"smallButton",name:"MainOverlays",onClick:function(n){n.stopPropagation(),gd.createDialog(e,(function(){t.fillList()}))}}))}},{key:"componentDidMount",value:function(){Oe.storeData(ve.gui.global.soundEnabled,!0)}},{key:"selectChart",value:function(e){var t=(this.state.chartList||[]).length,n=this.state.selectedChart,r=n+e;r>=t&&(r=0),r<0&&(r=0),r!=n&&this.setState({selectedChart:r})}},{key:"readOverlays",value:function(e){return wt.getJson("",{},{request:"api",type:"chart",command:"listOverlays"}).then((function(t){var n={};for(var r in t.data){var o=t.data[r];n[o.name]=o}for(var i in e)e[i].hasOverlays=!!n[e[i].overlayConfig];return{overlays:n,chartList:e}}),(function(t){return{chartList:e}}))}},{key:"fillList",value:function(e){var t=this;wt.getJson("?request=list&type=chart",{timeout:3*parseFloat(Oe.getData(ve.properties.networkTimeout))}).then((function(n){var r,o=[],i=Wi.getBaseChart(),a=i?i.getChartKey():Wi.getLastChartKey(),s=0;for(var l in n.items.sort((function(e,t){var n=e.name.toUpperCase(),r=t.name.toUpperCase();return n<r?-1:n>r?1:0})),n.items){var u=n.items[l];u.key||(u.key=u.chartKey||u.url),u.hasOverlays=!!t.state.overlays[u.overlayConfig],a===u.key&&(r=s),o.push(u),s++}var c={};void 0===r&&o.length>0&&(r=0,i=void 0),void 0!==r&&(c.selectedChart=r,i||t.props.options&&t.props.options.noInitial||Wi.setChartEntry(o[r])),c.selectedChart!==t.state.selectedChart&&t.setState(c),t.readOverlays(o).then((function(n){t.setState((function(e,t){var r={};return p(e.chartList,n.chartList)||(r.chartList=n.chartList),p(e.overlays,n.overlays)||(r.overlays=n.overlays),r.chartList||r.overlays?r:null})),void 0!==e&&t.timer.startTimer(e)}))}),(function(n){ct("unable to read chart list: "+n),void 0!==e&&t.timer.startTimer(e)}))}},{key:"readAddOns",value:function(){var e=this;_m(!0).then((function(t){e.setState({addOns:t})})).catch((function(){}))}},{key:"render",value:function(){var e=this;return Ue.createElement(bm,Hd({},e.props,{id:"mainpage",title:"AvNav "+Fe.getPrefix(),mainContent:Ue.createElement(Ea,{className:"mainContent",itemClass:this.ChartItem,onItemClick:this.showNavpage,itemList:this.state.chartList,selectedIndex:this.state.selectedChart,scrollable:!0,listRef:function(e){if(e){var t=e.querySelector(".activeEntry"),n=It.scrollInContainer(e,t);n<1||n>2||t.scrollIntoView(1==n)}}}),bottomContent:Ue.createElement(Qd,null),buttonList:e.getButtons(),dummy:e.state.status}))}}])}(Ue.Component),ev="20240610-1121";function tv(e){return tv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tv(e)}function nv(){return nv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},nv.apply(null,arguments)}function rv(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ov(r.key),r)}}function ov(e){var t=function(e,t){if("object"!=tv(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=tv(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==tv(t)?t:t+""}function iv(e,t,n){return t=sv(t),function(e,t){if(t&&("object"==tv(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,av()?Reflect.construct(t,n||[],sv(e).constructor):t.apply(e,n))}function av(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(av=function(){return!!e})()}function sv(e){return sv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},sv(e)}function lv(e,t){return lv=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},lv(e,t)}var uv=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=iv(this,t,[e])).buttons=[Lm(n.props.history),{name:"Cancel",onClick:function(){n.props.history.pop()}}],n.showLicense=n.showLicense.bind(n),n.showPrivacy=n.showPrivacy.bind(n),n.state={},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&lv(e,t)}(t,e),n=t,(r=[{key:"showLicense",value:function(){if(this.refs.info){var e=this.refs.frame;e&&(e.scrollTop=0)}}},{key:"showPrivacy",value:function(){var e=this.refs.privacy;if(e){var t=this.refs.frame;t&&(t.scrollTop=e.offsetTop-t.offsetTop)}}},{key:"componentDidMount",value:function(){var e=this;wt.getHtmlOrText("info.html").then((function(t){e.setState({info:t})}),(function(e){})),wt.getHtmlOrText("license.html").then((function(t){e.setState({license:t})}),(function(e){})),wt.getHtmlOrText("privacy-en.html").then((function(t){e.setState({privacy:t})}),(function(e){}))}},{key:"render",value:function(){var e=this,t=Ue.createElement(Ue.Fragment,null,Ue.createElement("div",{className:"linkWrapper"},Ue.createElement("div",{className:"link",onClick:e.showLicense},"License"),Ue.createElement("div",{className:"link",onClick:e.showPrivacy},"PrivacyInfo")),Ue.createElement("div",{className:"avnavVersion"},"Version: "+ev),Ue.createElement("div",{className:"listContainer scrollable",ref:"frame"},Ue.createElement("div",{className:"infoFrame"},Ue.createElement("div",{className:"infoText",dangerouslySetInnerHTML:{__html:this.state.info},ref:"info"}),Ue.createElement("div",{className:"licenseText",dangerouslySetInnerHTML:{__html:this.state.license}}),Ue.createElement("div",{className:"privacyText",dangerouslySetInnerHTML:{__html:this.state.privacy},ref:"privacy"}))));return Ue.createElement(bm,nv({},e.props,{id:"infopage",title:"License and Privacy Info",mainContent:t,buttonList:e.buttons}))}}])&&rv(n.prototype,r),o&&rv(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component),cv=uv;function pv(e){return pv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pv(e)}function fv(){return fv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},fv.apply(null,arguments)}function hv(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,mv(r.key),r)}}function mv(e){var t=function(e,t){if("object"!=pv(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=pv(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==pv(t)?t:t+""}function dv(e,t,n){return t=yv(t),function(e,t){if(t&&("object"==pv(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,vv()?Reflect.construct(t,n||[],yv(e).constructor):t.apply(e,n))}function vv(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(vv=function(){return!!e})()}function yv(e){return yv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},yv(e)}function gv(e,t){return gv=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},gv(e,t)}var bv=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=dv(this,t,[e])).state={panel:e.panel,widget:wn()(e.current),parameters:um.getEditableWidgetParameters(e.current.name)},n.insert=n.insert.bind(n),n.showDialog=n.showDialog.bind(n),n.updateWidgetState=n.updateWidgetState.bind(n),n.dialogHelper=Ya(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&gv(e,t)}(t,e),n=t,r=[{key:"insert",value:function(e){this.props.insertCallback&&(this.props.closeCallback(),this.props.insertCallback(this.state.widget,e,this.state.panel))}},{key:"showDialog",value:function(e){this.dialogHelper.showDialog(e)}},{key:"updateWidgetState",value:function(e,t){var n=void 0;if(t){n=e;var r={widget:y()({weight:this.state.widget.weight},n),parameters:um.getEditableWidgetParameters(n.name)};r.parameters.forEach((function(e){e.setDefault(r.widget)})),this.setState(r)}else n=y()({},this.state.widget,e),this.setState({widget:n})}},{key:"changedParameters",value:function(){if(!this.state.parameters)return this.state.widget;var e=$h(this.state.parameters,this.state.widget),t=um.findWidget(this.state.widget),n={};return this.state.parameters.forEach((function(r){var o=r.getValue(e);if(void 0!==o){var i=r.getValue(t);if(f(o,i))return;r.setValue(n,o)}})),["name","weight"].forEach((function(t){void 0!==e[t]&&(n[t]=e[t])})),n}},{key:"render",value:function(){var e=this,t=this,n=void 0!==this.props.current.name,r=this.state.parameters,o="panel";this.props.panel!==this.state.panel&&(o+=" changed");var i=y()({},wn()(um.findWidget(this.state.widget.name)),this.state.widget);return Ue.createElement(Ue.Fragment,null,Ue.createElement("div",{className:"selectDialog editWidgetDialog"},Ue.createElement("h3",{className:"dialogTitle"},this.props.title||"Select Widget"),Ue.createElement(iu,{className:o,dialogRow:!0,label:"Panel",value:this.state.panel,list:function(t){return Vm(e.props.panelList,t)},onChange:function(t){e.setState({panel:t.name})},showDialogFunction:this.showDialog}),n?Ue.createElement("div",{className:"dialogRow info"},Ue.createElement("span",{className:"inputLabel"},"Current"),this.props.current.name):null,void 0!==this.props.weight?Ue.createElement(tu,{className:"weigth",dialogRow:!0,type:"number",label:"Weight",onChange:function(t){return e.updateWidgetState({weight:t})},value:void 0!==this.state.widget.weight?this.state.widget.weight:1}):null,Ue.createElement(iu,{className:"selectElement info",dialogRow:!0,label:"New Widget",onChange:function(t){e.updateWidgetState({name:t.name},!0)},list:function(){return Vm(um.getAvailableWidgets(e.props.types))},value:this.state.widget.name||"-Select Widget-",showDialogFunction:this.showDialog}),r.map((function(e){return Km({param:e,currentValues:i,showDialogFunction:t.dialogHelper.showDialog,onChange:t.updateWidgetState})})),void 0!==this.state.widget.name?Ue.createElement("div",{className:"insertButtons"},n?Ue.createElement(Ia,{name:"before",onClick:function(){return e.insert(!0)}},"Before"):null,n?Ue.createElement(Ia,{name:"after",onClick:function(){return e.insert(!1)}},"After"):null,n?null:Ue.createElement(Ia,{name:"after",onClick:function(){return e.insert(!1)}},"Insert")):null,Ue.createElement("div",{className:"dialogButtons"},this.props.removeCallback&&this.state.panel===this.props.panel?Ue.createElement(Ia,{name:"delete",onClick:function(){e.props.closeCallback(),e.props.removeCallback()}},"Delete"):null,Ue.createElement(Ia,{name:"cancel",onClick:this.props.closeCallback},"Cancel"),this.props.updateCallback?Ue.createElement(Ia,{name:"ok",onClick:function(){e.props.closeCallback();var t=e.changedParameters();e.props.weight?void 0!==t.weight&&(t.weight=parseFloat(t.weight)):t.weight=void 0,e.props.updateCallback(t,e.state.panel)}},"Update"):null)))}}],r&&hv(n.prototype,r),o&&hv(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);bv.propTypes={title:Ge().string,panel:Ge().string,panelList:Ge().array,current:Ge().any,weight:Ge().bool,insertCallback:Ge().func,updateCallback:Ge().func,removeCallback:Ge().func,closeCallback:Ge().func.isRequired,types:Ge().array};var wv=function(e){for(var t in e)void 0===e[t]&&delete e[t];return e};bv.createDialog=function(e,t,n,r){if(!pn.isEditing())return!1;r||(r={});var o=r.beginning?-1:1;return e&&(o=e.index),$a.dialog((function(i){var a=[n];return r.fixPanel||(a=pn.getPagePanels(t)),r.fixPanel instanceof Array&&(a=r.fixPanel),Ue.createElement(bv,fv({},i,{title:"Select Widget",panel:n,types:r.types,panelList:a,current:e||{},weight:r.weight,insertCallback:function(n,i,a){if(n&&n.name){var s=pn.ADD_MODES.noAdd;s=e?i?pn.ADD_MODES.beforeIndex:pn.ADD_MODES.afterIndex:r.beginning?pn.ADD_MODES.beginning:pn.ADD_MODES.end,pn.replaceItem(t,a,o,wv(n),s)}},removeCallback:e?function(){pn.replaceItem(t,n,o)}:void 0,updateCallback:e?function(e,r){r!==n?(pn.replaceItem(t,n,o),pn.replaceItem(t,r,1,wv(e),pn.ADD_MODES.end)):pn.replaceItem(t,n,o,wv(e))}:void 0}))})),!0};var kv=bv;function Cv(){return Cv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Cv.apply(null,arguments)}function Sv(e,t,n){return t=Ov(t),function(e,t){if(t&&("object"==Dv(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Ev()?Reflect.construct(t,n||[],Ov(e).constructor):t.apply(e,n))}function Ev(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ev=function(){return!!e})()}function Ov(e){return Ov=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ov(e)}function Pv(e,t){return Pv=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Pv(e,t)}function Dv(e){return Dv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dv(e)}function Tv(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Nv(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,xv(r.key),r)}}function Rv(e,t,n){return t&&Nv(e.prototype,t),n&&Nv(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function xv(e){var t=function(e,t){if("object"!=Dv(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Dv(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Dv(t)?t:t+""}var jv=[{display:"default",options:[]},{display:"small",options:[pn.OPTIONS.SMALL]},{display:"anchor",options:[pn.OPTIONS.ANCHOR]},{display:"anchor+small",options:[pn.OPTIONS.ANCHOR,pn.OPTIONS.SMALL]}],Av=function(e){var t=[];for(var n in jv){var r=jv[n].options,o=!0;for(var i in r)if(e.indexOf(r[i])<0){o=!1;break}o&&t.push(jv[n])}return t},Lv=function(e,t){var n={};return e.forEach((function(e){n[e]=!t})),n},Iv=function(){return Rv((function e(t,n,r){Tv(this,e),this.pagename=t,this.handledOptions=r,this.basename=n,this.foundCombinations=[]}),[{key:"hasOptionCombination",value:function(e){return!(e<0||e>=this.foundCombinations.length)&&this.foundCombinations[e]}},{key:"fillCombinations",value:function(){var e=Av(this.handledOptions);for(var t in e){var n=e[t],r=pn.getPanelTryList(this.basename,Lv(n.options));pn.getDirectPanelData(this.pagename,r[0])?this.foundCombinations.push(!0):this.foundCombinations.push(!1)}}},{key:"writePanelsToLayout",value:function(){for(var e=Av(this.handledOptions),t=0;t<this.foundCombinations.length;t++){var n=e[t],r=this.foundCombinations[t],o=pn.getPanelTryList(this.basename,Lv(n.options));r?pn.getDirectPanelData(this.pagename,o[0],!0):pn.removePanel(this.pagename,o[0])}}}])}(),Mv=function(e){function t(e){var n,r,o,i,a;return Tv(this,t),(n=Sv(this,t,[e])).state={page:e.page,currentOptions:pn.getOptionValues(e.handledOptions),panelList:(r=e.page,o=e.panelNames,i=e.handledOptions,a={},o.forEach((function(e){var t=new Iv(r,e,i);t.fillCombinations(),a[e]=t})),a),sizeCount:0},n.sizeCount=0,n.setMode=n.setMode.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Pv(e,t)}(t,e),Rv(t,[{key:"getPanelsAsArray",value:function(){var e=[];for(var t in this.state.panelList)e.push(this.state.panelList[t]);return e}},{key:"setMode",value:function(e){var t=y()({},this.state.currentOptions);t[e]=!t[e],this.setState({currentOptions:t})}},{key:"setCombination",value:function(e,t){var n=y()({},this.state.panelList);n[e.basename].foundCombinations[t]=!n[e.basename].foundCombinations[t],this.setState({panelList:n})}},{key:"render",value:function(){var e=this;this.state.panelList;return Ue.createElement(Ue.Fragment,null,Ue.createElement("div",{className:"selectDialog editPageDialog"},Ue.createElement("h3",{className:"dialogTitle"},this.props.title),Ue.createElement("div",{className:"info"},Ue.createElement("span",{className:"label"},"Page:"),this.props.page),Ue.createElement("div",{className:"selectCurrent"},Ue.createElement("div",{className:"currentHeadline"},"Current Conditions"),this.props.handledOptions.map((function(t){return Ue.createElement(nu,{className:"modeSelect",onClick:function(){e.setMode(t)},key:t,label:t,value:e.state.currentOptions[t]})}))),Ue.createElement("div",{className:"panelList"},Ue.createElement("div",{className:"panelHeadline"},"Panel Configurations"),this.getPanelsAsArray().map((function(t){return Ue.createElement("div",{className:"editPanel "+t.basename,key:t.basename.replace(/  */,"")},Ue.createElement("span",{className:"label"},t.basename),Ue.createElement("div",{className:"combinationFrame"},Av(e.props.handledOptions).map((function(n,r){return Ue.createElement(nu,{className:"combinationSelect",onClick:function(){e.setCombination(t,r)},key:n.display,label:n.display,value:t.foundCombinations[r]})}))))}))),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"cancel",onClick:this.props.closeCallback},"Cancel"),Ue.createElement(Ia,{name:"ok",onClick:function(){for(var t in e.props.closeCallback(),e.state.panelList){e.state.panelList[t].writePanelsToLayout()}pn.setTemporaryOptionValues(e.state.currentOptions)}},"Ok"))))}}])}(Ue.Component);Mv.propTypes={title:Ge().string,page:Ge().string,panelNames:Ge().array,supportedOptions:Ge().array,closeCallback:Ge().func.isRequired},Mv.createDialog=function(e,t,n){return!!pn.isEditing()&&($a.dialog((function(r){return Ue.createElement(Mv,Cv({},r,{title:"Edit Page Layout",page:e,panelNames:t,handledOptions:n}))})),!0)},Mv.getButtonDef=function(e,t,n){return{name:"EditPage",editOnly:!0,onClick:function(){Mv.createDialog(e,t,n)}}};var _v=Mv;function Fv(e){return Fv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fv(e)}var Bv=["weight"];function Wv(){return Wv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Wv.apply(null,arguments)}function Hv(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Vv(r.key),r)}}function Vv(e){var t=function(e,t){if("object"!=Fv(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Fv(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Fv(t)?t:t+""}function Kv(e,t,n){return t=qv(t),function(e,t){if(t&&("object"==Fv(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Uv()?Reflect.construct(t,n||[],qv(e).constructor):t.apply(e,n))}function Uv(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Uv=function(){return!!e})()}function qv(e){return qv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},qv(e)}function zv(e,t){return zv=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},zv(e,t)}var Gv=["left","m1","m2","m3","right"];function Zv(){It.resizeByQuerySelector("#gpspage .resize")}var Xv=function(e,t){var n=e.weight;!function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}}(e,Bv);void 0===n&&(n=1);var r=n/t*100;return um.createWidget(e,{style:{height:r+"%"},mode:"gps"})},Jv=function(e,t){var n="gpspage"+t,r=pn.getPanelData(n,e,pn.getOptionValues([pn.OPTIONS.ANCHOR]));return r.page=n,r},Yv=function(e){var t="gpspage"+e;if(!pn.getPageData(t))return!1;var n=Gv;for(var r in n){var o=n[r],i=pn.getPanelData(t,o,pn.getAllOptions());if(i.list&&i.list.length>0)return!0}return!1},Qv=600,$v=600,ey=21,ty=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);n=Kv(this,t,[e]);if(n.buttons=[{name:"Cancel",onClick:function(){n.props.history.pop()}}],n.state={update:1},n.onItemClick=n.onItemClick.bind(n),e.options&&e.options.widget&&!e.options.returning){var r=function(e){var t=[1,2,3,4,5],n=Gv;if(e)for(var r in t)for(var o in n){var i=Jv(n[o],t[r]);if(i&&i.list)for(var a in i.list)if(i.list[a]&&i.list[a].name==e)return t[r]}}(e.options.widget);void 0!==r&&Oe.storeData(ve.gui.gpspage.pageNumber,r)}var o=Oe.getData(ve.gui.gpspage.pageNumber);return void 0!==o&&Yv(o)||Oe.storeData(ve.gui.gpspage.pageNumber,1),n.remoteToken=Xt.subscribe(Gt.gpsNum,(function(e){var t=parseInt(e);t<1||t>5||Yv(t)&&n.setPageNumber(t,!0)})),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&zv(e,t)}(t,e),n=t,(r=[{key:"componentWillUnmount",value:function(){Xt.unsubscribe(this.remoteToken)}},{key:"getButtons",value:function(){var e=this,t=this;return[{name:"GpsCenter",onClick:function(){Wi.centerToGps(),e.props.history.pop()},editDisable:!0},{name:"Gps1",storeKeys:{pageNumber:ve.gui.gpspage.pageNumber,layoutSequence:ve.gui.global.layoutSequence,isEditing:ve.gui.global.layoutEditing},updateFunction:function(e){return{toggle:1==e.pageNumber||void 0===e.pageNumber,visible:Yv(1)||e.isEditing}},onClick:function(){t.setPageNumber(1)},overflow:!0},{name:"Gps2",storeKeys:{pageNumber:ve.gui.gpspage.pageNumber,layoutSequence:ve.gui.global.layoutSequence,isEditing:ve.gui.global.layoutEditing},updateFunction:function(e){return{toggle:2==e.pageNumber,visible:Yv(2)||e.isEditing}},onClick:function(){t.setPageNumber(2)},overflow:!0},{name:"Gps3",storeKeys:{pageNumber:ve.gui.gpspage.pageNumber,layoutSequence:ve.gui.global.layoutSequence,isEditing:ve.gui.global.layoutEditing},updateFunction:function(e){return{toggle:3==e.pageNumber,visible:Yv(3)||e.isEditing}},onClick:function(){t.setPageNumber(3)},overflow:!0},{name:"Gps4",storeKeys:{pageNumber:ve.gui.gpspage.pageNumber,layoutSequence:ve.gui.global.layoutSequence,isEditing:ve.gui.global.layoutEditing},updateFunction:function(e){return{toggle:4==e.pageNumber,visible:Yv(4)||e.isEditing}},onClick:function(){t.setPageNumber(4)},overflow:!0},{name:"Gps5",storeKeys:{pageNumber:ve.gui.gpspage.pageNumber,layoutSequence:ve.gui.global.layoutSequence,isEditing:ve.gui.global.layoutEditing},updateFunction:function(e){return{toggle:5==e.pageNumber,visible:Yv(5)||e.isEditing}},onClick:function(){t.setPageNumber(5)},overflow:!0},ku(),Bd({overflow:!0}),Lm(this.props.history),_v.getButtonDef("gpspage"+Oe.getData(ve.gui.gpspage.pageNumber,0),Gv,[pn.OPTIONS.ANCHOR]),Rm.getButtonDef(),Td.fullScreenDefinition,Vt.buttonDef(),{name:"Cancel",onClick:function(){e.props.history.pop()}}]}},{key:"onItemClick",value:function(e,t,n){if(!kv.createDialog(e,n.page,n.name,{beginning:!1,weight:!0,types:["!map"]}))if(e&&"AisTarget"===e.name){var r=t&&t.mmsi?t.mmsi:e.mmsi;this.props.history.push("aisinfopage",{mmsi:r})}else this.props.history.pop()}},{key:"componentDidMount",value:function(){Zv()}},{key:"componentDidUpdate",value:function(){Zv()}},{key:"setPageNumber",value:function(e,t){Oe.storeData(ve.gui.gpspage.pageNumber,e),t||Xt.sendMessage(Gt.gpsNum,e)}},{key:"render",value:function(){var e=this,t=void 0;Oe.getData(ve.properties.autoHideGpsPage)&&(t=1e3*Oe.getData(ve.properties.hideButtonTime,30));var n=function(t){var n=ey,r=Oe.getData(ve.gui.global.windowDimensions);if(r){var o=r.width-60;if(o>0&&r.height>0){var i=o/Qv||0,a=r.height/$v||0;i>0&&a>0&&(n*=Math.min(a,i))}}var s=[];Gv.forEach((function(t){var r=Jv(t,e.props.pageNum||1);if(r.list){var o=function(e){var t=0;return e?(e.forEach((function(e){void 0!==e.weight?t+=parseFloat(e.weight||0):t+=1})),t):t}(r.list),i={name:t,className:"widgetContainer",itemCreator:function(e){return Xv(e,o)},itemList:r.list,fontSize:n,onItemClick:function(t,n){e.onItemClick(t,n,r)},onClick:function(){kv.createDialog(void 0,r.page,r.name,{beginning:!1,weight:!0,types:["!map"]})},dragdrop:pn.isEditing(),onSortEnd:function(e,t){return pn.moveItem(r.page,r.name,e,t)}};s.push(i)}}));var l=100;s.length&&(l/=s.length);var u=Oe.getData(ve.properties.titleIconsGps);return Ue.createElement(Ue.Fragment,null,u&&Ue.createElement(Su,null),s.map((function(e){return Ue.createElement("div",{className:"hfield",style:{width:l+"%"},key:e.name},Ue.createElement(Ea,e))})))};return Ue.createElement(bm,Wv({},e.props,{id:"gpspage",mainContent:Ue.createElement(n,null),buttonList:e.getButtons(),autoHideButtons:t,buttonWidthChanged:function(){Zv()}}))}}])&&Hv(n.prototype,r),o&&Hv(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);ty.propTypes={pageNum:Ge().number};var ny=ot(ty,{storeKeys:pn.getStoreKeys({pageNum:ve.gui.gpspage.pageNumber})});function ry(e){return ry="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ry(e)}function oy(){return oy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},oy.apply(null,arguments)}function iy(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ay(r.key),r)}}function ay(e){var t=function(e,t){if("object"!=ry(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=ry(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ry(t)?t:t+""}function sy(e,t,n){return t=uy(t),function(e,t){if(t&&("object"==ry(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ly()?Reflect.construct(t,n||[],uy(e).constructor):t.apply(e,n))}function ly(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ly=function(){return!!e})()}function uy(e){return uy=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},uy(e)}function cy(e,t){return cy=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},cy(e,t)}var py=[[{name:"distance",label:"Dst ",unit:"nm",len:6},{name:"cpa",label:"Cpa ",unit:"nm",len:6},{name:"headingTo",label:"Brg ",unit:"°",len:3},{name:"tcpa",label:"Tcpa",unit:"h",len:8}],[{name:"course",label:"Cog ",unit:"°",len:6},{name:"speed",label:"Sog ",unit:"kn",len:6},{name:"heading",label:"Hdg ",unit:"°",len:3}],[{name:"length",label:"Len ",len:6},{name:"beam",label:"Beam",len:6},{name:"draught",label:"Drau",len:8}],[{name:"age",label:"Age ",len:6},{name:"status",label:"Stat"}],[{name:"shiptype",label:"Type"},{name:"aid_type",label:"Type"},{name:"callsign",label:"Call"},{name:"destination",label:"Dest"}]],fy=[py[0]],hy=function(e){var t=Oe.getData(ve.properties.aisReducedList,!0),n=Z,r=n.format("passFront",e),o={color:e.color},i=e.addClass||"";e.initialTarget&&(i+=" initialTarget"),e.warning&&(i+=" "+vy);var a=n.format("clazz",e);""!==a&&(a="["+a+"]");var s="",l=!1;return(t?fy:py).forEach((function(t){l&&(s+="\n"),l=!1,t.forEach((function(t){if(n.shouldShow(t.name,e)){l=!0,s+=(t.label+": ").replace(/ /g," ");var r=n.format(t.name,e)||"";t.len&&(r=function(e,t){var n=new Array(t+1).join(" ")+e;return n.substr(n.length-t)}(r,t.len)),s+=r.replace(/ /g," "),s+="  "}}))})),Ue.createElement("div",{className:"aisListItem "+i,onClick:e.onClick},Ue.createElement("div",{className:"aisItemFB",style:o},Ue.createElement("span",{className:"fb1"},r.substr(0,1)),r.substr(1)),Ue.createElement("div",{className:"aisData"},Ue.createElement("div",{className:"aisData1"},n.format("mmsi",e)," ",n.format("shipname",e)," ",a),Ue.createElement("div",{className:"aisData2"},s)))},my=function(e,t){return f(e,t)},dy=Ue.memo(hy,my),vy="aisWarning",yy=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=n=sy(this,t,[e]);e.options&&e.options.mmsi&&(n.initialMmsi=e.options.mmsi);var o="cpa";return e.options&&e.options.sortField&&(o=e.options.sortField),n.state={sortField:o,searchValue:"",searchActive:!1},n.searchHandler=It.storeHelperState(n,{searchActive:ve.gui.aispage.searchActive,searchValue:ve.gui.aispage.searchValue}),n.scrollWarning=n.scrollWarning.bind(n),n.computeList=n.computeList.bind(n),n.sortDialog=n.sortDialog.bind(n),n.computeSummary=n.computeSummary.bind(n),n.buttons=[{name:"AisNearest",onClick:function(){ml.getAisHandler().setTrackedTarget(0),r.props.history.pop()}},{name:"AisSort",onClick:n.sortDialog},{name:"AisLock",onClick:function(){Oe.storeData(ve.properties.aisListLock,!Oe.getData(ve.properties.aisListLock,!1))},storeKeys:{toggle:ve.properties.aisListLock}},{name:"AisSearch",onClick:function(){n.state.searchActive?n.searchHandler.setMultiple({searchActive:!1}):$a.valueDialogPromise("filter",n.state.searchValue).then((function(e){n.searchHandler.setMultiple({searchValue:e.toUpperCase(),searchActive:!0})})).catch((function(e){}))},toggle:function(){return n.state.searchActive}},Lm(n.props.history),{name:"Cancel",onClick:function(){r.props.history.pop()}}],n.listRef=void 0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&cy(e,t)}(t,e),n=t,(r=[{key:"getSnapshotBeforeUpdate",value:function(e,t){return this.listRef?this.listRef.scrollTop:null}},{key:"componentDidUpdate",value:function(e,t,n){null!=n&&void 0===this.initialMmsi&&this.listRef&&(this.listRef.scrollTop=n)}},{key:"computeSummary",value:function(e){var t={sortField:this.state.sortField||"cpa",numTargets:0,warning:void 0},n=e.list;if(!n||0===n.length)return t;var r=t;for(var o in n){var i=n[o];i.warning&&(r.warning=i.mmsi)}return r.numTargets=n.length,r}},{key:"computeList",value:function(e){var t=this,n=e.list;if(!n)return{itemList:[]};var r,o=e.tracked,i=[],a=(r=this.state.sortField||"cpa",function(e,t){var n=e[r],o=t[r];if("tcpa"==r){if(n<0&&o>=0)return 1;if(o<0&&n>=0)return-1;if(n<0&&o<0)return n<o?1:n>o?-1:0}return n<o?-1:n>o?1:n==o?0:void 0});n.sort(a);var s=function(){var e=n[l];if(!e.mmsi)return 0;if(t.state.searchActive){var r=!1;if(["name","mmsi","callsign","shipname"].forEach((function(n){var o=e[n];o&&(o+"").toUpperCase().indexOf(t.state.searchValue)>=0&&(r=!0)})),!r)return 0}var a=vn.getAisColor({nearest:e.nearest,warning:e.warning}),s=y()({},e,{color:a,key:e.mmsi});s.mmsi==o&&(s.selected=!0),t.initialMmsi&&s.mmsi===t.initialMmsi&&(s.initialTarget=!0),i.push(s)};for(var l in n)s();return{itemList:i}}},{key:"scrollWarning",value:function(e){e&&e.stopPropagation&&e.stopPropagation();var t=document.querySelector(".aisList ."+vy);t&&t.scrollIntoView()}},{key:"sortDialog",value:function(){var e=this;(function(e){var t=[{label:"CPA",value:"cpa"},{label:"TCPA",value:"tcpa"},{label:"DST",value:"distance"}];for(var n in t)t[n].value===e&&(t[n].selected=!0);return $a.selectDialogPromise("Sort Order",t)})(this.state.sortField).then((function(t){e.setState({sortField:t.value}),e.props.history.setOptions({sortField:t.value})})).catch((function(){}))}},{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this,t=this,n=1e3*Oe.getData(ve.properties.aisListUpdateTime,1),r=ot(Ea,{minTime:n}),o=ot((function(e){var n,r,o=vn.getAisColor({warning:!0});return Ue.createElement("div",{className:"aisSummary",onClick:t.sortDialog},Ue.createElement("span",{className:"aisNumTargets"},e.numTargets," Targets"),e.warning&&Ue.createElement("span",{className:vy,style:{backgroundColor:o},onClick:t.scrollWarning}),Ue.createElement("span",null,"sorted by ",(n=t.state.sortField,py.map((function(e){e.map((function(e){e.name==n&&(r=e.label)}))})),r||n)),void 0!==e.searchValue&&Ue.createElement("span",null,"[",e.searchValue,"]"))}),{minTime:n}),i=Oe.getData(ve.properties.aisListLock,!1)?this.computeList(Oe.getMultiple({list:ve.nav.ais.list,tracked:ve.nav.ais.trackedMmsi})):{storeKeys:{updateCount:ve.nav.ais.updateCount,list:ve.nav.ais.list,tracked:ve.nav.ais.trackedMmsi},updateFunction:this.computeList},a=Ue.createElement(Ue.Fragment,null,Ue.createElement(o,{numTargets:0,storeKeys:{updateCount:ve.nav.ais.updateCount,list:ve.nav.ais.list},updateFunction:this.computeSummary,sortField:this.state.sortField,searchValue:this.state.searchActive?this.state.searchValue:void 0}),Ue.createElement(r,oy({itemClass:dy,onItemClick:function(e){t.props.history.setOptions({mmsi:e.mmsi}),t.props.history.replace("aisinfopage",{mmsi:e.mmsi})},className:"aisList"},i,{scrollable:!0,listRef:function(t){if(e.listRef=t,t&&e.initialMmsi){var n=t.querySelector(".initialTarget");if(n){e.initialMmsi=void 0;var r=It.scrollInContainer(t,n);r<1||r>2||n.scrollIntoView(1===r)}}}})));return Ue.createElement(bm,oy({},this.props,{id:"aispage",title:"Ais",mainContent:a,buttonList:t.buttons}))}}])&&iy(n.prototype,r),o&&iy(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);yy.propTypes=bm.pageProperties;var gy=yy;function by(e){return by="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},by(e)}function wy(){return wy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},wy.apply(null,arguments)}function ky(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ny(r.key),r)}}function Cy(e,t,n){return t=Ey(t),function(e,t){if(t&&("object"==by(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Sy()?Reflect.construct(t,n||[],Ey(e).constructor):t.apply(e,n))}function Sy(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Sy=function(){return!!e})()}function Ey(e){return Ey=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ey(e)}function Oy(e,t){return Oy=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Oy(e,t)}function Py(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Dy(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Py(Object(n),!0).forEach((function(t){Ty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Py(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ty(e,t,n){return(t=Ny(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ny(e){var t=function(e,t){if("object"!=by(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=by(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==by(t)?t:t+""}var Ry=[{name:"mmsi",label:"MMSI"},{name:"shipname",label:"Name"},{name:"callsign",label:"Callsign"},{name:"shiptype",label:"Type"},{name:"aid_type",label:"Type"},{name:"clazz",label:"Class"},{name:"status",label:"Status"},{name:"destination",label:"Destination"},{name:"position",label:"Position"},{name:"course",label:"COG(°)"},{name:"speed",label:"SOG(kn)"},{name:"heading",label:"HDG(°)"},{name:"turn",label:"ROT(°/min)"},{name:"headingTo",label:"BRG(°)"},{name:"distance",label:"Distance(nm)"},{name:"cpa",label:"CPA(nm)"},{name:"tcpa",label:"TCPA(h:min:sec)"},{name:"passFront",label:"we pass",addClass:"aisFront"},{name:"length",label:"Length(m)"},{name:"beam",label:"Beam(m)"},{name:"draught",label:"Draught(m)"},{name:"age",label:"Age(s)"}],xy=function(e,t){return function(n){return Dy(t?{current:ml.getAisHandler().getAisByMmsi(t)}:{current:void 0},e)}},jy={aisSequence:ve.nav.ais.updateCount},Ay=Ui(Ea),Ly=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=n=Cy(this,t,[e]);n.buttons=[{name:"AisNearest",onClick:function(){ml.getAisHandler().setTrackedTarget(0);var e=ml.getAisHandler().getAisPositionByMmsi(ml.getAisHandler().getTrackedTarget());e&&Wi.setCenter(e),r.props.history.pop()}},{name:"AisInfoLocate",onClick:function(){if(r.props.options&&r.props.options.mmsi){ml.getAisHandler().setTrackedTarget(r.props.options.mmsi);var e=ml.getAisHandler().getAisPositionByMmsi(r.props.options.mmsi);e&&(Wi.setCenter(e),Wi.setGpsLock(!1)),r.props.history.pop()}}},{name:"AisInfoHide",onClick:function(){r.props.options&&r.props.options.mmsi&&(Oe.getData(ve.gui.aisinfopage.hidden)?ml.getAisHandler().unsetHidden(r.props.options.mmsi):ml.getAisHandler().setHidden(r.props.options.mmsi),r.props.history.pop())},storeKeys:{toggle:ve.gui.aisinfopage.hidden}},{name:"AisInfoList",onClick:function(){var e=(n.props.options||{}).mmsi;r.props.history.backFromReplace()||r.props.history.replace("aispage",{mmsi:e})}},Lm(n.props.history),{name:"Cancel",onClick:function(){r.props.history.backFromReplace(!0)}}],n.checkNoTarget=n.checkNoTarget.bind(n),n.drawIcon=n.drawIcon.bind(n),n.timer=It.lifecycleTimer(n,n.checkNoTarget,5e3,!0);var o=(n.props.options||{}).mmsi;return o&&It.storeHelper(n,(function(){Oe.storeData(ve.gui.aisinfopage.hidden,ml.getAisHandler().isHidden(o))}),jy,!0),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Oy(e,t)}(t,e),n=t,(r=[{key:"checkNoTarget",value:function(e){var t=this.props.options?this.props.options.mmsi:void 0;t&&ml.getAisHandler().getAisByMmsi(t)?this.timer.startTimer(e):this.props.history.pop()}},{key:"drawIcon",value:function(e,t){if(e&&t){var n=new Rr({coordToPixel:function(e){return e},pixelToCoord:function(e){return e}},Oe.getData(ve.properties.style.useHdpi,!1)),r=e.getContext("2d");n.setContext(r);var o=e.getBoundingClientRect();e.width=o.width,e.height=o.height,Wi.aislayer.drawTargetSymbol(n,[o.width/2,o.height/2],t,(function(e,t,n){return t=t/180*Math.PI,[o.width/2*(1+Math.sin(t)),o.height/2*(1-Math.cos(t))]}))}}},{key:"render",value:function(){var e=this,t=ot((function(t){return Ue.createElement("canvas",{className:"status",ref:function(n){e.drawIcon(n,t.current)}})})),n=function(n){return Ue.createElement(Ue.Fragment,null,Ue.createElement(t,{storeKeys:jy,updateFunction:xy({},n.mmsi)}),Ue.createElement(Ay,{itemCreator:function(e){return function(e,t){var n="aisData";return e.addClass&&(n+=" "+e.addClass),ot((function(e){return Z.shouldShow(e.name,e.current)?Ue.createElement("div",{className:"aisInfoRow"},Ue.createElement("div",{className:"label "},e.label),Ue.createElement("div",{className:n},Z.format(e.name,e.current))):null}),{storeKeys:jy,updateFunction:xy(e,t)})}(e,n.mmsi)},itemList:Ry,scrollable:!0,className:"infoList",onClick:function(){e.props.history.backFromReplace()||e.props.history.pop()}}))};return Ue.createElement(bm,wy({},e.props,{id:"aisinfopage",title:"AIS Info",mainContent:Ue.createElement(n,{mmsi:this.props.options?this.props.options.mmsi:void 0}),buttonList:e.buttons}))}}])&&ky(n.prototype,r),o&&ky(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component),Iy=Ly;function My(e){return My="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},My(e)}function _y(){return _y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_y.apply(null,arguments)}function Fy(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,By(r.key),r)}}function By(e){var t=function(e,t){if("object"!=My(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=My(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==My(t)?t:t+""}function Wy(e,t,n){return t=Vy(t),function(e,t){if(t&&("object"==My(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Hy()?Reflect.construct(t,n||[],Vy(e).constructor):t.apply(e,n))}function Hy(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Hy=function(){return!!e})()}function Vy(e){return Vy=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Vy(e)}function Ky(e,t){return Ky=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ky(e,t)}var Uy=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=n=Wy(this,t,[e]);return n.buttons=[Lm(n.props.history),{name:"Back",onClick:function(){window.history.back()}},{name:"Cancel",onClick:function(){r.props.history.pop()}}],n.state={addOns:[]},n.buildButtonList=n.buildButtonList.bind(n),n.props.options&&void 0!==n.props.options.activeAddOn&&Oe.storeData(ve.gui.addonpage.activeAddOn,n.props.options.activeAddOn),void 0===Oe.getData(ve.gui.addonpage.activeAddOn)&&Oe.storeData(ve.gui.addonpage.activeAddOn,0),n.remoteToken=Xt.subscribe(Gt.addOn,(function(e){var t=parseInt(e);t<0||t>=n.state.addOns.length||(Oe.storeData(ve.gui.addonpage.activeAddOn,-1),window.setTimeout((function(){Oe.storeData(ve.gui.addonpage.activeAddOn,t)}),100))})),n.blockIds={},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ky(e,t)}(t,e),n=t,r=[{key:"componentWillUnmount",value:function(){for(var e in Xt.unsubscribe(this.remoteToken),this.blockIds)il.removeBlock(e);this.blockIds={}}},{key:"blockAlarm",value:function(e){for(var t in this.blockIds)if(this.blockIds[t]===e)return;this.blockIds[il.addBlock(e)]=e}},{key:"unblockAlarm",value:function(e){for(var t in this.blockIds)if(this.blockIds[t]===e)return il.removeBlock(t),void delete this.blockIds[t]}},{key:"componentDidMount",value:function(){var e=this;_m(!0).then((function(t){var n=Oe.getData(ve.gui.addonpage.activeAddOn);if(e.props.options&&e.props.options.addonName)for(var r=0;r<t.length;r++)if(t[r].name==e.props.options.addonName){r!=n&&(n=r,Oe.storeData(ve.gui.addonpage.activeAddOn,r));break}(void 0===n||n<0||n>=t.length)&&Oe.storeData(ve.gui.addonpage.activeAddOn,0),e.setState({addOns:t})})).catch((function(){}))}},{key:"buildButtonList",value:function(e,t){var n=[];if(e)for(var r=function(r){var o=e[r],i={name:o.key,icon:o.icon,onClick:function(){Xt.sendMessage(Gt.addOn,r),"true"!==o.newWindow?(Oe.storeData(ve.gui.addonpage.activeAddOn,-1),window.setTimeout((function(){Oe.storeData(ve.gui.addonpage.activeAddOn,r)}),100)):window.open(o.url,o.key)},toggle:t==r,overflow:!0,visible:"true"!==o.newWindow||o.url.match(/^http/)||!Oe.getData(ve.gui.global.onAndroid,!1)};n.push(i)},o=0;o<e.length;o++)r(o);return this.buttons.concat(n)}},{key:"render",value:function(){var e=this,t=this,n=ot((function(n){var r={};t.state.addOns&&(r=t.state.addOns[n.activeAddOn||0]||{});var o=r.url;if(o&&!r.keepUrl){var i="_="+(new Date).getTime();o.match(/\?/)?o+="&"+i:o+="?"+i}r.preventConnectionLost?e.blockAlarm("connectionLost"):e.unblockAlarm("connectionLost");var a="true"===r.newWindow,s=ca((function(e){return Ue.createElement("div",{className:"addOnFrame"},r.url&&!a?Ue.createElement("iframe",{src:o,className:"addOn"}):null)}));return Ue.createElement(bm,_y({},t.props,{id:"addonpage",title:a?"":r.title,mainContent:Ue.createElement(s,null),buttonList:t.buildButtonList(t.state.addOns,n.activeAddOn||0)}))}),{storeKeys:{activeAddOn:ve.gui.addonpage.activeAddOn}});return Ue.createElement(n,null)}}],r&&Fy(n.prototype,r),o&&Fy(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component),qy=Uy,zy=n(42401),Gy=n.n(zy);function Zy(e){return Zy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zy(e)}function Xy(){return Xy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Xy.apply(null,arguments)}function Jy(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Yy(r.key),r)}}function Yy(e){var t=function(e,t){if("object"!=Zy(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Zy(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Zy(t)?t:t+""}function Qy(e,t,n){return t=eg(t),function(e,t){if(t&&("object"==Zy(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,$y()?Reflect.construct(t,n||[],eg(e).constructor):t.apply(e,n))}function $y(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return($y=function(){return!!e})()}function eg(e){return eg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},eg(e)}function tg(e,t){return tg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},tg(e,t)}var ng=function(e){var t="http://"+e.value;return Ue.createElement("div",{className:"address"},Ue.createElement("div",{className:"url"},t),Ue.createElement(Gy(),{value:t}))},rg=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);n=Qy(this,t,[e]);return n.buttons=[{name:"AndroidBrowser",visible:Oe.getData(ve.gui.global.onAndroid),onClick:function(){avnav.android.launchBrowser()}},Lm(n.props.history),{name:"Cancel",onClick:function(){n.props.history.pop()}}],n.querySequence=1,n.doQuery=n.doQuery.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tg(e,t)}(t,e),n=t,(r=[{key:"doQuery",value:function(){var e=this.querySequence,t=this;wt.getJson("?request=status",{checkOk:!1}).then((function(n){if(t.querySequence==e){var r=[];n.handler&&n.handler.forEach((function(e){if(e.properties&&e.properties.addresses)for(var t=0;t<e.properties.addresses.length;t++)r.push(e.properties.addresses[t])})),Oe.storeData(ve.gui.addresspage.addressList,r),t.timer=window.setTimeout(t.doQuery,Oe.getData(ve.properties.statusQueryTimeout))}}),(function(n){t.querySequence==e&&(Oe.storeData(ve.gui.addresspage.addressList,[]),t.timer=window.setTimeout(t.doQuery,Oe.getData(ve.properties.statusQueryTimeout)))}))}},{key:"componentDidMount",value:function(){this.querySequence++,this.doQuery()}},{key:"componentWillUnmount",value:function(){var e=this;e.timer&&(window.clearTimeout(e.timer),delete e.timer),e.querySequence++}},{key:"render",value:function(){var e=ot((function(e){if(!e.addressList||e.addressList.length<1)return null;var t=[];return e.addressList.forEach((function(e){t.push({name:e,value:e})})),Ue.createElement(Ea,{itemList:t,itemClass:ng,scrollable:!0})}));return Ue.createElement(bm,Xy({},this.props,{id:"addresspage",title:"Server Addresses",mainContent:Ue.createElement(e,{storeKeys:{addressList:ve.gui.addresspage.addressList}}),buttonList:this.buttons}))}}])&&Jy(n.prototype,r),o&&Jy(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component),og=rg;function ig(e){return ig="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ig(e)}function ag(){return ag=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ag.apply(null,arguments)}function sg(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,lg(r.key),r)}}function lg(e){var t=function(e,t){if("object"!=ig(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=ig(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ig(t)?t:t+""}function ug(e,t,n){return t=pg(t),function(e,t){if(t&&("object"==ig(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,cg()?Reflect.construct(t,n||[],pg(e).constructor):t.apply(e,n))}function cg(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(cg=function(){return!!e})()}function pg(e){return pg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},pg(e)}function fg(e,t){return fg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},fg(e,t)}var hg=function(e){var t=function(t){return Ue.createElement("div",{className:"flexInner HelpDialog"},Ue.createElement("div",{className:"dialogRow infoText"},e.param.description),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"ok",onClick:function(){return t.closeCallback()}},"Ok")))};return Ue.createElement(ds,{name:"help",className:"Help smallButton",onClick:function(n){n.stopPropagation(),n.preventDefault(),e.param&&e.param.description&&e.showDialog(t)}})},mg=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=ug(this,t,[e])).state={loaded:!1,parameters:void 0,handlerId:e.handlerId},n.currentValues=Lt(n,{},"current"),n.modifiedValues=Lt(n,{},"modified"),n.dialogHelper=Ya(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&fg(e,t)}(t,e),n=t,r=[{key:"componentDidMount",value:function(){var e=this,t={request:"api",type:"config",handlerId:this.state.handlerId,handlerName:this.props.handlerName};this.props.addHandler?t.command="getAddAttributes":(t.command="getEditables",void 0!==this.props.child&&(t.child=this.props.child)),wt.getJson("",void 0,t).then((function(t){var n={};void 0===e.props.handlerId&&void 0!==t.handlerId&&(n.handlerId=t.handlerId);var r=[];t.data.forEach((function(e){var t=e.type;"FILTER"===t&&(t="STRING"),"FLOAT"===t&&(t="NUMBER");var n=xh(e.name,t,e.rangeOrList,e.name);n&&(n.default=e.default,n.mandatory=e.mandatory,n.description=e.description,n.condition=e.condition,r.push(n))})),n.loaded=!0,n.parameters=r,n.name=t.configName||e.props.handlerName,n.canDelete=t.canDelete,e.setState(n),e.currentValues.setState(t.values||{}),e.props.initialValues&&e.modifiedValues.setState(e.props.initialValues)})).catch((function(t){ct(t),e.props.closeCallback()}))}},{key:"getRequestParam",value:function(e){var t=y()({request:"api",type:"config",handlerId:this.state.handlerId},e);return void 0!==this.props.child&&(t.child=this.props.child),t}},{key:"updateValues",value:function(){var e=this,t=this.getRequestParam({command:"setConfig"});wt.postJson("",this.modifiedValues.getState(),void 0,t).then((function(t){e.props.closeCallback()})).catch((function(e){return ct(e)}))}},{key:"deleteHandler",value:function(){var e=this,t="really delete handler "+this.state.name||0;this.props.child&&(t="really delete "+this.props.child+"?");var n=$a.createConfirmDialog(t,(function(){var t=e.getRequestParam({command:void 0!==e.props.child?"deleteChild":"deleteHandler"});wt.getJson("",void 0,t).then((function(){return e.props.closeCallback()})).catch((function(e){return ct(e)}))}));this.dialogHelper.showDialog(n)}},{key:"addHandler",value:function(){var e=this,t=this.getRequestParam({handlerName:this.props.handlerName,command:"createHandler"});wt.postJson("",this.modifiedValues.getState(),void 0,t).then((function(t){e.props.createdCallback&&e.props.createdCallback(t.id),e.props.closeCallback()})).catch((function(e){return ct(e)}))}},{key:"modifyValues",value:function(e){var t=y()(this.modifiedValues.getState(!0),e),n=this.currentValues.getState();for(var r in n)t[r]!==n[r]&&t[r]+""!=n[r]+""||delete t[r];this.modifiedValues.setState(t,!0)}},{key:"checkCondition",value:function(e,t){for(var n in e instanceof Array||(e=[e]),e){var r=!0;for(var o in e[n]){var i=e[n][o],a=void 0,s=!1;for(var l in this.state.parameters)if(this.state.parameters[l].name===o){a=this.state.parameters[l].getValueForDisplay(t),s=!0;break}if(s||(a=t[o]),"string"==typeof i&&i.match(/^!/)){if(void 0===a&&"!"===i){r=!1;break}if(i.substr(1)==a){r=!1;break}}else if(i!=a){r=!1;break}}if(r)return!0}return!1}},{key:"render",value:function(){var e=this,t=y()({},this.currentValues.getState(),this.modifiedValues.getState()),n=this.state.name||"";return this.props.child&&(n+=":"+this.props.child),Ue.createElement(Ue.Fragment,null,Ue.createElement("div",{className:"selectDialog EditHandlerDialog"},Ue.createElement("h3",{className:"dialogTitle"},this.props.title||"Edit Handler"),Ue.createElement("div",{className:"dialogRow"},n),this.state.loaded?Ue.createElement(Ue.Fragment,null,this.state.parameters.map((function(n){var r=!n.mandatoryOk(t),o=Ue.createElement("div",{className:"paramButtons"},n.description&&Ue.createElement(hg,{param:n,showDialog:e.dialogHelper.showDialog}),void 0!==n.default&&Ue.createElement(ds,{name:"Delete",className:"smallButton",onClick:function(t){t.stopPropagation();var r={};r[n.name]=n.default,e.modifyValues(r)}}));return n.condition&&!e.checkCondition(n.condition,t)?null:Km({param:n,currentValues:t,showDialogFunction:e.dialogHelper.showDialog,onChange:function(t){return e.modifyValues(t)},className:r?"missing":"",children:o})}))):Ue.createElement("div",{className:"loadingIndicator"}),Ue.createElement("div",{className:"dialogButtons"},this.state.canDelete?Ue.createElement(Ia,{name:"delete",onClick:function(){e.deleteHandler()}},"Delete"):null,Ue.createElement(Ia,{name:"cancel",onClick:this.props.closeCallback},"Cancel"),Ue.createElement(Ia,{name:"ok",onClick:function(){e.props.addHandler?e.addHandler():e.updateValues()}},"Ok"))))}}],r&&sg(n.prototype,r),o&&sg(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);mg.propTypes={title:Ge().string,handlerId:Ge().oneOfType([Ge().string,Ge().number]),childId:Ge().string,handlerName:Ge().string,closeCallback:Ge().func.isRequired,initialValues:Ge().object,createdCallback:Ge().func,addHandler:Ge().bool};mg.createDialog=function(e,t,n,r){return $a.dialog((function(n){return Ue.createElement(mg,ag({},n,{title:"Edit Handler",handlerId:e,handlerName:r,child:t}))}),void 0,n),!0},mg.createNewHandlerDialog=function(e,t,n){$a.dialog((function(r){return Ue.createElement(mg,ag({},r,{title:"Add Handler",handlerName:e,initialValues:t,createdCallback:n,addHandler:!0}))}),void 0)},mg.createAddDialog=function(e){wt.getJson("",void 0,{request:"api",type:"config",command:"getAddables"}).then((function(t){if(!t.data||t.data.length<1)ct("no handlers can be added");else{var n=[];t.data.forEach((function(e){return n.push({label:e,value:e})})),$a.selectDialogPromise("Select Handler to Add",n).then((function(t){mg.createNewHandlerDialog(t.value,void 0,e)})).catch((function(e){}))}})).catch((function(e){return ct(e)}))};var dg=mg;function vg(e){return vg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vg(e)}function yg(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,gg(r.key),r)}}function gg(e){var t=function(e,t){if("object"!=vg(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=vg(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==vg(t)?t:t+""}function bg(e,t,n){return t=kg(t),function(e,t){if(t&&("object"==vg(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,wg()?Reflect.construct(t,n||[],kg(e).constructor):t.apply(e,n))}function wg(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(wg=function(){return!!e})()}function kg(e){return kg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},kg(e)}function Cg(e,t){return Cg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Cg(e,t)}var Sg=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=bg(this,t,[e])).state={log:void 0,loading:!0,autoreload:e.autoreload},n.downloadFrame=null,n.mainref=null,n.getLog=n.getLog.bind(n),n.timer=new It.lifecycleTimer(n,(function(e){n.state.autoreload?n.getLog().then((function(){return n.timer.startTimer(e)})):n.timer.startTimer(e)}),5e3,!0),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Cg(e,t)}(t,e),n=t,r=[{key:"componentDidMount",value:function(){this.getLog().then((function(){}))}},{key:"componentDidUpdate",value:function(e,t,n){this.mainref&&(this.mainref.scrollTop=this.mainref.scrollHeight)}},{key:"getLog",value:function(){var e=this;return wt.getHtmlOrText(this.props.baseUrl,{useNavUrl:!1},{maxBytes:this.props.maxBytes||5e5}).then((function(t){return e.setState({log:t}),t})).catch((function(e){return ct(e)}))}},{key:"render",value:function(){var e=this;return Ue.createElement("div",{className:"selectDialog LogDialog"},Ue.createElement("h3",{className:"dialogTitle"},this.props.title||"AvNav log"),Ue.createElement("div",{className:"logDisplay dialogRow",ref:function(t){return e.mainref=t}},this.state.log||""),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"autoreload",onClick:function(){return e.setState((function(e){return{autoreload:!e.autoreload}}))},toggle:this.state.autoreload},"Auto"),Ue.createElement(Ia,{name:"download",onClick:function(){var t=e.props.dlname?e.props.dlname:"avnav-"+W.formatDateTime(new Date).replace(/[: /]/g,"-").replace(/--/g,"-")+".log",n=e.props.baseUrl+"&filename="+encodeURIComponent(t);e.downloadFrame&&(e.downloadFrame.src=n)}},"Download"),Ue.createElement(Ia,{name:"reload",onClick:this.getLog},"Reload"),Ue.createElement(Ia,{name:"ok",onClick:this.props.closeCallback},"Ok")),Ue.createElement("iframe",{className:"downloadFrame",onLoad:function(e){var t=e.target.contentDocument.body.textContent;t&&ct(t)},src:void 0,ref:function(t){return e.downloadFrame=t}}))}}],r&&yg(n.prototype,r),o&&yg(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);function Eg(){return Eg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Eg.apply(null,arguments)}Sg.propTypes={baseUrl:Ge().string.isRequired,title:Ge().string,maxBytes:Ge().number,dlname:Ge().string,autoreload:Ge().bool};var Og=function(e){var t=Oe.getData(ve.properties.statusIcons[e]);return t||(t=Oe.getData(ve.properties.statusIcons.INACTIVE)),t},Pg=function(e){return Ue.createElement(ds,{name:"Edit",className:"Edit smallButton editIcon",onClick:e.onClick})},Dg=function(e){var t=e.canEdit&&e.connected,n=e.sub||e.name&&e.name.match(/:#:/),r=n?e.name.replace(/^.*:#:/,""):e.name,o="childStatus";return n&&(o+=" sub"),Ue.createElement("div",{className:o,onClick:e.onClick},Ue.createElement("img",{src:Og(e.status)}),Ue.createElement("span",{className:"statusName"},r),Ue.createElement("span",{className:"statusInfo"},e.info),(e.forceEdit||t&&!n)&&Ue.createElement(Pg,{onClick:function(){return e.showEditDialog(e.handlerId,e.id,e.finishCallback)}}))},Tg=function(e){var t=e.canEdit&&e.connected&&e.allowEdit,n=e.disabled,r=e.name.replace(/\[.*\]/,"");void 0!==e.id&&(r="["+e.id+"]"+r);var o="status";e.requestFocus&&(o+=" requestFocus");var i=e.info&&e.info.items?e.info.items:[];return i.sort((function(e,t){return e.name>t.name?1:e.name<t.name?-1:0})),Ue.createElement("div",{className:o,key:e.id},Ue.createElement("div",{className:"statusHeading"+(n?" disabled":"")},Ue.createElement("span",{className:"statusName"},r),n&&Ue.createElement("span",{className:"disabledInfo"},"[disabled]"),t&&Ue.createElement(Pg,{onClick:function(){return e.showEditDialog(e.id,void 0,e.finishCallback)}})),i.map((function(t){return Ue.createElement(Dg,Eg({},t,{key:e.name+t.name,connected:e.connected,handlerId:e.id,finishCallback:e.finishCallback,showEditDialog:e.showEditDialog}))})))};function Ng(){return Ng=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ng.apply(null,arguments)}function Rg(e,t,n){return t=jg(t),function(e,t){if(t&&("object"==Ig(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,xg()?Reflect.construct(t,n||[],jg(e).constructor):t.apply(e,n))}function xg(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(xg=function(){return!!e})()}function jg(e){return jg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},jg(e)}function Ag(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Lg(e,t)}function Lg(e,t){return Lg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Lg(e,t)}function Ig(e){return Ig="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ig(e)}function Mg(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Bg(r.key),r)}}function Fg(e,t,n){return t&&_g(e.prototype,t),n&&_g(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Bg(e){var t=function(e,t){if("object"!=Ig(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Ig(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Ig(t)?t:t+""}var Wg=function(){return Fg((function e(){Mg(this,e),this.callbacks={}}),[{key:"register",value:function(e){e?this.callbacks[e]=e:delete this.callbacks[e]}},{key:"trigger",value:function(e,t){var n=this,r=function(){for(var e in n.callbacks)n.callbacks[e]&&n.callbacks[e](t)};e?window.setTimeout(r,e):r()}}])}(),Hg=function(e){function t(e){var n;return Mg(this,t),(n=Rg(this,t,[e])).state={isDebug:!1,pattern:"",timeout:60},n.save=n.save.bind(n),n}return Ag(t,e),Fg(t,[{key:"componentDidMount",value:function(){var e=this;wt.getJson("",void 0,{request:"currentloglevel"}).then((function(t){var n={};n.isDebug=t.level&&t.level.match(/debug/i),n.pattern=t.filter||"",e.setState(n)})).catch((function(e){return ct(e)}))}},{key:"save",value:function(){var e=this;wt.getJson("",void 0,{request:"debuglevel",level:this.state.isDebug?"debug":"info",timeout:this.state.timeout,filter:this.state.pattern||""}).then((function(){return e.props.closeCallback()})).catch((function(e){return ct(e)}))}},{key:"render",value:function(){var e=this;return Ue.createElement("div",{className:"selectDialog DebugDialog"},Ue.createElement("h3",{className:"dialogTitle"},this.props.title||"Enable/Disable Debug"),Ue.createElement(nu,{dialogRow:!0,label:"debug",value:this.state.isDebug,onChange:function(t){return e.setState({isDebug:t})}}),Ue.createElement(tu,{type:"number",label:"timeout(s)",dialogRow:!0,value:this.state.timeout,onChange:function(t){return e.setState({timeout:t})}}),Ue.createElement(tu,{label:"pattern",dialogRow:!0,value:this.state.pattern,onChange:function(t){return e.setState({pattern:t})}}),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"cancel",onClick:this.props.closeCallback},"Cancel"),Ue.createElement(Ia,{name:"ok",onClick:this.save},"Ok")))}}])}(Ue.Component),Vg=function(e,t,n){dg.createDialog(e,t,n)},Kg=function(e){function t(e){var n;return Mg(this,t),(n=Rg(this,t,[e])).querySequence=1,n.doQuery=n.doQuery.bind(n),n.queryResult=n.queryResult.bind(n),n.errors=0,n.timer=It.lifecycleTimer(n,n.doQuery,Oe.getData(ve.properties.statusQueryTimeout),!0),n.mainListRef=null,n.state={itemList:[]},n.defaults={addresses:!1,wpa:!1,shutdown:!1,serverError:!1},n.props.reloadNotifier&&n.props.reloadNotifier.register((function(e){return n.retriggerQuery(e)})),n.focusItem=void 0,n}return Ag(t,e),Fg(t,[{key:"componentWillUnmount",value:function(){this.props.reloadNotifier&&this.props.reloadNotifier.register(void 0)}},{key:"queryResult",value:function(e,t){var n=[],r=y()({},this.defaults);this.errors=0,e.handler&&e.handler.forEach((function(e){e.properties&&e.properties.addresses&&(r.addresses=!0),"AVNWpaHandler"===e.configname&&(r.wpa=!0),"AVNCommandHandler"===e.configname&&e.properties&&e.properties.shutdown&&(r.shutdown=!0),e.key=e.displayKey||e.id,void 0!==t&&t===e.id&&(e.requestFocus=!0),n.push(e)})),this.props.onChange&&this.props.onChange(r),this.setState({itemList:n})}},{key:"retriggerQuery",value:function(e){this.timer.stopTimer(),this.doQuery(void 0,e)}},{key:"doQuery",value:function(e,t){var n=this,r=this;wt.getJson("?request=status",{checkOk:!1}).then((function(n){r.timer.guardedCall(e,(function(){r.queryResult(n,t),r.timer.startTimer(e)}))}),(function(t){n.timer.guardedCall(e,(function(){if(r.errors++,r.errors>4){var t={itemList:[],serverError:!0};n.props.onChange&&n.props.onChange({serverError:!0}),n.setState(t)}r.timer.startTimer(e)}))}))}},{key:"getSnapshotBeforeUpdate",value:function(e,t){return this.mainListRef?{x:this.mainListRef.scrollLeft,y:this.mainListRef.scrollTop}:null}},{key:"componentDidUpdate",value:function(e,t,n){if(n&&this.mainListRef&&(this.mainListRef.scrollLeft=n.x,this.mainListRef.scrollTop=n.y),this.mainListRef){var r=this.mainListRef.querySelector(".requestFocus");if(r){var o=It.scrollInContainer(this.mainListRef,r);o>=1&&o<=2&&r.scrollIntoView(1===o)}}}},{key:"render",value:function(){var e=this;return Ue.createElement(Ea,{itemClass:function(t){return Ue.createElement(Tg,Ng({connected:e.props.connected,allowEdit:e.props.allowEdit,finishCallback:function(){window.setTimeout((function(){return e.retriggerQuery()}),1e3)},showEditDialog:Vg},t))},itemList:this.state.itemList,scrollable:!0,listRef:function(t){return e.mainListRef=t}})}}])}(Ue.Component);Kg.propTypes={onChange:Ge().func,connected:Ge().bool,allowEdit:Ge().bool,reloadNotifier:Ge().instanceOf(Wg)};var Ug=function(e){function t(e){var n;Mg(this,t);n=Rg(this,t,[e]);return n.state={addresses:!1,wpa:!1,shutdown:!1,serverError:!1,canRestart:!1},n.reloadNotifier=new Wg,n}return Ag(t,e),Fg(t,[{key:"componentDidMount",value:function(){var e=this;Oe.getData(ve.gui.capabilities.config)&&wt.getJson("",void 0,{request:"api",type:"config",command:"canRestart"}).then((function(t){e.setState({canRestart:t.canRestart})})).catch((function(e){return ct(e)}))}},{key:"componentWillUnmount",value:function(){}},{key:"restartServer",value:function(){$a.confirm("really restart the AvNav server software?").then((function(e){wt.getJson("",void 0,{request:"api",type:"config",command:"restartServer"}).then((function(){return ct("restart triggered")})).catch((function(e){return ct(e)}))})).catch((function(e){}))}},{key:"render",value:function(){var e=this,t=ot((function(t){var n=[{name:"StatusWpa",visible:e.state.wpa&&t.connected,onClick:function(){e.props.history.push("wpapage")}},{name:"StatusAddresses",visible:e.state.addresses,onClick:function(){e.props.history.push("addresspage")}},{name:"StatusAndroid",visible:t.android,onClick:function(){avnav.android.showSettings()}},{name:"AndroidBrowser",visible:t.android&&e.state.addresses,onClick:function(){avnav.android.launchBrowser()}},{name:"MainInfo",onClick:function(){e.props.history.push("infopage")},overflow:!0},{name:"StatusShutdown",visible:!t.android&&e.state.shutdown&&t.connected,onClick:function(){$a.confirm("really shutdown the server computer?").then((function(){wt.getJson("?request=command&start=shutdown").then((function(e){ct("shutdown started")}),(function(e){$a.alert("unable to trigger shutdown: "+e)}))})).catch((function(){}))}},{name:"StatusRestart",visible:e.state.canRestart&&t.connected,onClick:function(){return e.restartServer()}},{name:"StatusLog",visible:t.log,onClick:function(){$a.dialog((function(e){return Ue.createElement(Sg,Ng({},e,{baseUrl:Oe.getData(ve.properties.navUrl)+"?request=download&type=config",title:"AvNav Log"}))}))},overflow:!0},{name:"StatusDebug",visible:t.debugLevel&&t.connected,onClick:function(){$a.dialog(Hg)},overflow:!0},{name:"StatusAdd",visible:t.config&&t.connected,onClick:function(){dg.createAddDialog((function(t){return e.reloadNotifier.trigger(1e3,t)}))}},Lm(e.props.history),{name:"Cancel",onClick:function(){e.props.history.pop()}}],r=t.className;e.state.serverError&&(r+=" serverError");var o=d.filteredAssign(bm.pageProperties,e.props);return Ue.createElement(bm,Ng({},o,{className:r,id:"statuspage",title:e.state.serverError?"Server Connection lost":"Server Status",mainContent:Ue.createElement(Kg,{connected:t.connected,allowEdit:t.config,onChange:function(t){return window.setTimeout((function(){return e.setState((function(e,n){var r=d.filteredAssign(t,e);return f(t,r)?null:t}))}),1)},reloadNotifier:e.reloadNotifier}),buttonList:n}))}),{storeKeys:{connected:ve.properties.connectedMode,android:ve.gui.global.onAndroid,config:ve.gui.capabilities.config,log:ve.gui.capabilities.log,debugLevel:ve.gui.capabilities.debugLevel}});return Ue.createElement(t,null)}}])}(Ue.Component),qg=Ug;function zg(e){return zg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zg(e)}function Gg(){return Gg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Gg.apply(null,arguments)}function Zg(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Xg(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Yg(r.key),r)}}function Jg(e,t,n){return t&&Xg(e.prototype,t),n&&Xg(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Yg(e){var t=function(e,t){if("object"!=zg(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=zg(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==zg(t)?t:t+""}function Qg(e,t,n){return t=eb(t),function(e,t){if(t&&("object"==zg(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,$g()?Reflect.construct(t,n||[],eb(e).constructor):t.apply(e,n))}function $g(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return($g=function(){return!!e})()}function eb(e){return eb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},eb(e)}function tb(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&nb(e,t)}function nb(e,t){return nb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},nb(e,t)}var rb=function(e){var t=e.level;try{t=parseInt(t)}catch(e){}t+=t>=0?"%":"dBm";var n=void 0!==e.flags&&e.flags.match(/DISABLED/),r=e.activeItem?"activeEntry":"";return Ue.createElement("div",{className:"listEntry wpaNetwork "+r,onClick:e.onClick},Ue.createElement("span",{className:"ssid"},e.ssid),Ue.createElement("div",{className:"detailsContainer"},Ue.createElement("span",{className:"detail"},"Signal:",t),Ue.createElement("span",{className:"detail"},e.id>=0?"configured":""),n&&Ue.createElement("span",{className:"detail"},"disabled"),e.allowAccess&&e.showAccess&&Ue.createElement("span",{className:"detail"},"ext access"),e.activeItem&&Ue.createElement("span",{className:"detail"},"active")))},ob=function(e){var t=e.interface||{};if(!t.wpa_state)return Ue.createElement("div",null,"Waiting for interface...");var n=t.ssid?"["+t.ssid+"]":"",r=e.showAccess;return t.ip_address?(n+=", IP: "+t.ip_address,t.allowAccess&&r&&(n+=", ext access"),r&&(n+=", firewall "+(0===t.fwStatus?"ok":"failed"))):n+=" waiting for IP...",Ue.createElement("div",{className:"wpaInterface"},Ue.createElement("div",null,"Interface: ",t.wpa_state),"COMPLETED"==t.wpa_state&&Ue.createElement("div",{className:"detail"},n))},ib=function(e){function t(e){var n;return Zg(this,t),(n=Qg(this,t,[e])).state={psk:"",allowAccess:e.allowAccess||!1},n.buttonClick=n.buttonClick.bind(n),n}return tb(t,e),Jg(t,[{key:"buttonClick",value:function(e){var t=e.target.name;this.props.closeCallback(),"cancel"!=t&&this.props.resultCallback(t,this.state.psk,this.state.allowAccess)}},{key:"render",value:function(){var e=this.props.id,t=this;return Ue.createElement("div",{className:"wpaDialog inner"},Ue.createElement("div",null,Ue.createElement("h3",null,Ue.createElement("span",null,this.props.ssid)),Ue.createElement(tu,{dialogRow:!0,label:"Password",type:"password",name:"psk",onChange:function(e){return t.setState({psk:e})},value:this.state.psk}),this.props.showAccess?Ue.createElement(nu,{dialogRow:!0,onChange:function(e){return t.setState({allowAccess:e})},label:"External access",value:this.state.allowAccess}):null,Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"cancel",onClick:this.buttonClick},"Cancel"),e>=0&&Ue.createElement(Ia,{name:"remove",onClick:this.buttonClick},"Remove"),e>=0&&Ue.createElement(Ia,{name:"enable",onClick:this.buttonClick},"Enable"),e>=0&&Ue.createElement(Ia,{name:"disable",onClick:this.buttonClick},"Disable"),Ue.createElement(Ia,{name:"connect",onClick:this.buttonClick},"Connect"))))}}])}(Ue.Component);ib.propTypes={closeCallback:Ge().func.isRequired,resultCallback:Ge().func.isRequired,showAccess:Ge().bool};var ab="list",sb=function(e){function t(e){var n;Zg(this,t),(n=Qg(this,t,[e])).state={interface:void 0,showAccess:void 0};return n.buttons=[Lm(n.props.history),{name:"Cancel",onClick:function(){n.props.history.pop()}}],n.itemClick=n.itemClick.bind(n),n.timer=It.lifecycleTimer(n,n.doQuery,4e3,!0),n.numErrors=0,n.listItemStore=new Ee("wpaList"),n.listItemStore.storeData(ab,[]),n.ItemList=ot(Ea,void 0,n.listItemStore),n.listRef=void 0,n}return tb(t,e),Jg(t,[{key:"getSnapshotBeforeUpdate",value:function(e,t){return this.listRef?this.listRef.scrollTop:null}},{key:"componentDidUpdate",value:function(e,t,n){if(null!=n){if(!this.listRef)return;this.listRef.scrollTop=n}}},{key:"doQuery",value:function(e){var t=this,n=this;wt.getJson("?request=wpa&command=all",{sequenceFunction:this.timer.currentSequence,timeout:3600,checkOk:!1}).then((function(r){n.numErrors=0,t.setState({interface:r.status,showAccess:r.showAccess});var o=[];if(r.status&&r.list)for(var i in r.list){var a=r.list[i],s=a.ssid;if(void 0!==s){var l={};l.ssid=s,l.key=s,l.name=s,l.allowAccess=a.allowAccess,l.showAccess=r.showAccess,l.id=a["network id"],l.level=a["signal level"],l.flags=a.flags+" "+a["network flags"],void 0===l.id&&(l.id=-1),r.status.ssid&&a.ssid==r.status.ssid&&(l.activeItem=!0),o.push(l)}}t.listItemStore.storeData(ab,o),n.timer.startTimer(e)})).catch((function(t){n.numErrors++,n.numErrors>3&&(n.numErrors=0,ct("Status query error: "+d.escapeHtml(t))),n.timer.startTimer(e)}))}},{key:"wpaRequest",value:function(e,t,n){ct("sending "+t),wt.getJson("?request=wpa&command="+e,{},n).then((function(e){})).catch((function(e){ct(t+"...Error")}))}},{key:"itemClick",value:function(e,t){var n=this;if(e&&e.ssid&&void 0!==e.id){var r=function(t,r,o){var i={id:e.id,ssid:e.ssid};return"connect"==t?(i.psk=r,o&&(i.allowAccess=o),void n.wpaRequest("connect","connect to "+d.escapeHtml(i.ssid),i)):"enable"==t?(o&&(i.allowAccess=o),r&&""!=r&&(i.psk=r),void n.wpaRequest(t,t+" "+d.escapeHtml(i.ssid),i)):void("remove"!=t&&"disable"!=t||n.wpaRequest(t,t+" "+d.escapeHtml(i.ssid),i))};$a.dialog((function(t){return Ue.createElement(ib,Gg({resultCallback:r},t,e))}))}}},{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this,t=this,n=function(n){return Ue.createElement(Ue.Fragment,null,Ue.createElement(ob,{showAccess:e.state.showAccess,interface:e.state.interface}),Ue.createElement(e.ItemList,{itemClass:rb,scrollable:!0,storeKeys:{itemList:ab},onItemClick:t.itemClick,listRef:function(t){return e.listRef=t}}))};return Ue.createElement(bm,Gg({},this.props,{id:"wpapage",title:"Wifi Client connection",mainContent:Ue.createElement(n,null),buttonList:t.buttons}))}}])}(Ue.Component),lb=function(e){var t="listEntry waypointListItem "+e.className||0;return e.selected&&(t+=" activeEntry"),Ue.createElement("div",{className:t,onClick:e.onClick},Ue.createElement(ds,{className:"Delete smallButton",onClick:function(t){t.preventDefault(),t.stopPropagation(),e.onClick("btnDelete")}}),Ue.createElement("div",{className:"name"},e.name),Ue.createElement("div",{className:"info"},W.formatLonLats(e),", ",W.formatDirection(e.course),"°/",W.formatDistance(e.distance),"nm"))};lb.propTypes={idx:Ge().number,name:Ge().string,course:Ge().number,distance:Ge().number,lat:Ge().number,lon:Ge().number,className:Ge().string,onClick:Ge().func.isRequired,selected:Ge().bool};var ub=lb,cb=n(23435);function pb(e){return pb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pb(e)}function fb(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,hb(r.key),r)}}function hb(e){var t=function(e,t){if("object"!=pb(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=pb(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==pb(t)?t:t+""}function mb(e,t,n){return t=vb(t),function(e,t){if(t&&("object"==pb(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,db()?Reflect.construct(t,n||[],vb(e).constructor):t.apply(e,n))}function db(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(db=function(){return!!e})()}function vb(e){return vb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},vb(e)}function yb(e,t){return yb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},yb(e,t)}var gb=function(e){if(void 0!==e)return"string"==typeof e?cb.A.parse(e.replace(/o/i,"e")):cb.A.parse(e)},bb=function(e){if(void 0!==e)return cb.A.parse(e)},wb=function(e){var t="string"==typeof e?gb(e):e;return-180<=t&&t<=180},kb=function(e){var t="string"==typeof e?bb(e):e;return-90<=t&&t<=90},Cb=function(e,t){return void 0===e?"":t?e.toFixed(8):cb.A.toLon(e,"dm",4)},Sb=function(e,t){return void 0===e?"":t?e.toFixed(8):cb.A.toLat(e,"dm",4)},Eb=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=mb(this,t,[e])).state={name:n.props.waypoint.name,lat:Sb(n.props.waypoint.lat),lon:Cb(n.props.waypoint.lon),show:!0,decimal:!1},n.okFunction=n.okFunction.bind(n),n.cancelFunction=n.cancelFunction.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&yb(e,t)}(t,e),n=t,o=[{key:"updateWaypoint",value:function(e,t,n){var r=e.clone(),o=t;if(o){r.name=o.name;var i=!0;try{r.lon=o.lon,(isNaN(r.lon)||void 0===r.lon)&&(n&&n("invalid lon, cannot convert "),i=!1),r.lat=o.lat,(isNaN(r.lat)||void 0===r.lat)&&(n&&n("invalid lat, cannot convert "),i=!1)}catch(e){n&&n("invalid coordinate, cannot convert"),i=!1}if(r.routeName&&r.routeName!=e.routeName&&(n&&n("internal error, route name changed"),i=!1),r.name==S.WayPoint.MOB&&(i=!1,n&&n("you cannot use this name")),i)return r}}}],(r=[{key:"valueChanged",value:function(e,t){var n={};n[e]=t,this.setState(n)}},{key:"closeFunction",value:function(){this.setState({show:!1}),this.props.closeCallback&&this.props.closeCallback()}},{key:"okFunction",value:function(e){var t={name:this.state.name,lat:bb(this.state.lat),lon:gb(this.state.lon)};if(wb(t.lon)&&kb(t.lat)){var n=this.props.waypoint.clone();y()(n,t),this.props.okCallback(n,this.closeFunction)&&this.closeFunction()}}},{key:"cancelFunction",value:function(e){this.closeFunction()}},{key:"render",value:function(){var e=this;if(!this.state.show)return null;var t=wb(this.state.lon)&&kb(this.state.lat);return Ue.createElement("div",{className:"inner"},Ue.createElement("h3",null,"Edit Waypoint"),Ue.createElement("div",null,Ue.createElement(tu,{dialogRow:!0,label:"Name",value:this.state.name,onChange:function(t){return e.valueChanged("name",t)}}),Ue.createElement(tu,{dialogRow:!0,label:"Lat",onChange:function(t){e.valueChanged("lat",t)},value:this.state.lat,checkFunction:kb}),Ue.createElement(tu,{dialogRow:!0,label:"Lon",onChange:function(t){return e.valueChanged("lon",t)},value:this.state.lon,checkFunction:wb}),Ue.createElement(nu,{dialogRow:!0,label:"decimal",onChange:function(t){return e.setState((function(e){return e.decimal===t?null:t?{lat:bb(e.lat),lon:gb(e.lon),decimal:t}:{lat:Sb(e.lat),lon:Cb(e.lon),decimal:t}}))},value:this.state.decimal||!1})),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"cancel",tabIndex:"3",onClick:this.cancelFunction},"Cancel"),Ue.createElement(Ia,{name:"ok",tabIndex:"4",onClick:this.okFunction,disabled:!t},"Ok")))}}])&&fb(n.prototype,r),o&&fb(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);Eb.propTypes={waypoint:Ge().instanceOf(S.WayPoint).isRequired,okCallback:Ge().func.isRequired,closeCallback:Ge().func};var Ob=Eb;function Pb(e){return Pb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pb(e)}function Db(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],l=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){u=!0,o=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Tb(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Tb(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Tb(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Nb(){return Nb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Nb.apply(null,arguments)}function Rb(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xb(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ab(r.key),r)}}function jb(e,t,n){return t&&xb(e.prototype,t),n&&xb(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ab(e){var t=function(e,t){if("object"!=Pb(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Pb(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Pb(t)?t:t+""}function Lb(e,t,n){return t=Mb(t),function(e,t){if(t&&("object"==Pb(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Ib()?Reflect.construct(t,n||[],Mb(e).constructor):t.apply(e,n))}function Ib(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ib=function(){return!!e})()}function Mb(e){return Mb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Mb(e)}function _b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Fb(e,t)}function Fb(e,t){return Fb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Fb(e,t)}var Bb="routepage",Wb=new $n($n.MODES.PAGE),Hb=new $n($n.MODES.ACTIVE),Vb=function(){var e=Hb.getRouteName();return!(!e||e!=Wb.getRouteName())},Kb=ot(bm),Ub=ml.getRoutingHandler(),qb=function(e){if(!e.currentRoute)return null;var t=e.currentRoute.computeLength(0,e.useRhumbLine);return Ue.createElement("div",{className:"routeCurrent",onClick:e.onClick},Ue.createElement("div",{className:"routeName"},e.currentRoute.name||""),Ue.createElement("div",{className:"routeInfo"},e.currentRoute.points.length||0,"Points,",W.formatDistance(t),"nm"),Ue.createElement("span",{className:"more"}," "))},zb=function(){return!!Wb.isRouteWritable()||($a.confirm("you cannot edit this route as you are disconnected. Please select a new name"),!1)},Gb=function(){if(Wb.hasRoute()){$a.dialog(function(e,t){var n=function(n){function r(t){var n;return Rb(this,r),(n=Lb(this,r,[t])).state={name:e,copyPoints:!0},n.nameChanged=n.nameChanged.bind(n),n.okFunction=n.okFunction.bind(n),n.cancelFunction=n.cancelFunction.bind(n),n}return _b(r,n),jb(r,[{key:"nameChanged",value:function(e){this.setState({name:e})}},{key:"okFunction",value:function(e){t(this.state,this.props.closeCallback)&&this.props.closeCallback()}},{key:"cancelFunction",value:function(e){this.props.closeCallback()}},{key:"render",value:function(){var e=this;return Ue.createElement("div",{className:"editRouteName inner"},Ue.createElement("h3",{className:"dialogTitle"},"Save as New"),Ue.createElement("div",null,Ue.createElement("div",{className:"dialogRow"},Ue.createElement(tu,{label:"Name",value:this.state.name,onChange:this.nameChanged})),Ue.createElement("div",{className:"dialogRow"},Ue.createElement(nu,{onChange:function(t){e.setState({copyPoints:t})},label:"Copy Points",value:e.state.copyPoints}))),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"cancel",onClick:this.cancelFunction},"Cancel"),Ue.createElement(Ia,{name:"ok",onClick:this.okFunction},"Ok")))}}])}(Ue.Component);return n}(Wb.getRouteName(),(function(e,t){if(Wb.hasRoute()){var n=e.name||"";return n==Wb.getRouteName()||(n==Oe.getData(ve.gui.routepage.initialName)||(Ub.fetchRoute(n,!1,(function(e){ct("route with name "+n+" already exists")}),(function(r){var o=Wb.getRoute().clone();o.setName(n),e.copyPoints||(o.points=[]),Oe.getData(ve.properties.connectedMode,!1)||(o.server=!1),Wb.setRouteAndIndex(o,-1),t()})),!1))}})))}},Zb=function(e,t){Oe.getData(ve.gui.routepage.initialName,"")!=e.name&&(e.server=Oe.getData(ve.properties.connectedMode,!1));var n=Wb.getPointAt();return n&&Wi.setCenter(n),Wb.setNewRoute(e),Wb.setNewIndex(Wb.getIndexFromPoint(n,!0)),Wb.syncTo($n.MODES.EDIT),Vb()&&Hb.setNewRoute(e),t&&n&&Ub.wpOn(n,!0),!0},Xb=function(e){function t(e){var n;Rb(this,t);var r=n=Lb(this,t,[e]);return n.listRef=void 0,n.buttons=[{name:"RoutePageOk",onClick:function(){r.storeRouteAndReturn(!1)}},{name:"NavGoto",onClick:function(){vu(!0).then((function(){return r.storeRouteAndReturn(!0)})).catch((function(){}))}},{name:"NavInvert",onClick:function(){zb()&&Wb.invertRoute()}},{name:"NavDeleteAll",onClick:function(){zb()&&Wb.emptyRoute()}},{name:"RoutePageDownload",onClick:function(){n.props.history.push("downloadpage",{downloadtype:"route",allowChange:!1,selectItemCallback:function(e){Ub.fetchRoute(e.name,!e.server,(function(e){Wb.setRouteAndIndex(e,0),Oe.storeData(ve.gui.routepage.initialName,e.name),n.props.history.pop()}),(function(e){ct("unable to load route")}))}})}},Lm(n.props.history),{name:"Cancel",onClick:function(){n.props.history.pop()}}],n.storeRouteAndReturn=n.storeRouteAndReturn.bind(n),Oe.storeData(ve.gui.routepage.initialName,Wb.getRouteName()),Ub.setCurrentRoutePage(Bb),n}return _b(t,e),jb(t,[{key:"componentDidMount",value:function(){if(this.listRef){var e=this.listRef.querySelector(".activeEntry");if(e){var t=It.scrollInContainer(this.listRef,e);(t>=1||t<=2)&&e.scrollIntoView(1==t)}}}},{key:"componentWillUnmount",value:function(){Ub.unsetCurrentRoutePage(Bb)}},{key:"storeRouteAndReturn",value:function(e){var t=this;if(Wb.hasRoute()){var n=Wb.getRouteName(),r=Wb.getRoute();if(n==Oe.getData(ve.gui.routepage.initialName,""))return Zb(r.clone(),e)&&this.props.history.pop(),!0;Ub.fetchRoute(n,!r.server,(function(e){ct("route with name "+n+" already exists")}),(function(n){Zb(r.clone(),e)&&t.props.history.pop()}))}else this.props.history.pop()}},{key:"render",value:function(){var e=this,t=ot((function(t){var n=Db(Xn.getRouteIndexFlag(t),3),r=n[0],o=n[1];n[2];return r?Ue.createElement(Ue.Fragment,null,Ue.createElement(qb,{onClick:Gb,currentRoute:r,useRhumbLine:t.useRhumbLine}),Ue.createElement(Ea,{itemList:r.getRoutePoints(o,t.useRhumbLine),itemClass:ub,scrollable:!0,onItemClick:function(e,t){if("btnDelete"==t){if(!zb())return;return Wb.setNewIndex(e.idx),void Wb.deleteWaypoint()}e.idx!=Wb.getIndex()?Wb.setNewIndex(e.idx):function(e,t){if(e){var n=new S.WayPoint;y()(n,e);var r=function(e,r){if(zb()){var o=Ob.updateWaypoint(n,e,(function(e){ct(d.escapeHtml(e))}));return!!o&&(Wb.checkChangePossible(o,t)?(Wb.changeSelectedWaypoint(o,t),!0):(ct("unable to set waypoint, already exists"),!1))}};$a.dialog((function(e){return Ue.createElement(Ob,Nb({},e,{waypoint:n,okCallback:r}))}))}}(e,e.idx)},listRef:function(t){e.listRef=t}})):null}));return Ue.createElement(Kb,Nb({},this.props,{id:Bb,mainContent:Ue.createElement(t,{storeKeys:Wb.getStoreKeys({useRhumbLine:ve.nav.routeHandler.useRhumbLine})}),buttonList:e.buttons,storeKeys:de.flattenedKeys(Wb.getStoreKeys()).concat(de.flattenedKeys(Hb.getStoreKeys())),updateFunction:function(e){var t=Vb();return{title:t?"Active Route":"Inactive Route",className:t?"activeRoute":""}}}))}}])}(Ue.Component);function Jb(e){return Jb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jb(e)}function Yb(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Qb(r.key),r)}}function Qb(e){var t=function(e,t){if("object"!=Jb(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Jb(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Jb(t)?t:t+""}function $b(e,t,n){return t=tw(t),function(e,t){if(t&&("object"==Jb(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ew()?Reflect.construct(t,n||[],tw(e).constructor):t.apply(e,n))}function ew(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ew=function(){return!!e})()}function tw(e){return tw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},tw(e)}function nw(e,t){return nw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},nw(e,t)}var rw=1e5,ow=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=$b(this,t,[e])).state={uploadSequence:0,lastClickSequence:0},n.stateHelper=Lt(n,{},"upload"),n.uploadServer=n.uploadServer.bind(n),n.fileChange=n.fileChange.bind(n),n.androidSubscriptions=[],n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&nw(e,t)}(t,e),n=t,r=[{key:"checkName",value:function(e){return this.props.checkNameCallback?this.props.checkNameCallback(e):new Promise((function(t,n){t({name:e})}))}},{key:"upload",value:function(e){var t=this;e&&this.props.type&&this.checkName(e.name).then((function(n){t.props.local?t.uploadFileReader(e,n.name,n):t.uploadServer(e,n.name,n.type||t.props.type,n.uploadParameters,n)})).catch((function(e){t.props.errorCallback(e)}))}},{key:"uploadFileReader",value:function(e,t,n){var r=this;if(this.stateHelper.setState({},!0),e.size&&e.size>rw){var o="file is to big, max allowed: "+rw;this.props.errorCallback(o)}else if(window.FileReader){var i=new FileReader;i.onloadend=function(){var o=i.result;o?r.props.doneCallback({data:o,name:t,param:n}):r.props.errorCallback("unable to load file "+e.name)},i.readAsText(e)}else this.props.errorCallback("your browser does not support FileReader, cannot upload")}},{key:"uploadServer",value:function(e,t,n,r,o){var i=this,a=Oe.getData(ve.properties.navUrl)+"?request=upload&type="+n+"&name="+encodeURIComponent(t);if(r)for(var s in r)void 0!==r[s]&&(a+="&"+s+"="+encodeURIComponent(r[s]));var l=this.props.uploadSequence;wt.uploadFile(a,e,{self:i,starthandler:function(e,t){i.props.uploadSequence===l?i.stateHelper.setState({xhdr:t}):t&&t.abort()},errorhandler:function(e,t){i.props.uploadSequence===l&&(i.stateHelper.setState({},!0),i.props.errorCallback&&i.props.errorCallback(t))},progresshandler:function(e,t){i.props.uploadSequence===l&&t.lengthComputable&&i.stateHelper.setState({total:t.total,loaded:t.loaded})},okhandler:function(e,t){i.props.uploadSequence===l&&(i.stateHelper.setState({},!0),i.props.doneCallback&&i.props.doneCallback({param:o}))}})}},{key:"checkForUpload",value:function(){if(this.state.uploadSequence!==this.props.uploadSequence){var e=this.stateHelper.getValue("xhdr");if(e&&e.abort(),this.stateHelper.setState({},!0),avnav.android){var t={uploadSequence:this.props.uploadSequence,androidSequence:(new Date).getTime()};this.setState(t),avnav.android.requestFile(this.props.type,t.androidSequence,!!this.props.local)}this.setState({uploadSequence:this.props.uploadSequence})}}},{key:"androidUploadHandler",value:function(e){var t=this;if(avnav.android){var n=e.id;if(n===this.state.androidSequence){this.props.type;var r=avnav.android.getFileName(n);if(r){var o=avnav.android.getFileData(n);this.checkName(r).then((function(e){t.props.doneCallback({name:e.name,data:o,param:e})})).catch((function(e){ct(e)}))}}}}},{key:"androidCopyHandler",value:function(e){var t=this;if(avnav.android){var n=this.state.androidSequence,r=e.id;if(r===n){this.props.type;var o=avnav.android.getFileName(r);this.checkName(o).then((function(e){var n={xhdr:{abort:function(){avnav.android.interruptCopy(r)}},total:avnav.android.getFileSize(r),loaded:0,loadedPercent:!0,param:e};t.stateHelper.setState(n,!0),avnav.android.copyFile(r,e.name)?t.stateHelper.setValue("total",avnav.android.getFileSize(r)):(t.props.errorCallback("unable to upload"),t.stateHelper.setState({},!0))})).catch((function(e){avnav.android.interruptCopy(r),e&&t.props.errorCallback(e)}))}}}},{key:"androidProgressHandler",value:function(e){var t=e.event,n=e.id;if("fileCopyPercent"===t){if(!this.stateHelper.getState().total)return;this.stateHelper.setValue("loaded",n)}else{var r=this.stateHelper.getValue("param");this.stateHelper.setState({},!0),this.props.doneCallback({param:r})}}},{key:"componentDidMount",value:function(){this.androidUploadHandler=this.androidUploadHandler.bind(this),this.androidCopyHandler=this.androidCopyHandler.bind(this),this.androidProgressHandler=this.androidProgressHandler.bind(this),this.androidSubscriptions.push(Pt.subscribe("uploadAvailable",this.androidUploadHandler)),this.androidSubscriptions.push(Pt.subscribe("fileCopyReady",this.androidCopyHandler)),this.androidSubscriptions.push(Pt.subscribe("fileCopyPercent",this.androidProgressHandler)),this.androidSubscriptions.push(Pt.subscribe("fileCopyDone",this.androidProgressHandler)),this.checkForUpload()}},{key:"componentWillUnmount",value:function(){this.androidSubscriptions.forEach((function(e){Pt.unsubscribe(e)}));var e=this.stateHelper.getValue("xhdr");e&&e.abort()}},{key:"componentDidUpdate",value:function(){this.checkForUpload()}},{key:"fileChange",value:function(e){e.stopPropagation();var t=e.target;t.files&&t.files.length>0&&this.upload(t.files[0])}},{key:"render",value:function(){var e=this;if(!this.state.uploadSequence)return null;var t=this.stateHelper.getState(),n=t.loaded,r=t.total?100*n/t.total:0;t.loadedPercent&&(r=t.loaded||0,n=t.loaded*t.total/100);var o={width:r+"%"};return Ue.createElement(Ue.Fragment,null,!avnav.android&&Ue.createElement("form",{className:"hiddenUpload",method:"post"},Ue.createElement("input",{type:"file",ref:function(t){t&&e.state.uploadSequence!==e.state.lastClickSequence&&(t.click(),e.setState({lastClickSequence:e.state.uploadSequence}))},name:"file",key:this.state.uploadSequence,onChange:this.fileChange})),this.stateHelper.getValue("xhdr")&&Ue.createElement("div",{className:"downloadProgress"},Ue.createElement("div",{className:"progressContainer"},Ue.createElement("div",{className:"progressInfo"},(n||0)+"/"+(t.total||0)),Ue.createElement("div",{className:"progressDisplay"},Ue.createElement("div",{className:"progressDone",style:o}))),Ue.createElement(ds,{className:"DownloadPageUploadCancel button",onClick:function(){t.xhdr&&t.xhdr.abort(),e.stateHelper.setState({},!0),e.props.errorCallback&&e.props.errorCallback("cancelled")}})))}}],r&&Yb(n.prototype,r),o&&Yb(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);ow.propTypes={uploadSequence:Ge().number,type:Ge().string,local:Ge().bool,doneCallback:Ge().func,errorCallback:Ge().func,checkNameCallback:Ge().func};var iw=ow,aw=n(42347),sw=n(20410),lw=n.n(sw);n(24867),n(47981),n(10614),n(40966),n(19175),n(26692);function uw(e){return uw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},uw(e)}function cw(){return cw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},cw.apply(null,arguments)}function pw(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,fw(r.key),r)}}function fw(e){var t=function(e,t){if("object"!=uw(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=uw(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==uw(t)?t:t+""}function hw(e,t,n){return t=dw(t),function(e,t){if(t&&("object"==uw(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,mw()?Reflect.construct(t,n||[],dw(e).constructor):t.apply(e,n))}function mw(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(mw=function(){return!!e})()}function dw(e){return dw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},dw(e)}function vw(e,t){return vw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},vw(e,t)}var yw={js:"js",json:"json",html:"markup",css:"css",xml:"markup",gpx:"markup",txt:void 0},gw=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);n=hw(this,t,[e]);var r={data:"",changed:!1,readOnly:!1};return n.props.options||n.props.history.pop(),n.type=n.props.options.type,n.name=n.props.options.name,n.url=n.props.options.url,n.html=n.props.options.html,(n.props.options.readOnly||n.isImage()||n.url||n.html)&&(r.readOnly=!0),n.html&&(r.data=n.html),n.state=r,n.changed=n.changed.bind(n),n.flask=void 0,rn.disable(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&vw(e,t)}(t,e),n=t,r=[{key:"buttons",value:function(){var e=this,t=this;return[Lm(this.props.history),{name:"ViewPageView",visible:this.canChangeMode(),toggle:this.state.readOnly,onClick:function(){e.setState({readOnly:!0})}},{name:"ViewPageEdit",visible:this.canChangeMode(),toggle:!this.state.readOnly,onClick:function(){e.setState({readOnly:!1})}},{name:"ViewPageSave",disabled:!this.state.changed,visible:!this.state.readOnly||this.canChangeMode(),onClick:function(){pt();var n=e.flask.getCode();if("json"==t.getLanguage())try{JSON.parse(n)}catch(e){var r=e.message;if(r.match(/osition [0-9]/))try{var o=r.replace(/.*osition */,"");o=parseInt(o),r+=" (around line "+(n.substr(0,o).replace(/[^\n]*/g,"").length+1)+")"}catch(e){}return void ct("invalid json: "+r)}else if("xml"==t.getExt())try{var i=d.parseXml(n).getElementsByTagName("parsererror");if(i.length>0)return void ct("invalid xml: "+i[0].textContent.replace(/ *[bB]elow is a .*/,""))}catch(e){}var a,s=Uk.create({type:t.type,name:t.name});a=s.localUploadFunction?s.localUploadFunction:function(e,n,r){return wt.postPlain({request:"upload",type:t.type,overwrite:r,name:e},n)},a(t.name,n,!0).then((function(t){return e.setState({changed:!1})})).catch((function(e){return ct("unable to save: "+e)}))}},{name:"Cancel",onClick:function(){e.state.changed?$a.confirm("Discard Changes?").then((function(t){e.props.history.pop()})).catch((function(e){})):e.props.history.pop()}}]}},{key:"changed",value:function(e){this.state.changed||this.setState({changed:!0})}},{key:"getExt",value:function(){return this.url?d.getExt(this.url):this.html?"html":Uk.create({type:this.type,name:this.name}).extForView}},{key:"isImage",value:function(){var e=this.getExt().toLowerCase();return It.IMAGES.indexOf(e)>=0}},{key:"canChangeMode",value:function(){return"html"==this.getExt()&&!this.props.options.readOnly&&!this.url&&!this.html}},{key:"getLanguage",value:function(){var e=this.getExt(),t=yw[e];return t||(t="text"),t}},{key:"getUrl",value:function(e){return this.url?this.url:(e?Oe.getData(ve.properties.navUrl):"")+"?request=download&type="+this.type+"&name="+encodeURIComponent(this.name)}},{key:"componentDidMount",value:function(){var e=this,t=this;this.isImage()||this.html||this.url&&this.props.options.useIframe||wt.getHtmlOrText(this.getUrl(!0),{noCache:!0}).then((function(n){if(!e.state.readOnly||e.canChangeMode()){var r=t.getLanguage();e.flask=new aw.A(t.refs.editor,{language:r,lineNumbers:!0,defaultTheme:!1,noInitialCallback:!0,highLighter:lw().highlightElement}),e.flask.updateCode(n,!0),e.flask.onUpdate(e.changed)}e.setState({data:n})}),(function(t){ct("unable to load "+(e.url||e.name)+": "+t)}))}},{key:"componentWillUnmount",value:function(){rn.enable()}},{key:"render",value:function(){var e=this.isImage()?0:"html"==this.getExt()?1:2;this.url&&(e=this.props.options.useIframe?4:1),this.html&&(e=1);var t=this.state.readOnly||this.canChangeMode(),n=!this.state.readOnly||this.canChangeMode(),r=n&&this.flask?this.flask.getCode():this.state.data,o="mainContainer view";this.state.readOnly||(o+=" hidden"),4===e&&(o+=" flex"),0==e&&(o+=" image");var i="mainContainer edit";this.state.readOnly&&(i+=" hidden");var a=Ue.createElement(Ue.Fragment,null,t&&Ue.createElement("div",{className:o},1==e&&Ue.createElement("div",{dangerouslySetInnerHTML:{__html:r}}),0==e&&Ue.createElement("img",{className:"readOnlyImage",src:this.getUrl(!0)}),2==e&&Ue.createElement("textarea",{className:"readOnlyText",defaultValue:r,readOnly:!0}),4==e&&Ue.createElement("div",{className:"addOnFrame"},Ue.createElement("iframe",{className:"viewPageIframe addOn",src:this.getUrl(!0)}))),n&&Ue.createElement("div",{className:i,ref:"editor"}));return Ue.createElement(bm,cw({},this.props,{id:"viewpage",title:(this.state.readOnly?"Showing":"Editing")+": "+this.name,mainContent:a,buttonList:this.buttons()}))}}],r&&pw(n.prototype,r),o&&pw(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component),bw=ca(gw);bw.VIEWABLES=Object.keys(yw).concat(It.IMAGES),bw.EDITABLES=Object.keys(yw),bw.MAXEDITSIZE=5e4;var ww=bw;function kw(e){return kw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kw(e)}function Cw(){return Cw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Cw.apply(null,arguments)}function Sw(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ew(r.key),r)}}function Ew(e){var t=function(e,t){if("object"!=kw(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=kw(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==kw(t)?t:t+""}function Ow(e,t,n){return t=Dw(t),function(e,t){if(t&&("object"==kw(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Pw()?Reflect.construct(t,n||[],Dw(e).constructor):t.apply(e,n))}function Pw(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Pw=function(){return!!e})()}function Dw(e){return Dw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Dw(e)}function Tw(e,t){return Tw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Tw(e,t)}var Nw=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Ow(this,t,[e])).stateHelper=Lt(n,y()({},e.addon,e.fixed),"addon"),n.dialogHelper=Ya(n),n.state.iconList=[],n.state.userFiles=[],n.state.addons=[],n.state.internal=!0,n.state.loaded=void 0===(e.fixed||{}).url||void 0!==e.addon,n.state.loaded&&(e.addon||{}).keepUrl&&(n.state.internal=!1),n.fillLists(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Tw(e,t)}(t,e),n=t,(r=[{key:"fillLists",value:function(){var e=this,t=this;wt.getJson("?request=list&type=user").then((function(e){var n=[],r=[];e.items&&(e.items.forEach((function(e){It.IMAGES.indexOf(d.getExt(e.name))>=0&&(e.label=e.url,e.value=e.url,n.push(e)),"html"===d.getExt(e.name)&&(e.label=e.url,e.value=e.url,r.push(e))})),t.setState({iconList:t.state.iconList.concat(n),userFiles:r}))})).catch((function(e){})),wt.getJson("?request=list&type=images").then((function(e){var n=[];e.items&&(e.items.forEach((function(e){It.IMAGES.indexOf(d.getExt(e.name))>=0&&(e.label=e.url,e.value=e.url,n.push(e))})),t.setState({iconList:t.state.iconList.concat(n)}))})).catch((function(e){})),this.state.loaded||_m().then((function(n){var r=Fm(n,t.props.fixed.url);r&&e.stateHelper.setState(y()({},r,e.props.fixed)),e.setState({loaded:!0})})).catch((function(e){return ct("unable to load addons: "+e)}))}},{key:"checkOk",value:function(){var e=this.stateHelper.getValues();return e.url?e.icon?!(!this.state.internal&&!e.url.startsWith("http")&&(ct("external urls must start with http"),1)):(ct("you must provide an icon"),!1):(ct("you must provide an url"),!1)}},{key:"render",value:function(){var e=this,t=this,n=this.props.fixed||{},r=this.stateHelper.getValue("canDelete",!0);this.state.loaded||(r=!1);var o=void 0!==n.url,i="";return r&&(i=n?"Modify ":"Create "),Ue.createElement(Ue.Fragment,null,Ue.createElement("div",{className:"userAppDialog"},Ue.createElement("h3",{className:"dialogTitle"},i+"User App"),o||!r?Ue.createElement(ou,{dialogRow:!0,className:"url",label:"url",value:this.stateHelper.getValue("url","")}):Ue.createElement(Ue.Fragment,null,r&&!o&&Ue.createElement(nu,{dialogRow:!0,label:"internal",value:this.state.internal,onChange:function(t){e.setState({internal:t}),e.stateHelper.setState({url:"",newWindow:!1})}}),this.state.internal?Ue.createElement(iu,{dialogRow:!0,label:"internal url",value:this.stateHelper.getValue("url",""),list:this.state.userFiles,showDialogFunction:this.dialogHelper.showDialog,onChange:function(e){return t.stateHelper.setState({url:e.url})}}):Ue.createElement(tu,{dialogRow:!0,label:"external url",value:this.stateHelper.getValue("url",""),minSize:50,maxSize:100,onChange:function(e){return t.stateHelper.setState({url:e})}})),r?Ue.createElement(tu,{dialogRow:!0,label:"title",value:this.stateHelper.getValue("title",""),minSize:50,maxSize:100,onChange:function(e){t.stateHelper.setState({title:e})}}):Ue.createElement(ou,{dialogRow:!0,label:"title",value:this.stateHelper.getValue("title")}),r?Ue.createElement(iu,{dialogRow:!0,label:"icon",value:this.stateHelper.getValue("icon"),list:this.state.iconList,showDialogFunction:this.dialogHelper.showDialog,onChange:function(t){return e.stateHelper.setState({icon:t.url})}},this.stateHelper.getValue("icon")&&Ue.createElement("img",{className:"appIcon",src:this.stateHelper.getValue("icon")})):Ue.createElement(ou,{dialogRow:!0,label:"icon",value:this.stateHelper.getValue("icon")},this.stateHelper.getValue("icon")&&Ue.createElement("img",{className:"appIcon",src:this.stateHelper.getValue("icon")})),r&&!this.state.internal&&Ue.createElement(nu,{dialogRow:!0,label:"newWindow",value:"true"===this.stateHelper.getValue("newWindow"),onChange:function(t){e.stateHelper.setState({newWindow:t?"true":"false"})}}),Ue.createElement("div",{className:"dialogButtons"},this.stateHelper.getValue("name")&&this.stateHelper.getValue("canDelete")&&r&&Ue.createElement(Ia,{name:"delete",onClick:function(){t.dialogHelper.showDialog($a.createConfirmDialog("really delete User App?",(function(){e.props.closeCallback(),e.props.removeFunction(e.stateHelper.getValue("name"))})))}},"Delete"),Ue.createElement(Ia,{name:"cancel",onClick:this.props.closeCallback},"Cancel"),Ue.createElement(Ia,{name:"ok",onClick:function(){e.checkOk()&&(e.props.closeCallback(),e.props.okFunction(y()({},e.stateHelper.getValues(),e.props.fixed)))},disabled:!this.stateHelper.getValue("icon")||!this.stateHelper.getValue("url")||!r},"Ok"))))}}])&&Sw(n.prototype,r),o&&Sw(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);function Rw(e){return Rw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Rw(e)}Nw.propTypes={fixed:Ge().object.isRequired,addon:Ge().object,closeCallback:Ge().func.isRequired,okFunction:Ge().func.isRequired,removeFunction:Ge().func.isRequired},Nw.showUserAppDialog=function(e,t,n){return new Promise((function(r,o){if(!e&&!(t||{}).url){var i="either addon or fixed.url required";n&&ct(i),o(i)}$a.dialog((function(i){return Ue.createElement(Nw,Cw({},i,{okFunction:function(e){Bm(e.name,e.url,e.icon,e.title,e.newWindow).then((function(e){r(e)})).catch((function(e){n&&ct("unable to add/update: "+e),o(e)}))},removeFunction:function(e){Wm(e).then((function(e){return r(e)})).catch((function(e){n&&ct("unable to remove: "+e),o(e)}))},addon:e,fixed:t}))}))}))};var xw=["useDialogButton","url","localData","fileName","type","androidUrl"];function jw(){return jw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},jw.apply(null,arguments)}function Aw(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Lw(r.key),r)}}function Lw(e){var t=function(e,t){if("object"!=Rw(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Rw(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Rw(t)?t:t+""}function Iw(e,t,n){return t=_w(t),function(e,t){if(t&&("object"==Rw(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Mw()?Reflect.construct(t,n||[],_w(e).constructor):t.apply(e,n))}function Mw(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Mw=function(){return!!e})()}function _w(e){return _w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_w(e)}function Fw(e,t){return Fw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Fw(e,t)}var Bw=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Iw(this,t,[e])).hiddenA=void 0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Fw(e,t)}(t,e),n=t,r=[{key:"saveLocal",value:function(){if(this.hiddenA){if(!this.props.localData)return!1;var e=this.props.localData;"function"==typeof this.props.localData&&(e=this.props.localData());var t="data:application/octet-stream;base64,"+function(e){if("string"==typeof e){e=(new TextEncoder).encode(e);var t=Array.from(e,(function(e){return String.fromCodePoint(e)})).join("");return window.btoa(t)}return window.btoa(e)}(e);this.hiddenA.href=t}}},{key:"render",value:function(){var e=this,t=this.props,n=t.useDialogButton,r=t.url,o=t.localData,i=t.fileName,a=(t.type,t.androidUrl,function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(t,xw)),s=n?Ia:ds;return r||o?Ue.createElement(Ue.Fragment,null,Ue.createElement("a",{download:i||"file.txt",className:"hidden",ref:function(t){return e.hiddenA=t},href:r||"",onClick:function(e){return e.stopPropagation()}}),Ue.createElement(s,jw({},a,{onClick:function(t){t.stopPropagation(),e.hiddenA&&(r||e.saveLocal(),e.hiddenA.click(),e.props.onClick&&e.props.onClick(t))}}),this.props.children)):null}}],r&&Aw(n.prototype,r),o&&Aw(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);Bw.propTypes={localData:Ge().any,url:Ge().string,className:Ge().string,useDialogButton:Ge().bool,fileName:Ge().string,type:Ge().string,onClick:Ge().func,androidUrl:Ge().string};var Ww=Bw;function Hw(e){return Hw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hw(e)}function Vw(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Kw(r.key),r)}}function Kw(e){var t=function(e,t){if("object"!=Hw(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Hw(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Hw(t)?t:t+""}var Uw=function(){return e=function e(t,n,r,o){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.points=t,this.useLen=n,this.count=r,this.maxXte=o,this.computePoints=[],this.minIndex=void 0,this.removedMax=void 0,void 0===this.count&&void 0===this.maxXte)throw new Error("either maxXte or count must be given")},(t=[{key:"computeXte",value:function(e,t,n){if(this.useLen){var r=P.computeDistance(e,n).dts+P.computeDistance(n,t).dts-P.computeDistance(e,t).dts;return Math.abs(r)}return Math.abs(P.computeXte(e,t,n))}},{key:"computeMin",value:function(){this.minIndex=void 0;for(var e=void 0,t=0;t<this.computePoints.length;t++){var n=this.computePoints[t];if(void 0!==n.xte){var r=n.xte;(void 0===e||r<e)&&(e=r,this.minIndex=t)}}}},{key:"computeAlLXte",value:function(){if(!(this.points.length<3)){for(var e=0;e<this.points.length;e++){var t=void 0;e>0&&e<this.points.length-1&&(t=this.computeXte(this.points[e-1],this.points[e+1],this.points[e])),this.computePoints.push({point:this.points[e],xte:t})}this.computeMin()}}},{key:"process",value:function(){if(this.points.length<3)return this.points;if(this.count>=this.points.length)return this.points;for(this.computeAlLXte();!(void 0!==this.maxXte&&this.computePoints[this.minIndex].xte>this.maxXte||void 0!==this.count&&this.computePoints.length<=this.count)&&this.removePoint(););var e=[];return this.computePoints.forEach((function(t){e.push(t.point)})),e}},{key:"removePoint",value:function(){var e=this.minIndex,t=this.computePoints[e];if(!t)return!1;if(this.removedMax=t.xte,this.computePoints.splice(e,1),e<this.computePoints.length-1&&e>0){var n=this.computeXte(this.computePoints[e-1].point,this.computePoints[e+1].point,this.computePoints[e].point);n!==this.computePoints[e].xte&&(this.computePoints[e].xte=n)}if(e<this.computePoints.length&&e>1){var r=this.computeXte(this.computePoints[e-2].point,this.computePoints[e].point,this.computePoints[e-1].point);r!==this.computePoints[e-1].xte&&(this.computePoints[e-1].xte=r)}return this.computeMin(),!0}}])&&Vw(e.prototype,t),n&&Vw(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}(),qw=void 0;function zw(){return zw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},zw.apply(null,arguments)}function Gw(e,t,n){return t=Xw(t),function(e,t){if(t&&("object"==Qw(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Zw()?Reflect.construct(t,n||[],Xw(e).constructor):t.apply(e,n))}function Zw(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Zw=function(){return!!e})()}function Xw(e){return Xw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Xw(e)}function Jw(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Yw(e,t)}function Yw(e,t){return Yw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Yw(e,t)}function Qw(e){return Qw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qw(e)}function $w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ek(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,nk(r.key),r)}}function tk(e,t,n){return t&&ek(e.prototype,t),n&&ek(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function nk(e){var t=function(e,t){if("object"!=Qw(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Qw(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Qw(t)?t:t+""}var rk=ml.getRoutingHandler(),ok=[{label:"name",value:"name"},{label:"points",value:"numPoints",formatter:function(e,t){return void 0!==t.refIdx?t.refIdx+"/"+t.numPoints:e}},{label:"length",value:"distance",formatter:function(e){return W.formatDistance(e)+" nm"}},{label:"remain",value:"remain",formatter:function(e){return W.formatDistance(e)+" nm"}},{label:"average",value:"avgSpeed",formatter:function(e){return W.formatSpeed(e)+" kn"}},{label:"speed",value:"pointSpeed",formatter:function(e){return W.formatSpeed(e)+" kn"}},{label:"course",value:"pointCourse",formatter:function(e){return W.formatDirection(e)+" °"}},{label:"time",value:"pointTime",formatter:function(e){return W.formatDateTime(e)}},{label:"start",value:"startTime",formatter:function(e){return W.formatDateTime(e)}},{label:"end",value:"endTime",formatter:function(e){return W.formatDateTime(e)}}],ik=function(){return tk((function e(t){$w(this,e),this.points=[],this.distance=0,this.lastPoint=void 0,this.startTime=void 0,this.endTime=void 0,this.hasTimeErrors=!1,this.refPoint=t,this.foundPoint=void 0}),[{key:"addPoint",value:function(e){if((void 0===this.startTime||e.ts<this.startTime)&&(this.startTime=e.ts),(void 0===this.endTime||e.ts>this.endTime)&&(this.endTime=e.ts),this.points.push(e),this.lastPoint){var t=P.computeDistance(this.lastPoint,e,Oe.getData(ve.nav.routeHandler.useRhumbLine));this.distance+=t.dts}this.lastPoint=e}},{key:"finalize",value:function(e,t){if(this.points.length<2)t("no points parsed from track");else{var n=void 0;void 0!==this.endTime&&void 0!==this.startTime&&this.endTime>this.startTime+1&&(n=this.distance/(this.endTime-this.startTime));var r=-1,o=0;if(this.refPoint){for(var i,a=0;a<this.points.length;a++){var s=P.computeDistance(this.refPoint,this.points[a],Oe.getData(ve.nav.routeHandler.useRhumbLine)).dts;(void 0===i||s<i)&&(r=a,i=s)}this.foundPoint=this.points[r];for(var l=this.foundPoint,u=Oe.getData(ve.nav.routeHandler.useRhumbLine),c=r+1;c<this.points.length;c++)o+=P.computeDistance(l,this.points[c],u).dts,l=this.points[c]}e({points:this.points,distance:this.distance,numPoints:this.points.length,refIdx:r>=0?r:void 0,remain:r>=0?o:void 0,pointTime:void 0!==this.foundPoint?new Date(1e3*this.foundPoint.ts):void 0,pointSpeed:void 0!==this.foundPoint?this.foundPoint.speed:void 0,pointCourse:void 0!==this.foundPoint?this.foundPoint.opt_course||this.foundPoint.course:void 0,timeErrors:this.hasTimeErrors,avgSpeed:n,startTime:new Date(1e3*this.startTime),endTime:new Date(1e3*this.endTime)})}}}])}(),ak=function(e,t){var n=new ik(t);return new Promise((function(t,r){e.forEach((function(e){n.addPoint(e)})),n.finalize(t,r)}))},sk=[{name:"time",target:"ts",convert:function(e){var t=new Date(e);return isNaN(t)?void 0:t.getTime()/1e3}},{name:"speed",target:"speed",convert:function(e){return parseFloat(e)}},{name:"course",target:"opt_course",convert:function(e){return parseFloat(e)}}],lk=function(e,t){if("current"===e){var n=Oe.getData(ve.nav.track.currentTrack,[]);return ak(n,t)}var r=new ik(t);return new Promise((function(t,n){e||n("missing track name"),wt.getHtmlOrText("",{useNavUrl:!0},{request:"download",type:"track",name:e}).then((function(e){var o;try{o=d.parseXml(e)}catch(e){return void n("exception while parsing track file: "+e)}var i=o.getElementsByTagName("gpx");if(i.length<1)n("no gpx file");else{var a=i[0].getElementsByTagName("trk");if(a.length<1)n("no tracks in trackfile");else{var s=a[0].getElementsByTagName("trkseg");if(s.length<1)n("no track segments in trackfile");else{for(var l=0;l<s.length;l++)for(var u=s[l].getElementsByTagName("trkpt"),c=function(){var e=u[p],t=e.getAttribute("lat"),n=e.getAttribute("lon");if(!t||!n)return 0;if(n=parseFloat(n),t=parseFloat(t),isNaN(n)||isNaN(t))return 0;var o=new S.TrackPoint(n,t,void 0),i=!1;sk.forEach((function(t){var n=e.getElementsByTagName(t.name)[0];n&&n.textContent&&(n=t.convert?t.convert(n.textContent):n.textContent),n&&("time"===t.name&&(i=!0),o[t.target]=n)})),i?r.addPoint(o):r.hasTimeErrors=!0},p=0;p<u.length;p++)c();r.finalize(t,n)}}}})).catch((function(e){return n(e)}))}))},uk=[{label:"points",value:"numPoints"},{label:"length",value:"distance",formatter:function(e){return W.formatDistance(e)+" nm"}}],ck=function(e){return Ue.createElement("div",{className:"AskEditRouteDialog flexInner"},Ue.createElement("h3",{className:"dialogTitle"},"Route Created"),Ue.createElement("div",{className:"dialogRow"},"route  ",Ue.createElement("span",null,e.route.name),"  successfully created"),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"cancel",onClick:e.closeCallback},"Cancel"),Ue.createElement(Ia,{name:"editRoute",onClick:function(){e.closeCallback(),new $n($n.MODES.EDIT).setNewRoute(e.route,0),qw.props.history.push("editroutepage",{center:!0})}},"Edit")))},pk=function(e){function t(e){var n;return $w(this,t),(n=Gw(this,t,[e])).state={points:n.props.points,convertedPoints:n.props.points,routeName:"Track-"+n.props.name,loaded:!1,processing:!1,routesLoaded:!1,currentRoutes:[],maxXte:e.maxXte||20},n.info=Lt(n,{},"info"),n.originalInfo=Lt(n,{},"originalInfo"),n.okClicked=n.okClicked.bind(n),n.convert=n.convert.bind(n),n}return Jw(t,e),tk(t,[{key:"componentDidMount",value:function(){var e=this;ak(this.state.points).then((function(t){e.setState({loaded:!0}),e.info.setState(t,!0),e.originalInfo.setState(t,!0)})).catch((function(e){return ct(e)})),rk.listRoutes(!0).then((function(t){e.setState({currentRoutes:t,routesLoaded:!0})})).catch((function(e){ct(e)}))}},{key:"existsRoute",value:function(e){if(!this.state.routesLoaded)return!1;"gpx"!==d.getExt(e)&&(e+=".gpx");for(var t=0;t<this.state.currentRoutes.length;t++)if(this.state.currentRoutes[t].name===e)return!0;return!1}},{key:"getRowValue",value:function(e,t){var n=e[t.value];return void 0===n||t.formatter&&void 0===(n=t.formatter(n,e))?null:Ue.createElement(Qa,{label:t.label,value:n})}},{key:"okClicked",value:function(){var e=this,t=this.state.routeName.replace(/\.gpx$/,""),n=new In.Route(t),r=1;this.state.convertedPoints.forEach((function(e){r=n.addPoint(r,e),r++})),rk.saveRoute(n,!0).then((function(){e.props.closeCallback(),Wi.getCurrentChartEntry()&&$a.dialog((function(e){return Ue.createElement(ck,zw({},e,{route:n}))}))})).catch((function(e){ct(e)}))}},{key:"convert",value:function(){var e=this,t=new Uw(this.state.points,!1,void 0,this.state.maxXte);this.setState({processing:!0}),window.setTimeout((function(){var n=t.process();ak(n).then((function(t){e.info.setState(t,!0),e.setState({convertedPoints:n,processing:!1})}))}),10)}},{key:"render",value:function(){var e=this,t=this.props.maxroute||50,n=this.info.getValue("numPoints"),r=this.existsRoute(this.state.routeName),o=this.state.routeName.replace(/\.gpx$/,"");return Ue.createElement("div",{className:"TrackConvertDialog flexInner"},Ue.createElement("h3",{className:"dialogTitle"},"Convert Track to Route"),Ue.createElement(tu,{dialogRow:!0,label:"route name",value:o,onChange:function(t){return e.setState({routeName:t+".gpx"})}}),r&&Ue.createElement("div",{className:"warning"},"Name already exists"),Ue.createElement("div",{className:"originalPoints"},Ue.createElement("div",{className:"heading dialogRow"},"original points"),uk.map((function(t){return e.getRowValue(e.originalInfo.getState(),t)}))),Ue.createElement("div",{className:"computedPoints"},Ue.createElement("div",{className:"heading dialogRow"},"optimized points"),uk.map((function(t){return e.getRowValue(e.info.getState(),t)}))),Ue.createElement("div",{className:"converter"},n>t&&Ue.createElement("div",{className:"warning"},"Your track contains more then ".concat(t," points. \n                You should reduce this count by clicking compute below. \n                Potentially you need to enlarge the allowed Xte")),Ue.createElement("div",{className:"heading dialogRow"},"converter options"),Ue.createElement(tu,{dialogRow:!0,label:"max Xte",value:this.state.maxXte,onChange:function(t){return e.setState({maxXte:t})}}),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"convert",onClick:this.convert},"Compute"))),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"cancel",onClick:this.props.closeCallback},"Cancel"),r?Ue.createElement(Ia,{name:"ok",onClick:this.okClicked},"Overwrite"):Ue.createElement(Ia,{name:"ok",onClick:this.okClicked},"Save")))}}])}(Ue.Component);pk.propTypes={history:Ge().object.isRequired,points:Ge().array.isRequired,name:Ge().string.isRequired},pk.showDialog=function(e,t,n){n||(n=$a.dialog),lk(t).then((function(r){n((function(n){return Ue.createElement(pk,zw({},n,{history:e,points:r.points,name:t}))}))})).catch((function(e){return ct(e)}))};var fk=function(e){function t(e){var n;return $w(this,t),(n=Gw(this,t,[e])).state={points:[],loaded:!1,name:n.props.name},n.showConvertDialog=n.showConvertDialog.bind(n),n}return Jw(t,e),tk(t,[{key:"componentDidMount",value:function(){var e=this;lk(this.props.name).then((function(t){e.setState(y()({loaded:!0},t))})).catch((function(e){return ct(e)}))}},{key:"showConvertDialog",value:function(){var e=this;this.props.closeCallback(),$a.dialog((function(t){return Ue.createElement(pk,zw({},t,{points:e.state.points,name:e.props.name}))}))}},{key:"render",value:function(){var e=this;return Ue.createElement("div",{className:"TrackInfoDialog flexInner"},Ue.createElement("h3",{className:"dialogTitle"},"Track Info"),ok.map((function(t){var n=e.state[t.value];return void 0===n?null:(t.formatter&&(n=t.formatter(n,e.state)),void 0===n?null:Ue.createElement(Qa,{label:t.label,value:n}))})),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"toroute",onClick:this.showConvertDialog,disabled:!this.state.loaded},"Convert"),Ue.createElement(Ia,{name:"cancel",onClick:this.props.closeCallback},"Cancel")))}}])}(Ue.Component);fk.PropTypes={name:Ge().string.isRequired},fk.showDialog=function(e,t){return t||(t=$a.dialog),t((function(t){return Ue.createElement(fk,zw({},e,t))}))};function hk(e){return hk="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hk(e)}function mk(){return mk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},mk.apply(null,arguments)}function dk(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,vk(r.key),r)}}function vk(e){var t=function(e,t){if("object"!=hk(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=hk(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==hk(t)?t:t+""}function yk(e,t,n){return t=bk(t),function(e,t){if(t&&("object"==hk(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,gk()?Reflect.construct(t,n||[],bk(e).constructor):t.apply(e,n))}function gk(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(gk=function(){return!!e})()}function bk(e){return bk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},bk(e)}function wk(e,t){return wk=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},wk(e,t)}var kk=ml.getRoutingHandler(),Ck=[{label:"name",value:"name"},{label:"points",value:"numPoints"},{label:"length",value:"length",formatter:function(e){return W.formatDistance(e)+" nm"}},{label:"next point",value:"routeTarget",formatter:function(e){return e.name}}],Sk=function(e,t){return new Promise((function(n,r){e||r("missing route name"),kk.fetchRoute(e,!1,(function(e){var r=kk.getInfoFromRoute(e),o={length:r.length,numPoints:r.numpoints};t&&(o.routeTarget=function(e,t){var n=e.findBestMatchingIdx(t),r=Oe.getData(ve.nav.routeHandler.useRhumbLine);if(n>=0){var o=e.getPointAtIndex(n),i=e.getPointAtIndex(n+1);return i&&o&&P.computeDistance(t,i,r).dts<=P.computeDistance(o,i,r).dts*(100-Oe.getData(ve.properties.routeCatchRange,50))/100?i:o}}(e,t)),n(o)}),(function(e){return r(e)}))}))},Ek=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=yk(this,t,[e])).state={loaded:!1,name:n.props.name},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&wk(e,t)}(t,e),n=t,(r=[{key:"componentDidMount",value:function(){var e=this;Sk(this.props.name).then((function(t){e.setState(y()({loaded:!0},t))})).catch((function(e){return ct(e)}))}},{key:"render",value:function(){var e=this;return Ue.createElement("div",{className:"RouteInfoDialog flexInner"},Ue.createElement("h3",{className:"dialogTitle"},"Route Info"),Ck.map((function(t){var n=e.state[t.value];return void 0===n?null:(t.formatter&&(n=t.formatter(n,e.state)),void 0===n?null:Ue.createElement(Qa,{label:t.label,value:n}))})),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"cancel",onClick:this.props.closeCallback},"Cancel")))}}])&&dk(n.prototype,r),o&&dk(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);Ek.PropTypes={name:Ge().string.isRequired},Ek.showDialog=function(e,t){return t||(t=$a.dialog),t((function(t){return Ue.createElement(Ek,mk({},e,t))}))};function Ok(e){return Ok="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ok(e)}var Pk=["item"];function Dk(e,t,n){return t=Nk(t),function(e,t){if(t&&("object"==Ok(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Tk()?Reflect.construct(t,n||[],Nk(e).constructor):t.apply(e,n))}function Tk(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Tk=function(){return!!e})()}function Nk(e){return Nk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Nk(e)}function Rk(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&xk(e,t)}function xk(e,t){return xk=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},xk(e,t)}function jk(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ak(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ik(r.key),r)}}function Lk(e,t,n){return t&&Ak(e.prototype,t),n&&Ak(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ik(e){var t=function(e,t){if("object"!=Ok(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Ok(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Ok(t)?t:t+""}function Mk(){return Mk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Mk.apply(null,arguments)}var _k=ml.getRoutingHandler(),Fk={url:!0,chartKey:!0},Bk=function(e){var t=e.item,n=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,Pk);if(!1===t.canDownload)return null;var r=Wk(t);return Ue.createElement(Ww,Mk({},n,{url:r?void 0:Vk(t),fileName:Hk(t),localData:r,type:t.type,androidUrl:t.url}))},Wk=function(e){return"route"!==e.type||e.server?"layout"===e.type?pn.getLocalDownload(e.name):void 0:function(){return _k.getLocalRouteXml(e.name)}},Hk=function(e){return Uk.create(e,!1).nameForDownload(e.name)},Vk=function(e){var t=e.name;if("route"===e.type){if(!1===e.server)return;t.match(/\.gpx$/)||(t+=".gpx")}var n=Oe.getData(ve.properties.navUrl)+"?request=download&type="+encodeURIComponent(e.type)+"&name="+encodeURIComponent(t)+"&filename="+encodeURIComponent(Hk(e));for(var r in Fk)void 0!==e[r]&&(n+="&"+r+"="+encodeURIComponent(e[r]));return n},Kk={track:function(e,t){pk.showDialog(e,t.name)}},Uk=function(){function e(t){jk(this,e),this.type=t,this.headline=t,this.showEdit=!1,this.showView=!1,this.showDelete=!1,this.showRename=!1,this.showApp=!1,this.isApp=!1,this.showOverlay=!1,this.showScheme=!1,this.showConvertFunction=void 0,this.showImportLog=!1,this.showDownload=!1,this.showIsServer=!1,this.timeText="",this.infoText="",this.className="",this.extForView="",this.localUploadFunction=void 0,this.nameForDownload=function(e){return e},this.nameForUpload=function(e){return e}}return Lk(e,null,[{key:"create",value:function(t,n){if("string"==typeof t&&(t={type:t}),!t||!t.type)return new e;var r=new e(t.type),o=d.getExt(t.name),i=ww.VIEWABLES.indexOf(o)>=0,a=void 0!==t.size&&t.size<ww.MAXEDITSIZE,s=rd.indexOf(d.getExt(t.name,!0))>=0,l=Oe.getData(ve.gui.capabilities.uploadOverlays)&&n;switch(void 0!==t.time&&(r.timeText=W.formatDateTime(new Date(1e3*t.time))),r.infoText=t.name,t.active&&(r.className+=" activeEntry"),r.extForView=o,t.type){case"chart":r.headline="Charts",r.showDelete=t.canDelete&&n,r.showOverlay=l,r.showScheme=n&&t.url&&t.url.match(/.*mbtiles.*/),r.showImportLog=t.hasImportLog,r.showDownload=t.canDelete,t.originalScheme&&(r.className+=" userAction");break;case"track":r.headline="Tracks",r.showDelete=!0,r.showDownload=!0,r.showView=i,r.showConvertFunction="gpx"===o?Kk[t.type]:void 0,r.showOverlay=s&&l;break;case"route":r.headline="Routes",r.showIsServer=t.server,r.showDelete=!t.active&&!1!==t.canDelete&&(!t.isServer||n),r.showView=i,r.showEdit=void 0!==Wi.getCurrentChartEntry(),r.showOverlay=l,r.showDownload=!0,r.extForView="gpx",r.infoText+=","+W.formatDecimal(t.length,4,2)+" nm, "+t.numpoints+" points",r.nameForDownload=function(e){return e.match(/\.gpx$/)||(e+=".gpx"),e},r.nameForUpload=function(e){return e.replace(/\.gpx$/,"")},r.localUploadFunction=function(e,t){try{var n=new In.Route("");return n.fromXml(t),n.name?_k.saveRoute(n):Promise.reject("route has no name")}catch(e){return Promise.reject(e)}};break;case"layout":r.headline="Layouts",r.showDelete=n&&!1!==t.canDelete&&!t.active,r.showView=!0,r.showEdit=n&&a&&t.canDelete,r.showDownload=!0,r.extForView="json",r.nameForDownload=function(e){return pn.nameToBaseName(e)+".json"},r.nameForUpload=function(e){return pn.fileNameToServerName(e)},r.localUploadFunction=function(e,t,n){return pn.uploadLayout(e,t,n)};break;case"settings":r.headline="Settings",r.showDelete=n&&!1!==t.canDelete&&!t.active,r.showView=!0,r.showEdit=n&&a&&t.canDelete,r.showDownload=!0,r.showRename=n&&t.canDelete,r.extForView="json",r.nameForDownload=function(e){return e.replace(/^user\./,"").replace(/^system\./,"").replace(/^plugin/,"")+".json"},r.nameForUpload=function(e){var t=e;return["user","system","plugin"].forEach((function(e){0===t.indexOf(e+".")&&(t=t.substr(e.length+1))})),"user."+t.replace(/\.json$/,"")},r.localUploadFunction=function(e,t,n){return vn.verifySettingsData(t,!0,!0).then((function(t){return vn.uploadSettingsData(e,t.data,!1,n)}))};break;case"user":r.headline="User",r.showDelete=n&&t.canDelete,r.showRename=n&&t.canDelete,r.showView=i,r.showEdit=a&&ww.EDITABLES.indexOf(o)>=0&&t.canDelete&&n,r.showDownload=!0,r.showApp=n&&"html"===o&&Oe.getData(ve.gui.capabilities.addons),r.isApp=r.showApp&&t.isAddon;break;case"images":r.headline="Images",r.showDelete=n&&!1!==t.canDelete,r.showView=i,r.showRename=n&&!1!==t.canDelete,r.showDownload=!0;break;case"overlay":r.headline="Overlays",r.showDelete=n&&!1!==t.canDelete,r.showView=i,r.showRename=n&&!1!==t.canDelete,r.showDownload=!0,r.showEdit=a&&ww.EDITABLES.indexOf(o)>=0&&n,r.showOverlay=l&&s}return r}}])}(),qk=function(e){function t(e){var n;return jk(this,t),(n=Dk(this,t,[e])).state={},n.state.chartList=[yd],n.state.chart=yd.chartKey,n.state.action="add",n.state.changed=!1,n.titles={add:"Add to Charts",remove:"Remove from Charts"},n.dialogHelper=Ya(n),n}return Rk(t,e),Lk(t,[{key:"componentDidMount",value:function(){var e=this;wt.getJson("",{},{request:"list",type:"chart"}).then((function(t){e.setState({chartList:e.state.chartList.concat(t.items)})})).catch((function(e){return ct("unable to read chart list: "+e)}))}},{key:"action",value:function(){if("remove"!==this.state.action)if("add"!==this.state.action);else{var e=this.findChart(this.state.chart);if(!e)return;gd.createDialog(e,void 0,this.props.current)}else wt.getJson("",{},{request:"api",type:"chart",command:"deleteFromOverlays",name:this.props.current.name,itemType:this.props.current.type}).then((function(){})).catch((function(e){ct(e)}))}},{key:"findChart",value:function(e){for(var t=0;t<this.state.chartList.length;t++)if(this.state.chartList[t].chartKey===e)return this.state.chartList[t]}},{key:"getChartSelectionList",value:function(){if("remove"===this.state.action)return{label:yd.name,value:yd.chartKey};var e=[];return this.state.chartList.forEach((function(t){t.chartKey&&e.push({label:t.name,value:t.chartKey})})),e}},{key:"getCurrentChartValue",value:function(){return"remove"===this.state.action?{label:"All Charts",value:void 0}:{label:(this.findChart(this.state.chart)||{}).name,value:this.state.chart}}},{key:"render",value:function(){var e=this;return Ue.createElement("div",{className:"AddRemoveOverlayDialog flexInner"},Ue.createElement("h3",{className:"dialogTitle"},"On Charts"),Ue.createElement("div",{className:"dialogRow"},Ue.createElement("span",{className:"itemInfo"},this.props.current.name)),Ue.createElement(ru,{dialogRow:!0,label:"Action",value:this.state.action,onChange:function(t){e.setState({changed:!0,action:t})},itemList:[{label:this.titles.add,value:"add"},{label:this.titles.remove,value:"remove"}]}),Ue.createElement(iu,{dialogRow:!0,label:"Chart",value:this.getCurrentChartValue(),onChange:function(t){e.setState({changed:!0,chart:t})},changeOnlyValue:!0,showDialogFunction:this.dialogHelper.showDialog,itemList:this.getChartSelectionList()}),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"cancel",onClick:function(){e.props.closeCallback()}},"Cancel"),Ue.createElement(Ia,{name:"ok",onClick:function(){e.action(),e.props.closeCallback()}},"Ok")))}}])}(Ue.Component),zk=[],Gk={track:ok,route:Ck},Zk={track:lk,route:Sk},Xk=function(e){function t(e){var n;return jk(this,t),(n=Dk(this,t,[e])).state={changed:!1,existingName:!1,name:e.current.name,scheme:e.current.scheme,allowed:Uk.create(e.current,Oe.getData(ve.properties.connectedMode,!0))},n.onChange=n.onChange.bind(n),n.extendedInfo=Lt(n,{},"extendedInfo"),n}return Rk(t,e),Lk(t,[{key:"componentDidMount",value:function(){var e=this,t=Zk[this.props.current.type];t&&t(this.props.current.name).then((function(t){e.extendedInfo.setState(t,!0)})).catch((function(){}))}},{key:"infoRowDisplay",value:function(e,t){var n=t[e.value];return void 0===n?null:(e.formatter&&(n=e.formatter(n,t)),void 0===n?null:Ue.createElement(Qa,{label:e.label,value:n}))}},{key:"onChange",value:function(e){if(e!==this.state.name)if(e!==this.props.current.name){var t={name:e,changed:!0};this.props.checkName&&(t.existingName=this.props.checkName(e)),this.setState(t)}else this.setState({changed:!1,existingName:!1,name:e})}},{key:"render",value:function(){var e=this,t=this,n=this.state.existingName?"existing":"",r=this.state.changed&&!this.state.existingName&&this.state.name!==this.props.current.name,o=this.state.allowed.showScheme&&((this.props.current.scheme||"tms")!==this.state.scheme||this.props.current.originalScheme),i=Gk[this.props.current.type];return Ue.createElement(Ue.Fragment,null,Ue.createElement("div",{className:"fileDialog flexInner"},Ue.createElement("h3",{className:"dialogTitle"},this.props.current.name),void 0!==this.props.current.info?Ue.createElement("div",{className:"dialogRow"},Ue.createElement("span",{className:"itemInfo"},this.props.current.info)):null,zk.map((function(t){return e.infoRowDisplay(t,e.props)})),i&&i.map((function(t){return e.infoRowDisplay(t,e.extendedInfo.getState())})),this.state.allowed.showScheme&&this.props.current.originalScheme&&Ue.createElement("div",{className:"dialogRow userAction"},Ue.createElement("span",{className:"inputLabel"},"original DB scheme"),Ue.createElement("span",{className:"value"},this.props.current.originalScheme)),this.state.allowed.showScheme&&Ue.createElement(ru,{label:"scheme",value:this.state.scheme,onChange:function(t){e.setState({changed:!0,scheme:t})},itemList:[{label:"xyz",value:"xyz"},{label:"tms",value:"tms"}],className:"mbtilesType"}),this.state.allowed.showRename?Ue.createElement("div",{className:"dialogRow"},Ue.createElement(tu,{label:this.state.existingName?"existing":"new name",className:n,value:this.state.name,onChange:this.onChange})):null,Ue.createElement("div",{className:"dialogButtons"},this.state.allowed.showRename||this.state.allowed.showScheme?Ue.createElement(Ia,{name:"ok",onClick:function(){t.props.closeCallback();var n="";r&&(n+="rename"),o&&e.props.current.scheme!==e.state.scheme&&(""===n?n="scheme":n+=",scheme"),t.props.okFunction(n,y()({},e.props.current,{name:e.state.name,scheme:e.state.scheme}))},disabled:!r&&!o},"Change"):null,this.state.allowed.showDelete?Ue.createElement(Ia,{name:"delete",onClick:function(){t.props.closeCallback(),t.props.okFunction("delete",e.props.current.name)},disabled:this.state.changed},"Delete"):null),Ue.createElement("div",{className:"dialogButtons"},this.state.allowed.showImportLog&&Ue.createElement(Ia,{name:"log",onClick:function(){e.props.closeCallback(),$a.dialog((function(t){return Ue.createElement(Sg,Mk({},t,{baseUrl:(n=e.props.current.name,Oe.getData(ve.properties.navUrl)+"?request=api&type=import&command=getlog&name="+encodeURIComponent(n)),title:"Import Log"}));var n}))}},"Log"),this.state.allowed.showConvertFunction&&Ue.createElement(Ia,{name:"toroute",onClick:function(){e.props.closeCallback(),e.props.okFunction("convert",e.props.current)}},"Convert"),this.state.allowed.showView?Ue.createElement(Ia,{name:"view",onClick:function(){t.props.closeCallback(),t.props.okFunction("view",e.props.current)},disabled:this.state.changed},"View"):null,this.state.allowed.showEdit?Ue.createElement(Ia,{name:"edit",onClick:function(){t.props.closeCallback(),t.props.okFunction("edit",e.props.current)},disabled:this.state.changed},"Edit"):null,this.state.allowed.showOverlay?Ue.createElement(Ia,{name:"overlays",onClick:function(){t.props.closeCallback(),t.props.okFunction("overlay",e.props.current)},disabled:this.state.changed},"Overlays"):null,Ue.createElement(Bk,{name:"download",disabled:this.state.changed,item:this.props.current||{},useDialogButton:!0,onClick:this.props.closeCallback},"Download"),this.state.allowed.showApp&&Ue.createElement(Ia,{name:"userApp",onClick:function(){e.props.closeCallback(),e.props.okFunction("userapp",e.props.current)},disabled:this.state.changed},"App"),Ue.createElement(Ia,{name:"cancel",onClick:t.props.closeCallback},"Cancel"))))}}])}(Ue.Component),Jk=function(e,t,n){return y()({},d.filteredAssign(Fk,t),n,{request:e,type:t.type,name:t.name})},Yk=function(e,t){var n=function(){t&&t(e)},r=$a.confirm("delete "+e.name+"?");r.then((function(){"layout"!==e.type?"route"!==e.type?wt.getJson("",{},Jk("delete",e)).then((function(){"track"===e.type&&ml.resetTrack(),n()})).catch((function(t){ct("unable to delete "+e.name+": "+t),n()})):(_k.isActiveRoute(e.name)&&(ct("unable to delete active route"),n()),_k.deleteRoute(e.name,(function(){n()}),(function(e){ct("unable to delete route: "+e),n()}),!e.server)):pn.deleteItem(e.name).then((function(e){n()})).catch((function(t){ct("unable to delete layout "+e.name+": "+t),n()}))})),r.catch((function(){i.log("delete canceled"),n()}))};function Qk(e){return Qk="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qk(e)}function $k(){return $k=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},$k.apply(null,arguments)}function eC(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tC(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,rC(r.key),r)}}function nC(e,t,n){return t&&tC(e.prototype,t),n&&tC(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function rC(e){var t=function(e,t){if("object"!=Qk(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Qk(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Qk(t)?t:t+""}function oC(e,t,n){return t=aC(t),function(e,t){if(t&&("object"==Qk(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,iC()?Reflect.construct(t,n||[],aC(e).constructor):t.apply(e,n))}function iC(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(iC=function(){return!!e})()}function aC(e){return aC=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},aC(e)}function sC(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&lC(e,t)}function lC(e,t){return lC=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},lC(e,t)}var uC=function(e,t){return t?t+e:e},cC=function(e){function t(e){var n;eC(this,t),n=oC(this,t,[e]);var r=function(e,t){if(t){var n=t.length;return e.substr(0,n)===t?e.substr(n):e}return e}(e.value,e.fixedPrefix);return n.state=y()({value:r},e.checkFunction(uC(r,n.props.fixedPrefix))),n.valueChanged=n.valueChanged.bind(n),n}return sC(t,e),nC(t,[{key:"valueChanged",value:function(e){var t=y()({value:e},this.props.checkFunction(uC(e,this.props.fixedPrefix)));this.setState(t)}},{key:"render",value:function(){var e=this,t="New ";return this.state.active?t="Active ":this.state.existing&&(t="Existing "),t+=this.props.itemLabel,Ue.createElement("div",{className:this.props.className+" inner saveItemDialog"},Ue.createElement("h3",{className:"dialogTitle"},this.props.title||"Select "+this.props.itemLabel+" Name"),this.props.subTitle?Ue.createElement("p",null,this.props.subTitle):null,Ue.createElement("div",null,Ue.createElement("div",{className:"dialogRow"},Ue.createElement("span",{className:"wideLabel"},t)),Ue.createElement("div",{className:"dialogRow"},Ue.createElement(tu,{className:"saveName",label:this.props.fixedPrefix||"",value:this.state.value,onChange:this.valueChanged}))),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"cancel",onClick:this.props.closeCallback},"Cancel"),Ue.createElement(Ia,{name:"ok",onClick:function(){e.props.okCallback(uC(e.state.value,e.props.fixedPrefix)),e.props.closeCallback()},disabled:this.state.existing&&!this.props.allowOverwrite},this.state.existing&&this.props.allowOverwrite?"Overwrite":"Ok")))}}])}(Ue.Component);cC.propTypes={title:Ge().string,subTitle:Ge().string,className:Ge().string,fixedPrefix:Ge().string,checkFunction:Ge().func.isRequired,itemLabel:Ge().string.isRequired,allowOverwrite:Ge().bool,value:Ge().string,okCallback:Ge().func.isRequired,closeCallback:Ge().func.isRequired},cC.createDialog=function(e,t,n){return n||(n={}),new Promise((function(r,o){$a.dialog((function(o){return Ue.createElement(cC,$k({},n,o,{value:e,okCallback:function(e){r(e)},checkFunction:function(e){return!!t&&t(e)}}))}),void 0,(function(){o("")}))}))};var pC=function(e){function t(e){var n;return eC(this,t),(n=oC(this,t,[e])).state={value:e.value},n.valueChanged=n.valueChanged.bind(n),n.dialog=Ya(n),n}return sC(t,e),nC(t,[{key:"valueChanged",value:function(e){var t={value:e};this.setState(t)}},{key:"render",value:function(){var e=this;return Ue.createElement("div",{className:this.props.className+" inner loadItemDialog"},Ue.createElement("h3",{className:"dialogTitle"},this.props.title||"Select "+this.props.itemLabel),this.props.subTitle?Ue.createElement("p",null,this.props.subTitle):null,Ue.createElement("div",null,Ue.createElement("div",{className:"dialogRow"},Ue.createElement(iu,{className:"loadName",label:this.props.itemLabel,value:this.state.value,itemList:this.props.itemList,onChange:this.valueChanged,changeOnlyValue:!0,showDialogFunction:this.dialog.showDialog}))),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"cancel",onClick:this.props.closeCallback},"Cancel"),Ue.createElement(Ia,{name:"ok",onClick:function(){e.props.okCallback(e.state.value),e.props.closeCallback()}},"Ok")))}}])}(Ue.Component);function fC(e){return fC="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fC(e)}function hC(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,mC(r.key),r)}}function mC(e){var t=function(e,t){if("object"!=fC(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=fC(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==fC(t)?t:t+""}function dC(e,t,n){return t=yC(t),function(e,t){if(t&&("object"==fC(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,vC()?Reflect.construct(t,n||[],yC(e).constructor):t.apply(e,n))}function vC(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(vC=function(){return!!e})()}function yC(e){return yC=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},yC(e)}function gC(e,t){return gC=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},gC(e,t)}pC.propTypes={title:Ge().string,subTitle:Ge().string,className:Ge().string,itemLabel:Ge().string.isRequired,value:Ge().string,itemList:Ge().any.isRequired,okCallback:Ge().func.isRequired,closeCallback:Ge().func.isRequired},pC.createDialog=function(e,t,n){return n||(n={}),new Promise((function(r,o){$a.dialog((function(o){return Ue.createElement(pC,$k({},n,o,{value:e,okCallback:function(e){r(e)},itemList:t}))}),void 0,(function(){o("")}))}))};var bC=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=dC(this,t,[e]);var r=e.name,o=d.getExt(r);return r=r.substr(0,r.length-o.length-1),n.state={subdir:e.subdir,useSubdir:!!e.subdir,name:r,ext:o},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&gC(e,t)}(t,e),n=t,(r=[{key:"render",value:function(){var e=this;return Ue.createElement(Ue.Fragment,null,Ue.createElement("div",{className:"importDialog flexInner"},Ue.createElement("h3",{className:"dialogTitle"},"Upload Chart to Importer"),!this.props.allowNameChange&&Ue.createElement(ou,{dialogRow:!0,label:"name",value:this.state.name},Ue.createElement("span",{className:"ext"},".",this.state.ext)),this.props.allowNameChange&&Ue.createElement(tu,{dialogRow:!0,value:this.state.name,onChange:function(t){e.setState({name:t})},label:"name"},Ue.createElement("span",{className:"ext"},".",this.state.ext)),this.props.allowSubDir&&Ue.createElement(nu,{dialogRow:!0,label:"use set name",value:this.state.useSubdir,onChange:function(t){return e.setState({useSubdir:t})}}),this.props.allowSubDir&&this.state.useSubdir?Ue.createElement(tu,{dialogRow:!0,label:"set name",value:this.state.subdir,onChange:function(t){e.setState({subdir:t})}}):null,Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"cancel",onClick:function(){e.props.cancelFunction(),e.props.closeCallback()}},"Cancel"),Ue.createElement(Ia,{name:"ok",onClick:function(){e.props.okFunction(y()({},e.props,{name:e.state.name+"."+e.state.ext}),e.state.useSubdir?e.state.subdir:void 0),e.props.closeCallback()},disabled:this.state.useSubdir&&!this.state.subdir},"OK"))))}}])&&hC(n.prototype,r),o&&hC(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);bC.propTypes={okFunction:Ge().func.isRequired,cancelFunction:Ge().func.isRequired,subdir:Ge().string,name:Ge().string.isRequired,allowSubDir:Ge().bool,allowNameChange:Ge().bool};var wC=function(){return new Promise((function(e,t){Oe.getData(ve.gui.capabilities.uploadImport)||e([]),wt.getJson({request:"api",type:"import",command:"extensions"}).then((function(t){e(t.items)})).catch((function(){e([])}))}))},kC=function(e,t){if(!e||!t)return{allow:!1,subdir:!1};e=e.toUpperCase(),d.startsWith(e,".")||(e="."+e);for(var n=0;n<t.length;n++)if(t[n].ext===e)return{allow:!0,subdir:t[n].sub};return{allow:!1,sub:!1}},CC=bC;function SC(e){return SC="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},SC(e)}function EC(){return EC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},EC.apply(null,arguments)}function OC(e,t,n){return t=DC(t),function(e,t){if(t&&("object"==SC(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,PC()?Reflect.construct(t,n||[],DC(e).constructor):t.apply(e,n))}function PC(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(PC=function(){return!!e})()}function DC(e){return DC=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},DC(e)}function TC(e,t){return TC=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},TC(e,t)}function NC(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,xC(r.key),r)}}function RC(e,t,n){return t&&NC(e.prototype,t),n&&NC(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function xC(e){var t=function(e,t){if("object"!=SC(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=SC(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==SC(t)?t:t+""}function jC(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var AC=ml.getRoutingHandler(),LC=RC((function e(t,n,r){jC(this,e),this.name=t,this.type=n||"track",this.time=r||0,this.canDelete=!0})),IC=function(e,t){for(var n=0;n<e.length;n++)if(e[n].name===t.name)return n;return-1},MC=function(e,t){return void 0!==e.time&&void 0!==t.time?t.time-e.time:e.name>t.name?1:e.name<t.name?-1:0},_C=function(e){var t=Uk.create(e,Oe.getData(ve.properties.connectedMode,!1)),n="listEntry "+t.className,r="downloadItemData";return t.showDelete||(r+=" noDelete"),Ue.createElement("div",{className:n,onClick:function(t){e.onClick("select")}},e.icon&&Ue.createElement("span",{className:"icon",style:{backgroundImage:"url('"+e.icon+"')"}}),t.showDelete&&Ue.createElement(ds,{name:"Delete",className:"Delete smallButton",onClick:function(t){t.preventDefault(),t.stopPropagation(),e.onClick("delete")}}),Ue.createElement("div",{className:"itemMain"},Ue.createElement("div",{className:r},Ue.createElement("div",{className:"date"},t.timeText),Ue.createElement("div",{className:"info"},t.infoText)),Ue.createElement("div",{className:"infoImages"},t.showView&&Ue.createElement("div",{className:"viewimage"}),t.showEdit&&Ue.createElement("div",{className:"editimage"}),t.showIsServer&&Ue.createElement("div",{className:"listrasimage"}),t.isApp&&Ue.createElement("div",{className:"appimage"}))),Ue.createElement(Bk,{name:"Download",className:"Download smallButton",item:e}))},FC=function(e){function t(e){var n;jC(this,t),(n=OC(this,t,[e])).getButtons=n.getButtons.bind(n);var r="chart";return e.options&&e.options.downloadtype&&(r=e.options.downloadtype),n.state={uploadSequence:0,type:r,items:[],addOns:[],chartImportExtensions:[],importSubDir:""},n.checkNameForUpload=n.checkNameForUpload.bind(n),n.changeType=n.changeType.bind(n),n.entryExists=n.entryExists.bind(n),n.fillData=n.fillData.bind(n),n.readAddOns(),n.fillData(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&TC(e,t)}(t,e),RC(t,[{key:"componentDidMount",value:function(){var e=this;wC().then((function(t){e.setState({chartImportExtensions:t})}))}},{key:"componentDidUpdate",value:function(e,t,n){t.type===this.state.type&&e.reloadSequence===this.props.reloadSequence||this.fillData()}},{key:"readAddOns",value:function(){var e=this;_m(!0).then((function(t){e.setState({addOns:t}),e.fillData()})).catch((function(){}))}},{key:"addItems",value:function(e,t){var n=t?[]:this.state.items||[],r=[];for(var o in n)r.push(n[o]);for(var i in e){var a=IC(r,e[i]);a>=0?r[a]=e[i]:r.push(e[i])}r.sort(MC),this.setState({items:r})}},{key:"fillData",value:function(){var e=this,t=this.state.type;("route"===t?AC.listRoutes(!0):"layout"===t?pn.listLayouts():"settings"===t?vn.listSettings():function(e){return wt.getJson({request:"listdir",type:e}).then((function(t){var n=[];"chart"===e&&n.push(y()({},yd));for(var r=0;r<t.items.length;r++){var o=new LC;y()(o,t.items[r]),void 0!==o.name&&(o.type=e,o.server=!0,o.icon||"chart"!==e||(o.icon=wm),void 0===o.canDelete&&(o.canDelete=!1),n.push(o))}return n}))}(t).then((function(t){var n=e.state.addOns;return t.forEach((function(e){"user"===e.type&&Fm(n,e.url)&&(e.isAddon=!0)})),t}))).then((function(t){return e.addItems(t,!0)})).catch((function(n){ct("unable to load "+t+": "+n),e.addItems([],!0)}))}},{key:"changeType",value:function(e){e!==this.state.type&&(this.setState({type:e,items:[]}),this.props.history.replace(this.props.history.currentLocation(),{downloadtype:e}))}},{key:"entryExists",value:function(e){var t=this.state.items;return IC(t,{name:e})>=0}},{key:"getButtonParam",value:function(e,t,n,r){var o=this,i=this.state.type===t||!(this.props.options&&!1===this.props.options.allowChange);return r&&(i=i&&Oe.getData(r,!1)),{name:e,toggle:this.state.type===t,visible:i,onClick:function(){return o.changeType(t)},overflow:!0===n}}},{key:"getButtons",value:function(){var e=this;this.props.options&&this.props.options.allowChange;return[this.getButtonParam("DownloadPageCharts","chart"),{name:"DownloadPageImporter",onClick:function(){return e.props.history.push("importerpage")},storeKeys:{visible:ve.gui.capabilities.uploadImport}},this.getButtonParam("DownloadPageTracks","track"),this.getButtonParam("DownloadPageRoutes","route"),this.getButtonParam("DownloadPageLayouts","layout"),this.getButtonParam("DownloadPageSettings","settings",!0,ve.gui.capabilities.uploadSettings),this.getButtonParam("DownloadPageUser","user",!0),this.getButtonParam("DownloadPageImages","images",!0),this.getButtonParam("DownloadPageOverlays","overlay",!0),{name:"DownloadPageUpload",visible:("route"===this.state.type||"layout"===this.state.type.type||"chart"===this.state.type&&Oe.getData(ve.gui.capabilities.uploadCharts,!1)||"user"===this.state.type&&Oe.getData(ve.gui.capabilities.uploadUser,!1)||"images"===this.state.type&&Oe.getData(ve.gui.capabilities.uploadImages,!1)||"overlay"===this.state.type&&Oe.getData(ve.gui.capabilities.uploadOverlays,!1)||"settings"===this.state.type&&Oe.getData(ve.gui.capabilities.uploadOverlays,!1)||"layout"===this.state.type&&Oe.getData(ve.gui.capabilities.uploadLayout,!1)||"track"===this.state.type&&Oe.getData(ve.gui.capabilities.uploadTracks,!1))&&Oe.getData(ve.properties.connectedMode,!0),onClick:function(){e.setState({uploadSequence:e.state.uploadSequence+1})}},Lm(this.props.history),{name:"Cancel",onClick:function(){e.props.history.pop()}}]}},{key:"checkNameForUpload",value:function(e){var t=this;return new Promise((function(n,r){var o=Uk.create({type:t.state.type},!1),i=d.getExt(e),a={name:e},s=o.nameForUpload(e);if("route"!==t.state.type||"gpx"===i)if("track"!==t.state.type||"gpx"===i)if("images"===t.state.type&&It.IMAGES.indexOf(i)<0)r("only images of types "+It.IMAGES.join(","));else{if("settings"===t.state.type)return"json"!==i?void r("only .json files allowed for settings"):t.entryExists(s)?void cC.createDialog(s,(function(e){return{existing:t.entryExists(e)}}),{title:"Settings file exists, select new name",itemLabel:"Settings",fixedPrefix:"user."}).then((function(e){n({name:e})})).catch((function(e){r(e)})):void n(a);if("layout"!==t.state.type){if("chart"===t.state.type){if(["gemf","mbtiles","xml"].indexOf(i)<0){var l=kC(i,t.state.chartImportExtensions);return l.allow?void $a.dialog((function(o){return Ue.createElement(CC,EC({},o,{allowNameChange:!0,allowSubDir:l.subdir,okFunction:function(e,r){r!==t.state.importSubDir&&t.setState({importSubDir:r}),n({name:e.name,type:"import",uploadParameters:{subdir:r},showImportPage:!0})},cancelFunction:function(){return r("canceled")},name:e,subdir:t.state.importSubDir}))})):void r('unknown chart type "'+i+'"')}}t.entryExists(e)?r("already exists"):n(a)}else t.entryExists(s)?cC.createDialog(s,(function(e){return{existing:t.entryExists(e)}}),{title:"Layout exists, select new name",itemLabel:"Layout",fixedPrefix:"user."}).then((function(e){n({name:e})})).catch((function(e){r(e)})):n(a)}else r("only gpx for tracks");else r("only gpx for routes")}))}},{key:"getLocalUploadFunction",value:function(){var e=this,t=Uk.create(this.state.type);if(t.localUploadFunction)return function(n){n?t.localUploadFunction(n.name,n.data).then((function(t){return e.fillData()})).catch((function(t){ct(t),e.fillData()})):ct("no data available after upload")}}},{key:"createItem",value:function(){var e=this;$a.valueDialogPromise("enter filename","").then((function(t){if(e.entryExists(t))ct("already exists");else{wt.postPlain({request:"upload",type:e.state.type,name:t},"").then((function(t){e.fillData()})).catch((function(t){ct("creation failed: "+t),e.fillData()}))}})).catch((function(){}))}},{key:"render",value:function(){var e=this,t=this,n=this.getLocalUploadFunction();return Ue.createElement(bm,EC({},t.props,{id:"downloadpage",mainContent:Ue.createElement(Ue.Fragment,null,Ue.createElement(Ea,{itemClass:_C,scrollable:!0,itemList:this.state.items,onItemClick:function(n,r){return console.log("click on "+n.name+" type="+r),"delete"===r?Yk(n,e.fillData):"download"===r?e.download(n):t.props.options&&t.props.options.selectItemCallback?t.props.options.selectItemCallback(n):void("chart"!==n.type||Vr(n)!==Vr(yd)?function(e,t,n,r){var o=function(r,o){var i=function(e){n&&n(r,o,e)},a=function(e,n){wt.getJson("",{},Jk("api",t,{command:"rename",newName:n})).then((function(){i()})).catch((function(e){ct("rename failed: "+e),i()}))};if(r.match(/scheme/))(s=o.scheme,wt.getJson("",{},Jk("api",t,{command:"scheme",newScheme:s}))).then((function(){r.match(/rename/)&&a(t.name,o.name),i()})).catch((function(e){ct("change scheme failed: "+e),r.match(/rename/)&&a(t.name,o.name),i()}));else{var s;if("rename"===r)return a(t.name,o.name);if("view"===r)return i(!0),void e.push("viewpage",{type:t.type,name:t.name,readOnly:!0});if("edit"===r)return"route"===t.type?void _k.fetchRoute(t.name,!t.server,(function(t){new $n($n.MODES.EDIT).setNewRoute(t,0),i(!0),e.push("editroutepage",{center:!0})}),(function(e){ct(e),i()})):(i(!0),void e.push("viewpage",{type:t.type,name:t.name}));if("userapp"===r&&Nw.showUserAppDialog(void 0,{url:t.url}).then((function(e){return i()})).catch((function(e){return i()})),"delete"===r)return Yk(t,(function(){return i()}));if("overlay"===r)return i(),"chart"===t.type?gd.createDialog(t):void $a.dialog((function(e){return Ue.createElement(qk,Mk({},e,{current:t}))}));if("convert"!==r);else{var l=Kk[o.type];l&&l(e,o)}}};$a.dialog((function(e){return Ue.createElement(Xk,Mk({},e,{okFunction:o,current:t,checkName:r}))}))}(e.props.history,n,(function(t,n,r){r||("userapp"===t?e.readAddOns():e.fillData())}),(function(t){return e.entryExists(t)})):gd.createDialog(n,(function(){return e.fillData()})))}}),Ue.createElement(iw,{local:void 0!==n,type:this.state.type,doneCallback:function(t){t.param&&t.param.showImportPage&&e.props.history.push("importerpage"),n?n(t):e.fillData(t)},errorCallback:function(t){t&&ct(t),e.fillData()},uploadSequence:this.state.uploadSequence,checkNameCallback:this.checkNameForUpload}),"user"===this.state.type?Ue.createElement(ds,{className:"fab",name:"DownloadPageCreate",onClick:function(){e.createItem()}}):null),title:Uk.create({type:this.state.type}).headline,buttonList:this.getButtons()}))}}])}(Ue.Component),BC=ot(FC,{storeKeys:{reloadSequence:ve.gui.global.reloadSequence}}),WC=function(e,t,n,r){var o=function(t){return vn.importSettings(t,e,!0)},i=[],a=void 0;return vn.listSettings().then((function(e){i=e;var o=[],a=void 0;return e.forEach((function(e){e.name===t&&(a=e.name),o.push({label:e.name,value:e.name})})),a&&r?new Promise((function(e,t){e(a)})):pC.createDialog(t,o,{title:n||"Select Settings to load",itemLabel:"Settings"})})).then((function(e){return i.forEach((function(t){t.name===e&&(a=t)})),wt.getJson({request:"download",type:"settings",noattach:!0,name:e},{checkOk:!1})}),(function(e){return Promise.reject()})).then((function(e){var t;return a&&a.scopePrefix&&(t={prefix:a.scopePrefix}),vn.verifySettingsData(e,!1,!1,t)}),(function(e){return Promise.reject(e?"unable to download settings from server: "+e:e)})).then((function(e){return e.warnings&&e.warnings.length?$a.confirm(e.warnings.join("\n"),void 0,"Import anyway?").then((function(){return o(e.data)}),(function(){return Promise.reject()})):o(e.data)}))};function HC(){return HC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},HC.apply(null,arguments)}function VC(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function KC(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,qC(r.key),r)}}function UC(e,t,n){return t&&KC(e.prototype,t),n&&KC(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function qC(e){var t=function(e,t){if("object"!=YC(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=YC(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==YC(t)?t:t+""}function zC(e,t,n){return t=ZC(t),function(e,t){if(t&&("object"==YC(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,GC()?Reflect.construct(t,n||[],ZC(e).constructor):t.apply(e,n))}function GC(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(GC=function(){return!!e})()}function ZC(e){return ZC=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ZC(e)}function XC(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&JC(e,t)}function JC(e,t){return JC=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},JC(e,t)}function YC(e){return YC="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},YC(e)}var QC={Layer:[ve.properties.layers.base,ve.properties.layers.ais,ve.properties.layers.track,ve.properties.layers.nav,ve.properties.layers.boat,ve.properties.layers.grid,ve.properties.layers.compass,ve.properties.layers.scale,ve.properties.layers.user],UpdateTimes:[ve.properties.positionQueryTimeout,ve.properties.trackQueryTimeout,ve.properties.aisQueryTimeout,ve.properties.networkTimeout,ve.properties.connectionLostAlarm],Widgets:[ve.properties.widgetFontSize,ve.properties.allowTwoWidgetRows,ve.properties.showClock,ve.properties.showZoom,ve.properties.showWind,ve.properties.showDepth],Buttons:[ve.properties.style.buttonSize,ve.properties.cancelTop,ve.properties.buttonCols,ve.properties.showDimButton,ve.properties.showFullScreen,ve.properties.hideButtonTime,ve.properties.showButtonShade,ve.properties.autoHideNavPage,ve.properties.autoHideGpsPage,ve.properties.nightModeNavPage,ve.properties.showSplitButton],Layout:[ve.properties.layoutName,ve.properties.baseFontSize,ve.properties.smallBreak,ve.properties.nightFade,ve.properties.nightChartFade,ve.properties.dimFade,ve.properties.localAlarmSound,ve.properties.alarmVolume,ve.properties.titleIcons,ve.properties.titleIconsGps,ve.properties.startLastSplit],AIS:[ve.properties.aisDistance,ve.properties.aisWarningCpa,ve.properties.aisWarningTpa,ve.properties.aisShowEstimated,ve.properties.aisEstimatedOpacity,ve.properties.aisMinDisplaySpeed,ve.properties.aisOnlyShowMoving,ve.properties.aisFirstLabel,ve.properties.aisSecondLabel,ve.properties.aisThirdLabel,ve.properties.aisTextSize,ve.properties.aisUseCourseVector,ve.properties.aisCurvedVectors,ve.properties.aisRelativeMotionVectorRange,ve.properties.style.aisNormalColor,ve.properties.style.aisNearestColor,ve.properties.style.aisWarningColor,ve.properties.style.aisTrackingColor,ve.properties.aisIconBorderWidth,ve.properties.aisIconScale,ve.properties.aisClassbShrink,ve.properties.aisShowA,ve.properties.aisShowB,ve.properties.aisShowOther,ve.properties.aisUseHeading,ve.properties.aisReducedList,ve.properties.aisListUpdateTime,ve.properties.aisHideTime,ve.properties.aisLostTime],Navigation:[ve.properties.bearingColor,ve.properties.bearingWidth,ve.properties.navCircleColor,ve.properties.navCircleWidth,ve.properties.navCircle1Radius,ve.properties.navCircle2Radius,ve.properties.navCircle3Radius,ve.properties.navBoatCourseTime,ve.properties.boatIconScale,ve.properties.boatDirectionMode,ve.properties.boatDirectionVector,ve.properties.boatSteadyDetect,ve.properties.boatSteadyMax,ve.properties.courseAverageTolerance,ve.properties.gpsXteMax,ve.properties.courseAverageInterval,ve.properties.speedAverageInterval,ve.properties.positionAverageInterval,ve.properties.anchorWatchDefault,ve.properties.anchorCircleWidth,ve.properties.anchorCircleColor,ve.properties.windKnots,ve.properties.windScaleAngle,ve.properties.measureColor,ve.properties.measureRhumbLine],Map:[ve.properties.startNavPage,ve.properties.autoZoom,ve.properties.mobMinZoom,ve.properties.style.useHdpi,ve.properties.clickTolerance,ve.properties.featureInfo,ve.properties.emptyFeatureInfo,ve.properties.mapFloat,ve.properties.mapScale,ve.properties.mapUpZoom,ve.properties.mapOnlineUpZoom,ve.properties.mapLockMode,ve.properties.mapLockMove,ve.properties.mapScaleBarText,ve.properties.mapZoomLock],Track:[ve.properties.trackColor,ve.properties.trackWidth,ve.properties.trackInterval,ve.properties.initialTrackLength],Route:[ve.properties.routeColor,ve.properties.routeWidth,ve.properties.routeWpSize,ve.properties.routingTextSize,ve.properties.routeApproach,ve.properties.routeShowLL],Remote:[ve.properties.remoteChannelName,ve.properties.remoteChannelRead,ve.properties.remoteChannelWrite,ve.properties.remoteGuardTime]},$C={};$C[ve.properties.dimFade]=function(){return Vt.canHandle()},$C[ve.properties.showDimButton]=function(){return Vt.canHandle()},$C[ve.properties.showFullScreen]=function(){return Td.fullScreenAvailable()},$C[ve.properties.boatDirectionVector]=function(e){return"cog"!==(e||{})[ve.properties.boatDirectionMode]},$C[ve.properties.aisMinDisplaySpeed]=function(e){return(e||{})[ve.properties.aisOnlyShowMoving]||(e||{})[ve.properties.aisShowEstimated]},$C[ve.properties.aisEstimatedOpacity]=function(e){return(e||{})[ve.properties.aisShowEstimated]},$C[ve.properties.boatSteadyMax]=function(e){return(e||{})[ve.properties.boatSteadyDetect]};var eS={Remote:function(){return Oe.getData(ve.gui.capabilities.remoteChannel)&&void 0!==window.WebSocket}},tS=function(e){var t=(e.className||"")+" listEntry";return e.activeItem&&(t+=" activeEntry"),Ue.createElement("div",{className:t,onClick:e.onClick},e.name)},nS=function(e){return Ue.createElement(nu,{className:e.className,onChange:e.onClick,label:e.label,value:e.value})},rS=function(e){var t=e.value;if("object"!==YC(t))return null;var n=[];for(var r in t)n.push({label:r,value:t[r]});return Ue.createElement("div",null,n.map((function(n){return Ue.createElement(nu,{className:e.className,onChange:function(r){var o=y()({},t);o[n.label]=r,e.onClick(o)},label:n.label,value:n.value})})))},oS=function(e){return Ue.createElement("div",{className:e.className,onClick:function(t){!function(e){var t=function(t){function n(t){var r;return VC(this,n),(r=zC(this,n,[t])).state={value:e.value},r.valueChange=r.valueChange.bind(r),r.buttonClick=r.buttonClick.bind(r),r}return XC(n,t),UC(n,[{key:"valueChange",value:function(e){this.setState({value:e.target.value})}},{key:"buttonClick",value:function(t){var n=t.target.name;if("ok"==n){if(this.state.value<e.values[0]||this.state.value>e.values[1])return void ct("out of range");e.onClick(this.state.value)}"reset"!=n?(pt(),this.props.closeCallback()):this.setState({value:e.defaultv})}},{key:"render",value:function(){var t=e.values[0]+"..."+e.values[1];return Ue.createElement("div",{className:"settingsDialog inner"},Ue.createElement("h3",null,Ue.createElement("span",null,e.label)),Ue.createElement("div",{className:"settingsRange"},"Range: ",t),Ue.createElement("div",{className:"dialogRow"},Ue.createElement("span",{className:"inputLabel"},"Value"),Ue.createElement("input",{type:"number",min:e.values[0],max:e.values[1],step:e.values[2]||1,name:"value",onChange:this.valueChange,value:this.state.value})),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"reset",onClick:this.buttonClick},"Reset"),Ue.createElement(Ia,{name:"cancel",onClick:this.buttonClick},"Cancel"),Ue.createElement(Ia,{name:"ok",onClick:this.buttonClick},"OK")))}}])}(Ue.Component);$a.dialog(t)}(e)}},Ue.createElement("div",{className:"label"},e.label),Ue.createElement("div",{className:"value"},e.value))},iS=function(e){var t=[];for(var n in e.values){var r=e.values[n].split(":");r.length>1?t.push({label:r[0],value:r[1]}):t.push({label:r[0],value:r[0]})}return Ue.createElement("div",{className:e.className},Ue.createElement("div",{className:"label"},e.label),Ue.createElement(ru,{onChange:function(t){e.onClick(t)},itemList:t,value:e.value}))},aS=function(e){var t=[],n=e.value;for(var r in e.values){var o=e.values[r];if("object"!==YC(o)){var i=o.split(":");o=i.length>1?{label:i[0],value:i[1]}:{label:i[0],value:i[0]}}t.push({label:o.label,value:o.value}),o.value===e.value&&(n={label:o.label,value:o.value})}return Ue.createElement(iu,{className:e.className,onChange:function(t){e.onClick(t)},itemList:t,changeOnlyValue:!0,value:n,label:e.label,resetCallback:function(t){e.onClick(e.defaultv)}})},sS=function(e){e.value;return Ue.createElement(au,{className:e.className,onChange:e.onClick,label:e.label,default:e.defaultv,value:e.value})},lS=function(e){return e.type==se.CHECKBOX?nS:e.type==se.MULTICHECKBOX?rS:e.type==se.RANGE?oS:e.type==se.COLOR?sS:e.type==se.LAYOUT?uS:e.type==se.LIST?iS:e.type==se.SELECT?aS:function(e){return Ue.createElement("div",{className:e.className},Ue.createElement("div",{className:"label"},e.label),Ue.createElement("div",{className:"value"},e.value))}},uS=function(e){var t=function(){ct("cannot change layout during editing")};if(pn.isEditing())return e=y()({},e,{value:pn.name}),Ue.createElement(ou,{className:e.className,label:e.label,value:e.value,onClick:t});return Ue.createElement(iu,{className:e.className,onChange:function(n){pn.isEditing()?t():pn.loadLayout(n).then((function(t){e.onClick(n)})).catch((function(e){ct(e+"")}))},itemList:function(e){return new Promise((function(t,n){pn.listLayouts().then((function(n){var r=[];n.forEach((function(t){var n={label:t.name,value:t.name};e===t.name&&(n.selected=!0),r.push(n)})),t(r)})).catch((function(e){return n(e)}))}))},changeOnlyValue:!0,value:e.value,label:e.label,resetCallback:function(t){e.onClick(e.defaultv)}})},cS=function(e){function t(e){var n;VC(this,t);var r=n=zC(this,t,[e]);return n.buttons=[{name:"SettingsOK",onClick:function(){if(r.leftPanelVisible())if(r.hasChanges()){var e=r.values.getValues(!0);if(e[ve.properties.layoutName]!=Oe.getData(ve.properties.layoutName)){if(!pn.hasLoaded(e[ve.properties.layoutName]))return void ct("layout not loaded, cannot activate it");pn.activateLayout()}Oe.storeMultiple(e),n.props.history.pop()}else n.props.history.pop();else r.handlePanel(void 0)}},{name:"SettingsDefaults",onClick:function(){r.confirmAbortOrDo().then((function(){r.resetData()}))}},{name:"SettingsSplitReset",storeKeys:{editing:ve.gui.global.layoutEditing},updateFunction:function(e){return{visible:!e.editing&&Fe.hasPrefix()}},onClick:function(){var e=vn.getMasterValues(),t=[];for(var r in e){de.getKeyDescriptions()[r].type===se.LAYOUT&&t.push(pn.loadLayout(e[r]))}Promise.all(t).then((function(){return n.values.setState(e)})).catch((function(e){return ct(e)}))},overflow:!0},{name:"SettingsAndroid",visible:Oe.getData(ve.gui.global.onAndroid,!1),onClick:function(){r.confirmAbortOrDo().then((function(){r.resetChanges(),n.props.history.pop(),avnav.android.showSettings()}))}},{name:"SettingsLayout",onClick:function(){n.handleLayoutClick()},updateFunction:function(e){return{toggle:e.toggle,visible:!e.cap||e.con}},storeKeys:{toggle:ve.gui.global.layoutEditing,cap:ve.gui.capabilities.uploadLayout,con:ve.properties.connectedMode}},{name:"SettingsAddons",onClick:function(){r.confirmAbortOrDo().then((function(){r.resetChanges(),n.props.history.push("addonconfigpage")}))},storeKeys:{visible:ve.properties.connectedMode}},{name:"SettingsSave",onClick:function(){return n.saveSettings()},visible:Oe.getData(ve.properties.connectedMode,!1)&&Oe.getData(ve.gui.capabilities.uploadSettings),overflow:!0},{name:"SettingsLoad",onClick:function(){r.confirmAbortOrDo().then((function(){r.resetChanges(),n.loadSettings()}))},visible:Oe.getData(ve.properties.connectedMode,!1)&&Oe.getData(ve.gui.capabilities.uploadSettings),overflow:!0},{name:"SettingsReload",onClick:function(){r.confirmAbortOrDo().then((function(){Re.stop(),window.location.href=window.location.href}))},storeKeys:{visible:ve.gui.global.layoutEditing},updateFunction:function(e){return{visible:!e.visible}}},Lm(n.props.history),{name:"Cancel",onClick:function(){r.leftPanelVisible()?r.confirmAbortOrDo().then((function(){n.props.history.pop()})):r.handlePanel(void 0)}}],n.resetData=n.resetData.bind(n),n.hasChanges=n.hasChanges.bind(n),n.leftPanelVisible=n.leftPanelVisible.bind(n),n.handlePanel=n.handlePanel.bind(n),n.sectionClick=n.sectionClick.bind(n),n.handleLayoutClick=n.handleLayoutClick.bind(n),n.changeItem=n.changeItem.bind(n),n.confirmAbortOrDo=n.confirmAbortOrDo.bind(n),n.MainContent=n.MainContent.bind(n),n.flattenedKeys=de.flattenedKeys(ve.properties),n.state={leftPanelVisible:!0,section:"Layer"},n.values=Lt(n,Oe.getMultiple(n.flattenedKeys)),n.defaultValues={},n.flattenedKeys.forEach((function(e){var t=de.getKeyDescriptions()[e];t&&(n.defaultValues[e]=t.defaultv)})),n}return XC(t,e),UC(t,[{key:"confirmAbortOrDo",value:function(){return this.hasChanges()?$a.confirm("discard changes?"):new Promise((function(e,t){e(0)}))}},{key:"saveSettings",value:function(){var e=this,t=Uk.create("settings"),n=Oe.getData(ve.properties.lastLoadedName).replace(/-*[0-9]*$/,""),r=W.formatDateTime(new Date).replace(/[: /]/g,"").replace(/--/g,""),o=t.nameForUpload(n+"-"+r);vn.listSettings(!0).then((function(e){return cC.createDialog(o,(function(t){for(var n in e)if(e[n].value===t)return{existing:!0};return{}}),{title:"Select Name to save settings",itemLabel:"Settings",fixedPrefix:"user."})})).then((function(t){return t&&"user."!==t?(o=t,vn.uploadSettingsData(t,vn.exportSettings(e.values.getValues(!0)),!0)):Promise.reject()})).then((function(e){Oe.storeData(ve.properties.lastLoadedName,o),ct("settings saved")})).catch((function(e){e&&ct(e)}))}},{key:"loadSettings",value:function(){var e=this;WC(this.values.getState(),Oe.getData(ve.properties.lastLoadedName)).then((function(t){return e.values.setState(t,!0)})).catch((function(e){e&&ct(e)}))}},{key:"changeItem",value:function(e,t){this.values.setValue(e.name,t)}},{key:"componentDidUpdate",value:function(e,t,n){this.props.small!==e.small&&e.small&&!this.state.leftPanelVisible&&this.setState({leftPanelVisible:!0})}},{key:"resetChanges",value:function(){this.values.setState(Oe.getMultiple(this.flattenedKeys),!0)}},{key:"handleLayoutClick",value:function(){var e=this,t=this;if(pn.isEditing())Rm.createDialog().then((function(e){t.changeItem({name:ve.properties.layoutName},pn.name)})).catch((function(e){}));else{var n=function(){pn.listLayouts().then((function(t){var n=pn.nameToBaseName(pn.name);cC.createDialog(n,(function(e){return{existing:t.indexOf(e)>=0}}),{title:"Start Layout Editor",itemLabel:"Layout",subtitle:"save changes to",fixedPrefix:"user.",allowOverwrite:!0}).then((function(t){pn.startEditing(t),e.props.history.pop()})).catch((function(){}))})).catch((function(e){ct("cannot start layout editing: "+e)}))};if(!this.hasChanges())return void n();t.confirmAbortOrDo().then((function(){e.resetChanges(),n()})).catch((function(){}))}}},{key:"resetData",value:function(){var e=y()({},this.defaultValues);this.values.setState(e,!0)}},{key:"hasChanges",value:function(){return this.values.isChanged()}},{key:"leftPanelVisible",value:function(){return this.state.leftPanelVisible}},{key:"handlePanel",value:function(e){void 0===e?this.setState({leftPanelVisible:!0}):this.setState({leftPanelVisible:!this.props.small,section:e})}},{key:"sectionClick",value:function(e){this.handlePanel(e.name)}},{key:"componentDidMount",value:function(){}},{key:"MainContent",value:function(e){var t=this,n=e.leftPanelVisible,r=!e.small||!e.leftPanelVisible,o="sectionList";r||(o+=" expand");var i=e.section||"Layer",a=[];for(var s in QC){var l=eS[s];if(void 0===l||l()){var u={name:s};s===i&&(u.activeItem=!0),a.push(u)}}var c=!1;a.forEach((function(e){e.name===i&&(c=!0)})),c||(i=a[0].name,a[0].activeItem=!0);var p=[],f={};for(var h in QC)for(var m in QC[h]){var d=QC[h][m];if(void 0===$C[d]||$C[d](t.values.getValues())){var v=de.getKeyDescriptions()[d],g=t.values.getValue(d),b="listEntry";if(g===this.defaultValues[d]?b+=" defaultValue":(f[h]||(f[h]={}),f[h].isDefault=!1),this.values.isItemChanged(d)&&(b+=" changed",f[h]||(f[h]={}),f[h].isChanged=!0),vn.isPrefixProperty(d)&&(b+=" prefix"),h===i){var w=y()({},v,{name:d,value:g,className:b});p.push(w)}}}return a.forEach((function(e){var t="listEntry";(f[e.name]||{}).isChanged&&(t+=" changed"),!1!==(f[e.name]||{}).isDefault&&(t+=" defaultValue"),e.className=t})),Ue.createElement("div",{className:"leftSection"},n?Ue.createElement(Ea,{className:o,scrollable:!0,itemClass:tS,onItemClick:t.sectionClick,itemList:a}):null,r?Ue.createElement(Ea,{className:"settingsList",scrollable:!0,itemCreator:lS,itemList:p,onItemClick:t.changeItem}):null)}},{key:"render",value:function(){var e=this,t=this.MainContent;return Ue.createElement(bm,HC({},e.props,{id:"settingspage",mainContent:Ue.createElement(t,{section:e.state.section,leftPanelVisible:e.state.leftPanelVisible,small:e.props.small}),buttonList:e.buttons,title:"Settings"+(e.props.small&&!e.state.leftPanelVisible?" "+e.state.section:"")}))}}])}(Ue.Component);cS.propTypes=bm.pageProperties;var pS=cS;function fS(e){return fS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fS(e)}function hS(){return hS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},hS.apply(null,arguments)}function mS(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,dS(r.key),r)}}function dS(e){var t=function(e,t){if("object"!=fS(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=fS(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==fS(t)?t:t+""}function vS(e,t,n){return t=gS(t),function(e,t){if(t&&("object"==fS(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,yS()?Reflect.construct(t,n||[],gS(e).constructor):t.apply(e,n))}function yS(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(yS=function(){return!!e})()}function gS(e){return gS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},gS(e)}function bS(e,t){return bS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},bS(e,t)}var wS=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=vS(this,t,[e])).state={eula:void 0},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&bS(e,t)}(t,e),n=t,(r=[{key:"componentDidMount",value:function(){var e=this;wt.getHtmlOrText(this.props.eulaUrl).then((function(t){e.setState({eula:t})})).catch((function(e){}))}},{key:"render",value:function(){var e=this;return Ue.createElement("div",{className:"inner EulaDialog"},Ue.createElement("h3",{className:"dialogTitle"},"EULA"),Ue.createElement("div",{className:"dialogRow"},this.props.name),Ue.createElement("div",{className:"dialogRow eulaContainer"},this.state.eula?Ue.createElement("div",{className:"eula",dangerouslySetInnerHTML:{__html:this.state.eula}}):Ue.createElement("div",{className:"dialogRow"},"Loading EULA")),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"cancel",onClick:this.props.closeCallback},"Cancel"),Ue.createElement(Ia,{name:"ok",onClick:function(){e.props.okCallback(e.state.value),e.props.closeCallback()}},"Accept")))}}])&&mS(n.prototype,r),o&&mS(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);wS.propTypes={eulaUrl:Ge().string,name:Ge().string,okCallback:Ge().func.isRequired,closeCallback:Ge().func.isRequired},wS.createDialog=function(e,t){return new Promise((function(n,r){$a.dialog((function(r){return Ue.createElement(wS,hS({},r,{okCallback:function(){n(0)},name:e,eulaUrl:t}))}),void 0,(function(){r("")}))}))};var kS=wS;function CS(e){return CS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},CS(e)}var SS=["panel","mode"];function ES(){return ES=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ES.apply(null,arguments)}function OS(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,PS(r.key),r)}}function PS(e){var t=function(e,t){if("object"!=CS(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=CS(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==CS(t)?t:t+""}function DS(e,t,n){return t=NS(t),function(e,t){if(t&&("object"==CS(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,TS()?Reflect.construct(t,n||[],NS(e).constructor):t.apply(e,n))}function TS(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(TS=function(){return!!e})()}function NS(e){return NS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},NS(e)}function RS(e,t){return RS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},RS(e,t)}var xS=0,jS=1,AS={eula:Me.EULAS,info:Me.CHARTINFO},LS=function(e,t,n){if(n==xS)return!1;var r=Fe.getItem(t)||"{}",o={};try{o=JSON.parse(r)}catch(e){base.log("unable to read state for "+t)}var i=o[e];if(void 0===i)return!0;if(n==jS)return!1;var a=void 0;try{a=new Date(i)}catch(e){}if(void 0===a)return!0;var s=new Date;return a.getDay()!=s.getDay()},IS=function(e,t){var n=Fe.getItem(t)||"{}",r={};try{r=JSON.parse(n)}catch(e){base.log("unable to read state for "+t)}r[e]=(new Date).getTime(),Fe.setItem(t,void 0,JSON.stringify(r))},MS=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);n=DS(this,t,[e]);return n.mapEvent=n.mapEvent.bind(n),n.subscribeToken=void 0,n.bottomContainer=void 0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&RS(e,t)}(t,e),n=t,r=[{key:"mapEvent",value:function(e){if(!Oe.getData(ve.gui.global.layoutEditing))return this.props.mapEventCallback(e)}},{key:"componentWillUnmount",value:function(){ml.setAisCenterMode(S.AisCenterMode.GPS),Wi.renderTo(),void 0!==this.subscribeToken&&(Wi.unsubscribe(this.subscribeToken),this.subscribeToken=void 0)}},{key:"computeScalePosition",value:function(){var e=function(e){var t=document.querySelector(".ol-scale-bar");t&&(t.style.bottom=e)};if(this.props.mapFloat){if(!this.bottomContainer)return;e(this.bottomContainer.getBoundingClientRect().height+"px")}else e("0px")}},{key:"componentDidMount",value:function(){var e=this;ml.setAisCenterMode(S.AisCenterMode.MAP),this.subscribeToken=Wi.subscribe(this.mapEvent);var t=Wi.getCurrentChartEntry()||{},n=function(){void 0!==t.infoMode&&LS(t.url,AS.info,t.infoMode)&&(ct("Chart "+t.info),IS(t.url,AS.info)),Wi.loadMap(e.refs.map,e.props.preventCenterDialog).then((function(t){e.computeScalePosition()})).catch((function(e){ct(e)}))};void 0!==t.eulaMode&&LS(t.url,AS.eula,t.eulaMode)?kS.createDialog(t.name,t.url+"/eula").then((function(){IS(t.url,AS.eula),n()})).catch((function(){ct("EULA rejected")})):n()}},{key:"componentDidUpdate",value:function(e,t,n){this.computeScalePosition()}},{key:"render",value:function(){var e=this,t=this,n=function(e){var n=e.panel,r=e.mode,o=(function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}}(e,SS),t.props.panelCreator(n));if(!o.list)return null;var i="vertical"===r||"bottomLeft"===n;return Ue.createElement(Ea,ES({},e,{className:"widgetContainer "+r+" "+n,itemCreator:function(e){return function(e,t){var n=um.createWidget(e,{mode:t,handleVisible:!Oe.getData(ve.gui.global.layoutEditing)});return"CenterDisplay"==e.name&&(n=ot(fh(n),{storeKeys:{locked:ve.map.lockPosition,editing:ve.gui.global.layoutEditing},updateFunction:function(e){return{visible:!e.locked||e.editing}}})),n}(e,r)},itemList:o.list,onItemClick:function(e,n){t.props.onItemClick(e,n,o.name,i)},onClick:function(){kv.createDialog(void 0,t.props.id,o.name,{fixPanel:!0,beginning:i,types:["!map"]})},dragdrop:Oe.getData(ve.gui.global.layoutEditing),horizontal:"horizontal"===r,onSortEnd:function(e,n){return pn.moveItem(t.props.id,o.name,e,n)}}))},r=Oe.getData(ve.properties.nightMode)?Oe.getData(ve.properties.nightChartFade,100)/100:1,o=Ue.createElement("div",{className:"map",ref:"map",style:{opacity:r}},Ue.createElement(Su,null)),i=t.props.className?t.props.className+" mapPage":"mapPage";this.props.mapFloat&&(i+=" mapFloat");var a=d.filteredAssign(bm.propTypes,t.props),s=t.props.overlayContent||null;return"function"==typeof s&&(s=s({})),Ue.createElement(bm,ES({},a,{className:i,floatContent:this.props.mapFloat?o:void 0,mainContent:Ue.createElement(Ue.Fragment,null,Ue.createElement("div",{className:"leftSection"},Ue.createElement(n,{fontSize:t.props.widgetFontSize+"px",panel:"left",mode:"vertical"}),Ue.createElement(n,{fontSize:t.props.widgetFontSize+"px",panel:"top",mode:"horizontal"}),!this.props.mapFloat&&o,s),Ue.createElement("div",{ref:function(t){e.bottomContainer=t,e.computeScalePosition()},className:"bottomSection"+(Oe.getData(ve.properties.allowTwoWidgetRows)?" twoRows":"")},Ue.createElement(n,{reverse:!0,fontSize:t.props.widgetFontSize+"px",panel:"bottomLeft",mode:"horizontal"}),Ue.createElement(n,{fontSize:t.props.widgetFontSize+"px",panel:"bottomRight",mode:"horizontal"}))),buttonList:t.props.buttonList,buttonWidthChanged:function(){Wi.updateSize()},autoHideButtons:t.props.autoHideButtons}))}}],r&&OS(n.prototype,r),o&&OS(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);MS.propertyTypes=y()({},bm.pageProperties,{buttonList:Ge().array,panelCreator:Ge().func.isRequired,onItemClick:Ge().func.isRequired,mapEventCallback:Ge().func,id:Ge().string,overlayContent:Ge().any,mapLoadCallback:Ge().func,preventCenterDialog:Ge().bool,autoHideButtons:Ge().any,widgetFontSize:Ge().number,mapFloat:Ge().bool});var _S=function(e,t){var n=Wi.getCurrentMergedOverlayConfig();if(n){var r=Wi.getCurrentChartEntry()||{};$a.dialog((function(o){var i=void 0!==Vr(r)&&Oe.getData(ve.properties.connectedMode,!1);return Ue.createElement(gd,ES({},o,{chartName:e||r.name,title:"Active Overlays",current:n,updateCallback:function(e){Wi.updateOverlayConfig(e),t&&t(e)},resetCallback:function(){Wi.resetOverlayConfig()},editCallback:i?function(){return gd.createDialog(r,(function(e){e&&Wi.loadMap(void 0,!0).then((function(){Wi.resetOverlayConfig()}))})),!0}:void 0,preventEdit:!0}))}))}},FS=ot(MS,{storeKeys:pn.getStoreKeys({widgetFontSize:ve.properties.widgetFontSize,mapFloat:ve.properties.mapFloat})});FS.PANELS=["left","top","bottomLeft","bottomRight"],FS.propertyTypes=MS.propertyTypes;var BS=FS;function WS(e){return WS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},WS(e)}function HS(){return HS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},HS.apply(null,arguments)}function VS(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,KS(r.key),r)}}function KS(e){var t=function(e,t){if("object"!=WS(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=WS(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==WS(t)?t:t+""}function US(e,t,n){return t=zS(t),function(e,t){if(t&&("object"==WS(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,qS()?Reflect.construct(t,n||[],zS(e).constructor):t.apply(e,n))}function qS(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(qS=function(){return!!e})()}function zS(e){return zS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},zS(e)}function GS(e,t){return GS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},GS(e,t)}ml.getRoutingHandler();var ZS=[{label:"position",value:"coordinates",formatter:function(e){return W.formatLonLats({lon:e[0],lat:e[1]})}},{label:"distance",value:"coordinates",formatter:function(e){var t=Oe.getData(ve.nav.gps.position);if(Oe.getData(ve.nav.gps.valid,!1)){var n=P.computeDistance(t,new S.Point(e[0],e[1]),Oe.getData(ve.nav.routeHandler.useRhumbLine));return W.formatDistance(n.dts)+" nm"}}},{label:"bearing",value:"coordinates",formatter:function(e){var t=Oe.getData(ve.nav.gps.position);if(Oe.getData(ve.nav.gps.valid,!1)){var n=P.computeDistance(t,new S.Point(e[0],e[1]),Oe.getData(ve.nav.routeHandler.useRhumbLine));return W.formatDirection(n.course)+" °"}}},{label:"name",value:"name"},{label:"description",value:"desc",formatter:function(e,t){if(t.name!==e)return e}},{label:"time",value:"time",formatter:function(e){try{var t=new Date(e);return W.formatDateTime(t)}catch(e){}}},{label:"overlay",value:"overlayName",formatter:function(e,t){if("chart"!==t.overlayType){var n="";return t.overlayType&&(n=XS[t.overlayType]||""),n+e}}},{label:"chart",value:"overlayName",formatter:function(e,t){if("chart"===t.overlayType)return e}},{label:"symbol",value:"sym"},{label:"buoy",value:"buoy"},{label:"top",value:"top"},{label:"light",value:"light"}],XS={route:"Route: ",track:"Track: "},JS={track:lk,route:Sk},YS={track:ok,route:Ck},QS=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=US(this,t,[e])).linkAction=n.linkAction.bind(n),n.hideAction=n.hideAction.bind(n),n.extendedInfo=Lt(n,{},"trackInfo"),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&GS(e,t)}(t,e),n=t,(r=[{key:"linkAction",value:function(){if(this.props.link||this.props.htmlInfo){this.props.closeCallback();var e=this.props.link;this.props.htmlInfo?this.props.history.push("viewpage",{html:this.props.htmlInfo,name:this.props.name||"featureInfo"}):this.props.history.push("viewpage",{url:e,name:this.props.name,useIframe:!0})}}},{key:"hideAction",value:function(){this.props.overlaySource&&(this.props.closeCallback(),this.props.overlaySource.setEnabled(!1,!0))}},{key:"componentDidMount",value:function(){var e=this,t=JS[this.props.overlayType],n=this.props.nextTarget?this.props.nextTarget:this.props.coordinates;t&&t(this.props.overlayName,new S.WayPoint(n[0],n[1])).then((function(t){e.extendedInfo.setState(t,!0)})).catch((function(e){return ct(e)}))}},{key:"infoRowDisplay",value:function(e,t){var n=t[e.value];return void 0===n?null:(e.formatter&&(n=e.formatter(n,t)),void 0===n?null:Ue.createElement(Qa,{label:e.label,value:n}))}},{key:"render",value:function(){var e=this,t=this.props.link||this.props.htmlInfo,n=YS[this.props.overlayType],r=y()({},this.props,this.extendedInfo.getState());return Ue.createElement("div",{className:"FeatureInfoDialog flexInner"},Ue.createElement("h3",{className:"dialogTitle"},this.props.icon&&Ue.createElement("span",{className:"icon",style:{backgroundImage:"url('"+this.props.icon+"')"}}),"Feature Info"),ZS.map((function(t){return e.infoRowDisplay(t,e.props)})),n&&n.map((function(t){return e.infoRowDisplay(t,e.extendedInfo.getState())})),this.props.additionalInfoRows&&this.props.additionalInfoRows.map((function(t){return e.infoRowDisplay(t,r)})),Ue.createElement("div",{className:"dialogButtons"},this.props.additionalActions&&this.props.additionalActions.map((function(t){return"function"==typeof t.condition&&!t.condition(r)||void 0!==t.condition&&!t.condition?null:Ue.createElement(Ia,{name:t.name,onClick:function(){e.props.closeCallback(),t.onClick(r)}},t.label)})),t&&Ue.createElement(Ia,{name:"info",onClick:this.linkAction},"Info"),this.props.overlaySource&&Ue.createElement(Ia,{name:"hide",onClick:this.hideAction},"Hide"),Ue.createElement(Ia,{name:"cancel",onClick:this.props.closeCallback},"Cancel")))}}])&&VS(n.prototype,r),o&&VS(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);QS.propTypes={history:Ge().object.isRequired,info:Ge().string,link:Ge().string,coordinates:Ge().array,nextTarget:Ge().array,overlayName:Ge().string,overlayType:Ge().string,overlayUrl:Ge().string,additionalActions:Ge().array,additionalInfoRows:Ge().array},QS.showDialog=function(e,t,n){return n||(n=$a.dialog),n((function(n){return Ue.createElement(QS,HS({},t,{history:e},n))}))};var $S=QS;function eE(e){return eE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},eE(e)}function tE(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function nE(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,oE(r.key),r)}}function rE(e,t,n){return t&&nE(e.prototype,t),n&&nE(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function oE(e){var t=function(e,t){if("object"!=eE(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=eE(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==eE(t)?t:t+""}function iE(e,t,n){return t=sE(t),function(e,t){if(t&&("object"==eE(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,aE()?Reflect.construct(t,n||[],sE(e).constructor):t.apply(e,n))}function aE(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(aE=function(){return!!e})()}function sE(e){return sE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},sE(e)}function lE(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&uE(e,t)}function uE(e,t){return uE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},uE(e,t)}function cE(){return cE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},cE.apply(null,arguments)}var pE=ml.getRoutingHandler(),fE=new $n($n.MODES.ACTIVE),hE="navpage",mE=function(e){return pn.getPanelData(hE,e,pn.getOptionValues([pn.OPTIONS.SMALL,pn.OPTIONS.ANCHOR]))},dE=function(e){var t=mE(e);if(t&&t.list){var n=Oe.getData(ve.gui.global.layoutSequence),r=0;return t.list.forEach((function(e){e.key=n+"_"+r,r++})),t.list}return[]},vE=function(e,t){if(e){var n=function(n,r){var o=Ob.updateWaypoint(e,n,(function(e){ct(d.escapeHtml(e))}));return!!o&&(void 0!==t?fE.changeSelectedWaypoint(o,t):fE.changeTargetWaypoint(o),!0)};$a.dialog((function(t){return Ue.createElement(Ob,cE({},t,{waypoint:e,okCallback:n}))}))}},yE=function(){if(Oe.getData(ve.nav.gps.valid)){var e=Oe.getData(ve.nav.gps.position);if(e)return Wi.setBoatOffset(e)}},gE=function(){Wi.setGpsLock(!1),void 0!==Oe.getData(ve.nav.anchor.watchDistance)?Wi.setCenter(fE.getCurrentFrom()):Wi.setCenter(fE.hasRoute()?fE.getPointAt():fE.getCurrentTarget())},bE=function(e){if(e){var t=Oe.getData(ve.map.centerPosition),n=fE.getCurrentTarget(),r=new S.WayPoint;return n&&n.name&&n.name!==S.WayPoint.MOB?r.name=n.name:r.name="Marker",r.routeName=void 0,t.assign(r),void pE.wpOn(r)}pE.routeOff(),Wi.triggerRender()},wE="overlay",kE=function(e){function t(e){var n;return tE(this,t),(n=iE(this,t,[e])).state={items:n.getCurrent()},n.sequence=It.storeHelper(n,(function(){n.setState({items:n.getCurrent()})}),[ve.gui.global.layoutSequence]),n}return lE(t,e),rE(t,[{key:"getCurrent",value:function(){var e=dE(wE),t=0,n=[];return e.forEach((function(e){n.push(y()({index:t},e)),t++})),n}},{key:"onItemClick",value:function(e){kv.createDialog(e,hE,wE,{fixPanel:!0,types:["map"]})}},{key:"render",value:function(){var e=this;return Ue.createElement("div",{className:"MapWidgetsDialog"},Ue.createElement("h2",null,"Map Widgets"),this.state.items&&this.state.items.map((function(t){var n=t;return Ue.createElement("div",{className:"dialogRow listEntry",onClick:function(){return e.onItemClick(n)}},t.name)})),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"add",onClick:function(){return kv.createDialog(void 0,hE,wE,{fixPanel:!0,types:["map"]})}},"Add"),Ue.createElement(Ia,{name:"cancel",onClick:this.props.closeCallback},"Close")))}}])}(Ue.Component),CE=function(e){function t(e){var n;tE(this,t);var r=n=iE(this,t,[e]);return n.getButtons=n.getButtons.bind(n),n.mapEvent=n.mapEvent.bind(n),n.state={showWpButtons:!1,sequence:0},n.showWpButtons=n.showWpButtons.bind(n),n.widgetClick=n.widgetClick.bind(n),n.sequence=It.storeHelper(n,(function(){Wi.triggerRender()}),[ve.gui.global.layoutSequence]),Oe.storeData(ve.map.measurePosition,void 0),n.waypointButtons=[ku(),{name:"WpLocate",onClick:function(){r.wpTimer.startTimer(),gE(),n.showWpButtons(!1)}},{name:"WpEdit",onClick:function(){fE.hasRoute()?vE(fE.getPointAt(),fE.getIndex()):vE(fE.getCurrentTarget()),n.showWpButtons(!1)},storeKeys:{watchDistance:ve.nav.anchor.watchDistance},updateFunction:function(e){return{visible:!(void 0!==e.watchDistance)}}},{name:"WpGoto",storeKeys:fE.getStoreKeys({watchDistance:ve.nav.anchor.watchDistance}),updateFunction:function(e){return{visible:!(Xn.selectedIsActiveTarget(e)||void 0!==e.watchDistance)}},onClick:function(){var e=fE.getPointAt();n.showWpButtons(!1),e&&pE.wpOn(e)}},{name:"NavNext",storeKeys:fE.getStoreKeys({watchDistance:ve.nav.anchor.watchDistance}),updateFunction:function(e){return{visible:Xn.selectedIsActiveTarget(e)&&Xn.hasPointAtOffset(e,1)&&!(void 0!==e.watchDistance)}},onClick:function(){r.showWpButtons(!1),fE.moveIndex(1),pE.wpOn(fE.getPointAt())}},{name:"NavRestart",storeKeys:fE.getStoreKeys({watchDistance:ve.nav.anchor.watchDistance}),updateFunction:function(e){return{visible:Xn.hasActiveTarget(e)}},onClick:function(){r.showWpButtons(!1),pE.legRestart()}},{name:"WpNext",storeKeys:fE.getStoreKeys({watchDistance:ve.nav.anchor.watchDistance}),updateFunction:function(e){return{disabled:!Xn.hasPointAtOffset(e,1),visible:Xn.hasRoute(e)&&!(void 0!==e.watchDistance)}},onClick:function(){r.wpTimer.startTimer(),fE.moveIndex(1);var e=fE.getPointAt();Wi.setCenter(e)}},{name:"WpPrevious",storeKeys:fE.getStoreKeys({watchDistance:ve.nav.anchor.watchDistance}),updateFunction:function(e){return{disabled:!Xn.hasPointAtOffset(e,-1),visible:Xn.hasRoute(e)&&!(void 0!==e.watchDistance)}},onClick:function(){r.wpTimer.startTimer(),fE.moveIndex(-1);var e=fE.getPointAt();Wi.setCenter(e)}}],fE.setIndexToTarget(),n.wpTimer=It.lifecycleTimer(n,(function(){n.showWpButtons(!1)}),1e3*Oe.getData(ve.properties.wpButtonTimeout)),It.keyEventHandler(n,(function(e,t){if("centerToTarget"==t)return gE();"navNext"!=t?"toggleNav"==t&&bE(!fE.hasActiveTarget()):fE.hasRoute()&&pE.wpOn(fE.getNextWaypoint())}),"page",["centerToTarget","navNext","toggleNav"]),"center"===Oe.getData(ve.properties.mapLockMode)&&Wi.setBoatOffset(),n.checkChartCount=30,n.checkChartTimer=It.lifecycleTimer(n,(function(e){var t=n.needsChartLoad();t?(n.checkChartCount--,n.checkChartCount<0?n.props.history.pop():wt.getJson("?request=list&type=chart",{timeout:3*parseFloat(Oe.getData(ve.properties.networkTimeout))}).then((function(r){n.checkChartTimer.startTimer(e),(r.items||[]).forEach((function(e){e.key||(e.key=e.chartKey||e.url),e.key===t&&(Wi.setChartEntry(e),n.setState({sequence:n.state.sequence+1}))}))})).catch((function(){n.checkChartTimer.startTimer(e)}))):n.checkChartTimer.startTimer(e)}),1e3,!0),n}return lE(t,e),rE(t,[{key:"needsChartLoad",value:function(){if(!Wi.getCurrentChartEntry())return Wi.getLastChartKey()}},{key:"widgetClick",value:function(e,t,n,r){var o=pn.getPagePanels(hE),i=o.indexOf(wE);if(i>=0&&o.splice(i,1),!kv.createDialog(e,hE,n,{fixPanel:o,beginning:r,types:["!map"]}))if("AisTarget"!=e.name){if("ActiveRoute"==e.name){if(!fE.hasRoute())return;return fE.setIndexToTarget(),fE.syncTo($n.MODES.EDIT),void this.props.history.push("editroutepage")}if("Zoom"!=e.name)return n&&n.match(/^bottomLeft/)?(fE.setIndexToTarget(),void this.showWpButtons(!0)):void this.props.history.push("gpspage",{widget:e.name});Wi.checkAutoZoom(!0)}else{var a=t&&t.mmsi?t.mmsi:e.mmsi;if(!a)return;this.props.history.push("aisinfopage",{mmsi:a})}}},{key:"showWpButtons",value:function(e){e?this.wpTimer.startTimer():this.wpTimer.stopTimer(),this.setState({showWpButtons:e})}},{key:"mapEvent",value:function(e){var t=this;if(console.log("mapevent: "+e.type),e.type===Wi.EventTypes.SELECTAIS){var n=e.aisparam;if(!n)return;return n.mmsi?(this.props.history.push("aisinfopage",{mmsi:n.mmsi}),!0):void 0}if(e.type===Wi.EventTypes.FEATURE){var r=e.feature;if(!r)return;r.additionalActions=[],r.additionalInfoRows=[];var o=function(){r.nextTarget&&!r.activeRoute&&r.additionalActions.push({name:"goto",label:"Goto",onClick:function(){var e=r.nextTarget;if(e){var t=new S.WayPoint(e[0],e[1],r.name);pE.wpOn(t)}}}),$S.showDialog(t.props.history,r)};if("route"===r.overlayType&&!r.activeRoute){var i=fE.getRouteName();if("gpx"!==d.getExt(i)&&(i+=".gpx"),fE.hasActiveTarget()&&i===r.overlayName)return!1}if("track"===r.overlayType&&r.additionalActions.push({name:"toroute",label:"Convert",onClick:function(e){pk.showDialog(t.props.history,e.overlayName)}}),"route"===r.overlayType&&r.nextTarget){var a=fE.getCurrentTarget();r.activeRoute&&a&&a.lon===r.nextTarget[0]&&a.lat===r.nextTarget[1]||r.additionalActions.push({name:"routeTo",label:"Route",onClick:function(e){pE.wpOn(e.routeTarget)},condition:function(e){return e.routeTarget}}),r.additionalActions.push({name:"editRoute",label:"Edit",onClick:function(){pE.fetchRoute(r.overlayName,!1,(function(e){var n=new S.WayPoint(r.nextTarget[0],r.nextTarget[1]),o=e.findBestMatchingIdx(n);new $n($n.MODES.EDIT).setNewRoute(e,o>=0?o:void 0),t.props.history.push("editroutepage")}),(function(e){e&&ct(e)}))}}),o()}else o();return!0}}},{key:"componentWillUnmount",value:function(){Oe.storeData(ve.map.measurePosition,void 0),Wi.unregisterPageWidgets(hE)}},{key:"componentDidMount",value:function(){Wi.showEditingRoute(!1)}},{key:"getButtons",value:function(){var e=this;return[{name:"ZoomIn",onClick:function(){Wi.changeZoom(1)}},{name:"ZoomOut",onClick:function(){Wi.changeZoom(-1)}},{name:"LockPos",storeKeys:{toggle:ve.map.lockPosition},updateFunction:function(e){return e},onClick:function(){var e=Oe.getData(ve.map.lockPosition);if(!e){var t=Oe.getData(ve.properties.mapLockMode,"center");if("ask"===t)return void $a.dialog((function(e){return Ue.createElement("div",{className:"LockDialog inner"},Ue.createElement("h3",{className:"dialogTitle"},"Lock Boat"),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"current",onClick:function(){e.closeCallback(),yE()&&Wi.setGpsLock(!0)}},"Current"),Ue.createElement(Ia,{name:"center",onClick:function(){e.closeCallback(),Wi.setBoatOffset(),Wi.setGpsLock(!0)}},"Center"),Ue.createElement(Ia,{name:"cancel",onClick:function(){return e.closeCallback()}},"Cancel")))}));if("current"===t){if(!yE())return}else Wi.setBoatOffset()}Wi.setGpsLock(!e)},editDisable:!0},{name:"LockMarker",storeKeys:fE.getStoreKeys(bu),updateFunction:function(e){return{visible:!Xn.hasActiveTarget(e)&&!wu(e)}},onClick:function(){bE(!0)},editDisable:!0},ku(!0),{name:"StopNav",storeKeys:fE.getStoreKeys(),updateFunction:function(e){return{visible:Xn.hasActiveTarget(e)}},toggle:!0,onClick:function(){bE(!1)},editDisable:!0},{name:"CourseUp",storeKeys:{toggle:ve.map.courseUp},onClick:function(){Wi.setCourseUp(!Oe.getData(ve.map.courseUp,!1))},editDisable:!0},{name:"ShowRoutePanel",onClick:function(){fE.getIndex()<0&&fE.setIndexToTarget(),fE.syncTo($n.MODES.EDIT),e.props.history.push("editroutepage")},overflow:!0},{name:"NavOverlays",onClick:function(){return _S()},overflow:!0,storeKeys:{visible:ve.gui.capabilities.uploadOverlays}},{name:"GpsCenter",onClick:function(){Wi.centerToGps()},overflow:!0,editDisable:!0},{name:"Night",storeKeys:{toggle:ve.properties.nightMode,visible:ve.properties.nightModeNavPage},onClick:function(){var e=Oe.getData(ve.properties.nightMode,!1);e=!e,Oe.storeData(ve.properties.nightMode,e)},overflow:!0},{name:"Measure",storeKeys:{toggle:ve.map.measurePosition,visible:ve.properties.showMeasure},overflow:!0,onClick:function(){if(Oe.getData(ve.map.measurePosition))return Oe.storeData(ve.map.measurePosition,void 0),void Wi.triggerRender();if(!Wi.getGpsLock()){var e=Oe.getData(ve.map.centerPosition);Oe.storeData(ve.map.measurePosition,e),Wi.triggerRender()}}},Lm(this.props.history),_v.getButtonDef(hE,BS.PANELS,[pn.OPTIONS.SMALL,pn.OPTIONS.ANCHOR]),{name:"NavMapWidgets",editOnly:!0,overflow:!0,onClick:function(){return $a.dialog((function(e){return Ue.createElement(kE,e)}))}},Rm.getButtonDef(),Bd({overflow:!0}),Td.fullScreenDefinition,Vt.buttonDef(),{name:"Cancel",onClick:function(){e.props.history.pop()}}]}},{key:"registerMapWidget",value:function(e,t){Wi.registerMapWidget(hE,e,t)}},{key:"render",value:function(){var e=this,t=this,n=void 0;!Oe.getData(ve.properties.autoHideNavPage)||this.state.showWpButtons||Oe.getData(ve.gui.global.layoutEditing)||(n=1e3*Oe.getData(ve.properties.hideButtonTime,30));var r=d.filteredAssign(BS.propertyTypes,t.props),o=this.needsChartLoad();if(o){var i=Ja((function(t){return Ue.createElement("div",{className:"inner"},Ue.createElement("h3",{className:"dialogTitle"},"Waiting for chart"),Ue.createElement("div",{className:"dialogText"},o),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"cancel",onClick:function(){return e.props.history.pop()}},"Cancel")))}),(function(){return e.props.history.pop()}));return Ue.createElement(bm,cE({},r,{id:hE,buttonList:t.getButtons(),mainContent:i}))}return Ue.createElement(BS,cE({},r,{id:hE,mapEventCallback:t.mapEvent,onItemClick:t.widgetClick,panelCreator:mE,overlayContent:function(n){return Ue.createElement(Ue.Fragment,null,e.state.showWpButtons?Ue.createElement(Lu,{itemList:t.waypointButtons,className:"overlayContainer"}):null,Ue.createElement(Ea,{className:"mapWidgetContainer widgetContainer",itemCreator:function(t){var n=um.findWidget(t)||{},r=t.key;return um.createWidget(t,{handleVisible:!Oe.getData(ve.gui.global.layoutEditing),registerMap:function(t){return e.registerMapWidget({name:r,storeKeys:n.storeKeys},t)},triggerRender:function(){return Wi.triggerRender()}})},itemList:dE(wE)}))},buttonList:t.getButtons(),preventCenterDialog:(t.props.options||{}).remote,autoHideButtons:n}))}}])}(Ue.Component),SE=CE;function EE(e){return EE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},EE(e)}function OE(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function PE(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,TE(r.key),r)}}function DE(e,t,n){return t&&PE(e.prototype,t),n&&PE(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function TE(e){var t=function(e,t){if("object"!=EE(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=EE(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==EE(t)?t:t+""}function NE(e,t,n){return t=xE(t),function(e,t){if(t&&("object"==EE(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,RE()?Reflect.construct(t,n||[],xE(e).constructor):t.apply(e,n))}function RE(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(RE=function(){return!!e})()}function xE(e){return xE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},xE(e)}function jE(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&AE(e,t)}function AE(e,t){return AE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},AE(e,t)}function LE(){return LE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},LE.apply(null,arguments)}var IE=ml.getRoutingHandler(),ME="editroutepage",_E=new $n($n.MODES.EDIT),FE=new $n($n.MODES.ACTIVE),BE=function(){return(e=FE.getRouteName())&&e===_E.getRouteName()?FE:_E;var e},WE=function(e,t){if(e){var n=function(n,r){var o=Ob.updateWaypoint(e,n,(function(e){ct(d.escapeHtml(e))}));return!!o&&(BE().changeSelectedWaypoint(o,t),!0)};$a.dialog((function(t){return Ue.createElement(Ob,LE({},t,{waypoint:e,okCallback:n}))}))}},HE=[{label:"points",value:"numpoints"},{label:"length",value:"length",formatter:function(e){return W.formatDistance(e)+" nm"}}],VE=function(e){function t(e){var n;return OE(this,t),(n=NE(this,t,[e])).state={name:e.route.name,unchangedName:e.route.name,route:n.props.route?n.props.route.clone():void 0,changed:!1,nameChanged:!1,currentRoutes:[],inverted:!1},n.changeName=n.changeName.bind(n),n.dialog=Ya(n),n.loadNewRoute=n.loadNewRoute.bind(n),n}return jE(t,e),DE(t,[{key:"componentDidMount",value:function(){var e=this;IE.listRoutes(!0).then((function(t){t.sort((function(e,t){var n=e.name?e.name.toLowerCase():void 0,r=t.name?t.name.toLowerCase():void 0;return n<r?-1:n>r?1:0})),e.setState({currentRoutes:t,routesLoaded:!0})})).catch((function(e){ct(e)}))}},{key:"isActiveRoute",value:function(){var e=FE.getRouteName();return e&&this.state.unchangedName===e}},{key:"getCurrentEditor",value:function(){return this.isActiveRoute()?FE:_E}},{key:"existsRoute",value:function(e){if(!this.state.routesLoaded)return!1;"gpx"!==d.getExt(e)&&(e+=".gpx");for(var t=0;t<this.state.currentRoutes.length;t++)if(this.state.currentRoutes[t].name===e)return!0;return!1}},{key:"changeName",value:function(e){var t=e!==this.props.route.name,n={name:e,nameChanged:t};t&&(n.forceChange=!1),this.setState(n)}},{key:"save",value:function(e){var t=this;this.props.closeCallback();var n=this.props.route.name,r=this.state.route.server;if(this.state.nameChanged?this.state.route.name=this.state.name:e=!1,e){var o=FE.getRouteName();if(o&&this.state.route.name===o)return void ct("unable to copy to active route");var i=this.state.route.clone();i.server&&!Oe.getData(ve.properties.connectedMode)&&(i.server=!1),_E.setNewRoute(i)}else this.getCurrentEditor().setNewRoute(this.state.route),_E.setNewRoute(this.state.route);!e&&this.state.nameChanged&&IE.deleteRoute(n,(function(){t.done()}),(function(e){t.done(),ct(e)}),!r)}},{key:"done",value:function(){this.props.updateCallback&&this.props.updateCallback()}},{key:"delete",value:function(){var e=this;this.isActiveRoute()||$a.confirm("Really delete route "+this.state.name).then((function(){e.props.closeCallback(),IE.deleteRoute(e.state.route.name,(function(){e.getCurrentEditor().getRouteName()===e.state.route.name&&e.getCurrentEditor().removeRoute(),e.done()}),(function(e){ct(e)}),!e.state.route.server)})).catch((function(){}))}},{key:"loadNewRoute",value:function(){var e=this,t=[];this.state.currentRoutes.forEach((function(e){var n=e.name.replace(/\.gpx/,""),r=BE().getRouteName()===n;t.push({label:n,value:n,key:n,originalName:e.name,selected:r})}));var n=$a.createSelectDialog("load route",t,(function(t){t.name!==e.state.route.name&&IE.fetchRoute(t.originalName,!1,(function(t){e.setState({route:t.clone(),changed:!0,name:t.name,unchangedName:t.name,nameChanged:!1,inverted:!1})}),(function(e){ct(e)}))}));this.dialog.showDialog(n)}},{key:"render",value:function(){var e=this,t=this.existsRoute(this.state.name)&&this.state.nameChanged,n=!this.isActiveRoute()&&!this.state.nameChanged&&this.state.name!==UE,r=IE.getInfoFromRoute(this.state.route);return Ue.createElement("div",{className:"EditRouteDialog flexInnner"},Ue.createElement("h3",{className:"dialogTitle"},"Edit Route"),Ue.createElement(tu,{dialogRow:!0,label:"name",value:this.state.name,onChange:this.changeName}),t&&Ue.createElement("div",{className:"warning"},"Name already exists"),HE.map((function(e){return Qa.show(r,e)})),this.state.inverted&&Ue.createElement(Qa,{label:"",value:"inverted"}),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"empty",onClick:function(){var t=e.state.route.clone();t.points=[],e.setState({changed:!0,route:t})}},"Empty"),Ue.createElement(Ia,{name:"invert",onClick:function(){var t=e.state.route.clone();t.swap();var n=!e.state.inverted;e.setState({changed:!0,route:t,inverted:n})}},"Invert"),this.props.editAction&&Ue.createElement(Ia,{name:"edit",onClick:function(){e.props.closeCallback(),e.props.editAction()}},"Edit")),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"load",onClick:this.loadNewRoute},"Load"),n&&Ue.createElement(Ia,{name:"delete",onClick:function(){e.delete()}},"Delete"),Ue.createElement(Ia,{name:"copy",onClick:function(){return e.save(!0)},disabled:!this.state.nameChanged||t},"Save As"),Ue.createElement(Ia,{name:"cancel",onClick:this.props.closeCallback},"Cancel"),this.state.nameChanged?Ue.createElement(Ia,{name:"ok",onClick:function(){return e.save()},disabled:t},"Rename"):Ue.createElement(Ia,{name:"ok",onClick:function(){return e.save()},disabled:!this.state.changed||t},"OK")))}}])}(Ue.Component),KE=function(e){return pn.getPanelData(ME,e,pn.getOptionValues([pn.OPTIONS.SMALL]))},UE="default",qE=function(e){function t(e){var n;OE(this,t),(n=NE(this,t,[e])).hasCentered=!1,n.state={showWpButtons:!1,lastCenteredWp:void 0};return n.getButtons=n.getButtons.bind(n),n.mapEvent=n.mapEvent.bind(n),n.checkEmptyRoute(),n.wpTimer=It.lifecycleTimer(n,(function(){n.setState({showWpButtons:!1})}),1e3*Oe.getData(ve.properties.wpButtonTimeout)),IE.setCurrentRoutePage(ME),n.widgetClick=n.widgetClick.bind(n),It.storeHelperState(n,{activeRouteName:ve.nav.routeHandler.activeName,dimensions:ve.gui.global.windowDimensions}),n}return jE(t,e),DE(t,[{key:"checkRouteWritable",value:function(e){var t=this,n=BE();return!!n.isRouteWritable()||(e||$a.confirm("you cannot edit this route as you are disconnected. OK to select a new name").then((function(){n.syncTo($n.MODES.PAGE),t.props.history.push("routepage")})),!1)}},{key:"checkEmptyRoute",value:function(){_E.hasRoute()||IE.fetchRoute(UE,!0,(function(e){_E.setRouteAndIndex(e,0)}),(function(e){var t=new In.Route(UE);_E.setRouteAndIndex(t,0)}))}},{key:"showWpButtons",value:function(e){e?this.wpTimer.startTimer():this.wpTimer.stopTimer(),this.setState({showWpButtons:e})}},{key:"widgetClick",value:function(e,t,n,r){var o=this,i=BE();if("EditRoute"!==e.name)if("RoutePoints"!==e.name){if(!kv.createDialog(e,ME,n,{beginning:r,types:["!map"]}))if("bottomRight"!=n)"bottomLeft"==n&&this.showWpButtons(!0);else{if(!Oe.getData(ve.nav.gps.valid))return;var a=Oe.getData(ve.nav.gps.position);Wi.setCenter(a)}}else{if(Oe.getData(ve.gui.global.layoutEditing))return;if(t&&void 0!==t.idx){var s=i.getIndex();i.setNewIndex(t.idx);var l=this.state.lastCenteredWp;Wi.setCenter(i.getPointAt()),this.setState({lastCenteredWp:t.idx}),s==t.idx&&l==t.idx&&WE(t,t.idx)}}else{if(Oe.getData(ve.gui.global.layoutEditing))return;$a.dialog((function(e){return Ue.createElement(VE,LE({},e,{route:i.getRoute().clone(),editAction:function(){i.syncTo($n.MODES.PAGE),o.props.history.push("routepage")},updateCallback:function(){o.checkEmptyRoute()}}))}))}}},{key:"getWaypointButtons",value:function(){var e=this,t=this;return[{name:"WpLocate",onClick:function(){t.wpTimer.startTimer();var n=BE();Wi.setCenter(n.getPointAt()),e.setState({lastCenteredWp:n.getIndex()})}},{name:"WpEdit",onClick:function(){t.wpTimer.startTimer();var e=BE();WE(e.getPointAt(),e.getIndex())}},{name:"WpNext",storeKeys:BE().getStoreKeys(),updateFunction:function(e){return{disabled:!Xn.hasPointAtOffset(e,1)}},onClick:function(){t.wpTimer.startTimer();var n=BE();n.moveIndex(1),Wi.setCenter(n.getPointAt()),e.setState({lastCenteredWp:n.getIndex()})}},{name:"WpPrevious",storeKeys:BE().getStoreKeys(),updateFunction:function(e){return{disabled:!Xn.hasPointAtOffset(e,-1)}},onClick:function(){t.wpTimer.startTimer();var n=BE();n.moveIndex(-1),Wi.setCenter(n.getPointAt()),e.setState({lastCenteredWp:n.getIndex()})}}]}},{key:"insertOtherRoute",value:function(e,t,n){var r=BE(),o=r.getIndex(),i=r.getPointAt(o);if(t){var a=function(){IE.fetchRoute(e,!1,(function(e){if(e.points){for(var o=[],i=!1,a=0;a<e.points.length;a++)e.points[a].compare(t)&&(i=!0),i&&o.push(e.points[a]);r.addMultipleWaypoints(o,n)}}),(function(e){ct(e)}))};if(!i)return a();var s,l,u=o+(n?-1:1),c=r.getPointAt(u);void 0!==c&&u>=0?(s="Really insert route ${route} starting at ${start} between ${from} and ${to}?",l={route:e,start:t.name},n?(l.from=c.name,l.to=i.name):(l.from=i.name,l.to=c.name)):(s=n?"Really insert route ${route} starting at ${start} before ${current}?":"Really append route ${route} starting at ${start} after ${current}?",l={route:e,current:i.name,start:t.name}),$a.confirm(d.templateReplace(s,l)).then((function(){return a()})).catch((function(){}))}}},{key:"mapEvent",value:function(e){var t=this;console.log("mapevent: "+e.type);var n=BE();if(e.type===Wi.EventTypes.LOAD||e.type===Wi.EventTypes.RELOAD){if(this.hasCentered)return!0;if(this.props.options&&this.props.options.center&&_E.hasRoute()){var r=_E.getPointAt();r&&(this.state.lastCenteredWp=r,Wi.setCenter(r))}this.hasCentered=!0}if(e.type===Wi.EventTypes.SELECTWP)return n.setNewIndex(n.getIndexFromPoint(e.wp)),!0;if(e.type===Wi.EventTypes.FEATURE){var o=e.feature;if(!o)return;if(o.nextTarget&&this.checkRouteWritable(!0)&&(o.additionalActions=[{name:"insert",label:"Before",onClick:function(){var e=BE(),n=new S.WayPoint(o.nextTarget[0],o.nextTarget[1],o.name);Wi.setCenter(n),e.addWaypoint(n,!0),t.setState({lastCenteredWp:e.getIndex()})}},{name:"add",label:"After",onClick:function(){var e=BE(),n=new S.WayPoint(o.nextTarget[0],o.nextTarget[1],o.name);Wi.setCenter(n),e.addWaypoint(n),t.setState({lastCenteredWp:e.getIndex()})}},{name:"center",label:"Center",onClick:function(){var e=BE(),n=new S.WayPoint(o.nextTarget[0],o.nextTarget[1],o.name);Wi.setCenter(n),e.changeSelectedWaypoint(n),t.setState({lastCenteredWp:e.getIndex()})}}]),"route"===o.overlayType){var i=o.overlayName;i&&i.replace(/\.gpx$/,"")!==n.getRouteName()&&this.checkRouteWritable(!0)&&(o.additionalActions=[{name:"insert",label:"Before",onClick:function(e){t.insertOtherRoute(o.overlayName,e.routeTarget,!0)},condition:function(e){return e.routeTarget}}],n.getIndex()>=0&&n.getPointAt()&&o.additionalActions.push({name:"add",label:"Ater",onClick:function(e){t.insertOtherRoute(o.overlayName,e.routeTarget,!1)},condition:function(e){return e.routeTarget}}))}return $S.showDialog(this.props.history,o),!0}}},{key:"componentWillUnmount",value:function(){Wi.setRoutingActive(!1),Wi.setGpsLock(this.lastGpsLock,!0),IE.unsetCurrentRoutePage(ME)}},{key:"componentDidMount",value:function(){Wi.setRoutingActive(!0),Wi.showEditingRoute(!0),this.lastGpsLock=Wi.getGpsLock(),Wi.setGpsLock(!1)}},{key:"getButtons",value:function(){var e=this;return[{name:"ZoomIn",onClick:function(){Wi.changeZoom(1)}},{name:"ZoomOut",onClick:function(){Wi.changeZoom(-1)}},{name:"NavAddAfter",onClick:function(){if(e.checkRouteWritable()){var t=Wi.getCenter();if(t){var n=BE(),r=n.getPointAt();if(r)if(Wi.pixelDistance(t,r)<8)return;n.addWaypoint(t),e.setState({lastCenteredWp:n.getIndex()})}}},editDisable:!0},{name:"NavAdd",onClick:function(){if(e.checkRouteWritable()){var t=Wi.getCenter();if(t){var n=BE(),r=n.getPointAt();if(r)if(Wi.pixelDistance(t,r)<8)return;n.addWaypoint(t,!0),e.setState({lastCenteredWp:n.getIndex()})}}},editDisable:!0},{name:"NavDelete",onClick:function(){if(e.checkRouteWritable()){BE().deleteWaypoint();var t=BE().getIndex(),n=BE().getPointAt(t);n&&(Wi.setCenter(n),e.setState({lastCenteredWp:t}))}},editDisable:!0},{name:"NavToCenter",onClick:function(){if(e.checkRouteWritable()){var t=Wi.getCenter();if(t){var n=BE();n.changeSelectedWaypoint(t),e.setState({lastCenteredWp:n.getIndex()})}}},overflow:!0,editDisable:!0},{name:"NavGoto",onClick:function(){e.checkRouteWritable()&&vu(!0).then((function(){IE.wpOn(BE().getPointAt()),e.props.history.pop()})).catch((function(){}))},editDisable:!0,overflow:!0},{name:"NavOverlays",onClick:function(){return _S()},overflow:!0,storeKeys:{visible:ve.gui.capabilities.uploadOverlays}},Lm(this.props.history),_v.getButtonDef(ME,BS.PANELS,[pn.OPTIONS.SMALL]),Rm.getButtonDef(),{name:"Cancel",onClick:function(){e.props.history.pop()}}]}},{key:"render",value:function(){var e=this,t=(this.state.dimensions||{width:0}).width<Oe.getData(ve.properties.smallBreak)||this.state.showWpButtons?Ue.createElement(Lu,{itemList:this.getWaypointButtons(),className:"overlayContainer"}):null,n=d.filteredAssign(BS.propertyTypes,e.props);return Ue.createElement(BS,LE({},n,{id:ME,mapEventCallback:e.mapEvent,onItemClick:this.widgetClick,panelCreator:KE,buttonList:e.getButtons(),overlayContent:t}))}}])}(Ue.Component),zE=qE;function GE(e){return GE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},GE(e)}function ZE(){return ZE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ZE.apply(null,arguments)}function XE(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,JE(r.key),r)}}function JE(e){var t=function(e,t){if("object"!=GE(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=GE(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==GE(t)?t:t+""}function YE(e,t,n){return t=$E(t),function(e,t){if(t&&("object"==GE(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,QE()?Reflect.construct(t,n||[],$E(e).constructor):t.apply(e,n))}function QE(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(QE=function(){return!!e})()}function $E(e){return $E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},$E(e)}function eO(e,t){return eO=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},eO(e,t)}var tO=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=YE(this,t,[e])).state={},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&eO(e,t)}(t,e),n=t,r=[{key:"componentDidMount",value:function(){var e=this;wt.getHtmlOrText("warning.html").then((function(t){e.setState({warning:t})}),(function(e){}))}},{key:"okFunction",value:function(){var e=this;Fe.hasStorage()&&Fe.setItem(Me.LICENSE,void 0,"true");var t=de.flattenedKeys(ve.properties),n=d.getParam("defaultSettings");vn.listSettings(!0).then((function(e){if(n&&e&&e.length>0)try{for(var r=0;r<e.length;r++)if(e[r].value.match(n))return WC(Oe.getMultiple(t),e[r].value,"Select initial Settings",!0)}catch(e){i.log("unable to check for preferred settings: "+e)}return e&&e.length>1?WC(Oe.getMultiple(t),e[0].value,"Select initial Settings"):Promise.reject()}),(function(e){return Promise.reject()})).then((function(e){if(e[ve.properties.layoutName]!==Oe.getData(ve.properties.layoutName)){if(!pn.hasLoaded(e[ve.properties.layoutName]))return void Promise.reject("layout not loaded, cannot activate it");pn.activateLayout()}return Oe.storeMultiple(e),0})).then((function(t){return e.props.history.replace("mainpage")})).catch((function(t){t&&ct(t),e.props.history.replace("mainpage")}))}},{key:"render",value:function(){var e=this,t=Ue.createElement(Ue.Fragment,null,Ue.createElement("div",{className:"listContainer scrollable",ref:"frame"},Ue.createElement("div",{className:"warningFrame"},Ue.createElement("div",{className:"warningText",dangerouslySetInnerHTML:{__html:this.state.warning}})),Ue.createElement("div",{className:"warningButtonContainer"},Ue.createElement(ds,{name:"WarningOK",onClick:function(){e.okFunction()}}))));return Ue.createElement(bm,ZE({},this.props,{id:"warningpage",title:"Warning",mainContent:t,buttonList:[{name:"Cancel",storeKeys:{visible:ve.gui.global.onAndroid},onClick:function(){avnav.android.goBack()}}]}))}}],r&&XE(n.prototype,r),o&&XE(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component),nO=tO;function rO(e){return rO="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rO(e)}function oO(){return oO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},oO.apply(null,arguments)}function iO(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,aO(r.key),r)}}function aO(e){var t=function(e,t){if("object"!=rO(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=rO(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==rO(t)?t:t+""}function sO(e,t,n){return t=uO(t),function(e,t){if(t&&("object"==rO(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,lO()?Reflect.construct(t,n||[],uO(e).constructor):t.apply(e,n))}function lO(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(lO=function(){return!!e})()}function uO(e){return uO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},uO(e)}function cO(e,t){return cO=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},cO(e,t)}var pO=function(e){var t="addonItem listEntry";e.invalid&&(t+=" invalid"),e.className&&(t+=" "+e.className);var n=e.source||"user";e.invalid&&(n+=", invalid"),"true"===e.newWindow&&(n+=", new window");var r=void 0!==e.originalUrl?e.originalUrl:e.url;return Ue.createElement("div",{className:t,onClick:e.onClick},Ue.createElement("img",{className:"appIcon",src:e.icon}),Ue.createElement("div",{className:"itemMain"},Ue.createElement("div",{className:"info"},r),e.title&&Ue.createElement("div",{className:"itemTitle"},e.title),Ue.createElement("div",{className:"sourceInfo"},n)),!e.invalid&&Ue.createElement(ds,{name:"AddonConfigView",className:"smallButton",onClick:function(t){t.preventDefault(),t.stopPropagation(),"true"!==e.newWindow?e.history.push("addonpage",{addonName:e.name}):window.open(e.url,e.name)}}))},fO=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=n=sO(this,t,[e]);return n.buttons=[Lm(n.props.history),{name:"AddonConfigPlus",onClick:function(){Nw.showUserAppDialog({},{},!0).then((function(){return n.readAddons()})).catch((function(){return n.readAddons()}))}},{name:"AddonConfigAddOns",onClick:function(){r.props.history.push("addonpage")}},{name:"Cancel",onClick:function(){r.props.history.pop()}}],n.state={addOns:[]},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&cO(e,t)}(t,e),n=t,(r=[{key:"readAddons",value:function(){var e=this;_m(!0,!0).then((function(t){e.setState({addOns:t})})).catch((function(){}))}},{key:"componentDidMount",value:function(){this.readAddons()}},{key:"render",value:function(){var e=this,t=function(t){return Ue.createElement(Ea,{className:"addonItems",scrollable:!0,itemList:t.items,itemClass:function(t){return Ue.createElement(pO,oO({},t,{history:e.props.history}))},onItemClick:function(t){var n=void 0!==t.originalUrl?t.originalUrl:t.url;Nw.showUserAppDialog(y()(t,{url:n}),{name:t.name},!0).then((function(){return e.readAddons()})).catch((function(){return e.readAddons()}))}})};return Ue.createElement(bm,oO({},e.props,{id:"addonconfigpage",title:"Configure UserApps",mainContent:Ue.createElement(t,{items:e.state.addOns}),buttonList:e.buttons}))}}])&&iO(n.prototype,r),o&&iO(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component),hO=fO;function mO(e){return mO="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mO(e)}function dO(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,vO(r.key),r)}}function vO(e){var t=function(e,t){if("object"!=mO(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=mO(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==mO(t)?t:t+""}function yO(e,t,n){return t=bO(t),function(e,t){if(t&&("object"==mO(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,gO()?Reflect.construct(t,n||[],bO(e).constructor):t.apply(e,n))}function gO(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(gO=function(){return!!e})()}function bO(e){return bO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},bO(e)}function wO(e,t){return wO=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},wO(e,t)}function kO(){return kO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},kO.apply(null,arguments)}var CO=function(e){var t=Oe.getData(ve.properties.connectedMode);return Ue.createElement("div",{className:"status"},Ue.createElement("span",{className:"itemLabel"},"Converter"),e.main&&Ue.createElement(Dg,kO({},e.main,{name:"scanner",forceEdit:!0,sub:!0,showEditDialog:e.showScannerDialog})),e.converter&&Ue.createElement(Dg,kO({},e.converter,{connected:!0,forceEdit:t,showEditDialog:e.showConverterDialog,sub:!0})))},SO=function(e){var t=Oe.getData(ve.properties.connectedMode);return Ue.createElement("div",{className:"status"},Ue.createElement(Dg,kO({},e,{canEdit:t,connected:!0,id:e.name,name:e.name.replace(/^conv:/,"")})),Ue.createElement("div",{className:"itemInfo"},e.basename),e.converter&&Ue.createElement("div",{className:"itemInfo"},Ue.createElement("span",{className:"label"},"converter:"),Ue.createElement("span",{className:"value"},e.converter)),void 0!==e.realname&&Ue.createElement("div",{className:"itemInfo"},Ue.createElement("span",{className:"label"},"linked name:"),Ue.createElement("span",{className:"value"},e.realname)))},EO=function(e){var t="NMEA"===e.status;return Ue.createElement("div",{className:"importStatusDialog flexInner"},Ue.createElement("h3",{className:"dialogTitle"},e.name),Ue.createElement("div",{className:"dialogRow"},Ue.createElement("span",{className:"itemInfo"},e.info)),Ue.createElement("div",{className:"dialogRow"},Ue.createElement("span",{className:"inputLabel"},"file"),Ue.createElement("span",{className:"itemInfo"},e.basename)),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"delete",onClick:function(){wt.getJson({type:"import",request:"delete",name:e.name}).then((function(t){e.closeCallback()})).catch((function(e){return ct("unable to delete "+e,5e3)}))}},"Delete"),!t&&Ue.createElement(Ia,{name:"disable",onClick:function(){wt.getJson({type:"import",request:"api",command:"disable",name:e.name}).then((function(t){e.closeCallback()})).catch((function(e){return ct("unable to disable "+e,5e3)}))}},"Disable"),t&&Ue.createElement(Ia,{name:"stop",onClick:function(){wt.getJson({type:"import",request:"api",command:"cancel",name:e.name}).then((function(t){e.closeCallback()})).catch((function(e){return ct("unable to stop "+e,5e3)}))}},"Stop"),!t&&Ue.createElement(Ia,{name:"restart",onClick:function(){wt.getJson({type:"import",request:"api",command:"restart",name:e.name}).then((function(t){e.closeCallback()})).catch((function(e){return ct("unable to restart "+e,5e3)}))}},"Restart"),e.canDownload&&Ue.createElement(Ia,{name:"download",onClick:function(){e.download(e.name),e.closeCallback()}},"Download"),e.hasLog&&Ue.createElement(Ia,{name:"log",onClick:function(){e.logCallback(e.name),e.closeCallback()}},"Log"),Ue.createElement(Ia,{name:"cancel",onClick:function(){e.closeCallback()}},"Cancel")))},OO=function(e){var t="NMEA"===e.status;return Ue.createElement("div",{className:"importConverterDialog flexInner"},Ue.createElement("h3",{className:"dialogTitle"},"Converter"),Ue.createElement("div",{className:"dialogRow childStatus"},Ue.createElement("img",{src:Og(e.status)}),Ue.createElement("span",{className:"itemInfo"},e.info)),Ue.createElement("div",{className:"dialogButtons"},t&&Ue.createElement(Ia,{name:"stop",onClick:function(){wt.getJson({type:"import",request:"api",command:"cancel"}).then((function(t){e.closeCallback()})).catch((function(e){return ct("unable to stop "+e,5e3)}))}},"Stop"),t&&Ue.createElement(Ia,{name:"log",onClick:function(){e.logCallback(),e.closeCallback()}},"Log"),Ue.createElement(Ia,{name:"cancel",onClick:function(){e.closeCallback()}},"Cancel")))},PO=function(e){e.status;return Ue.createElement("div",{className:"importScannerDialog flexInner"},Ue.createElement("h3",{className:"dialogTitle"},"Scanner"),Ue.createElement("div",{className:"dialogRow childStatus"},Ue.createElement("img",{src:Og(e.status)}),Ue.createElement("span",{className:"itemInfo"},e.info)),Ue.createElement("div",{className:"dialogButtons"},Ue.createElement(Ia,{name:"rescan",onClick:function(){wt.getJson({type:"import",request:"api",command:"rescan"}).then((function(t){e.closeCallback()})).catch((function(e){return ct("unable to trigger rescan "+e,5e3)}))}},"Rescan"),Ue.createElement(Ia,{name:"cancel",onClick:function(){e.closeCallback()}},"Cancel")))},DO=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=yO(this,t,[e])).activeButtons=[{name:"DownloadPageUpload",visible:Oe.getData(ve.properties.connectedMode,!0),onClick:function(){n.setState({uploadSequence:n.state.uploadSequence+1})}}],n.buttons=[{name:"Edit",onClick:function(){n.showEditHandlerDialog()}},Lm(n.props.history),{name:"Cancel",onClick:function(){n.props.history.pop()}}],n.state={items:[],uploadSequence:0,chartImportExtensions:[],disabled:!0},n.timer=It.lifecycleTimer(n,(function(e){wt.getJson({request:"list",type:"import"}).then((function(t){n.setState({items:t.items||[],disabled:!1}),n.timer.startTimer(e)})).catch((function(t){return n.timer.startTimer(e)}))}),1e3,!0),n.showEditDialog=n.showEditDialog.bind(n),n.checkNameForUpload=n.checkNameForUpload.bind(n),n.showEditHandlerDialog=n.showEditHandlerDialog.bind(n),n.downloadFrame=void 0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&wO(e,t)}(t,e),n=t,r=[{key:"shouldComponentUpdate",value:function(e,t,n){return!p(this.state,t)}},{key:"componentDidMount",value:function(){var e=this;wC().then((function(t){return e.setState({chartImportExtensions:t})}))}},{key:"showEditHandlerDialog",value:function(){var e=this;dg.createDialog(void 0,void 0,(function(){e.setState({items:[]})}),"AVNImporter")}},{key:"showConverterDialog",value:function(e){var t=this;$a.dialog((function(n){return Ue.createElement(OO,kO({},n,e,{logCallback:function(){if(t.downloadFrame){var e=Oe.getData(ve.properties.navUrl)+"?request=api&type=import&command=getlog&name=_current";$a.dialog((function(t){return Ue.createElement(Sg,kO({baseUrl:e,title:"Converter"},t))}))}}}))}))}},{key:"showScannerDialog",value:function(e){$a.dialog((function(t){return Ue.createElement(PO,kO({},t,e))}))}},{key:"showImportDialog",value:function(e){var t=this;$a.dialog((function(n){return Ue.createElement(EO,kO({},n,e,{logCallback:function(n){if(t.downloadFrame){var r=Oe.getData(ve.properties.navUrl)+"?request=api&type=import&command=getlog&name="+encodeURIComponent(n);$a.dialog((function(t){return Ue.createElement(Sg,kO({baseUrl:r,title:e.name},t))}))}},download:function(e){if(t.downloadFrame){var n=Oe.getData(ve.properties.navUrl)+"?request=download&type=import&name="+encodeURIComponent(e);t.downloadFrame.src=n}}}))}))}},{key:"showEditDialog",value:function(e,t,n){if(this.state.items)for(var r=0;r<this.state.items.length;r++)if(this.state.items[r].name===t)return void this.showImportDialog(this.state.items[r])}},{key:"checkNameForUpload",value:function(e){var t=this;return new Promise((function(n,r){var o=d.getExt(e),i=kC(o,t.state.chartImportExtensions);i.allow?$a.dialog((function(o){return Ue.createElement(CC,kO({},o,{allowNameChange:!0,okFunction:function(e,r){r!==t.state.importSubDir&&t.setState({importSubDir:r}),n({name:e.name,type:"import",uploadParameters:{subdir:r}})},cancelFunction:function(){return r("canceled")},name:e,allowSubDir:i.subdir,subdir:t.state.importSubDir}))})):r("unknown chart type "+o)}))}},{key:"render",value:function(){var e,t=this,n=this,r={};(this.state.items||[]).forEach((function(e){"main"!==e.name&&"converter"!==e.name||(r[e.name]=e)}));var o=!this.state.disabled&&r.main;return e=o?Ue.createElement(Ue.Fragment,null,Ue.createElement(CO,kO({},r,{showConverterDialog:function(){return t.showConverterDialog(r.converter)},showScannerDialog:function(){return t.showScannerDialog(r.main)}})),Ue.createElement(Ea,{itemList:this.state.items,itemCreator:function(e){return e.name&&e.name.match(/^conv:/)?function(e){return Ue.createElement(SO,kO({},e,{showEditDialog:t.showEditDialog}))}:null}}),Ue.createElement("iframe",{className:"downloadFrame",onLoad:function(e){var t=e.target.contentDocument.body.textContent;t&&ct(t)},src:void 0,ref:function(e){return t.downloadFrame=e}})):Ue.createElement("div",{className:"importerInfo"},"Importer inactive"),Ue.createElement(Ue.Fragment,null,Ue.createElement(bm,kO({},n.props,{id:"importerpage",title:"Chart Converter",mainContent:e,buttonList:o?n.activeButtons.concat(n.buttons):n.buttons})),Ue.createElement(iw,{local:!1,type:"chart",doneCallback:function(){},errorCallback:function(e){e&&ct(e)},uploadSequence:this.state.uploadSequence,checkNameCallback:this.checkNameForUpload}))}}],r&&dO(n.prototype,r),o&&dO(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component),TO=DO;function NO(e){return NO="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},NO(e)}function RO(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,xO(r.key),r)}}function xO(e){var t=function(e,t){if("object"!=NO(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=NO(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==NO(t)?t:t+""}function jO(e,t,n){return t=LO(t),function(e,t){if(t&&("object"==NO(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,AO()?Reflect.construct(t,n||[],LO(e).constructor):t.apply(e,n))}function AO(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(AO=function(){return!!e})()}function LO(e){return LO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},LO(e)}function IO(e,t){return IO=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},IO(e,t)}var MO=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=jO(this,t,[e])).state={initialized:!1},n.repeatCount=0,n.checkSound=n.checkSound.bind(n),n.askForSound=n.askForSound.bind(n),n.playerFinished=n.playerFinished.bind(n),n.volume=Oe.getData(ve.properties.alarmVolume,50),n.dataChanged=n.dataChanged.bind(n),Oe.register(n.dataChanged,[ve.properties.alarmVolume]),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&IO(e,t)}(t,e),n=t,(r=[{key:"dataChanged",value:function(){this.volume=Oe.getData(ve.properties.alarmVolume,50),this.refs.audio&&(this.refs.audio.volume=this.volume/100)}},{key:"render",value:function(){var e=this;return Ue.createElement("audio",{ref:"audio",className:"hidden",onPlaying:function(){e.state.initialized||e.setState({initialized:!0})},onEnded:e.playerFinished,volume:e.volume})}},{key:"askForSound",value:function(){var e=this;this.state.initialized||this.refs.audio&&ct("click to allow sounds",6e4,(function(){e.setState({initialized:!0}),e.refs.audio.play()}))}},{key:"playerFinished",value:function(){if(this.repeatCount>0){if(this.repeatCount--,!this.refs.audio)return;this.refs.audio.play()}}},{key:"checkSound",value:function(){if(this.refs.audio){var e=void 0===this.props.enabled||this.props.enabled,t=e?this.props.src:void 0;if(this.repeatCount=this.props.repeat,t||this.state.initialized||!e||(t=vn.getProperties().silenceSound,this.repeatCount=1e4),void 0===this.repeatCount&&(this.repeatCount=1e4),!t)return this.refs.audio.pause(),void this.refs.audio.removeAttribute("src");this.refs.audio.src=t;try{this.refs.audio.play().catch(this.askForSound)}catch(e){this.askForSound()}}}},{key:"componentDidMount",value:function(){this.checkSound()}},{key:"componentDidUpdate",value:function(){this.checkSound()}},{key:"componentWillUnmount",value:function(){Oe.deregister(this.dataChanged)}},{key:"shouldComponentUpdate",value:function(e,t){return!f(this.state,t)||!f(this.props,e)}}])&&RO(n.prototype,r),o&&RO(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(Ue.Component);function _O(e){return _O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_O(e)}function FO(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function BO(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,XO(r.key),r)}}function WO(e,t,n){return t&&BO(e.prototype,t),n&&BO(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function HO(e,t,n){return t=KO(t),function(e,t){if(t&&("object"==_O(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,VO()?Reflect.construct(t,n||[],KO(e).constructor):t.apply(e,n))}function VO(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(VO=function(){return!!e})()}function KO(e){return KO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},KO(e)}function UO(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&qO(e,t)}function qO(e,t){return qO=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},qO(e,t)}function zO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function GO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zO(Object(n),!0).forEach((function(t){ZO(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zO(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ZO(e,t,n){return(t=XO(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function XO(e){var t=function(e,t){if("object"!=_O(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=_O(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==_O(t)?t:t+""}MO.propTypes={src:Ge().string,repeat:Ge().number,enabled:Ge().bool};var JO=ot(MO),YO={alarms:ve.nav.alarms.all,enabled:ve.properties.localAlarmSound,gui:ve.gui.global.soundEnabled},QO=function(e){var t={src:void 0,repeat:void 0};if(!e.enabled||!e.gui)return GO({enabled:!1},t);if(!e.alarms)return GO({enabled:!0},t);var n=il.sortedActiveAlarms(e.alarms);return n.length>0?il.getAlarmSound(n[0]):GO({enabled:!0},t)},$O=function(e){function t(e){return FO(this,t),HO(this,t,[e])}return UO(t,e),WO(t,[{key:"render",value:function(){return Ue.createElement("h1",null,"Unknown page")}}])}(Ue.Component),eP={mainpage:function(e){function t(e){return FO(this,t),HO(this,t,[e])}return UO(t,e),WO(t,[{key:"render",value:function(){return Ue.createElement($d,this.props)}},{key:"componentDidMount",value:function(){this.props.history.reset()}}])}(Ue.Component),infopage:cv,gpspage:ny,aispage:gy,aisinfopage:Iy,addonpage:qy,addresspage:og,statuspage:qg,wpapage:sb,routepage:Xb,downloadpage:BC,settingspage:pS,navpage:SE,editroutepage:zE,warningpage:nO,viewpage:ww,addonconfigpage:hO,importerpage:TO},tP=function(e){function t(e){return FO(this,t),HO(this,t,[e])}return UO(t,e),WO(t,[{key:"render",value:function(){var e=eP[this.props.location];void 0===e&&(e=$O);var t="pageFrame "+(this.props.nightMode?"nightMode":""),n={};this.props.nightMode&&(n.opacity=Oe.getData(ve.properties.nightFade)/100);var r=(this.props.dimensions||{}).width<Oe.getData(ve.properties.smallBreak);return Ue.createElement("div",{className:t},this.props.dim?Ue.createElement("div",{className:"dimm",style:{opacity:.5},onClick:function(){return Vt.trigger()}}):null,Ue.createElement(e,{style:n,options:this.props.options,location:this.props.location,history:this.props.history,small:r,isEditing:this.props.isEditing}))}}])}(Ue.Component),nP=ot(tP),rP=function(e){var t={fontSize:e.fontSize/4+"px"};return Ue.createElement("div",{className:"buttonSizer",style:t,ref:e.refFunction},Ue.createElement(ds,{name:"dummy"}))},oP={},iP=function(e){function t(e){var n;if(FO(this,t),(n=HO(this,t,[e])).checkSizes=n.checkSizes.bind(n),n.keyDown=n.keyDown.bind(n),n.state={error:0},n.history=new os,n.buttonSizer=null,n.serverVersion=Oe.getData(ve.nav.gps.version),Oe.storeData(ve.gui.global.onAndroid,!1,!0),window.avnavAndroid){i.log("android integration enabled"),Oe.storeData(ve.gui.global.onAndroid,!0,!0),avnav.android=window.avnavAndroid,Oe.storeData(ve.properties.routingServerError,!1,!0),Oe.storeData(ve.properties.connectedMode,!0,!0),avnav.version=avnav.android.getVersion(),avnav.android.applicationStarted();var r=function(e,t){try{avnav.android.acceptEvent(e,t)}catch(e){}if("backPressed"==e&&!Oe.getData(ve.gui.global.ignoreAndroidBack)){if("mainpage"==n.history.currentLocation())return void avnav.android.goBack();n.history.pop()}"propertyChange"==e&&Oe.storeData(ve.gui.global.propertySequence,Oe.getData(ve.gui.global.propertySequence,0)+1),"reloadData"==e&&Oe.storeData(ve.gui.global.reloadSequence,Oe.getData(ve.gui.global.reloadSequence,0)+1),Pt.handleEvent(e,t)};avnav.android.receiveEvent=r,Ke.subscribe("android",(function(e){r(e.key,e.param)}))}Ke.subscribe("stopLeave",(function(){Oe.getData(ve.gui.global.layoutEditing)||Re.stop()})),Td.init(),Vt.init();var o="warningpage",a=!0;Fe.hasStorage()&&"true"===Fe.getItem(Me.LICENSE)&&(o="mainpage",a=!1),a&&vn.firstStart(),ml.startQuery(),n.pendingActions=[],n.pendingActions.push(wt.getJson("images.json",{useNavUrl:!1,checkOk:!1}).then((function(e){Wi.setImageStyles(e)})).catch((function(e){ct("unable to load image definitions")})).then((function(){return wt.getJson("/user/viewer/images.json",{useNavUrl:!1,checkOk:!1}).then((function(e){Wi.setImageStyles(e)})).catch((function(e){ct("unable to load user image definitions: "+e)}))}))),n.pendingActions.push(wt.getJson("keys.json",{useNavUrl:!1,checkOk:!1}).then((function(e){rn.registerMappings(e)})).catch((function(e){ct("unable to load key mappings: "+e)})).then((function(){return wt.getJson("/user/viewer/keys.json",{useNavUrl:!1,checkOk:!1}).then((function(e){rn.mergeMappings(2,e)}),(function(e){}))}))),n.pendingActions.push(wt.getJson("/user/viewer/splitkeys.json",{useNavUrl:!1,checkOk:!1}).then((function(e){if(void 0===e.version)throw new Error("missing version");if(void 0===e.keys)throw new Error("missing keys");vn.setPrefixKeys(e.keys),vn.resetToSaved(),vn.incrementSequence()})).catch((function(e){console.log("splitkeys.json: "+e)}))),n.pendingActions.push(pn.loadStoredLayout(!0).then((function(e){})).catch((function(e){ct(e)})));var s=Wi.getLastChartKey();if("mainpage"===o&&Oe.getData(ve.properties.startNavPage)&&s){var l=function(){n.history.push("navpage")};n.history.push(o,{noInitial:!0}),Promise.all(n.pendingActions).then((function(){return l()}),(function(){return l()}))}else n.history.push(o);return n.leftHistoryState=Lt(n,n.history.currentLocation(!0),"leftHistory"),n.history.setCallback((function(e){return n.leftHistoryState.setState(e,!0)})),It.keyEventHandler(n,(function(){Im(!0)}),"global","mobon"),It.keyEventHandler(n,(function(){Im(!1)}),"global","moboff"),It.keyEventHandler(n,(function(){Mm()}),"global","mobtoggle"),It.keyEventHandler(n,(function(){ml.getRoutingHandler().anchorOn(void 0,void 0,!0)}),"global","anchoron"),It.keyEventHandler(n,(function(){ml.getRoutingHandler().anchorOff()}),"global","anchoroff"),It.keyEventHandler(n,(function(e,t){var r=parseInt(t);"addonpage"===n.history.currentLocation()?n.history.replace("addonpage",{activeAddOn:r}):n.history.push("addonpage",{activeAddOn:r})}),"addon",["0","1","2","3","4","5","6","7"]),It.keyEventHandler(n,(function(e,t){Vt.toggle()}),"global","toggledimm"),It.keyEventHandler(n,(function(e,t){Vt.activate()}),"global","dimmon"),It.keyEventHandler(n,(function(e,t){Vt.trigger()}),"global","dimmoff"),n.newDeviceHandler=n.newDeviceHandler.bind(n),n.subscription=Pt.subscribe("deviceAdded",n.newDeviceHandler),n.remoteChannel=Xt,n.remoteChannel.start(),n.remoteChannel.subscribe(Gt.setPage,(function(e){var t=e.split(/  */);try{var r=t[0],o={};if(t.length>1&&(o=JSON.parse(t[1])),void 0===eP[r])return;n.history.setFromRemote(r,o)}catch(e){}})),It.storeHelper(n,(function(e){e.connectionLost?Oe.getData(ve.properties.connectionLostAlarm)&&il.startLocalAlarm(rl.connectionLost):il.stopAlarm(rl.connectionLost)}),{connectionLost:ve.nav.gps.connectionLost}),It.storeHelper(n,(function(e){n.checkReload()}),[ve.nav.gps.version]),n.titleSet=!1,n}return UO(t,e),WO(t,[{key:"newDeviceHandler",value:function(){try{var e=avnav.android.getAttachedDevice();if(!e)return;var t=JSON.parse(e);t.typeName&&t.initialParameters&&dg.createNewHandlerDialog(t.typeName,t.initialParameters)}catch(e){}}},{key:"componentDidCatch",value:function(e,t){oP.componentStack=(t||{}).componentStack,this.setState({error:2})}},{key:"checkSizes",value:function(){if(!Oe.getData(ve.gui.global.hasActiveInputs,!1)&&this.refs.app){var e=this.refs.app.getBoundingClientRect();if(e){var t=e.width<Oe.getData(ve.properties.smallBreak);Oe.storeData(ve.gui.global.smallDisplay,t),Oe.storeData(ve.gui.global.windowDimensions,{width:e.width,height:e.height}),this.computeButtonSizes()}}}},{key:"computeButtonSizes",value:function(){if(this.buttonSizer){var e=this.buttonSizer.getBoundingClientRect();Oe.storeMultiple({height:e.height,width:e.width},{height:ve.gui.global.computedButtonHeight,width:ve.gui.global.computedButtonWidth})}}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.keyDown);var e=window.setInterval(this.checkSizes,1e3);this.checkSizes(),this.setState({interval:e}),window.addEventListener("resize",this.checkSizes),il.start(),this.newDeviceHandler()}},{key:"componentWillUnmount",value:function(){Pt.unsubscribe(this.subscription),document.removeEventListener("keydown",this.keyDown),window.removeEventListener("resize",this.checkSizes),this.state.interval&&window.clearInterval(this.state.interval)}},{key:"keyDown",value:function(e){var t=Oe.getData(ve.gui.global.hasActiveInputs,!1);rn.handleKeyEvent(e,t)}},{key:"checkReload",value:function(){var e=this,t=Oe.getData(ve.nav.gps.version);void 0!==t&&""!==t&&(void 0!==this.serverVersion?this.serverVersion!==t&&$a.confirm("The server version has changed from "+this.serverVersion+" to "+t+". Would you like to reload?",void 0,"Server version change").then((function(){Re.stop(),window.location.replace(window.location.href)})).catch((function(){return e.serverVersion=t})):this.serverVersion=t)}},{key:"render",value:function(){var e=this;if(this.state.error){Re.stop();var t=(window.avnav||{}).version,n="VERSION:".concat(t,"\nERROR:").concat(oP.error,"\n").concat(oP.stack,"\n").concat(oP.componentStack),r="data:text/plain;charset=utf-8,"+encodeURIComponent(n);return Ue.createElement("div",{className:"errorDisplay"},Ue.createElement("h1",null,"Internal Error"),Ue.createElement("button",{className:"button",onClick:function(){return window.location.href=window.location.href}},"Reload App"),Ue.createElement("a",{className:"errorDownload button",href:r,download:"AvNavError"},"Download Error"),Ue.createElement("div",{className:"errorInfo"},n))}var o=$a.getDialogContainer,i="app";i+=" "+(this.props.layoutName||"").replace(/[^0-9a-zA-Z]/g,"_"),this.props.smallDisplay&&(i+=" smallDisplay");var a=this.leftHistoryState.getValue("location");return"warningpage"!==a?this.titleSet||(document.title="AVNav-Web",this.titleSet=!0):document.title="AVNav-Warning",Ue.createElement("div",{className:i,ref:"app",style:{fontSize:this.props.fontSize+"px"},tabIndex:"0"},Ue.createElement(nP,{storeKeys:y()({sequence:ve.gui.global.propertySequence,dimensions:ve.gui.global.windowDimensions,dim:ve.gui.global.dimActive,isEditing:ve.gui.global.layoutEditing},ve.gui.capabilities),location:a,options:this.leftHistoryState.getValue("options"),history:this.history,nightMode:this.props.nightMode}),Ue.createElement(o,{className:this.props.nightMode?"nightMode":""}),avnav.android||Oe.getData(ve.gui.global.preventAlarms)||!Oe.getData(ve.properties.localAlarmSound)?null:Ue.createElement(JO,{storeKeys:YO,updateFunction:QO}),Ue.createElement(st,null),Ue.createElement(rP,{sequence:this.props.sequence,fontSize:this.props.buttonFontSize,refFunction:function(t){e.buttonSizer=t,e.computeButtonSizes()}}))}}],[{key:"getDerivedStateFromError",value:function(e){return oP.error=e,oP.stack=(e||{}).stack,{error:1}}}])}(Ue.Component),aP=ot(iP,{storeKeys:{buttonFontSize:ve.properties.style.buttonSize,fontSize:ve.properties.baseFontSize,smallDisplay:ve.gui.global.smallDisplay,nightMode:ve.properties.nightMode,layoutName:ve.properties.layoutName,sequence:ve.gui.global.propertySequence}});function sP(e){return sP="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sP(e)}function lP(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,uP(r.key),r)}}function uP(e){var t=function(e,t){if("object"!=sP(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=sP(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==sP(t)?t:t+""}var cP=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.formatter=W},t=[{key:"log",value:function(e){i.log("API: "+e)}},{key:"registerWidget",value:function(e,t){um.registerWidget(e,t)}},{key:"formatter",value:function(){return W}},{key:"templateReplace",value:function(e,t){return d.templateReplace(e,t)}},{key:"escapeHtml",value:function(e){return d.escapeHtml(e)}},{key:"showToast",value:function(e,t){ct(e,t)}},{key:"registerFormatter",value:function(e,t){um.registerFormatter(e,t)}},{key:"registerFeatureFormatter",value:function(e,t){if(!e)throw new Error("missing name in registerFeatureFormatter");if(!t)throw new Error("missing name in registerFeatureFormatter");if("function"!=typeof t)throw new Error("formatterFunction is no function in registerFeatureFormatter");if(Fr[e])throw new Error("name "+e+" already exists in registerFeatureFormatter");Fr[e]=t}},{key:"getAvNavVersion",value:function(){var e=window.avnav.version;return e.match(/dev-/)&&(e=e.replace(/dev-/,"").replace(/[-].*/,"")),parseInt(e)}},{key:"LatLon",value:function(){return E.A}},{key:"dms",value:function(){return cb.A}}],t&&lP(e.prototype,t),n&&lP(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}(),pP=new cP,fP=function(e){var t=e,n=Lf(e.minValue,e.maxValue,10);return n&&(t.majorTicks=n),e.startHighlight?t.highlights=[{from:parseFloat(e.startHighlight),to:parseFloat(e.maxValue||200),color:e.colorHighlight}]:t.highlights=[],e.inputIsKelvin&&void 0!==e.value&&(t.value=e.value-273.15),t},hP=function(e){var t=e,n=Lf(e.minValue,e.maxValue,10);n&&(t.majorTicks=n),t.highlights=[];var r=parseFloat(e.minValue||0),o=parseFloat(e.minValue||0);return e.startDanger&&(t.highlights.push({from:parseFloat(e.minValue),to:parseFloat(e.startDanger),color:e.colorDanger}),o=r=parseFloat(e.startDanger)),e.startWarning&&(t.highlights.push({from:r,to:parseFloat(e.startWarning),color:e.colorWarning}),o=parseFloat(e.startWarning)),void 0!==e.colorOk&&t.highlights.push({from:o,to:e.maxValue||200,color:e.colorOk}),t},mP=function(){var e="radGauge_";um.registerWidget({name:e+"Compass",type:"radialGauge",unit:"°",formatter:"formatDirection",drawValue:!0,animationDuration:1e3,animationRule:"linear",minValue:0,maxValue:360,majorTicks:["N","NE","E","SE","S","SW","W","NW","N"],minorTicks:9,highlights:[],needleCircleSize:0,needleCircleOuter:!1,needleType:"line",needleStart:65,needleEnd:99,needleWidth:5,borderShadowWidth:0,valueBox:!1,ticksAngle:360,startAngle:180,animationTarget:"plate",colorPlate:"rgba(255, 255, 255, 0)"}),um.registerWidget({name:e+"Speed",type:"radialGauge",translateFunction:function(e){var t=e;if(void 0!==e.minValue&&void 0!==e.maxValue){var n=Math.floor((parseFloat(e.maxValue)-parseFloat(e.minValue))/10);n<1&&(n=1);for(var r=[],o=Math.round(e.minValue);o<=parseFloat(e.maxValue);o+=n)r.push(o);t.majorTicks=r}return e.startHighlight?t.highlights=[{from:parseFloat(e.startHighlight),to:parseFloat(e.maxValue||200),color:e.colorHighlight}]:t.highlights=[],t},formatter:"formatSpeed",minValue:0,startAngle:90,ticksAngle:180,valueBox:!1,maxValue:16,majorTicks:"0,2,4,6,8,10,12,14,16",minorTicks:2,strokeTicks:!0,highlights:[{from:6,to:16,color:"rgba(200, 50, 50, .75)"}],colorPlate:"rgba(255, 255, 255, 0)",borderShadowWidth:"0",borders:!1,needleType:"arrow",needleWidth:2,needleCircleSize:7,needleCircleOuter:!0,needleCircleInner:!1,animationDuration:1e3,animationRule:"linear"},{valueBox:!1,minValue:{type:"NUMBER",default:0},maxValue:{type:"NUMBER",default:100},colorHighlight:{type:"COLOR",default:"rgba(200, 50, 50, .75)"},startHighlight:{type:"NUMBER"}}),um.registerWidget({name:e+"Temperature",type:"radialGauge",translateFunction:fP,formatter:"formatDecimal",formatterParameters:"3,0",unit:"°C",minValue:-20,startAngle:90,ticksAngle:180,valueBox:!1,maxValue:50,majorTicks:[],minorTicks:10,strokeTicks:!0,highlights:[],colorPlate:"rgba(255, 255, 255, 0)",borderShadowWidth:"0",borders:!1,needleType:"arrow",needleWidth:2,needleCircleSize:7,needleCircleOuter:!0,needleCircleInner:!1,animationDuration:1e3,animationRule:"linear"},{formatter:!1,formatterParameters:!1,valueBox:!1,minValue:{type:"NUMBER",default:-100},maxValue:{type:"NUMBER",default:100},inputIsKelvin:{type:"BOOLEAN",default:!1},colorHighlight:{type:"COLOR",default:"rgba(200, 50, 50, .75)"},startHighlight:{type:"NUMBER",default:30}}),um.registerWidget({name:e+"Voltage",type:"radialGauge",translateFunction:hP,formatter:"formatDecimal",formatterParameters:"2,2",unit:"V",minValue:0,startAngle:90,ticksAngle:180,valueBox:!1,maxValue:18,majorTicks:[],minorTicks:10,strokeTicks:!0,highlights:[],colorPlate:"rgba(255, 255, 255, 0)",borderShadowWidth:"0",borders:!1,needleType:"arrow",needleWidth:2,needleCircleSize:7,needleCircleOuter:!0,needleCircleInner:!1,animationDuration:1e3,animationRule:"linear"},{formatter:!1,formatterParameters:!1,valueBox:!1,minValue:{type:"NUMBER",default:9},maxValue:{type:"NUMBER",default:16},startWarning:{type:"NUMBER",default:12.2},colorWarning:{type:"COLOR",default:"#e7ed0c"},startDanger:{type:"NUMBER",default:11.5},colorDanger:{type:"COLOR",default:"#ed1414"},colorOk:{type:"COLOR"}}),e="linGauge_",um.registerWidget({name:e+"Compass",type:"linearGauge",unit:"°",formatter:"formatDirection",drawValue:!1,tickSide:"right",numberSide:"right",borders:!1,barBeginCircle:0,barProgress:!1,barWidth:0,animationDuration:1e3,animationRule:"linear",minValue:0,maxValue:360,majorTicks:["0","45","90","135","180","225","270","315","360"],minorTicks:9,highlights:[],needleType:"line",needleWidth:5,needleStart:0,needleEnd:100,borderShadowWidth:0,valueBox:!1,ticksAngle:360,startAngle:180,animationTarget:"plate",colorPlate:"rgba(255, 255, 255, 0)"}),um.registerWidget({name:e+"Temperature",type:"linearGauge",unit:"°C",formatter:"formatDecimal",formatterParameters:"3,0",translateFunction:fP,drawValue:!1,tickSide:"right",numberSide:"right",borders:!1,barBeginCircle:0,barProgress:!0,animationDuration:1e3,animationRule:"linear",minValue:-20,maxValue:50,majorTicks:[],minorTicks:10,highlights:[],needleType:"line",needleWidth:5,needleStart:0,needleEnd:100,borderShadowWidth:0,valueBox:!1,colorPlate:"rgba(255, 255, 255, 0)"},{formatter:!1,formatterParameters:!1,valueBox:!1,minValue:{type:"NUMBER"},maxValue:{type:"NUMBER"},inputIsKelvin:{type:"BOOLEAN",default:!1},colorBar:{type:"COLOR",default:"#ccc"},colorBarProgress:{type:"COLOR",default:"#888"},colorHighlight:{type:"COLOR",default:"rgba(200, 50, 50, .75)"},startHighlight:{type:"NUMBER",default:30}}),um.registerWidget({name:e+"Voltage",type:"linearGauge",translateFunction:hP,formatter:"formatDecimal",formatterParameters:"2,2",unit:"V",minValue:0,valueBox:!1,maxValue:18,majorTicks:[],minorTicks:10,strokeTicks:!0,highlights:[],tickSide:"right",numberSide:"right",borders:!1,barBeginCircle:0,barProgress:!1,barWidth:0,barStrokeWidth:0,colorPlate:"rgba(255, 255, 255, 0)",borderShadowWidth:0,needleType:"line",needleWidth:4,needleStart:0,needleEnd:100,animationDuration:1e3,animationRule:"linear"},{formatter:!1,formatterParameters:!1,valueBox:!1,minValue:{type:"NUMBER",default:9},maxValue:{type:"NUMBER",default:16},startWarning:{type:"NUMBER",default:12.2},colorWarning:{type:"COLOR",default:"#e7ed0c"},startDanger:{type:"NUMBER",default:11.5},colorDanger:{type:"COLOR",default:"#ed1414"},colorOk:{type:"COLOR"}})},dP=n(92092),vP=n.n(dP);n(63363);function yP(e){var t=RegExp(e+"[^&]+").exec(window.location.search);return decodeURIComponent(t?t.toString().replace(/^[^=]+./,""):"")}function gP(){var e=yP("storePrefix");if(e&&""!==e&&Fe.setPrefix(e),Fe.hasPrefix())for(var t in Le){var n=Le[t],r=Fe.getItem(n,void 0);r||(r=Fe.getItem(n,void 0))&&Fe.setItem(n,void 0,r)}vn.resetToSaved(),vn.savePrefixedValues();var o=document.querySelector("body");o.style.display="block",vP()()&&(o.style.height="100vh",document.querySelector("html").style.height="100vh"),yP("log")&&(avnav.debugMode=!0);var a=yP("navurl");a?(Oe.storeData(ve.properties.navUrl,a,!0),Oe.storeData(ve.properties.routingServerError,!1,!0)):Oe.storeData(ve.properties.routingServerError,!0,!0);var s="readOnlyServer";yP(s)&&"true"==yP(s)&&Oe.storeData(ve.properties.connectedMode,!1,!0),"true"===yP("noCloseDialog")&&Re.stop(),"true"===yP("preventAlarms")&&Oe.storeData(ve.gui.global.preventAlarms,!0),"true"===yP("ignoreAndroidBack")&&Oe.storeData(ve.gui.global.ignoreAndroidBack,!0),"true"===yP("splitMode")&&Oe.storeData(ve.gui.global.splitMode,!0);var l=["/user/viewer/user.js"],u="addScripts";yP(u)&&yP(u).split(",").forEach((function(e){l.push(e)}));var c=function(e){var t=void 0;for(var n in e){var r=e[n];r.match(/js$/)?((t=document.createElement("script")).setAttribute("type","text/javascript"),t.setAttribute("src",r)):((t=document.createElement("link")).setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",r)),void 0!==t&&document.getElementsByTagName("head")[0].appendChild(t)}},p=function(e){qe.render(Ue.createElement(aP,null),document.getElementById("new_pages")),setTimeout((function(){vn.incrementSequence()}),1e3);var t=!1;e?wt.getJson("?request=plugins&command=list").then((function(e){e.data&&e.data.forEach((function(e){e.js&&l.push(e.js),e.css&&l.push(e.css)})),t||c(l),t=!0})).catch((function(e){ct("unable to load plugin data: "+e),t||c(l)})):c(l)};if(mP(),!Ke.setSplitFromLast()){var f={};for(var h in ve.gui.capabilities)f[h]=!1;wt.getJson("?request=capabilities").then((function(e){var t=y()({},f,e.data);Oe.storeMultiple(t,ve.gui.capabilities),p(Oe.getData(ve.gui.capabilities.plugins))})).catch((function(e){Oe.storeMultiple(f,ve.gui.capabilities),p(Oe.getData(ve.gui.capabilities.plugins))})),i.log("avnav loaded")}}yP("dimm")&&(avnav.testDim=!0),window.avnav||(window.avnav={}),window.avnav.api=pP,window.avnav.version=ev},21880:function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}(function(e){"Date"in this&&"now"in this.Date&&"getTime"in this.Date.prototype||(Date.now=function(){return(new Date).getTime()}),"requestAnimationFrame"in this||function(e){var t,n;if("performance"in this&&"now"in this.performance||(n=Date.now()),"mozRequestAnimationFrame"in e?t="moz":"webkitRequestAnimationFrame"in e&&(t="webkit"),t)e.requestAnimationFrame=function(r){return e[t+"RequestAnimationFrame"]((function(){r(n?Date.now()-n:performance.now())}))},e.cancelAnimationFrame=e[t+"CancelAnimationFrame"];else{var r=Date.now();e.requestAnimationFrame=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");var t=Date.now(),o=16+r-t;return o<0&&(o=0),r=t,setTimeout((function(){r=Date.now(),e(n?Date.now()-n:performance.now())}),o)},e.cancelAnimationFrame=function(e){clearTimeout(e)}}}(this)}).call("object"===("undefined"==typeof window?"undefined":r(window))&&window||"object"===("undefined"==typeof self?"undefined":r(self))&&self||"object"===(void 0===n.g?"undefined":r(n.g))&&n.g||{})},87019:function(e,t,n){n(34815),n(9325),window.avnav={},window.fetch=void 0,n(21880),n(90515).default()},63363:function(){}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var i=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}r.m=t,e=[],r.O=function(t,n,o,i){if(!n){var a=1/0;for(c=0;c<e.length;c++){n=e[c][0],o=e[c][1],i=e[c][2];for(var s=!0,l=0;l<n.length;l++)(!1&i||a>=i)&&Object.keys(r.O).every((function(e){return r.O[e](n[l])}))?n.splice(l--,1):(s=!1,i<a&&(a=i));if(s){e.splice(c--,1);var u=o();void 0!==u&&(t=u)}}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[n,o,i]},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},function(){var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=n[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e}(),function(){var e={792:0};r.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,i,a=n[0],s=n[1],l=n[2],u=0;if(a.some((function(t){return 0!==e[t]}))){for(o in s)r.o(s,o)&&(r.m[o]=s[o]);if(l)var c=l(r)}for(t&&t(n);u<a.length;u++)i=a[u],r.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return r.O(c)},n=self.webpackChunkavnav_viewer=self.webpackChunkavnav_viewer||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var o=r.O(void 0,[301],(function(){return r(87019)}));o=r.O(o)}();